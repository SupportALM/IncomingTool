"use strict";(self.webpackChunkincoming_tool=self.webpackChunkincoming_tool||[]).push([[544],{1453:(e,t,i)=>{i.d(t,{A:()=>p});var r=i(8613),n=i(8517),s=i(1911),l=i(5895),o=i(4199),a=i(2967),d=i(2571),c=i(8263),u=i(5557),m=i(579);const p=e=>{let{item:t,onSubmit:i,onClose:p}=e;const[h,v]=(0,r.useState)(""),[g,A]=(0,r.useState)("");return(0,m.jsxs)(n.A,{open:!0,onClose:p,maxWidth:"sm",fullWidth:!0,children:[(0,m.jsxs)(s.A,{children:[(0,m.jsx)(l.A,{variant:"h6",children:"Add Issue Update for:"}),(0,m.jsxs)(l.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]})]}),(0,m.jsxs)(o.A,{dividers:!0,children:[t.issueDescription&&(0,m.jsx)(a.A,{sx:{mb:2,p:1.5,background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:1},children:(0,m.jsxs)(l.A,{variant:"body2",children:[(0,m.jsx)("strong",{children:"Initial Issue:"})," ",t.issueDescription]})}),(0,m.jsx)(d.A,{autoFocus:!0,margin:"dense",id:"updateNote",label:"Update Note *",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:h,onChange:e=>{v(e.target.value),g&&A("")},error:!!g,helperText:g||"Enter details about the update.",placeholder:"e.g., Contacted seller, awaiting response..."})]}),(0,m.jsxs)(c.A,{sx:{padding:"16px 24px"},children:[(0,m.jsx)(u.A,{onClick:p,color:"secondary",children:"Cancel"}),(0,m.jsx)(u.A,{onClick:()=>{h.trim()?(i(h),p()):A("Please enter an update note.")},variant:"contained",color:"primary",children:"Save Update Note"})]})]})}},2630:(e,t,i)=>{i.d(t,{A:()=>f});var r=i(8613),n=i(8517),s=i(1911),l=i(5895),o=i(4199),a=i(2967),d=i(3863),c=i(5809),u=i(4553),m=i(8889),p=i(468),h=i(2571),v=i(8263),g=i(5557),A=i(579);const x=["Item Accepted / Kept As Is","Item Repaired / Refurbished","Partial Refund Received","Returned to Supplier","Disposed Of","Other"],f=e=>{let{item:t,onSubmit:i,onClose:f}=e;const[y,S]=(0,r.useState)(""),[j,b]=(0,r.useState)(""),[D,I]=(0,r.useState)("");return(0,A.jsxs)(n.A,{open:!0,onClose:f,maxWidth:"sm",fullWidth:!0,children:[(0,A.jsxs)(s.A,{children:[(0,A.jsx)(l.A,{variant:"h6",children:"Resolve Issue for:"}),(0,A.jsxs)(l.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]})]}),(0,A.jsxs)(o.A,{dividers:!0,children:[t.issueDescription&&(0,A.jsx)(a.A,{sx:{mb:2,p:1.5,background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:1},children:(0,A.jsxs)(l.A,{variant:"body2",children:[(0,A.jsx)("strong",{children:"Initial Issue:"})," ",t.issueDescription]})}),(0,A.jsxs)(d.A,{fullWidth:!0,error:!!D,sx:{mb:2},children:[(0,A.jsx)(c.A,{id:"resolution-outcome-label",children:"Resolution Outcome *"}),(0,A.jsxs)(u.A,{labelId:"resolution-outcome-label",id:"resolutionOutcome",value:y,label:"Resolution Outcome *",onChange:e=>{S(e.target.value),D&&I("")},children:[(0,A.jsx)(m.A,{value:"",disabled:!0,children:(0,A.jsx)("em",{children:"-- Select an Outcome --"})}),x.map((e=>(0,A.jsx)(m.A,{value:e,children:e},e)))]}),D&&(0,A.jsx)(p.A,{children:D})]}),(0,A.jsx)(h.A,{id:"resolutionNotes",label:"Resolution Notes (Optional)",multiline:!0,rows:3,fullWidth:!0,value:j,onChange:e=>b(e.target.value),placeholder:"e.g., Supplier issued refund, repaired screen...",variant:"outlined",sx:{mb:2}})]}),(0,A.jsxs)(v.A,{sx:{padding:"16px 24px"},children:[(0,A.jsx)(g.A,{onClick:f,color:"secondary",children:"Cancel"}),(0,A.jsx)(g.A,{onClick:()=>{I(""),y?i(y,j.trim()||void 0):I("Please select a resolution outcome.")},variant:"contained",color:"primary",children:"Save Resolution"})]})]})}},3368:(e,t,i)=>{i.d(t,{A:()=>x});var r=i(8613),n=i(8517),s=i(1911),l=i(4199),o=i(2967),a=i(2571),d=i(3287),c=i(6647),u=i(8889),m=i(5847),p=i(5303),h=i(8263),v=i(5557),g=i(7347),A=i(579);const x=e=>{let{onSave:t,onClose:i,initialData:x,firstInputRef:f}=e;const y=!!x,[S,j]=(0,r.useState)((null===x||void 0===x?void 0:x.purchaseStatus)||"Purchased"),[b,D]=(0,r.useState)((null===x||void 0===x?void 0:x.deliveryName)||""),[I,k]=(0,r.useState)((null===x||void 0===x?void 0:x.productName)||""),[C,w]=(0,r.useState)((null===x||void 0===x?void 0:x.quantity)||""),[E,N]=(0,r.useState)((null===x||void 0===x?void 0:x.pricePerItem)||""),[P,O]=(0,r.useState)((null===x||void 0===x?void 0:x.orderNumber)||""),[F,R]=(0,r.useState)((()=>(null===x||void 0===x?void 0:x.orderDate)||(new Date).toISOString().split("T")[0])),[T,U]=(0,r.useState)((null===x||void 0===x?void 0:x.seller)||""),[$,W]=(0,r.useState)((null===x||void 0===x?void 0:x.isVatRegistered)||"Unknown"),[z,L]=(0,r.useState)((null===x||void 0===x?void 0:x.destination)||""),[q,_]=(0,r.useState)((null===x||void 0===x?void 0:x.asinSku)||""),[V,G]=(0,r.useState)((null===x||void 0===x?void 0:x.acquisitionNotes)||""),[M,B]=(0,r.useState)((null===x||void 0===x?void 0:x.isFlagged)||!1),[K,H]=(0,r.useState)({});(0,r.useEffect)((()=>{x&&(j(x.purchaseStatus||"Purchased"),D(x.deliveryName||""),k(x.productName||""),w(x.quantity||""),N(x.pricePerItem||""),O(x.orderNumber||""),R(x.orderDate||(new Date).toISOString().split("T")[0]),U(x.seller||""),W(x.isVatRegistered||"Unknown"),L(x.destination||""),_(x.asinSku||""),G(x.acquisitionNotes||""),B(x.isFlagged||!1),H({}))}),[x]);const J=e=>{e.preventDefault(),console.log("AddItemForm: handleSubmit",{deliveryName:b,productName:I,quantity:C,pricePerItem:E,orderDate:F,seller:T,destination:z,acquisitionNotes:V,isFlagged:M});const i=(()=>{const e={};return b.trim()||(e.deliveryName="Delivery Name is required."),I.trim()||(e.productName="Product Name is required."),(""===C||C<=0)&&(e.quantity="Quantity must be a positive number."),(""===E||E<0)&&(e.pricePerItem="Price must be zero or positive."),F||(e.orderDate="Order Date is required."),H(e),0===Object.keys(e).length})();console.log("AddItemForm: validation result",i,K),i?(console.log("AddItemForm: form valid, calling onSave"),t({purchaseStatus:S,deliveryName:b,productName:I,quantity:Number(C),pricePerItem:Number(E),orderNumber:P||void 0,orderDate:F,seller:T||void 0,isVatRegistered:"Unknown"===$?void 0:$,destination:z||void 0,asinSku:q||void 0,acquisitionNotes:V||void 0,isFlagged:M})):console.log("AddItemForm: form invalid, errors:",K)};return(0,A.jsxs)(n.A,{open:!0,onClose:i,maxWidth:"sm",fullWidth:!0,children:[(0,A.jsx)(s.A,{children:y?"Edit Stock Item":"Add New Stock Item"}),(0,A.jsx)(l.A,{children:(0,A.jsxs)(o.A,{component:"form",onSubmit:J,id:"add-item-form",noValidate:!0,sx:{mt:1},children:[(0,A.jsx)(a.A,{inputRef:f,margin:"normal",required:!0,fullWidth:!0,id:"deliveryName",label:"Delivery Name",name:"deliveryName",value:b,onChange:e=>D(e.target.value),error:!!K.deliveryName,helperText:K.deliveryName,InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"productName",label:"Product Name",name:"productName",value:I,onChange:e=>k(e.target.value),error:!!K.productName,helperText:K.productName,InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"The common name of the item. Example: Blue Widget Model X",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"quantity",label:"Quantity",name:"quantity",type:"number",value:C,onChange:e=>w(""===e.target.value?"":Number(e.target.value)),error:!!K.quantity,helperText:K.quantity,InputProps:{inputProps:{min:1},endAdornment:(0,A.jsx)(d.A,{title:"How many units of this item are included? Example: 50",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"pricePerItem",label:"Price Per Item",name:"pricePerItem",type:"number",value:E,onChange:e=>N(""===e.target.value?"":Number(e.target.value)),error:!!K.pricePerItem,helperText:K.pricePerItem,InputProps:{inputProps:{min:0,step:.01},endAdornment:(0,A.jsx)(d.A,{title:"The cost for one single unit. Example: 12.50",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"orderDate",label:"Order Date",name:"orderDate",type:"date",value:F,onChange:e=>R(e.target.value),error:!!K.orderDate,helperText:K.orderDate,InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"The date the item was purchased or the return initiated.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"purchaseStatus",label:"Purchase Status",name:"purchaseStatus",select:!0,value:S,onChange:e=>j(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"What is the origin of this item?",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"Purchased",children:"Purchased"}),(0,A.jsx)(u.A,{value:"Ordered",children:"Ordered"}),(0,A.jsx)(u.A,{value:"Return Expected",children:"Return Expected"})]}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"orderNumber",label:"Order Number",name:"orderNumber",value:P,onChange:e=>O(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: External reference like eBay order ID or PO number. Example: 12-34567-89012",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"seller",label:"Seller / Source",name:"seller",value:T,onChange:e=>U(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Who did this item come from? Example: ebay_seller_123 or Customer Name (Return)",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"isVatRegistered",label:"Seller VAT Registered?",name:"isVatRegistered",select:!0,value:$,onChange:e=>W(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Is the seller registered for VAT?",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"Unknown",children:"Unknown"}),(0,A.jsx)(u.A,{value:"Yes",children:"Yes"}),(0,A.jsx)(u.A,{value:"No",children:"No"})]}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"destination",label:"Planned Destination",name:"destination",select:!0,value:["FBA Prep","Local Stock Shelf A","Refurbish Pile","Return to Supplier"].includes(z)?z:"Other",onChange:e=>{"Other"===e.target.value?L(""):L(e.target.value)},InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Where is this item intended to go after processing? Example: FBA Prep",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"FBA Prep",children:"FBA Prep"}),(0,A.jsx)(u.A,{value:"Local Stock Shelf A",children:"Local Stock Shelf A"}),(0,A.jsx)(u.A,{value:"Refurbish Pile",children:"Refurbish Pile"}),(0,A.jsx)(u.A,{value:"Return to Supplier",children:"Return to Supplier"}),(0,A.jsx)(u.A,{value:"Other",children:"Other (Specify Below)"})]}),""===z&&(0,A.jsx)(a.A,{margin:"dense",fullWidth:!0,id:"customDestination",label:"Specify Destination",name:"customDestination",value:z,onChange:e=>L(e.target.value),required:!0,error:!!K.destination,helperText:K.destination}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"asinSku",label:"ASIN / SKU",name:"asinSku",value:q,onChange:e=>_(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Amazon ASIN or internal SKU. Helps link inventory. Example: B0C1EXAMPLE / BLUE-WIDGET-XL",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"acquisitionNotes",label:"Acquisition Notes",name:"acquisitionNotes",value:V,onChange:e=>G(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Any specific notes from the purchase, order, or return request. Example: Seller mentioned slight scratch.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(m.A,{control:(0,A.jsx)(p.A,{id:"isFlagged",checked:M,onChange:e=>B(e.target.checked),name:"isFlagged"}),label:(0,A.jsxs)(o.A,{component:"span",sx:{display:"flex",alignItems:"center"},children:["Flag this item for follow-up",(0,A.jsx)(d.A,{title:"Check this box to mark the item with a flag for easy filtering later.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",sx:{ml:.5},children:(0,A.jsx)(g.A,{fontSize:"inherit"})})})]}),sx:{mt:1}})]})}),(0,A.jsxs)(h.A,{children:[(0,A.jsx)(v.A,{onClick:i,children:"Cancel"}),(0,A.jsx)(v.A,{type:"submit",form:"add-item-form",variant:"contained",onClick:J,children:y?"Save Changes":"Add Item"})]})]})}},3691:(e,t,i)=>{i.d(t,{A:()=>I});var r=i(8613),n=i.n(r),s=i(9550),l=i(8517),o=i(1911),a=i(4199),d=i(2967),c=i(5895),u=i(9623),m=i(5557),p=i(4225),h=i(2959),v=i(6185),g=i(549),A=i(5359),x=i(4527),f=i(8263),y=i(5929),S=i(579);const j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e||null===e||""===e?(0,S.jsx)("span",{style:{color:"#888"},children:"N/A"}):`${t}${e}${i}`},b=e=>{var t;const i=new Date(e.timestamp).toLocaleString();switch(e.type){case"CREATED":return`${i}: Item Created`;case"EDITED":return`${i}: Item Edited (${(null===(t=e.details.changedFields)||void 0===t?void 0:t.join(", "))||"details"} changed)`;case"STATUS_CHANGED":return`${i}: Status changed from ${e.details.previousStatus||"?"} to ${e.details.newStatus||"?"}`;case"FLAG_TOGGLED":return`${i}: Item ${e.details.isFlagged?"Flagged":"Unflagged"}`;case"ISSUE_REPORTED":return`${i}: Issue Reported: ${e.details.issueDescription||""}`;case"ISSUE_UPDATE_ADDED":return`${i}: Issue Update Added: ${e.details.note||""}`;case"ISSUE_RESOLVED":return`${i}: Issue Resolved (Outcome: ${e.details.resolutionOutcome||"N/A"}${e.details.note?` - Note: ${e.details.note}`:""}`;case"NOTE_ADDED":return`${i}: Note Added: ${e.details.note||""}`;default:return`${i}: Unknown action`}},D=e=>{var t,i,r,n,l,o,a,d,c,u;const m=e.timestamp instanceof s.Dc?e.timestamp.toDate().toISOString():"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),p=e.userId||"system";let h=null,v={};switch(e.action){case"item.create":h="CREATED";break;case"item.update.fields":h="EDITED";v={changedFields:e.before&&e.after?Object.keys(e.after).filter((t=>e.before&&e.after&&JSON.stringify(e.before[t])!==JSON.stringify(e.after[t]))):(null===(t=e.details)||void 0===t?void 0:t.changedFields)||["details"]};break;case"item.update.status.Delivered":h="STATUS_CHANGED",v={previousStatus:null===(i=e.before)||void 0===i?void 0:i.currentStatus,newStatus:"Delivered"};break;case"item.update.status.Archived":h="STATUS_CHANGED",v={previousStatus:null===(r=e.before)||void 0===r?void 0:r.currentStatus,newStatus:"Archived"};break;case"item.update.flag":h="FLAG_TOGGLED",v={isFlagged:null===(n=e.after)||void 0===n?void 0:n.isFlagged};break;case"item.update.issue.report":h="ISSUE_REPORTED",v={issueDescription:(null===(l=e.details)||void 0===l?void 0:l.description)||(null===(o=e.details)||void 0===o?void 0:o.issueDescription)};break;case"item.update.issue.resolve":h="ISSUE_RESOLVED",v={resolutionOutcome:null===(a=e.details)||void 0===a?void 0:a.outcome,note:null===(d=e.details)||void 0===d?void 0:d.note};break;case"item.update.issue.update":h="ISSUE_UPDATE_ADDED",v={note:null===(c=e.details)||void 0===c?void 0:c.note};break;case"item.add_note":h="NOTE_ADDED",v={note:null===(u=e.details)||void 0===u?void 0:u.note};break;default:return console.warn(`Unhandled log action type for UI mapping: ${e.action}`),null}return h?{timestamp:m,userId:p,type:h,details:v}:null},I=e=>{let{item:t,orgId:i,onClose:I,closeButtonRef:k,onActionSelected:C}=e;const[w,E]=(0,r.useState)([]),[N,P]=(0,r.useState)(!0),[O,F]=(0,r.useState)(null),R=(0,y.getAvailableActions)(t.currentStatus,t.isFlagged);return(0,r.useEffect)((()=>{if(null===t||void 0===t||!t.id||!i)return P(!1),void F("Missing item or organization ID for fetching logs.");E([]),P(!0),F(null);const e=(0,s.aU)(),r=`stockItems/${t.id}`,n=(0,s.rJ)(e,`orgs/${i}/logs`),l=(0,s.P)(n,(0,s._M)("entityPath","==",r),(0,s.My)("timestamp","desc")),o=(0,s.aQ)(l,(e=>{const t=e.docs.map((e=>({...e.data()}))).map(D).filter((e=>null!==e));E(t),P(!1)}),(e=>{console.error("Error fetching logs: ",e),F(`Failed to fetch activity log: ${e.message}`),P(!1)}));return()=>o()}),[null===t||void 0===t?void 0:t.id,i]),(0,S.jsxs)(l.A,{open:!0,onClose:I,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[(0,S.jsxs)(o.A,{children:[t.productName," - Details"]}),(0,S.jsxs)(a.A,{dividers:!0,children:[" ",(0,S.jsxs)(d.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",pb:2},children:[(0,S.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Actions"}),(0,S.jsxs)(u.A,{direction:"row",spacing:1,flexWrap:"wrap",children:[" ",R.map((e=>(0,S.jsx)(m.A,{variant:"contained",size:"small",onClick:()=>C(t.id,e),title:e.description,children:e.label},e.id))),0===R.length&&(0,S.jsx)(c.A,{variant:"body2",color:"textSecondary",children:"No actions available for current status."})]})]}),(0,S.jsxs)(d.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",pb:1},children:[(0,S.jsx)(c.A,{variant:"h6",children:"Details"}),(0,S.jsxs)(p.A,{dense:!0,children:[" ",(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"ID",secondary:t.id})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Current Status",secondary:j(t.currentStatus)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Flagged",secondary:t.isFlagged?"Yes":"No"})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Delivery Name",secondary:j(t.deliveryName)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Product Name",secondary:j(t.productName)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Quantity",secondary:j(t.quantity)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Price Per Item",secondary:j(t.pricePerItem,"\xa3")})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Order Date",secondary:j(t.orderDate)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Purchase Status",secondary:j(t.purchaseStatus)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Order Number",secondary:j(t.orderNumber)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Seller / Source",secondary:j(t.seller)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"VAT Registered?",secondary:j(t.isVatRegistered)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Destination",secondary:j(t.destination)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"ASIN / SKU",secondary:j(t.asinSku)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Acquisition Notes",secondary:j(t.acquisitionNotes),sx:{whiteSpace:"pre-wrap"}})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Date Delivered",secondary:t.dateDelivered?new Date(t.dateDelivered).toLocaleString():j(null)})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Processor Notes",secondary:j(t.processorNotes),sx:{whiteSpace:"pre-wrap"}})}),(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:"Issue Description",secondary:j(t.issueDescription),sx:{whiteSpace:"pre-wrap"}})})]})]}),(0,S.jsxs)(d.A,{children:[(0,S.jsx)(c.A,{variant:"h6",children:"Activity Log"}),N&&(0,S.jsx)(g.A,{size:24,sx:{display:"block",margin:"20px auto"}}),O&&(0,S.jsxs)(A.A,{severity:"error",children:["Error loading history: ",O]}),!N&&!O&&0===w.length&&(0,S.jsx)(c.A,{variant:"body2",color:"textSecondary",sx:{mt:2},children:"No activity recorded."}),!N&&!O&&w.length>0&&(0,S.jsx)(p.A,{dense:!0,children:w.map(((e,t)=>(0,S.jsxs)(n().Fragment,{children:[(0,S.jsx)(h.Ay,{children:(0,S.jsx)(v.A,{primary:b(e),primaryTypographyProps:{variant:"body2"}})}),t<w.length-1&&(0,S.jsx)(x.A,{component:"li"})]},t)))})]})]}),(0,S.jsx)(f.A,{children:(0,S.jsx)(m.A,{ref:k,onClick:I,children:"Close"})})]})}},5929:(e,t,i)=>{i.r(t),i.d(t,{ActionMenu:()=>X,default:()=>ae,getAvailableActions:()=>Y});var r=i(7064),n=i(3997),s=i(9550),l=i(8613),o=i(9284),a=i(8677),d=i(1024),c=i(6800),u=i(3368),m=i(3691),p=i(5982),h=i(1453),v=i(2630),g=i(7694),A=i(7553),x=i(6623),f=i(8889),y=i(2731),S=i(8517),j=i(1911),b=i(4199),D=i(4225),I=i(2959),k=i(6185),C=i(5895),w=i(8263),E=i(5557),N=i(3287),P=i(2967),O=i(6647),F=i(2571),R=i(8229),T=i(6687),U=i(5359),$=i(1),W=i(6859),z=i(2523),L=i(2011),q=i(4755),_=i(9841),V=i(1399),G=i(2043),M=i(2950),B=i(6936),K=i(2327),H=i(579);function J(e){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,i]=e;return void 0!==i})))}const Q=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:(new Date).toISOString(),type:t,userId:e,details:i}},Y=(e,t)=>{let i=[];switch(e){case"Pending Delivery":case"Late":i=[{id:"Mark as Delivered",label:"Mark as Delivered",description:"Update status to Delivered"},{id:"Report Issue",label:"Report Issue",description:"Report an issue with this item"},{id:"View Details",label:"View Details",description:"View full item details and history"},{id:"Edit Item",label:"Edit Item",description:"Edit item details"},{id:"Add Note",label:"Add Note",description:"Add a note to the item history"}];break;case"Delivered":i=[{id:"Archive",label:"Archive",description:"Archive this item"},{id:"Report Issue",label:"Report Issue",description:"Report an issue with this item"},{id:"View Details",label:"View Details",description:"View full item details and history"},{id:"Edit Item",label:"Edit Item",description:"Edit item details"},{id:"Add Note",label:"Add Note",description:"Add a note to the item history"}];break;case"Issue":i=[{id:"Resolve Issue",label:"Resolve Issue",description:"Mark the issue as resolved"},{id:"Add Issue Update",label:"Add Issue Update",description:"Add an update note to the ongoing issue"},{id:"Archive",label:"Archive",description:"Archive this item"},{id:"View Details",label:"View Details",description:"View full item details and history"},{id:"Edit Item",label:"Edit Item",description:"Edit item details"},{id:"Add Note",label:"Add Note",description:"Add a general note to the item history"}];break;default:i=[{id:"View Details",label:"View Details",description:"View full item details and history"}]}return"Archived"!==e&&i.unshift(t?{id:"Unflag Item",label:"Unflag",description:"Remove the flag from this item"}:{id:"Flag Item",label:"Flag",description:"Flag this item for attention"}),i},X=e=>{let{itemId:t,actions:i,onActionSelected:r,onClose:n,anchorEl:s,open:l}=e;return(0,H.jsx)(x.A,{anchorEl:s,open:l,onClose:n,MenuListProps:{"aria-labelledby":`actions-button-${t}`},children:i.map((e=>(0,H.jsx)(f.A,{onClick:()=>(e=>{r(t,e),n()})(e),children:e.label},e.id)))})},Z=[{id:"orderDate",label:"Order Date"},{id:"quantity",label:"Qty"},{id:"productName",label:"Product Name"},{id:"deliveryName",label:"Delivery Name"},{id:"pricePerItem",label:"Price/Item"},{id:"seller",label:"Seller/Source"},{id:"destination",label:"Destination"},{id:"asinSku",label:"ASIN/SKU"},{id:"purchaseStatus",label:"Purchase Status"},{id:"orderNumber",label:"Order #"},{id:"currentStatus",label:"Status"},{id:"isFlagged",label:"Flagged"},{id:"acquisitionNotes",label:"Acquisition Notes"},{id:"issueDescription",label:"Issue Description"},{id:"dateDelivered",label:"Date Delivered"},{id:"actions",label:"Actions"}],ee=["orderDate","quantity","productName","deliveryName","currentStatus","actions"],te="incomingTool_visibleColumns",ie=e=>{let{column:t}=e;const{attributes:i,listeners:r,setNodeRef:n,transform:s,transition:l,isDragging:o}=(0,a.gl)({id:t.id}),c={transform:d.Ks.Transform.toString(s),transition:l,opacity:o?.5:1,touchAction:"none"},u=["quantity","pricePerItem"].includes(t.id);return(0,H.jsxs)(y.A,{ref:n,component:"th",scope:"col",style:c,...i,...r,align:u?"right":"left",sx:{fontWeight:"bold",cursor:"grab",whiteSpace:"nowrap",bgcolor:o?"#e0e0e0":"background.paper",..."isFlagged"===t.id&&{width:50,p:"6px 8px"},..."seller"===t.id&&{minWidth:140},..."deliveryName"===t.id&&{minWidth:160},..."quantity"===t.id&&{width:80},..."destination"===t.id&&{minWidth:110},..."pricePerItem"===t.id&&{width:100},..."orderNumber"===t.id&&{width:110},..."purchaseStatus"===t.id&&{width:110},..."orderDate"===t.id&&{width:110},..."asinSku"===t.id&&{width:120},..."productName"===t.id&&{minWidth:160},..."actions"===t.id&&{width:60,p:"6px 8px"},..."currentStatus"===t.id&&{width:100}},children:[t.label," "]})},re=e=>{let{isChecked:t,onChange:i}=e;return(0,H.jsxs)("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center"},children:[" ",(0,H.jsx)("label",{htmlFor:"flagToggle",style:{marginRight:"8px",fontWeight:"bold"},children:"Show Flagged Only:"}),(0,H.jsx)("input",{type:"checkbox",id:"flagToggle",checked:t,onChange:e=>i(e.target.checked),style:{width:"20px",height:"20px"}})]})},ne=e=>{let{onClose:t}=e;return(0,H.jsxs)(S.A,{open:!0,onClose:t,"aria-labelledby":"help-modal-title",children:[(0,H.jsx)(j.A,{id:"help-modal-title",children:"Keyboard Shortcuts"}),(0,H.jsx)(b.A,{dividers:!0,children:(0,H.jsx)(D.A,{dense:!0,children:[{key:"/",description:"Focus search bar"},{key:"a",description:"Add new item"},{key:"c",description:"Open columns/settings"},{key:"f",description:"Toggle flagged only"},{key:"1-6",description:"Switch filter tabs"},{key:"?",description:"Show this help"},{key:"Arrow Up/Down",description:"Move row selection"},{key:"Enter / o",description:"View details for selected row"},{key:"e",description:"Edit selected row"},{key:"r",description:"Report issue for selected row"},{key:"l",description:"Flag/unflag selected row"},{key:"Esc",description:"Close any open modal"}].map(((e,t)=>(0,H.jsx)(I.Ay,{children:(0,H.jsx)(k.A,{primary:(0,H.jsx)(C.A,{component:"span",sx:{fontWeight:"bold",minWidth:"100px",display:"inline-block"},children:e.key}),secondary:(0,H.jsx)(C.A,{component:"span",variant:"body2",children:e.description})})},t)))})}),(0,H.jsx)(w.A,{children:(0,H.jsx)(E.A,{onClick:t,autoFocus:!0,children:"Close"})})]})},se={apiKey:"AIzaSyCC6x0MS2KOTIZtZUYh59KdsBos1fasNtA",authDomain:"hubalm.firebaseapp.com",projectId:"hubalm",storageBucket:"hubalm.firebasestorage.app",messagingSenderId:"201098929511",appId:"1:201098929511:web:a257c60dd4d6b4d2ab7bc2"};Object.entries(se).forEach((e=>{let[t,i]=e;if(!i)throw new Error(`Missing Firebase config value for ${t}. Did you set your .env file?`)}));const le=(0,r.Wp)(se),oe=((0,n.xI)(le),(0,s.aU)(le)),ae=e=>{var t,i,r,n;let{user:d,org:x,permissions:f,logAction:S}=e;console.log("ToolApp Props Received:",{user:d,orgId:null===x||void 0===x?void 0:x.id,permissions:f,logActionExists:!!S});const[j,b]=(0,l.useState)(-1),[D,I]=(0,l.useState)(!1),[k,w]=(0,l.useState)([]),[se,le]=(0,l.useState)(!0),[ae,de]=(0,l.useState)(null),[ce,ue]=(0,l.useState)(""),[me,pe]=(0,l.useState)("All"),[he,ve]=(0,l.useState)(null),[ge,Ae]=(0,l.useState)(!1),[xe,fe]=(0,l.useState)(!1),[ye,Se]=(0,l.useState)(null),[je,be]=(0,l.useState)(null),[De,Ie]=(0,l.useState)(null),[ke,Ce]=(0,l.useState)(null),[we,Ee]=(0,l.useState)(!1),[Ne,Pe]=(0,l.useState)(null),[Oe,Fe]=(0,l.useState)(!1),[Re,Te]=(0,l.useState)((()=>{try{const e=localStorage.getItem(te),t=e?JSON.parse(e):ee;return Array.isArray(t)?t:ee}catch(ae){return console.error("Error reading visible columns from localStorage",ae),ee}}));(0,l.useEffect)((()=>{try{localStorage.setItem(te,JSON.stringify(Re))}catch(ae){console.error("Error saving visible columns to localStorage",ae)}}),[Re]);const Ue=Re.map((e=>Z.find((t=>t.id===e)))).filter((e=>void 0!==e)),$e=k.filter((e=>{const t=!ce||e.deliveryName.toLowerCase().includes(ce.toLowerCase())||e.productName.toLowerCase().includes(ce.toLowerCase());let i=!1;i="All"===me||("Late"===me?(e=>{if("Pending Delivery"!==e.currentStatus)return!1;const t=new Date(e.orderDate),i=new Date;return i.setDate(i.getDate()-7),t<i})(e):e.currentStatus===me);const r=!xe||!0===e.isFlagged;return i&&t&&r}));(0,l.useEffect)((()=>{b((e=>0===$e.length?-1:e<0?0:e>=$e.length?$e.length-1:e))}),[$e]),(0,l.useEffect)((()=>{if(null===x||void 0===x||!x.id)return;le(!0),de(null);const e=(0,s.P)((0,s.rJ)(oe,"orgs",x.id,"stockItems"),(0,s.My)("orderDate","desc")),t=(0,s.aQ)(e,(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));w(t),le(!1)}),(e=>{de("Failed to load items: "+e.message),le(!1)}));return()=>t()}),[null===x||void 0===x?void 0:x.id]);const We=(0,l.useCallback)((async(e,t,i,r)=>{if(!oe||null===x||void 0===x||!x.id||!t)return console.error("Cannot update item: Missing configuration.",{db:!!oe,orgId:null===x||void 0===x?void 0:x.id,userId:t}),void de("Cannot update item: Missing configuration.");const n=(0,s.H9)(oe,"orgs",x.id,"stockItems",e),l=k.find((t=>t.id===e));if(!l)return console.error(`Item ${e} not found for update`),void de(`Item ${e} not found.`);const o=J({...i,lastUpdated:(0,s.O5)()}),a={...l,...o};try{if(await(0,s.mZ)(n,o),console.log(`Item ${e} updated successfully.`),console.log("updateItemAndLog: Attempting to log action. logAction available?",!!S),S){let t;try{if("EDITED"===r.type)t="item.update.fields";else if("FLAG_TOGGLED"===r.type)t="item.update.flag";else if("STATUS_CHANGED"===r.type){var d,c;t=`item.update.status.${(null===(d=r.details)||void 0===d||null===(c=d.newStatus)||void 0===c?void 0:c.toLowerCase())||"unknown"}`}else t="ISSUE_REPORTED"===r.type?"item.update.issue.report":"ISSUE_RESOLVED"===r.type?"item.update.issue.resolve":"ISSUE_UPDATE_ADDED"===r.type?"item.update.issue.update":"NOTE_ADDED"===r.type?"item.add_note":r.type}catch(u){console.error("Error deriving action name for logging:",u),t=r.type}const i={orgId:x.id,toolKey:"incomingtool",action:t,entityPath:`stockItems/${e}`,...void 0!==l&&{before:l},...void 0!==a&&{after:a},...void 0!==r.details&&{details:r.details}};await S(i)}}catch(m){throw console.error(`Error updating item ${e}:`,m),de(`Failed to update item: ${m.message}`),m}}),[x,k,S]),ze=(0,l.useCallback)((async(e,t)=>{console.log(`Action: ${t.label} on item ${e}`);const i=k.find((t=>t.id===e));if(i)switch(t.id){case"Edit Item":Se(i),Ae(!0);break;case"Flag Item":case"Unflag Item":const r="Flag Item"===t.id;await We(e,null===d||void 0===d?void 0:d.uid,{isFlagged:r},Q((null===d||void 0===d?void 0:d.uid)||"","FLAG_TOGGLED",{isFlagged:r}));break;case"Mark as Delivered":"Delivered"!==i.currentStatus&&await We(e,null===d||void 0===d?void 0:d.uid,{currentStatus:"Delivered",dateDelivered:(new Date).toISOString()},Q((null===d||void 0===d?void 0:d.uid)||"","STATUS_CHANGED",{previousStatus:i.currentStatus,newStatus:"Delivered"}));break;case"Archive":"Archived"!==i.currentStatus&&await We(e,null===d||void 0===d?void 0:d.uid,{currentStatus:"Archived"},Q((null===d||void 0===d?void 0:d.uid)||"","STATUS_CHANGED",{previousStatus:i.currentStatus,newStatus:"Archived"}));break;case"Add Note":Pe(i);break;case"Report Issue":ve(null),be(i);break;case"Resolve Issue":ve(null),Ce(i);break;case"Add Issue Update":ve(null),Ie(i);break;case"View Details":ve(i)}}),[null===d||void 0===d?void 0:d.uid,k,We,Se,Ae,be,Ie,Ce,ve]),Le=(0,l.useCallback)((async e=>{if(!je||null===x||void 0===x||!x.id)return;const t=je.id;try{await We(t,null===d||void 0===d?void 0:d.uid,{currentStatus:"Issue",issueDescription:e},Q((null===d||void 0===d?void 0:d.uid)||"","ISSUE_REPORTED",{issueDescription:e})),be(null)}catch(i){de("Failed to report issue: "+i.message)}}),[je,null===x||void 0===x?void 0:x.id,null===d||void 0===d?void 0:d.uid,We,be,de]),qe=(0,l.useCallback)((async e=>{if(De)try{await We(De.id,null===d||void 0===d?void 0:d.uid,{},Q((null===d||void 0===d?void 0:d.uid)||"","ISSUE_UPDATE_ADDED",{note:e})),Ie(null)}catch(t){}}),[De,We,Ie,null===d||void 0===d?void 0:d.uid]),_e=(0,l.useCallback)((async(e,t)=>{if(!ke||null===x||void 0===x||!x.id||!oe)return;const i=ke.id;let r="Delivered";"Returned to Supplier"!==e&&"Disposed Of"!==e||(r="Archived");try{const n=(0,s.H9)(oe,"orgs",x.id,"stockItems",i);await(0,s.mZ)(n,{currentStatus:r,lastUpdated:(0,s.O5)()});const l=k.find((e=>e.id===i));console.log("handleSaveResolveIssue: Attempting to log action. logAction available?",!!S),S&&await S({orgId:x.id,toolKey:"incomingtool",action:"item.update.issue.resolve",entityPath:`stockItems/${i}`,before:l,after:{...l,currentStatus:r},details:{resolutionOutcome:e,note:t}}),Ce(null)}catch(n){de("Failed to resolve issue: "+n.message)}}),[ke,null===x||void 0===x?void 0:x.id,k,S,Ce,de]),Ve=(0,l.useCallback)((()=>{Ae(!1),Se(null)}),[Ae,Se]),Ge=(0,l.useCallback)((async e=>{if(console.log("ToolApp: current editingItem at save",ye),null===x||void 0===x||!x.id||!oe)return console.error("ToolApp: Cannot save item because org.id or db is undefined",x),void de("Cannot save item: No organization selected or database unavailable.");console.log("ToolApp: handleSaveItem called",e);try{if(ye&&ye.id){const t=ye.id,i=Object.keys(e).filter((t=>ye.hasOwnProperty(t)&&ye[t]!==e[t]));"isFlagged"in e&&!i.includes("isFlagged")&&ye.isFlagged!==e.isFlagged&&i.push("isFlagged");const r=Q((null===d||void 0===d?void 0:d.uid)||"","EDITED",{changedFields:i.length>0?i:void 0});await We(t,null===d||void 0===d?void 0:d.uid,e,r)}else{const t=J({...e,currentStatus:"Pending Delivery",lastUpdated:(0,s.O5)()}),i=await(0,s.gS)((0,s.rJ)(oe,"orgs",x.id,"stockItems"),t);console.log("handleSaveItem: Attempting to log action. logAction available?",!!S),S&&await S({orgId:x.id,toolKey:"incomingtool",action:"item.create",entityPath:`stockItems/${i.id}`,after:t})}Ve()}catch(t){console.error("Failed to save item",t),de("Failed to save item: "+t.message)}}),[ye,x,d,S,We,Ve,de]),Me=(0,l.useCallback)((()=>{ve(null)}),[ve]),Be=(0,l.useRef)(void 0);(0,l.useEffect)((()=>{Be.current=null===x||void 0===x?void 0:x.id}),[x]);const Ke=(0,l.useCallback)((()=>{Be.current?(Se(null),Ae(!0)):de("Cannot add item: Organization ID is missing.")}),[Ae,Se,de]),He=(0,l.useRef)(null),Je=(0,l.useCallback)((e=>{const t=k.find((t=>t.id===e));return t?(console.log("Viewing details for:",t),x?void ve(t):(console.error("Org ID is missing, cannot fetch logs."),void de("Organization context is missing."))):(console.error("Item not found for viewing details:",e),void de("Item not found."))}),[x,k,de]);(0,l.useEffect)((()=>{const e=e=>{var t;const i=e.target,r=i.tagName;if("INPUT"===r||"TEXTAREA"===r||i.isContentEditable)return;if(ge||we||he||je||De||ke||D||Oe)"Escape"===e.key&&(ge&&Ae(!1),we&&Ee(!1),he&&ve(null),je&&be(null),De&&Ie(null),ke&&Ce(null),D&&I(!1),Oe&&Fe(!1));else{if(e.key>="1"&&e.key<="6"){const t=["All","Pending Delivery","Delivered","Issue","Late","Archived"],i=parseInt(e.key,10)-1;if(i>=0&&i<t.length)return pe(t[i]),void e.preventDefault()}if("?"===e.key)return I(!0),void e.preventDefault();if($e.length>0){if("Arrow Down"===e.key)return b((e=>Math.min($e.length-1,e<0?0:e+1))),void e.preventDefault();if("Arrow Up"===e.key)return b((e=>Math.max(0,e-1))),void e.preventDefault();if(("Enter"===e.key||"o"===e.key)&&j>=0&&j<$e.length)return ve($e[j]),void e.preventDefault();if("e"===e.key&&j>=0&&j<$e.length){const t=$e[j];return Se(t),Ae(!0),void e.preventDefault()}if("r"===e.key&&j>=0&&j<$e.length)return be($e[j]),void e.preventDefault();if("l"===e.key&&j>=0&&j<$e.length){const t=$e[j];return ze(t.id,t.isFlagged?{id:"Unflag Item",label:"Unflag",description:"Remove the flag from this item"}:{id:"Flag Item",label:"Flag",description:"Flag this item for attention"}),void e.preventDefault()}}switch(e.key){case"/":e.preventDefault(),null===(t=He.current)||void 0===t||t.focus();break;case"a":case"A":ye||Ke();break;case"c":case"C":Ee(!0)}}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[ge,we,he,je,De,ke,D,Oe,$e,j,ye,ze,pe,Ke]);const Qe=(0,l.useCallback)((async(e,t)=>{if(null===d||void 0===d||!d.uid)return console.error("User ID is missing, cannot save note."),void de("User ID is missing, cannot save note.");console.log(`Saving general note for item ${e}: ${t}`);try{const i=Q(d.uid,"NOTE_ADDED",{note:t});await We(e,d.uid,{},i),console.log(`General note saved and logged for item ${e}`),Pe(null)}catch(i){console.error(`Error saving general note for item ${e}:`,i),de(`Failed to save note: ${i.message}`)}}),[null===d||void 0===d?void 0:d.uid,We]),[Ye,Xe]=(0,l.useState)(null),[Ze,et]=(0,l.useState)(null),tt=(e,t)=>{const i=e[t],r={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"};if("actions"===t)return(0,H.jsx)(O.A,{"aria-label":"actions",size:"small",onClick:t=>{return i=t,r=e.id,et(i.currentTarget),void Xe(r);var i,r},children:(0,H.jsx)(G.A,{fontSize:"inherit"})});if("currentStatus"===t)return(0,H.jsx)(C.A,{variant:"body2",sx:{fontWeight:"medium",whiteSpace:"nowrap"},children:e.currentStatus});if("isFlagged"===t)return e.isFlagged?(0,H.jsx)(K.A,{color:"error",fontSize:"small"}):null;let n;if("orderDate"===t&&i)try{n=new Date(i).toLocaleDateString()}catch(s){n=String(null!==i&&void 0!==i?i:"-")}else n="pricePerItem"===t&&"number"===typeof i?i.toFixed(2):void 0===i||null===i||""===i?"-":String(i);return["seller","deliveryName","productName","acquisitionNotes","asinSku","orderNumber","destination"].includes(t)?((e,t)=>(0,H.jsx)(N.A,{title:String(null!==t&&void 0!==t?t:""),placement:"bottom-start",enterDelay:500,children:(0,H.jsx)(P.A,{component:"span",sx:r,children:e})}))(n,i):(0,H.jsx)(P.A,{component:"span",sx:{whiteSpace:"nowrap"},children:n})},it=(0,o.FR)((0,o.MS)(o.AN),(0,o.MS)(o.uN,{coordinateGetter:a.JR})),rt={"Pending Delivery":"#fffde7",Delivered:"#e3f2fd",Issue:"#ffebee",Late:"#fff3e0",Archived:"#f5f5f5"},nt=e=>{let{onSearch:t,inputRef:i}=e;return(0,H.jsx)(F.A,{inputRef:i,fullWidth:!0,variant:"outlined",placeholder:"Search by Delivery Name, Product Name, Seller, or ASIN/SKU...",onChange:e=>t(e.target.value),size:"small",sx:{mr:2,flexGrow:1}})},st=e=>{let{currentFilter:t,onFilterChange:i}=e;return(0,H.jsx)(P.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,H.jsx)(R.A,{value:t,onChange:(e,t)=>{i(t)},variant:"scrollable",scrollButtons:"auto","aria-label":"Stock item status filter tabs",children:["All","Pending Delivery","Delivered","Issue","Archived"].map((e=>(0,H.jsx)(T.A,{label:e,value:e},e)))})})};return(0,H.jsxs)(P.A,{sx:{display:"flex",flexDirection:"column",height:"100vh",p:3},children:[" ",(0,H.jsxs)(P.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,flexShrink:0},children:[(0,H.jsx)("h2",{children:"Incoming Stock Tool"}),(0,H.jsxs)("div",{children:[(0,H.jsx)(E.A,{variant:"contained",startIcon:(0,H.jsx)(M.A,{}),onClick:Ke,sx:{mr:1},children:"Add Item"}),(0,H.jsx)(E.A,{variant:"outlined",onClick:()=>Fe(!0),sx:{mr:1},children:"Activity"})," ",(0,H.jsx)(E.A,{variant:"outlined",onClick:()=>Ee(!0),startIcon:(0,H.jsx)(B.A,{}),children:"Settings"})," "]})]}),ae&&(0,H.jsx)(U.A,{severity:"error",onClose:()=>de(null),sx:{mb:2,flexShrink:0},children:ae}),se&&(0,H.jsx)($.A,{sx:{mb:2,flexShrink:0}}),(0,H.jsxs)(P.A,{sx:{display:"flex",alignItems:"center",mb:2,flexShrink:0},children:[(0,H.jsxs)(P.A,{sx:{display:"flex",alignItems:"center",flexGrow:1,mr:2},children:[(0,H.jsx)(nt,{onSearch:e=>{ue(e)},inputRef:He}),(0,H.jsx)(re,{isChecked:xe,onChange:fe})]}),(0,H.jsx)(st,{currentFilter:me,onFilterChange:e=>{pe(e)}})]}),(0,H.jsx)(o.Mp,{sensors:it,collisionDetection:o.fp,onDragEnd:e=>{const{active:t,over:i}=e;i&&t.id!==i.id&&Te((e=>{const r=e.indexOf(t.id),n=e.indexOf(i.id);return(0,a.be)(e,r,n)}))},modifiers:[c.dU],children:(0,H.jsx)(W.A,{component:z.A,sx:{flexGrow:1,overflow:"auto"},children:(0,H.jsxs)(L.A,{stickyHeader:!0,sx:{minWidth:650},"aria-label":"stock processing table",size:"small",children:[(0,H.jsx)(a.gB,{items:Ue.map((e=>e.id)),strategy:a.m$,children:(0,H.jsx)(q.A,{children:(0,H.jsx)(_.A,{children:Ue.map((e=>(0,H.jsx)(ie,{column:e},e.id)))})})}),(0,H.jsx)(V.A,{children:$e.length>0?$e.map(((e,t)=>{const i=t===j;return(0,H.jsx)(_.A,{hover:!0,onClick:()=>Je(e.id),selected:i,sx:{cursor:"pointer",backgroundColor:rt[e.currentStatus]||"inherit","&:hover":{backgroundColor:"#e0e0e0"},"& .MuiTableCell-root":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},children:Ue.map((t=>tt(e,t.id)))},e.id)})):(0,H.jsx)(_.A,{children:(0,H.jsx)(y.A,{colSpan:Ue.length,align:"center",sx:{py:3},children:"No items match the current filter or none loaded yet."})})})]})})}),ge&&(0,H.jsx)(u.A,{onSave:Ge,onClose:Ve,initialData:ye}),he&&(0,H.jsx)(m.A,{item:he,orgId:x.id,onClose:Me,onActionSelected:ze}),je&&(0,H.jsx)(p.A,{item:je,onSubmit:Le,onClose:()=>be(null)}),De&&(0,H.jsx)(h.A,{item:De,onSubmit:qe,onClose:()=>Ie(null)}),ke&&(0,H.jsx)(v.A,{item:ke,onSubmit:_e,onClose:()=>Ce(null)}),Ne&&(0,H.jsx)(h.A,{item:Ne,onSubmit:e=>Qe(Ne.id,e),onClose:()=>Pe(null)}),(0,H.jsx)(g.A,{isOpen:we,onClose:()=>Ee(!1),allColumns:Z,initialVisibleColumns:Ue,onSave:e=>{Te((t=>{const i=new Set(e);return[...t.filter((e=>i.has(e))),...e.filter((e=>!t.includes(e)))]})),Ee(!1)}}),Oe&&(null===x||void 0===x?void 0:x.id)&&(0,H.jsx)(A.A,{orgId:x.id,onClose:()=>Fe(!1),onEntityClick:Je,onActionSelected:ze}),D&&(0,H.jsx)(ne,{onClose:()=>I(!1)}),(0,H.jsx)(X,{itemId:Ye||"",actions:Ye?Y(null!==(t=null===(i=$e.find((e=>e.id===Ye)))||void 0===i?void 0:i.currentStatus)&&void 0!==t?t:"Pending Delivery",null!==(r=null===(n=$e.find((e=>e.id===Ye)))||void 0===n?void 0:n.isFlagged)&&void 0!==r&&r):[],onActionSelected:ze,onClose:()=>{et(null),Xe(null)},anchorEl:Ze,open:Boolean(Ye)})]})}},5982:(e,t,i)=>{i.d(t,{A:()=>m});var r=i(8613),n=i(8517),s=i(1911),l=i(5895),o=i(4199),a=i(2571),d=i(8263),c=i(5557),u=i(579);const m=e=>{let{item:t,onSubmit:i,onClose:m}=e;const[p,h]=(0,r.useState)(""),[v,g]=(0,r.useState)("");return(0,u.jsxs)(n.A,{open:!0,onClose:m,maxWidth:"sm",fullWidth:!0,children:[(0,u.jsxs)(s.A,{children:[(0,u.jsx)(l.A,{variant:"h6",children:"Report Issue for:"}),(0,u.jsxs)(l.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]})]}),(0,u.jsx)(o.A,{dividers:!0,children:(0,u.jsx)(a.A,{autoFocus:!0,margin:"dense",id:"issueDescription",label:"Describe the Issue *",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:p,onChange:e=>{h(e.target.value),v&&g("")},error:!!v,helperText:v||"Please provide details about the problem."})}),(0,u.jsxs)(d.A,{sx:{padding:"16px 24px"},children:[(0,u.jsx)(c.A,{onClick:m,color:"secondary",children:"Cancel"}),(0,u.jsx)(c.A,{onClick:()=>{p.trim()?(i(p),m()):g("Please enter a description of the issue.")},variant:"contained",color:"primary",children:"Save Issue Report"})]})]})}},7553:(e,t,i)=>{i.d(t,{A:()=>x});var r=i(8613),n=i(9550),s=i(6185),l=i(5895),o=i(8517),a=i(1911),d=i(4199),c=i(2967),u=i(549),m=i(4225),p=i(2959),h=i(4527),v=i(8263),g=i(5557),A=i(579);const x=e=>{let{orgId:t,onClose:i,onEntityClick:x,onActionSelected:f}=e;const[y,S]=(0,r.useState)([]),[j,b]=(0,r.useState)(!0),[D,I]=(0,r.useState)(null),[k,C]=(0,r.useState)({});(0,r.useEffect)((()=>{if(!t)return;const e=(0,n.aU)(),i=(0,n.rJ)(e,`orgs/${t}/members`);(0,n.GG)(i).then((e=>{const t={};e.docs.forEach((e=>{const i=e.data();t[e.id]=i.email||e.id})),C(t)})).catch((e=>console.error("Error fetching members:",e)))}),[t,C]),(0,r.useEffect)((()=>{if(!t)return I("Organization ID is required."),void b(!1);b(!0),I(null);const e=(0,n.aU)(),i=(0,n.rJ)(e,`orgs/${t}/logs`),r=(0,n.P)(i,(0,n._M)("tool","==","incomingtool"),(0,n.My)("ts","desc"),(0,n.AB)(100)),s=(0,n.aQ)(r,(e=>{const i=e.docs.map((e=>{const i=e.data();return{orgId:t,toolKey:i.toolKey||i.tool,action:i.action,entityPath:i.entityPath,timestamp:i.timestamp||i.ts,userId:i.userId||i.uid,userEmail:i.email,before:i.before,after:i.after,details:i.details}})).filter((e=>"app-loaded"!==e.action));S(i),b(!1)}),(e=>{console.error("Error fetching user activity logs: ",e);I(`Failed to load activity logs: ${e.message}`),b(!1)}));return()=>s()}),[t,S]);const w=e=>{var t,i,o;const a=e.timestamp instanceof n.Dc?e.timestamp.toDate().toLocaleString():"string"===typeof e.timestamp?new Date(e.timestamp).toLocaleString():"Invalid Date",d=e.userEmail||k[e.userId||""]||e.userId||"system",c=(e=>{switch(e.action){case"item.create":return"Item created";case"item.update.fields":{var t,i;if(e.before&&e.after){var r;const t=(null===(r=e.details)||void 0===r?void 0:r.changedFields)||Object.keys(e.after).filter((t=>{var i,r;return JSON.stringify(null===(i=e.before)||void 0===i?void 0:i[t])!==JSON.stringify(null===(r=e.after)||void 0===r?void 0:r[t])}));if(t.length)return`Edited ${t.map((t=>{var i,r;return`${t}: ${null===(i=e.before)||void 0===i?void 0:i[t]} \u2192 ${null===(r=e.after)||void 0===r?void 0:r[t]}`})).join(", ")}`}const n=null===(t=e.details)||void 0===t||null===(i=t.changedFields)||void 0===i?void 0:i.join(", ");return n?`Edited fields: ${n}`:"Item edited"}default:var n,s,l,o,a,d,c,u,m;return e.action.startsWith("item.update.status.")?`Status changed: ${(null===(n=e.details)||void 0===n?void 0:n.previousStatus)||(null===(s=e.before)||void 0===s?void 0:s.currentStatus)||"Unknown"} \u2192 ${(null===(l=e.details)||void 0===l?void 0:l.newStatus)||e.action.replace("item.update.status.","")}`:"item.update.flag"===e.action?(null===(o=e.details)||void 0===o?void 0:o.isFlagged)?"Item flagged":"Item unflagged":"item.update.issue.report"===e.action?`Issue reported: ${(null===(a=e.details)||void 0===a?void 0:a.description)||(null===(d=e.details)||void 0===d?void 0:d.issueDescription)||""}`:"item.update.issue.update"===e.action?`Issue update added: ${(null===(c=e.details)||void 0===c?void 0:c.note)||""}`:"item.update.issue.resolve"===e.action?`Issue resolved: ${(null===(u=e.details)||void 0===u?void 0:u.resolutionOutcome)||""}`:"item.add_note"===e.action?`Note added: ${(null===(m=e.details)||void 0===m?void 0:m.note)||""}`:e.action}})(e),u=e.entityPath.split("/"),m=u.length>=2?u[1]:"",p=null===(t=e.before)||void 0===t?void 0:t.quantity,h=null===(i=e.before)||void 0===i?void 0:i.productName,v=p&&h?`${p}x ${h}`:(null===(o=e.before)||void 0===o?void 0:o.deliveryName)||h||m;return(0,A.jsx)(s.A,{primary:(0,A.jsxs)(r.Fragment,{children:[(0,A.jsxs)(l.A,{sx:{display:"inline"},component:"span",variant:"body2",color:"text.primary",children:[a," - ",c," by ",d]}),(0,A.jsx)(l.A,{component:"span",variant:"body2",onClick:()=>x(m),sx:{ml:1,cursor:"pointer",color:"primary.main",textDecoration:"underline"},children:v})]})})};return(0,A.jsxs)(o.A,{open:!0,onClose:i,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[(0,A.jsxs)(a.A,{children:[(0,A.jsx)(l.A,{variant:"h6",children:"User Activity Log"}),(0,A.jsx)(l.A,{variant:"caption",children:"Last 100 entries"})]}),(0,A.jsxs)(d.A,{dividers:!0,children:[j&&(0,A.jsx)(c.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:(0,A.jsx)(u.A,{})}),D&&(0,A.jsx)(l.A,{color:"error",sx:{textAlign:"center",mt:2},children:D}),!j&&!D&&(0,A.jsx)(m.A,{dense:!0,sx:{width:"100%",bgcolor:"background.paper",p:0},children:0===y.length?(0,A.jsx)(p.Ay,{children:(0,A.jsx)(s.A,{primary:"No activity logs found."})}):y.map(((e,t)=>(0,A.jsxs)(r.Fragment,{children:[(0,A.jsx)(p.Ay,{alignItems:"flex-start",sx:{py:1.5},children:w(e)}),t<y.length-1&&(0,A.jsx)(h.A,{variant:"inset",component:"li"})]},`${e.timestamp}-${t}-${e.action}`)))})]}),(0,A.jsx)(v.A,{sx:{padding:"16px 24px"},children:(0,A.jsx)(g.A,{onClick:i,color:"primary",children:"Close"})})]})}},7694:(e,t,i)=>{i.d(t,{A:()=>v});var r=i(8613),n=i(8517),s=i(1911),l=i(5895),o=i(4199),a=i(2967),d=i(6679),c=i(5847),u=i(5303),m=i(8263),p=i(5557),h=i(579);const v=e=>{let{isOpen:t,onClose:i,allColumns:v,initialVisibleColumns:g,onSave:A}=e;const[x,f]=(0,r.useState)((()=>Object.fromEntries(v.map((e=>[e.id,!1])))));(0,r.useEffect)((()=>{if(t){const e=new Set(g.map((e=>e.id))),t=Object.fromEntries(v.map((t=>[t.id,e.has(t.id)])));f(t)}}),[t,g,v]);return(0,h.jsxs)(n.A,{open:t,onClose:i,maxWidth:"xs",fullWidth:!0,children:[(0,h.jsx)(s.A,{children:(0,h.jsx)(l.A,{variant:"h6",children:"Configure Table Columns"})}),(0,h.jsxs)(o.A,{dividers:!0,children:[(0,h.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:"Select the columns you want to display:"}),(0,h.jsxs)(a.A,{sx:{maxHeight:"60vh",overflowY:"auto",pr:1},children:[" ",(0,h.jsx)(d.A,{children:v.map((e=>(0,h.jsx)(c.A,{control:(0,h.jsx)(u.A,{checked:x[e.id]||!1,onChange:()=>{return t=e.id,void f((e=>({...e,[t]:!e[t]})));var t},disabled:"actions"===e.id}),label:e.label},e.id)))})]})]}),(0,h.jsxs)(m.A,{sx:{padding:"16px 24px"},children:[(0,h.jsx)(p.A,{onClick:i,color:"secondary",children:"Cancel"}),(0,h.jsx)(p.A,{onClick:()=>{const e=v.map((e=>e.id)).filter((e=>x[e]));A(e)},variant:"contained",color:"primary",children:"Save Settings"})]})]})}}}]);
//# sourceMappingURL=544.21de07c0.chunk.js.map