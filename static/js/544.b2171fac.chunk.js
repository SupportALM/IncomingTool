"use strict";(self.webpackChunkincoming_tool=self.webpackChunkincoming_tool||[]).push([[544],{1453:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(8613),o=i(579);const l=e=>{let{item:t,onSubmit:i,onClose:l}=e;const[r,s]=(0,n.useState)(""),[a,d]=(0,n.useState)("");return(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:l,children:(0,o.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",maxWidth:"500px",width:"90%",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,o.jsx)("h3",{children:"Add Issue Update for:"}),(0,o.jsxs)("p",{style:{margin:"5px 0 15px 0",fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]}),t.issueDescription&&(0,o.jsxs)("div",{style:{marginBottom:"15px",padding:"10px",background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px"},children:[(0,o.jsx)("strong",{children:"Initial Issue:"})," ",t.issueDescription]}),(0,o.jsx)("label",{htmlFor:"updateNote",style:{fontWeight:"bold"},children:"Update Note:"}),(0,o.jsx)("textarea",{id:"updateNote",value:r,onChange:e=>{s(e.target.value),a&&d("")},style:{width:"calc(100% - 16px)",padding:"8px",minHeight:"80px",marginTop:"5px"},rows:4,placeholder:"e.g., Contacted seller, awaiting response..."}),a&&(0,o.jsx)("div",{style:{color:"red",fontSize:"0.8em",marginTop:"4px"},children:a}),(0,o.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,o.jsx)("button",{type:"button",onClick:l,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,o.jsx)("button",{type:"button",onClick:()=>{r.trim()?i(r):d("Please enter an update note.")},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Update Note"})]})]})})}},2630:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(8613),o=i(579);const l=["Item Accepted / Kept As Is","Item Repaired / Refurbished","Partial Refund Received","Returned to Supplier","Disposed Of","Other"],r=e=>{let{item:t,onSubmit:i,onClose:r}=e;const[s,a]=(0,n.useState)(""),[d,c]=(0,n.useState)(""),[u,g]=(0,n.useState)(""),p={marginBottom:"15px"},m={display:"block",marginBottom:"5px",fontWeight:"bold"},h={width:"calc(100% - 16px)",padding:"8px"};return(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:r,children:(0,o.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",maxWidth:"500px",width:"90%",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,o.jsx)("h3",{children:"Resolve Issue for:"}),(0,o.jsxs)("p",{style:{margin:"5px 0 15px 0",fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]}),t.issueDescription&&(0,o.jsxs)("div",{style:{marginBottom:"15px",padding:"10px",background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px"},children:[(0,o.jsx)("strong",{children:"Initial Issue:"})," ",t.issueDescription]}),(0,o.jsxs)("div",{style:p,children:[(0,o.jsx)("label",{htmlFor:"resolutionOutcome",style:m,children:"Resolution Outcome:"}),(0,o.jsxs)("select",{id:"resolutionOutcome",value:s,onChange:e=>{a(e.target.value),u&&g("")},style:h,children:[(0,o.jsx)("option",{value:"",disabled:!0,children:"-- Select an Outcome --"}),l.map((e=>(0,o.jsx)("option",{value:e,children:e},e)))]}),u&&(0,o.jsx)("div",{style:{color:"red",fontSize:"0.8em",marginTop:"4px"},children:u})]}),(0,o.jsxs)("div",{style:p,children:[(0,o.jsx)("label",{htmlFor:"resolutionNotes",style:m,children:"Resolution Notes (Optional):"}),(0,o.jsx)("textarea",{id:"resolutionNotes",value:d,onChange:e=>c(e.target.value),style:{...h,minHeight:"60px"},rows:3,placeholder:"e.g., Supplier issued refund, repaired screen..."})]}),(0,o.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,o.jsx)("button",{type:"button",onClick:r,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,o.jsx)("button",{type:"button",onClick:()=>{s?i(s,d.trim()||void 0):g("Please select a resolution outcome.")},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Resolution"})]})]})})}},3368:(e,t,i)=>{i.d(t,{A:()=>f});var n=i(8613),o=i(8517),l=i(1911),r=i(4199),s=i(2967),a=i(2571),d=i(3287),c=i(6647),u=i(8889),g=i(5847),p=i(5303),m=i(8263),h=i(5557),x=i(7347),v=i(579);const f=e=>{let{onSave:t,onClose:i,initialData:f,firstInputRef:b}=e;const j=!!f,[y,S]=(0,n.useState)((null===f||void 0===f?void 0:f.purchaseStatus)||"Purchased"),[A,I]=(0,n.useState)((null===f||void 0===f?void 0:f.deliveryName)||""),[D,C]=(0,n.useState)((null===f||void 0===f?void 0:f.productName)||""),[k,E]=(0,n.useState)((null===f||void 0===f?void 0:f.quantity)||""),[w,N]=(0,n.useState)((null===f||void 0===f?void 0:f.pricePerItem)||""),[P,T]=(0,n.useState)((null===f||void 0===f?void 0:f.orderNumber)||""),[F,O]=(0,n.useState)((()=>(null===f||void 0===f?void 0:f.orderDate)||(new Date).toISOString().split("T")[0])),[R,$]=(0,n.useState)((null===f||void 0===f?void 0:f.seller)||""),[U,z]=(0,n.useState)((null===f||void 0===f?void 0:f.isVatRegistered)||"Unknown"),[L,W]=(0,n.useState)((null===f||void 0===f?void 0:f.destination)||""),[_,q]=(0,n.useState)((null===f||void 0===f?void 0:f.asinSku)||""),[B,G]=(0,n.useState)((null===f||void 0===f?void 0:f.acquisitionNotes)||""),[M,V]=(0,n.useState)((null===f||void 0===f?void 0:f.isFlagged)||!1),[H,K]=(0,n.useState)({});(0,n.useEffect)((()=>{f&&(S(f.purchaseStatus||"Purchased"),I(f.deliveryName||""),C(f.productName||""),E(f.quantity||""),N(f.pricePerItem||""),T(f.orderNumber||""),O(f.orderDate||(new Date).toISOString().split("T")[0]),$(f.seller||""),z(f.isVatRegistered||"Unknown"),W(f.destination||""),q(f.asinSku||""),G(f.acquisitionNotes||""),V(f.isFlagged||!1),K({}))}),[f]);const J=e=>{e.preventDefault(),console.log("AddItemForm: handleSubmit",{deliveryName:A,productName:D,quantity:k,pricePerItem:w,orderDate:F,seller:R,destination:L,acquisitionNotes:B,isFlagged:M});const i=(()=>{const e={};return A.trim()||(e.deliveryName="Delivery Name is required."),D.trim()||(e.productName="Product Name is required."),(""===k||k<=0)&&(e.quantity="Quantity must be a positive number."),(""===w||w<0)&&(e.pricePerItem="Price must be zero or positive."),F||(e.orderDate="Order Date is required."),K(e),0===Object.keys(e).length})();console.log("AddItemForm: validation result",i,H),i?(console.log("AddItemForm: form valid, calling onSave"),t({purchaseStatus:y,deliveryName:A,productName:D,quantity:Number(k),pricePerItem:Number(w),orderNumber:P||void 0,orderDate:F,seller:R||void 0,isVatRegistered:"Unknown"===U?void 0:U,destination:L||void 0,asinSku:_||void 0,acquisitionNotes:B||void 0,isFlagged:M})):console.log("AddItemForm: form invalid, errors:",H)};return(0,v.jsxs)(o.A,{open:!0,onClose:i,maxWidth:"sm",fullWidth:!0,children:[(0,v.jsx)(l.A,{children:j?"Edit Stock Item":"Add New Stock Item"}),(0,v.jsx)(r.A,{children:(0,v.jsxs)(s.A,{component:"form",onSubmit:J,id:"add-item-form",noValidate:!0,sx:{mt:1},children:[(0,v.jsx)(a.A,{inputRef:b,margin:"normal",required:!0,fullWidth:!0,id:"deliveryName",label:"Delivery Name",name:"deliveryName",value:A,onChange:e=>I(e.target.value),error:!!H.deliveryName,helperText:H.deliveryName,InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"productName",label:"Product Name",name:"productName",value:D,onChange:e=>C(e.target.value),error:!!H.productName,helperText:H.productName,InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"The common name of the item. Example: Blue Widget Model X",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"quantity",label:"Quantity",name:"quantity",type:"number",value:k,onChange:e=>E(""===e.target.value?"":Number(e.target.value)),error:!!H.quantity,helperText:H.quantity,InputProps:{inputProps:{min:1},endAdornment:(0,v.jsx)(d.A,{title:"How many units of this item are included? Example: 50",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"pricePerItem",label:"Price Per Item",name:"pricePerItem",type:"number",value:w,onChange:e=>N(""===e.target.value?"":Number(e.target.value)),error:!!H.pricePerItem,helperText:H.pricePerItem,InputProps:{inputProps:{min:0,step:.01},endAdornment:(0,v.jsx)(d.A,{title:"The cost for one single unit. Example: 12.50",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"orderDate",label:"Order Date",name:"orderDate",type:"date",value:F,onChange:e=>O(e.target.value),error:!!H.orderDate,helperText:H.orderDate,InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"The date the item was purchased or the return initiated.",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"purchaseStatus",label:"Purchase Status",name:"purchaseStatus",select:!0,value:y,onChange:e=>S(e.target.value),InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"What is the origin of this item?",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})},children:[(0,v.jsx)(u.A,{value:"Purchased",children:"Purchased"}),(0,v.jsx)(u.A,{value:"Ordered",children:"Ordered"}),(0,v.jsx)(u.A,{value:"Return Expected",children:"Return Expected"})]}),(0,v.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"orderNumber",label:"Order Number",name:"orderNumber",value:P,onChange:e=>T(e.target.value),InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"Optional: External reference like eBay order ID or PO number. Example: 12-34567-89012",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"seller",label:"Seller / Source",name:"seller",value:R,onChange:e=>$(e.target.value),InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"Optional: Who did this item come from? Example: ebay_seller_123 or Customer Name (Return)",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"isVatRegistered",label:"Seller VAT Registered?",name:"isVatRegistered",select:!0,value:U,onChange:e=>z(e.target.value),InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"Optional: Is the seller registered for VAT?",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})},children:[(0,v.jsx)(u.A,{value:"Unknown",children:"Unknown"}),(0,v.jsx)(u.A,{value:"Yes",children:"Yes"}),(0,v.jsx)(u.A,{value:"No",children:"No"})]}),(0,v.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"destination",label:"Planned Destination",name:"destination",select:!0,value:["FBA Prep","Local Stock Shelf A","Refurbish Pile","Return to Supplier"].includes(L)?L:"Other",onChange:e=>{"Other"===e.target.value?W(""):W(e.target.value)},InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"Optional: Where is this item intended to go after processing? Example: FBA Prep",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})},children:[(0,v.jsx)(u.A,{value:"FBA Prep",children:"FBA Prep"}),(0,v.jsx)(u.A,{value:"Local Stock Shelf A",children:"Local Stock Shelf A"}),(0,v.jsx)(u.A,{value:"Refurbish Pile",children:"Refurbish Pile"}),(0,v.jsx)(u.A,{value:"Return to Supplier",children:"Return to Supplier"}),(0,v.jsx)(u.A,{value:"Other",children:"Other (Specify Below)"})]}),""===L&&(0,v.jsx)(a.A,{margin:"dense",fullWidth:!0,id:"customDestination",label:"Specify Destination",name:"customDestination",value:L,onChange:e=>W(e.target.value),required:!0,error:!!H.destination,helperText:H.destination}),(0,v.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"asinSku",label:"ASIN / SKU",name:"asinSku",value:_,onChange:e=>q(e.target.value),InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"Optional: Amazon ASIN or internal SKU. Helps link inventory. Example: B0C1EXAMPLE / BLUE-WIDGET-XL",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"acquisitionNotes",label:"Acquisition Notes",name:"acquisitionNotes",value:B,onChange:e=>G(e.target.value),InputProps:{endAdornment:(0,v.jsx)(d.A,{title:"Optional: Any specific notes from the purchase, order, or return request. Example: Seller mentioned slight scratch.",children:(0,v.jsx)(c.A,{size:"small",edge:"end",children:(0,v.jsx)(x.A,{fontSize:"small"})})})}}),(0,v.jsx)(g.A,{control:(0,v.jsx)(p.A,{id:"isFlagged",checked:M,onChange:e=>V(e.target.checked),name:"isFlagged"}),label:(0,v.jsxs)(s.A,{component:"span",sx:{display:"flex",alignItems:"center"},children:["Flag this item for follow-up",(0,v.jsx)(d.A,{title:"Check this box to mark the item with a flag for easy filtering later.",children:(0,v.jsx)(c.A,{size:"small",edge:"end",sx:{ml:.5},children:(0,v.jsx)(x.A,{fontSize:"inherit"})})})]}),sx:{mt:1}})]})}),(0,v.jsxs)(m.A,{children:[(0,v.jsx)(h.A,{onClick:i,children:"Cancel"}),(0,v.jsx)(h.A,{type:"submit",form:"add-item-form",variant:"contained",onClick:J,children:j?"Save Changes":"Add Item"})]})]})}},3691:(e,t,i)=>{i.d(t,{A:()=>c});var n=i(8613),o=i(9550),l=i(5929),r=i(579);const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e||null===e||""===e?(0,r.jsx)("span",{style:{color:"#888"},children:"N/A"}):`${t}${e}${i}`},a=e=>{var t;const i=new Date(e.timestamp).toLocaleString();switch(e.type){case"CREATED":return`${i}: Item Created`;case"EDITED":return`${i}: Item Edited (${(null===(t=e.details.changedFields)||void 0===t?void 0:t.join(", "))||"details"} changed)`;case"STATUS_CHANGED":return`${i}: Status changed from ${e.details.previousStatus||"?"} to ${e.details.newStatus||"?"}`;case"FLAG_TOGGLED":return`${i}: Item ${e.details.isFlagged?"Flagged":"Unflagged"}`;case"ISSUE_REPORTED":return`${i}: Issue Reported: ${e.details.issueDescription||""}`;case"ISSUE_UPDATE_ADDED":return`${i}: Issue Update Added: ${e.details.note||""}`;case"ISSUE_RESOLVED":return`${i}: Issue Resolved (Outcome: ${e.details.resolutionOutcome||"N/A"}${e.details.note?` - Note: ${e.details.note}`:""}`;case"NOTE_ADDED":return`${i}: Note Added: ${e.details.note||""}`;default:return`${i}: Unknown action`}},d=e=>{var t,i,n,l,r,s,a,d,c,u;const g=e.timestamp instanceof o.Dc?e.timestamp.toDate().toISOString():"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),p=e.userId||"system";let m=null,h={};switch(e.action){case"item.create":m="CREATED";break;case"item.update.fields":m="EDITED";h={changedFields:e.before&&e.after?Object.keys(e.after).filter((t=>e.before&&e.after&&JSON.stringify(e.before[t])!==JSON.stringify(e.after[t]))):(null===(t=e.details)||void 0===t?void 0:t.changedFields)||["details"]};break;case"item.update.status.Delivered":m="STATUS_CHANGED",h={previousStatus:null===(i=e.before)||void 0===i?void 0:i.currentStatus,newStatus:"Delivered"};break;case"item.update.status.Archived":m="STATUS_CHANGED",h={previousStatus:null===(n=e.before)||void 0===n?void 0:n.currentStatus,newStatus:"Archived"};break;case"item.update.flag":m="FLAG_TOGGLED",h={isFlagged:null===(l=e.after)||void 0===l?void 0:l.isFlagged};break;case"item.update.issue.report":m="ISSUE_REPORTED",h={issueDescription:(null===(r=e.details)||void 0===r?void 0:r.description)||(null===(s=e.details)||void 0===s?void 0:s.issueDescription)};break;case"item.update.issue.resolve":m="ISSUE_RESOLVED",h={resolutionOutcome:null===(a=e.details)||void 0===a?void 0:a.outcome,note:null===(d=e.details)||void 0===d?void 0:d.note};break;case"item.update.issue.update":m="ISSUE_UPDATE_ADDED",h={note:null===(c=e.details)||void 0===c?void 0:c.note};break;case"item.add_note":m="NOTE_ADDED",h={note:null===(u=e.details)||void 0===u?void 0:u.note};break;default:return console.warn(`Unhandled log action type for UI mapping: ${e.action}`),null}return m?{timestamp:g,userId:p,type:m,details:h}:null},c=e=>{let{item:t,orgId:i,onClose:c,closeButtonRef:u,onActionSelected:g}=e;const[p,m]=(0,n.useState)([]),[h,x]=(0,n.useState)(!0),[v,f]=(0,n.useState)(null),b=(0,l.getAvailableActions)(t.currentStatus,t.isFlagged),j={padding:"6px 12px",border:"1px solid #007bff",backgroundColor:"#007bff",color:"white",borderRadius:"4px",cursor:"pointer"},y={marginBottom:"8px",paddingBottom:"8px",borderBottom:"1px dashed #eee",fontSize:"0.9em"};return(0,n.useEffect)((()=>{if(null===t||void 0===t||!t.id||!i)return x(!1),void f("Missing item or organization ID for fetching logs.");m([]),x(!0),f(null);const e=(0,o.aU)(),n=`stockItems/${t.id}`,l=(0,o.rJ)(e,`orgs/${i}/logs`),r=(0,o.P)(l,(0,o._M)("entityPath","==",n),(0,o.My)("timestamp","desc")),s=(0,o.aQ)(r,(e=>{const t=e.docs.map((e=>({...e.data()}))).map(d).filter((e=>null!==e));m(t),x(!1)}),(e=>{console.error("Error fetching logs: ",e),f(`Failed to fetch activity log: ${e.message}`),x(!1)}));return()=>s()}),[null===t||void 0===t?void 0:t.id,i]),(0,r.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:30},onClick:c,children:[" ",(0,r.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",border:"1px solid #ccc",borderRadius:"8px",maxWidth:"600px",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[" ",(0,r.jsxs)("h3",{children:["Item Details: ",t.productName," - ",t.deliveryName]}),(0,r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginBottom:"15px"},children:b.map((e=>(0,r.jsx)("button",{style:j,onClick:()=>g(t.id,e),children:e},e)))}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"20px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"ID:"})," ",t.id]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",t.currentStatus]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Flagged:"})," ",t.isFlagged?"Yes":"No"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Product:"})," ",t.productName]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Delivery:"})," ",t.deliveryName]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Quantity:"})," ",t.quantity]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Price/Item:"})," ",s(t.pricePerItem,"\xa3")]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Order Date:"})," ",t.orderDate]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Purchase Status:"})," ",s(t.purchaseStatus)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Order #:"})," ",s(t.orderNumber)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Seller/Source:"})," ",s(t.seller)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Destination:"})," ",s(t.destination)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"ASIN/SKU:"})," ",s(t.asinSku)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Acquisition Notes:"})," ",s(t.acquisitionNotes)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Date Delivered:"})," ",s(t.dateDelivered?new Date(t.dateDelivered).toLocaleString():void 0)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Issue Description:"})," ",s(t.issueDescription)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Processor Notes:"})," ",s(t.processorNotes)]})]}),(0,r.jsxs)("details",{style:{marginTop:"20px"},children:[(0,r.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"History / Activity Log"}),h&&(0,r.jsx)("div",{children:"Loading activity..."}),v&&(0,r.jsx)("div",{style:{color:"red"},children:v}),!h&&!v&&0===p.length&&(0,r.jsx)("div",{children:"No activity recorded."}),(0,r.jsx)("ul",{style:{paddingLeft:"20px",marginTop:"10px"},children:p.map(((e,t)=>(0,r.jsx)("li",{style:y,children:a(e)},t)))})]}),(0,r.jsx)("div",{style:{marginTop:"20px",textAlign:"right"},children:(0,r.jsx)("button",{ref:u,onClick:c,style:{padding:"8px 15px",fontWeight:"bold"},children:"Close"})})]})]})}},5929:(e,t,i)=>{i.r(t),i.d(t,{ActionMenu:()=>M,default:()=>ne,getAvailableActions:()=>G});var n=i(7064),o=i(3997),l=i(9550),r=i(8613),s=i(9284),a=i(8677),d=i(1024),c=i(6800),u=i(3368),g=i(3691),p=i(5982),m=i(1453),h=i(2630),x=i(7694),v=i(7553),f=i(2571),b=i(2967),j=i(8229),y=i(6687),S=i(6623),A=i(8889),I=i(2731),D=i(5557),C=i(3287),k=i(7397),E=i(6647),w=i(6859),N=i(2523),P=i(2011),T=i(4755),F=i(9841),O=i(1399),R=i(2043),$=i(2950),U=i(579);function z(e){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,i]=e;return void 0!==i})))}const L=e=>{let{onSearch:t,inputRef:i}=e;return(0,U.jsx)(f.A,{inputRef:i,fullWidth:!0,variant:"outlined",placeholder:"Search by Delivery Name or Product Name...",onChange:e=>t(e.target.value),sx:{mb:2}})},W=e=>{let{currentFilter:t,onFilterChange:i}=e;return(0,U.jsx)(b.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,U.jsx)(j.A,{value:t,onChange:(e,t)=>{i(t)},variant:"scrollable",scrollButtons:"auto","aria-label":"Stock item status filter tabs",children:["All","Pending Delivery","Delivered","Issue","Late","Archived"].map((e=>(0,U.jsx)(y.A,{label:e,value:e},e)))})})},_=e=>{if("Pending Delivery"!==e.currentStatus)return!1;const t=new Date(e.orderDate),i=new Date;return i.setDate(i.getDate()-7),t<i},q=(e,t,i)=>{const n=i?{borderLeft:"3px solid red"}:{};let o={};if("Pending Delivery"===e&&t)o={backgroundColor:"#cce5ff",color:"#004085"};else switch(e){case"Pending Delivery":o={backgroundColor:"#fff3cd",color:"#856404"};break;case"Delivered":o={backgroundColor:"#d4edda",color:"#155724"};break;case"Issue":o={backgroundColor:"#f8d7da",color:"#721c24"};break;case"Archived":o={backgroundColor:"#e2e3e5",color:"#383d41"};break;default:o={}}return{...o,...n}},B=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:(new Date).toISOString(),type:t,userId:e,details:i}},G=(e,t)=>{let i=[];switch(e){case"Pending Delivery":case"Late":i=["Mark as Delivered","Report Issue","View Details","Edit Item","Add Note"];break;case"Delivered":i=["Archive","Report Issue","View Details","Edit Item","Add Note"];break;case"Issue":i=["Resolve Issue","Add Issue Update","Archive","View Details","Edit Item","Add Note"];break;default:i=["View Details"]}return"Archived"!==e&&i.unshift(t?"Unflag Item":"Flag Item"),i},M=e=>{let{itemId:t,actions:i,onActionSelected:n,onClose:o,anchorEl:l,open:r}=e;return(0,U.jsx)(S.A,{anchorEl:l,open:r,onClose:o,MenuListProps:{"aria-labelledby":`actions-button-${t}`},children:i.map((e=>(0,U.jsx)(A.A,{onClick:()=>(e=>{n(t,e),o()})(e),children:e},e)))})},V=[{id:"orderDate",label:"Order Date"},{id:"quantity",label:"Qty"},{id:"productName",label:"Product Name"},{id:"deliveryName",label:"Delivery Name"},{id:"pricePerItem",label:"Price/Item"},{id:"seller",label:"Seller/Source"},{id:"destination",label:"Destination"},{id:"asinSku",label:"ASIN/SKU"},{id:"purchaseStatus",label:"Purchase Status"},{id:"orderNumber",label:"Order #"},{id:"currentStatus",label:"Status"},{id:"isFlagged",label:"Flagged"},{id:"acquisitionNotes",label:"Acquisition Notes"},{id:"issueDescription",label:"Issue Description"},{id:"dateDelivered",label:"Date Delivered"},{id:"actions",label:"Actions"}],H=["orderDate","quantity","productName","deliveryName","currentStatus","actions"],K="incomingTool_visibleColumns",J=e=>{let{col:t}=e;const{attributes:i,listeners:n,setNodeRef:o,transform:l,transition:r,isDragging:s}=(0,a.gl)({id:t.id}),c={transform:d.Ks.Transform.toString(l),transition:r,cursor:"grab",opacity:s?.5:1,touchAction:"none",backgroundColor:s?"#e0e0e0":void 0};return(0,U.jsx)(I.A,{ref:o,component:"th",scope:"col",style:c,...i,...n,sx:{fontWeight:"bold",cursor:"grab"},children:t.label})},Q=e=>{let{onClick:t}=e;return(0,U.jsx)(D.A,{variant:"contained",color:"primary",startIcon:(0,U.jsx)($.A,{}),onClick:t,sx:{mb:2},children:"Add New Item"})},Y=e=>{let{isFlagged:t,onToggle:i,disabled:n}=e;return(0,U.jsx)(C.A,{title:t?"Unflag Item":"Flag Item",placement:"top",children:(0,U.jsx)("span",{children:(0,U.jsx)(k.A,{checked:t,onChange:i,disabled:n,size:"small",onClick:e=>e.stopPropagation()})})})},Z=e=>{let{isChecked:t,onChange:i}=e;return(0,U.jsxs)("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center"},children:[" ",(0,U.jsx)("label",{htmlFor:"flagToggle",style:{marginRight:"8px",fontWeight:"bold"},children:"Show Flagged Only:"}),(0,U.jsx)("input",{type:"checkbox",id:"flagToggle",checked:t,onChange:e=>i(e.target.checked),style:{width:"20px",height:"20px"}})]})},X=e=>{let{onClose:t}=e;return(0,U.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,U.jsxs)("div",{style:{background:"white",padding:32,borderRadius:8,minWidth:400},children:[(0,U.jsx)("h3",{children:"Keyboard Shortcuts"}),(0,U.jsxs)("ul",{style:{lineHeight:2},children:[(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"/"})," \u2014 Focus search bar"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"a"})," \u2014 Add new item"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"c"})," \u2014 Open columns/settings"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"f"})," \u2014 Toggle flagged only"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"1-6"})," \u2014 Switch filter tabs"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"?"})," \u2014 Show this help"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"Arrow Up/Down"})," \u2014 Move row selection"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"Enter/o"})," \u2014 View details for selected row"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"e"})," \u2014 Edit selected row"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"r"})," \u2014 Report issue for selected row"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"l"})," \u2014 Flag/unflag selected row"]}),(0,U.jsxs)("li",{children:[(0,U.jsx)("b",{children:"Esc"})," \u2014 Close any open modal"]})]}),(0,U.jsx)("button",{autoFocus:!0,onClick:t,style:{marginTop:16,padding:"8px 20px"},children:"Close"})]})})},ee={apiKey:"AIzaSyCC6x0MS2KOTIZtZUYh59KdsBos1fasNtA",authDomain:"hubalm.firebaseapp.com",projectId:"hubalm",storageBucket:"hubalm.firebasestorage.app",messagingSenderId:"201098929511",appId:"1:201098929511:web:a257c60dd4d6b4d2ab7bc2"};Object.entries(ee).forEach((e=>{let[t,i]=e;if(!i)throw new Error(`Missing Firebase config value for ${t}. Did you set your .env file?`)}));const te=(0,n.Wp)(ee),ie=((0,o.xI)(te),(0,l.aU)(te)),ne=e=>{var t,i,n,o;let{user:d,org:f,permissions:b,logAction:j}=e;console.log("ToolApp Props Received:",{user:d,orgId:null===f||void 0===f?void 0:f.id,permissions:b,logActionExists:!!j});const[y,S]=(0,r.useState)(-1),[A,D]=(0,r.useState)(!1),[C,k]=(0,r.useState)([]),[$,ee]=(0,r.useState)(!0),[te,ne]=(0,r.useState)(null),[oe,le]=(0,r.useState)(""),[re,se]=(0,r.useState)("Pending Delivery"),[ae,de]=(0,r.useState)(null),[ce,ue]=(0,r.useState)(!1),[ge,pe]=(0,r.useState)(!1),[me,he]=(0,r.useState)(null),[xe,ve]=(0,r.useState)(null),[fe,be]=(0,r.useState)(null),[je,ye]=(0,r.useState)(null),[Se,Ae]=(0,r.useState)(!1),[Ie,De]=(0,r.useState)(!1),[Ce,ke]=(0,r.useState)(null),[Ee,we]=(0,r.useState)(!1),[Ne,Pe]=(0,r.useState)((()=>{try{const e=localStorage.getItem(K),t=e?JSON.parse(e):H;return Array.isArray(t)?t:H}catch(te){return console.error("Error reading visible columns from localStorage",te),H}}));(0,r.useEffect)((()=>{try{localStorage.setItem(K,JSON.stringify(Ne))}catch(te){console.error("Error saving visible columns to localStorage",te)}}),[Ne]);const Te=Ne.map((e=>V.find((t=>t.id===e)))).filter((e=>void 0!==e)),Fe=C.filter((e=>{const t=!oe||e.deliveryName.toLowerCase().includes(oe.toLowerCase())||e.productName.toLowerCase().includes(oe.toLowerCase());let i=!1;i="All"===re||("Late"===re?_(e):e.currentStatus===re);const n=!ge||!0===e.isFlagged;return i&&t&&n}));(0,r.useEffect)((()=>{S((e=>0===Fe.length?-1:e<0?0:e>=Fe.length?Fe.length-1:e))}),[Fe]),(0,r.useEffect)((()=>{if(null===f||void 0===f||!f.id)return;ee(!0),ne(null);const e=(0,l.P)((0,l.rJ)(ie,"orgs",f.id,"stockItems"),(0,l.My)("orderDate","desc")),t=(0,l.aQ)(e,(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));k(t),ee(!1)}),(e=>{ne("Failed to load items: "+e.message),ee(!1)}));return()=>t()}),[null===f||void 0===f?void 0:f.id]);const Oe=(0,r.useCallback)((async(e,t,i,n)=>{if(!ie||null===f||void 0===f||!f.id||!t)return console.error("Cannot update item: Missing configuration.",{db:!!ie,orgId:null===f||void 0===f?void 0:f.id,userId:t}),void ne("Cannot update item: Missing configuration.");const o=(0,l.H9)(ie,"orgs",f.id,"stockItems",e),r=C.find((t=>t.id===e));if(!r)return console.error(`Item ${e} not found for update`),void ne(`Item ${e} not found.`);const s=z({...i,lastUpdated:(0,l.O5)()}),a={...r,...s};try{if(await(0,l.mZ)(o,s),console.log(`Item ${e} updated successfully.`),console.log("updateItemAndLog: Attempting to log action. logAction available?",!!j),j){let t;try{if("EDITED"===n.type)t="item.update.fields";else if("FLAG_TOGGLED"===n.type)t="item.update.flag";else if("STATUS_CHANGED"===n.type){var d,c;t=`item.update.status.${(null===(d=n.details)||void 0===d||null===(c=d.newStatus)||void 0===c?void 0:c.toLowerCase())||"unknown"}`}else t="ISSUE_REPORTED"===n.type?"item.update.issue.report":"ISSUE_RESOLVED"===n.type?"item.update.issue.resolve":"ISSUE_UPDATE_ADDED"===n.type?"item.update.issue.update":"NOTE_ADDED"===n.type?"item.add_note":n.type}catch(u){console.error("Error deriving action name for logging:",u),t=n.type}const i={orgId:f.id,toolKey:"incomingtool",action:t,entityPath:`stockItems/${e}`,...void 0!==r&&{before:r},...void 0!==a&&{after:a},...void 0!==n.details&&{details:n.details}};await j(i)}}catch(g){throw console.error(`Error updating item ${e}:`,g),ne(`Failed to update item: ${g.message}`),g}}),[f,C,j]),Re=(0,r.useCallback)((async(e,t)=>{console.log(`Action: ${t} on item ${e}`);const i=C.find((t=>t.id===e));if(i)switch(t){case"Edit Item":he(i),ue(!0);break;case"Flag Item":case"Unflag Item":const n="Flag Item"===t;await Oe(e,null===d||void 0===d?void 0:d.uid,{isFlagged:n},B((null===d||void 0===d?void 0:d.uid)||"","FLAG_TOGGLED",{isFlagged:n}));break;case"Mark as Delivered":"Delivered"!==i.currentStatus&&await Oe(e,null===d||void 0===d?void 0:d.uid,{currentStatus:"Delivered",dateDelivered:(new Date).toISOString()},B((null===d||void 0===d?void 0:d.uid)||"","STATUS_CHANGED",{previousStatus:i.currentStatus,newStatus:"Delivered"}));break;case"Archive":"Archived"!==i.currentStatus&&await Oe(e,null===d||void 0===d?void 0:d.uid,{currentStatus:"Archived"},B((null===d||void 0===d?void 0:d.uid)||"","STATUS_CHANGED",{previousStatus:i.currentStatus,newStatus:"Archived"}));break;case"Add Note":ke(i);break;case"Report Issue":de(null),ve(i);break;case"Resolve Issue":de(null),ye(i);break;case"Add Issue Update":de(null),be(i);break;case"View Details":de(i)}}),[null===d||void 0===d?void 0:d.uid,C,Oe,he,ue,ve,be,ye,de]),$e=(0,r.useCallback)((async e=>{if(!xe||null===f||void 0===f||!f.id)return;const t=xe.id;try{await Oe(t,null===d||void 0===d?void 0:d.uid,{currentStatus:"Issue",issueDescription:e},B((null===d||void 0===d?void 0:d.uid)||"","ISSUE_REPORTED",{issueDescription:e})),ve(null)}catch(i){ne("Failed to report issue: "+i.message)}}),[xe,null===f||void 0===f?void 0:f.id,null===d||void 0===d?void 0:d.uid,Oe,ve,ne]),Ue=(0,r.useCallback)((async e=>{if(fe)try{await Oe(fe.id,null===d||void 0===d?void 0:d.uid,{},B((null===d||void 0===d?void 0:d.uid)||"","ISSUE_UPDATE_ADDED",{note:e})),be(null)}catch(t){}}),[fe,Oe,be,null===d||void 0===d?void 0:d.uid]),ze=(0,r.useCallback)((async(e,t)=>{if(!je||null===f||void 0===f||!f.id||!ie)return;const i=je.id;let n="Delivered";"Returned to Supplier"!==e&&"Disposed Of"!==e||(n="Archived");B((null===d||void 0===d?void 0:d.uid)||"","ISSUE_RESOLVED",{resolutionOutcome:e,note:t});try{const o=(0,l.H9)(ie,"orgs",f.id,"stockItems",i);await(0,l.mZ)(o,{currentStatus:n,lastUpdated:(0,l.O5)()});const r=C.find((e=>e.id===i));console.log("handleSaveResolveIssue: Attempting to log action. logAction available?",!!j),j&&await j({orgId:f.id,toolKey:"incomingtool",action:"item.update.issue.resolve",entityPath:`stockItems/${i}`,before:r,after:{...r,currentStatus:n},details:{resolutionOutcome:e,note:t}}),ye(null)}catch(o){ne("Failed to resolve issue: "+o.message)}}),[je,null===f||void 0===f?void 0:f.id,null===d||void 0===d?void 0:d.uid,C,j,ye,ne]),Le=(0,r.useCallback)((()=>{ue(!1),he(null)}),[ue,he]),We=(0,r.useCallback)((async e=>{if(console.log("ToolApp: current editingItem at save",me),null===f||void 0===f||!f.id||!ie)return console.error("ToolApp: Cannot save item because org.id or db is undefined",f),void ne("Cannot save item: No organization selected or database unavailable.");console.log("ToolApp: handleSaveItem called",e);try{if(me&&me.id){const t=me.id,i=Object.keys(e).filter((t=>me.hasOwnProperty(t)&&me[t]!==e[t]));"isFlagged"in e&&!i.includes("isFlagged")&&me.isFlagged!==e.isFlagged&&i.push("isFlagged");const n=B((null===d||void 0===d?void 0:d.uid)||"","EDITED",{changedFields:i.length>0?i:void 0});await Oe(t,null===d||void 0===d?void 0:d.uid,e,n)}else{B((null===d||void 0===d?void 0:d.uid)||"","CREATED");const t=z({...e,currentStatus:"Pending Delivery",lastUpdated:(0,l.O5)()}),i=await(0,l.gS)((0,l.rJ)(ie,"orgs",f.id,"stockItems"),t);console.log("handleSaveItem: Attempting to log action. logAction available?",!!j),j&&await j({orgId:f.id,toolKey:"incomingtool",action:"item.create",entityPath:`stockItems/${i.id}`,after:t})}Le()}catch(t){console.error("Failed to save item",t),ne("Failed to save item: "+t.message)}}),[me,f,d,j,Oe,Le,ne]),_e=(0,r.useCallback)((()=>{de(null)}),[de]),qe=(0,r.useRef)(void 0);(0,r.useEffect)((()=>{qe.current=null===f||void 0===f?void 0:f.id}),[f]);const Be=(0,r.useCallback)((()=>{qe.current?(he(null),ue(!0)):ne("Cannot add item: Organization ID is missing.")}),[ue,he,ne]),Ge=(0,r.useRef)(null),Me=e=>{const t=C.find((t=>t.id===e));t&&de(t)};(0,r.useEffect)((()=>{const e=e=>{var t;const i=e.target,n=i.tagName;if("INPUT"===n||"TEXTAREA"===n||i.isContentEditable)return;if(ce||Se||ae||xe||fe||je||A||Ee)"Escape"===e.key&&(ce&&ue(!1),Se&&Ae(!1),ae&&de(null),xe&&ve(null),fe&&be(null),je&&ye(null),A&&D(!1),Ee&&we(!1));else{if(e.key>="1"&&e.key<="6"){const t=["All","Pending Delivery","Delivered","Issue","Late","Archived"],i=parseInt(e.key,10)-1;if(i>=0&&i<t.length)return se(t[i]),void e.preventDefault()}if("?"===e.key)return D(!0),void e.preventDefault();if(Fe.length>0){if("ArrowDown"===e.key)return S((e=>Math.min(Fe.length-1,e<0?0:e+1))),void e.preventDefault();if("ArrowUp"===e.key)return S((e=>Math.max(0,e-1))),void e.preventDefault();if(("Enter"===e.key||"o"===e.key)&&y>=0&&y<Fe.length)return de(Fe[y]),void e.preventDefault();if("e"===e.key&&y>=0&&y<Fe.length){const t=Fe[y];return he(t),ue(!0),void e.preventDefault()}if("r"===e.key&&y>=0&&y<Fe.length)return ve(Fe[y]),void e.preventDefault();if("l"===e.key&&y>=0&&y<Fe.length){const t=Fe[y];return Re(t.id,t.isFlagged?"Unflag Item":"Flag Item"),void e.preventDefault()}}switch(e.key){case"/":e.preventDefault(),null===(t=Ge.current)||void 0===t||t.focus();break;case"a":case"A":me||Be();break;case"c":case"C":Ae(!0)}}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[ce,Se,ae,xe,fe,je,A,Ee,Fe,y,me,Re,se,Be]);const Ve=(0,r.useCallback)((async(e,t)=>{if(null===d||void 0===d||!d.uid)return console.error("User ID is missing, cannot save note."),void ne("User ID is missing, cannot save note.");console.log(`Saving general note for item ${e}: ${t}`);try{const i=B(d.uid,"NOTE_ADDED",{note:t});await Oe(e,d.uid,{},i),console.log(`General note saved and logged for item ${e}`),ke(null)}catch(i){console.error(`Error saving general note for item ${e}:`,i),ne(`Failed to save note: ${i.message}`)}}),[null===d||void 0===d?void 0:d.uid,Oe]),[He,Ke]=(0,r.useState)(null),[Je,Qe]=(0,r.useState)(null),Ye=(e,t)=>{var i,n;const o={verticalAlign:"middle",padding:"8px 16px"};switch(t){case"isFlagged":return(0,U.jsx)(I.A,{sx:o,align:"center",children:(0,U.jsx)(Y,{isFlagged:null!==(i=e.isFlagged)&&void 0!==i&&i,onToggle:()=>Ze(e.id,!e.isFlagged),disabled:"Archived"===e.currentStatus})},t);case"actions":return(0,U.jsx)(I.A,{sx:o,align:"right",children:"Archived"!==e.currentStatus&&(0,U.jsxs)(E.A,{"aria-label":`actions-for-${e.id}`,"aria-controls":`actions-menu-${e.id}`,"aria-haspopup":"true",onClick:t=>{t.stopPropagation(),((e,t)=>{Qe(e.currentTarget),Ke(t)})(t,e.id)},size:"small",children:[(0,U.jsx)(R.A,{fontSize:"small"})," "]})},t);case"currentStatus":const l=_(e);return(0,U.jsx)(I.A,{sx:{...o,...q(e.currentStatus,l,e.isFlagged)},children:e.currentStatus},t);case"quantity":case"pricePerItem":const r=e[t];return(0,U.jsx)(I.A,{sx:{...o,textAlign:"right"},children:"number"===typeof r?r.toLocaleString():"-"},t);case"dateDelivered":case"orderDate":const s=e[t],a="string"===typeof s&&s?new Date(s).toLocaleDateString():"-";return(0,U.jsx)(I.A,{sx:o,children:a},t);case"acquisitionNotes":case"issueDescription":const d=e[t];return(0,U.jsx)(I.A,{sx:o,children:"string"===typeof d?d:"-"},t);case"productName":case"deliveryName":case"seller":case"destination":case"asinSku":case"purchaseStatus":case"orderNumber":return(0,U.jsx)(I.A,{sx:o,children:null!==(n=e[t])&&void 0!==n?n:"-"},t);default:console.warn("Unhandled column ID in renderCellContent:",t);const c=e[t];return(0,U.jsx)(I.A,{sx:o,children:null!==c&&void 0!==c?c:"-"},t)}},Ze=(0,r.useCallback)((async(e,t)=>{if(null===f||void 0===f||!f.id||null===d||void 0===d||!d.uid)return console.error("Cannot toggle flag: OrgID or UserID missing."),void ne("Error: Missing user or organization information.");const i=(0,l.H9)(ie,"orgs",f.id,"stockItems",e);try{await(0,l.mZ)(i,{isFlagged:t}),console.log(`Item ${e} flag toggled successfully.`);const n=C.find((t=>t.id===e));console.log("handleToggleFlag: Attempting to log action. logAction available?",!!j),j&&await j({orgId:f.id,toolKey:"incomingtool",action:"item.update.flag",entityPath:`stockItems/${e}`,before:n,after:{...n,isFlagged:t},details:{newFlagState:t}})}catch(te){console.error("Error toggling flag status:",te),ne("Failed to update item flag status.")}}),[f,d,j,ne]),Xe=(0,s.FR)((0,s.MS)(s.AN),(0,s.MS)(s.uN,{coordinateGetter:a.JR})),et={"Pending Delivery":"#fffde7",Delivered:"#e3f2fd",Issue:"#ffebee",Late:"#fff3e0",Archived:"#f5f5f5"};return(0,U.jsxs)("div",{style:{padding:24},children:[(0,U.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,U.jsx)("h2",{children:"Incoming Stock Tool"}),(0,U.jsxs)("div",{children:[(0,U.jsx)("button",{onClick:()=>we(!0),style:{marginRight:"10px"},children:"View User Activity"}),(0,U.jsx)("button",{onClick:()=>Ae(!0),children:"Table Settings"})]})]}),te&&(0,U.jsxs)("div",{style:{color:"red",marginBottom:"1rem"},children:["Error: ",te]}),$&&(0,U.jsx)("div",{style:{color:"blue",marginBottom:"1rem"},children:"Loading items..."}),(0,U.jsx)(Q,{onClick:Be}),(0,U.jsx)(L,{onSearch:e=>{le(e)},inputRef:Ge}),(0,U.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[(0,U.jsx)(W,{currentFilter:re,onFilterChange:e=>{se(e)}}),(0,U.jsx)(Z,{isChecked:ge,onChange:pe})]}),(0,U.jsx)(s.Mp,{sensors:Xe,collisionDetection:s.fp,onDragEnd:e=>{const{active:t,over:i}=e;i&&t.id!==i.id&&Pe((e=>{const n=e.indexOf(t.id),o=e.indexOf(i.id);return(0,a.be)(e,n,o)}))},modifiers:[c.dU],children:(0,U.jsx)(w.A,{component:N.A,sx:{mt:2},children:(0,U.jsxs)(P.A,{sx:{minWidth:650},"aria-label":"stock processing table",children:[(0,U.jsx)(a.gB,{items:Te.map((e=>e.id)),strategy:a.m$,children:(0,U.jsx)(T.A,{children:(0,U.jsx)(F.A,{children:Te.map((e=>(0,U.jsx)(J,{col:e},e.id)))})})}),(0,U.jsx)(O.A,{children:Fe.length>0?Fe.map(((e,t)=>{const i=t===y;return(0,U.jsx)(F.A,{hover:!0,onClick:()=>Me(e.id),selected:i,sx:{cursor:"pointer",backgroundColor:et[e.currentStatus]||"inherit","&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.selected"}},"&:hover":{backgroundColor:i?"action.hover":et[e.currentStatus]?`color-mix(in srgb, ${et[e.currentStatus]} 90%, black 10%)`:"action.hover"}},children:Te.map((t=>Ye(e,t.id)))},e.id)})):(0,U.jsx)(F.A,{children:(0,U.jsx)(I.A,{colSpan:Te.length,align:"center",sx:{py:3},children:"No items match the current filter or none loaded yet."})})})]})})}),ce&&(0,U.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:20},children:[" ",(0,U.jsx)(u.A,{onSave:We,onClose:Le,initialData:me})]}),ae&&(0,U.jsx)(g.A,{item:ae,orgId:f.id,onClose:_e,onActionSelected:Re}),xe&&(0,U.jsx)(p.A,{item:xe,onSubmit:$e,onClose:()=>ve(null)}),fe&&(0,U.jsx)(m.A,{item:fe,onSubmit:Ue,onClose:()=>be(null)}),je&&(0,U.jsx)(h.A,{item:je,onSubmit:ze,onClose:()=>ye(null)}),Ce&&(0,U.jsx)(m.A,{item:Ce,onSubmit:e=>Ve(Ce.id,e),onClose:()=>ke(null)}),(0,U.jsx)(x.A,{isOpen:Se,onClose:()=>Ae(!1),allColumns:V,initialVisibleColumns:Te,onSave:e=>{Pe((t=>{const i=new Set(e);return[...t.filter((e=>i.has(e))),...e.filter((e=>!t.includes(e)))]})),Ae(!1)}}),Ee&&(null===f||void 0===f?void 0:f.id)&&(0,U.jsx)(v.A,{orgId:f.id,onClose:()=>we(!1),onEntityClick:Me,onActionSelected:Re}),A&&(0,U.jsx)(X,{onClose:()=>D(!1)}),(0,U.jsx)(M,{itemId:He||"",actions:He?G(null!==(t=null===(i=Fe.find((e=>e.id===He)))||void 0===i?void 0:i.currentStatus)&&void 0!==t?t:"Pending Delivery",null!==(n=null===(o=Fe.find((e=>e.id===He)))||void 0===o?void 0:o.isFlagged)&&void 0!==n&&n):[],onActionSelected:Re,onClose:()=>{Qe(null),Ke(null)},anchorEl:Je,open:Boolean(He)})]})}},5982:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(8613),o=i(579);const l=e=>{let{item:t,onSubmit:i,onClose:l}=e;const[r,s]=(0,n.useState)(""),[a,d]=(0,n.useState)("");return(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:l,children:(0,o.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",maxWidth:"500px",width:"90%",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,o.jsx)("h3",{children:"Report Issue for:"}),(0,o.jsxs)("p",{style:{margin:"5px 0 15px 0",fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]}),(0,o.jsx)("label",{htmlFor:"issueDescription",style:{fontWeight:"bold"},children:"Describe the Issue:"}),(0,o.jsx)("textarea",{id:"issueDescription",value:r,onChange:e=>{s(e.target.value),a&&d("")},style:{width:"calc(100% - 16px)",padding:"8px",minHeight:"80px",marginTop:"5px"},rows:4}),a&&(0,o.jsx)("div",{style:{color:"red",fontSize:"0.8em",marginTop:"4px"},children:a}),(0,o.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,o.jsx)("button",{type:"button",onClick:l,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,o.jsx)("button",{type:"button",onClick:()=>{r.trim()?i(r):d("Please enter a description of the issue.")},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Issue Report"})]})]})})}},7553:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(8613),o=i(9550),l=i(579);const r=e=>{let{orgId:t,onClose:i,onEntityClick:r,onActionSelected:s}=e;const[a,d]=(0,n.useState)([]),[c,u]=(0,n.useState)(!0),[g,p]=(0,n.useState)(null),[m,h]=(0,n.useState)({});(0,n.useEffect)((()=>{if(!t)return;const e=(0,o.aU)(),i=(0,o.rJ)(e,`orgs/${t}/members`);(0,o.GG)(i).then((e=>{const t={};e.docs.forEach((e=>{const i=e.data();t[e.id]=i.email||e.id})),h(t)})).catch((e=>console.error("Error fetching members:",e)))}),[t]),(0,n.useEffect)((()=>{if(!t)return p("Organization ID is required."),void u(!1);u(!0),p(null);const e=(0,o.aU)(),i=(0,o.rJ)(e,`orgs/${t}/logs`),n=(0,o.P)(i,(0,o._M)("tool","==","incomingtool"),(0,o.My)("ts","desc"),(0,o.AB)(100)),l=(0,o.aQ)(n,(e=>{const i=e.docs.map((e=>{const i=e.data();return{orgId:t,toolKey:i.toolKey||i.tool,action:i.action,entityPath:i.entityPath,timestamp:i.timestamp||i.ts,userId:i.userId||i.uid,userEmail:i.email,before:i.before,after:i.after,details:i.details}})).filter((e=>"app-loaded"!==e.action));d(i),u(!1)}),(e=>{console.error("Error fetching user activity logs: ",e),p(`Failed to load activity logs: ${e.message}`),u(!1)}));return()=>l()}),[t]);const x=e=>{var t,i,n;const s=e.timestamp instanceof o.Dc?e.timestamp.toDate().toLocaleString():"string"===typeof e.timestamp?new Date(e.timestamp).toLocaleString():"Invalid Date",a=e.userEmail||m[e.userId||""]||e.userId||"system",d=(e=>{switch(e.action){case"item.create":return"Item created";case"item.update.fields":{var t,i;if(e.before&&e.after){var n;const t=(null===(n=e.details)||void 0===n?void 0:n.changedFields)||Object.keys(e.after).filter((t=>{var i,n;return JSON.stringify(null===(i=e.before)||void 0===i?void 0:i[t])!==JSON.stringify(null===(n=e.after)||void 0===n?void 0:n[t])}));if(t.length)return`Edited ${t.map((t=>{var i,n;return`${t}: ${null===(i=e.before)||void 0===i?void 0:i[t]} \u2192 ${null===(n=e.after)||void 0===n?void 0:n[t]}`})).join(", ")}`}const o=null===(t=e.details)||void 0===t||null===(i=t.changedFields)||void 0===i?void 0:i.join(", ");return o?`Edited fields: ${o}`:"Item edited"}default:var o,l,r,s,a,d,c,u,g;return e.action.startsWith("item.update.status.")?`Status changed: ${(null===(o=e.details)||void 0===o?void 0:o.previousStatus)||(null===(l=e.before)||void 0===l?void 0:l.currentStatus)||"Unknown"} \u2192 ${(null===(r=e.details)||void 0===r?void 0:r.newStatus)||e.action.replace("item.update.status.","")}`:"item.update.flag"===e.action?(null===(s=e.details)||void 0===s?void 0:s.isFlagged)?"Item flagged":"Item unflagged":"item.update.issue.report"===e.action?`Issue reported: ${(null===(a=e.details)||void 0===a?void 0:a.description)||(null===(d=e.details)||void 0===d?void 0:d.issueDescription)||""}`:"item.update.issue.update"===e.action?`Issue update added: ${(null===(c=e.details)||void 0===c?void 0:c.note)||""}`:"item.update.issue.resolve"===e.action?`Issue resolved: ${(null===(u=e.details)||void 0===u?void 0:u.resolutionOutcome)||""}`:"item.add_note"===e.action?`Note added: ${(null===(g=e.details)||void 0===g?void 0:g.note)||""}`:e.action}})(e),c=e.entityPath.split("/"),u=c.length>=2?c[1]:"",g=null===(t=e.before)||void 0===t?void 0:t.quantity,p=null===(i=e.before)||void 0===i?void 0:i.productName,h=g&&p?`${g}x ${p}`:(null===(n=e.before)||void 0===n?void 0:n.deliveryName)||p||u;return(0,l.jsxs)("span",{children:[s,": ",d," by ",a," ",(0,l.jsx)("a",{href:"#",style:{textDecoration:"underline",cursor:"pointer"},onClick:e=>{e.preventDefault(),r(u)},children:h})]})},v={marginBottom:"5px",paddingBottom:"5px",borderBottom:"1px dashed #eee",fontSize:"0.9em"};return(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:40},onClick:i,children:(0,l.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",border:"1px solid #ccc",borderRadius:"8px",width:"80%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("h3",{children:"User Activity Log (Last 100 entries)"}),c&&(0,l.jsx)("div",{children:"Loading logs..."}),g&&(0,l.jsx)("div",{style:{color:"red"},children:g}),!c&&!g&&(0,l.jsxs)("div",{style:{flexGrow:1,overflowY:"auto",border:"1px solid #eee",padding:"10px",marginTop:"15px"},children:[0===a.length&&(0,l.jsx)("div",{children:"No activity logs found."}),a.map(((e,t)=>(0,l.jsx)("div",{style:v,children:x(e)},`${e.timestamp}-${t}`)))]}),(0,l.jsx)("div",{style:{marginTop:"20px",textAlign:"right"},children:(0,l.jsx)("button",{onClick:i,style:{padding:"8px 15px",fontWeight:"bold"},children:"Close"})})]})})}},7694:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(8613),o=i(579);const l=e=>{let{isOpen:t,onClose:i,allColumns:l,initialVisibleColumns:r,onSave:s}=e;const[a,d]=(0,n.useState)((()=>Object.fromEntries(l.map((e=>[e.id,!1])))));(0,n.useEffect)((()=>{if(t){const e=new Set(r.map((e=>e.id))),t=Object.fromEntries(l.map((t=>[t.id,e.has(t.id)])));d(t)}}),[t,r,l]);if(!t)return null;const c={padding:"8px 12px",display:"flex",alignItems:"center"},u={marginLeft:"10px",cursor:"pointer"};return(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},onClick:i,children:(0,o.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",width:"400px",maxWidth:"90%",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,o.jsx)("h3",{children:"Configure Table Columns"}),(0,o.jsx)("p",{children:"Select the columns you want to display:"}),(0,o.jsx)("div",{style:{flexGrow:1,overflowY:"auto",padding:"10px 0",border:"1px solid #eee",borderRadius:"4px",marginBottom:"15px"},children:l.map((e=>(0,o.jsxs)("div",{style:c,children:[(0,o.jsx)("input",{type:"checkbox",id:`col-checkbox-${e.id}`,checked:a[e.id]||!1,onChange:()=>{return t=e.id,void d((e=>({...e,[t]:!e[t]})));var t},disabled:"actions"===e.id}),(0,o.jsx)("label",{htmlFor:`col-checkbox-${e.id}`,style:u,children:e.label})]},e.id)))}),(0,o.jsxs)("div",{style:{marginTop:"auto",textAlign:"right",borderTop:"1px solid #eee",paddingTop:"15px"},children:[(0,o.jsx)("button",{type:"button",onClick:i,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,o.jsx)("button",{type:"button",onClick:()=>{const e=l.map((e=>e.id)).filter((e=>a[e]));s(e)},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Column Settings"})]})]})})}}}]);
//# sourceMappingURL=544.b2171fac.chunk.js.map