{"version":3,"file":"static/js/935.afc7acc4.chunk.js","mappings":"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","sources":["hooks/useStockItems.ts","hooks/useSnackbar.ts","AddUpdateModal.tsx","ActionMenu.tsx","ResolveIssueModal.tsx","AddItemForm.tsx","ControlSurface.tsx","config.ts","ItemDetailDrawer.tsx","ToolApp.tsx","ReportIssueModal.tsx","utils.ts","components/SnackbarAlert.tsx","UserActivityView.tsx","TableSettingsModal.tsx","StockItemList.tsx"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react';\r\nimport { collection, query, where, orderBy, onSnapshot, Query } from 'firebase/firestore';\r\nimport { db } from 'shell/firebase'; // Assuming db is correctly imported via MF\r\nimport { StockItem, ItemStatus } from '../types';\r\n\r\nexport const useStockItems = (orgId: string | undefined) => {\r\n  // State for non-archived items\r\n  const [nonArchivedItems, setNonArchivedItems] = useState<StockItem[]>([]);\r\n  const [mainLoading, setMainLoading] = useState<boolean>(true);\r\n  const [mainError, setMainError] = useState<string | null>(null);\r\n\r\n  // State for archived items\r\n  const [archivedItems, setArchivedItems] = useState<StockItem[]>([]);\r\n  const [archivedLoading, setArchivedLoading] = useState<boolean>(true);\r\n  const [archivedError, setArchivedError] = useState<string | null>(null);\r\n\r\n  // Filter state remains the same\r\n  const [searchTerm, setSearchTerm] = useState<string>('');\r\n  const [currentFilter, setCurrentFilter] = useState<ItemStatus | 'All'>('All');\r\n  const [showFlaggedOnly, setShowFlaggedOnly] = useState<boolean>(false);\r\n\r\n  // Combined loading and error state for the hook consumer\r\n  const loading = mainLoading || archivedLoading;\r\n  const error = mainError || archivedError;\r\n\r\n  // --- Firestore Real-time Sync for Non-Archived Items ---\r\n  useEffect(() => {\r\n    console.log('[useStockItems] Non-Archived Listener: Checking db and orgId:', { db_instance: db, org_id: orgId });\r\n    if (!db || !orgId) {\r\n      console.warn('[useStockItems] Non-Archived Listener: db or orgId is missing, skipping Firestore query.');\r\n      setMainLoading(false);\r\n      if (!orgId) setNonArchivedItems([]);\r\n      return;\r\n    }\r\n\r\n    setMainLoading(true);\r\n    setMainError(null);\r\n    console.log(`[useStockItems] Non-Archived Listener: Setting up listener for orgs/${orgId}/stockItems (non-archived)`);\r\n    \r\n    // Query for non-archived items\r\n    const q = query(\r\n        collection(db, 'orgs', orgId, 'stockItems') as Query<StockItem>, // Cast for type safety with Firestore V9\r\n        where(\"currentStatus\", \"!=\", \"Archived\"), \r\n        orderBy(\"currentStatus\"), // Order by status first to group non-archived logically?\r\n        orderBy('orderDate', 'desc') // Then by order date\r\n    );\r\n    \r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      console.log('[useStockItems] Non-Archived Listener: Received snapshot.');\r\n      const items: StockItem[] = snapshot.docs.map(docSnap => ({ ...docSnap.data(), id: docSnap.id }));\r\n      setNonArchivedItems(items);\r\n      setMainLoading(false);\r\n    }, (err) => {\r\n      console.error('[useStockItems] Non-Archived Listener: Snapshot error:', err);\r\n      setMainError('Failed to load items: ' + (err as Error).message);\r\n      setMainLoading(false);\r\n    });\r\n\r\n    return () => {\r\n      console.log('[useStockItems] Non-Archived Listener: Cleaning up listener.');\r\n      unsubscribe();\r\n    };\r\n  }, [orgId]);\r\n\r\n  // --- Firestore Real-time Sync for Archived Items ---\r\n  useEffect(() => {\r\n    console.log('[useStockItems] Archived Listener: Checking db and orgId:', { db_instance: db, org_id: orgId });\r\n    if (!db || !orgId) {\r\n      console.warn('[useStockItems] Archived Listener: db or orgId is missing, skipping Firestore query.');\r\n      setArchivedLoading(false);\r\n      if (!orgId) setArchivedItems([]);\r\n      return;\r\n    }\r\n\r\n    setArchivedLoading(true);\r\n    setArchivedError(null);\r\n    console.log(`[useStockItems] Archived Listener: Setting up listener for orgs/${orgId}/stockItems (archived)`);\r\n    \r\n    // Query for archived items\r\n    const qArchived = query(\r\n        collection(db, 'orgs', orgId, 'stockItems') as Query<StockItem>,\r\n        where(\"currentStatus\", \"==\", \"Archived\"), \r\n        orderBy('orderDate', 'desc')\r\n    );\r\n    \r\n    const unsubscribeArchived = onSnapshot(qArchived, (snapshot) => {\r\n      console.log('[useStockItems] Archived Listener: Received snapshot.');\r\n      const items: StockItem[] = snapshot.docs.map(docSnap => ({ ...docSnap.data(), id: docSnap.id }));\r\n      setArchivedItems(items);\r\n      setArchivedLoading(false);\r\n    }, (err) => {\r\n      console.error('[useStockItems] Archived Listener: Snapshot error:', err);\r\n      setArchivedError('Failed to load archived items: ' + (err as Error).message);\r\n      setArchivedLoading(false);\r\n    });\r\n\r\n    return () => {\r\n      console.log('[useStockItems] Archived Listener: Cleaning up listener.');\r\n      unsubscribeArchived();\r\n    };\r\n  }, [orgId]);\r\n\r\n  // --- Filtering Logic (Updated) ---\r\n  const filteredItems = useMemo(() => {\r\n    // Determine the source list based on the current filter\r\n    const sourceItems = currentFilter === 'Archived' ? archivedItems : nonArchivedItems;\r\n\r\n    return sourceItems.filter(item => {\r\n      const lowerSearchTerm = searchTerm.toLowerCase();\r\n      const matchesSearch = (\r\n        (item.deliveryName?.toLowerCase().includes(lowerSearchTerm)) ||\r\n        (item.productName?.toLowerCase().includes(lowerSearchTerm)) ||\r\n        (item.seller?.toLowerCase().includes(lowerSearchTerm)) ||\r\n        (item.asinSku?.toLowerCase().includes(lowerSearchTerm))\r\n      );\r\n        \r\n      // Filter logic based on the already selected source list\r\n      let matchesFilter = false;\r\n      if (currentFilter === 'All' || currentFilter === 'Archived') {\r\n          // If 'All', we use nonArchivedItems (already filtered by query)\r\n          // If 'Archived', we use archivedItems (already filtered by query)\r\n          matchesFilter = true;\r\n      } else if (currentFilter === 'Late') {\r\n          // Note: isItemLate logic is now primarily for highlighting in StockItemList\r\n          // We still need to filter correctly when the 'Late' tab is selected.\r\n          // We need access to the original isItemLate logic here for filtering.\r\n          // Let's redefine it locally for the filter memo, or ideally import from utils.\r\n          const checkItemLate = (itemToCheck: StockItem): boolean => {\r\n            if (itemToCheck.currentStatus !== 'Pending Delivery') return false;\r\n            try {\r\n              const orderDate = new Date(itemToCheck.orderDate);\r\n              const sevenDaysAgo = new Date();\r\n              sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\r\n              return orderDate < sevenDaysAgo;\r\n            } catch (e) {\r\n                console.error(\"Error parsing orderDate for late check:\", e);\r\n                return false; // Treat parse errors as not late\r\n            }\r\n          };\r\n          matchesFilter = checkItemLate(item);\r\n      } else {\r\n          matchesFilter = item.currentStatus === currentFilter;\r\n      }\r\n\r\n      const matchesFlag = !showFlaggedOnly || item.isFlagged === true;\r\n\r\n      return matchesFilter && matchesSearch && matchesFlag;\r\n    });\r\n  }, [nonArchivedItems, archivedItems, searchTerm, currentFilter, showFlaggedOnly]); // Include both lists in dependencies\r\n\r\n  return {\r\n    // Provide access to both lists if needed externally, though ToolApp mainly uses `items`\r\n    allItems: nonArchivedItems, \r\n    archivedItems: archivedItems, \r\n    items: filteredItems, // The items to display based on currentFilter\r\n    loading,\r\n    error,\r\n    searchTerm,\r\n    currentFilter,\r\n    showFlaggedOnly,\r\n    setSearchTerm,\r\n    setCurrentFilter,\r\n    setShowFlaggedOnly,\r\n    setError: (err: string | null) => { // Allow clearing both errors\r\n        setMainError(err);\r\n        setArchivedError(err);\r\n    }\r\n  };\r\n}; ","import { useState, useCallback } from 'react';\r\n\r\n// Define the severity type\r\nexport type SnackbarSeverity = 'success' | 'error' | 'info' | 'warning';\r\n\r\n// Define the hook's return type\r\ninterface UseSnackbarReturn {\r\n  snackbar: {\r\n    open: boolean;\r\n    message: string;\r\n    severity: SnackbarSeverity;\r\n  };\r\n  showSnackbar: (message: string, severity?: SnackbarSeverity) => void;\r\n  closeSnackbar: () => void;\r\n}\r\n\r\n// Define the custom hook\r\nexport const useSnackbar = (): UseSnackbarReturn => {\r\n  const [open, setOpen] = useState(false);\r\n  const [message, setMessage] = useState('');\r\n  const [severity, setSeverity] = useState<SnackbarSeverity>('success');\r\n\r\n  const showSnackbar = useCallback((msg: string, sev: SnackbarSeverity = 'success') => {\r\n    setMessage(msg);\r\n    setSeverity(sev);\r\n    setOpen(true);\r\n  }, []);\r\n\r\n  const closeSnackbar = useCallback(() => {\r\n    setOpen(false);\r\n    // Optionally reset message/severity on close, or let them persist until next showSnackbar\r\n    // setMessage(''); \r\n    // setSeverity('success');\r\n  }, []);\r\n\r\n  return {\r\n    snackbar: {\r\n      open,\r\n      message,\r\n      severity,\r\n    },\r\n    showSnackbar,\r\n    closeSnackbar,\r\n  };\r\n}; ","import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Typography, Box, CircularProgress\n} from '@mui/material';\nimport { StockItem } from './types';\n\ninterface AddUpdateModalProps {\n  isOpen: boolean;\n  item: StockItem; // Pass the item for context\n  onSubmit: (note: string) => void;\n  onClose: () => void;\n}\n\nconst AddUpdateModal: React.FC<AddUpdateModalProps> = ({ isOpen, item, onSubmit, onClose }) => {\n  const [note, setNote] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    if (!note.trim()) {\n      setError('Please enter an update note.');\n      return;\n    }\n    onSubmit(note);\n    onClose(); // Close modal on successful submission\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Add Issue Update for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {/* Display existing issue description for context */} \n        {item.issueDescription && (\n          <Box sx={(theme) => ({\n            mb: 2, \n            p: 1.5, \n            backgroundColor: theme.palette.action.selected || theme.palette.grey[100], \n            border: `1px solid ${theme.palette.divider}`,\n            borderRadius: 1 \n          })}>\n            <Typography variant=\"subtitle2\" gutterBottom>Item Context:</Typography>\n            <Typography variant=\"body2\" component=\"div\" noWrap>\n              {item.productName} ({item.deliveryName})\n            </Typography>\n          </Box>\n        )}\n\n        {/* Update Note TextField */} \n        <TextField\n          autoFocus\n          id=\"updateNote\"\n          label=\"Update Note *\"\n          type=\"text\"\n          fullWidth\n          multiline\n          rows={4}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n          value={note}\n          onChange={(e) => {\n            setNote(e.target.value);\n            if (error) setError(''); // Clear error on type\n          }}\n          error={!!error}\n          helperText={error || 'Enter details about the update.'}\n          placeholder=\"e.g., Contacted seller, awaiting response...\"\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Update Note\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default AddUpdateModal; ","import React from 'react';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  ListItemIcon,\r\n  ListItemText,\r\n} from '@mui/material';\r\nimport { ActionDefinition } from './types'; // Assuming types.ts is in the same directory\r\n\r\n// Interface (Moved from ToolApp.tsx)\r\nexport interface ActionMenuProps {\r\n  itemId: string;\r\n  actions: ActionDefinition[];\r\n  onActionSelected: (itemId: string, action: ActionDefinition) => void;\r\n  onClose: () => void;\r\n  anchorEl: null | HTMLElement;\r\n  open: boolean;\r\n}\r\n\r\n// Component (Moved from ToolApp.tsx)\r\nexport const ActionMenu: React.FC<ActionMenuProps> = ({ \r\n  itemId, \r\n  actions, \r\n  onActionSelected, \r\n  onClose, \r\n  anchorEl, \r\n  open \r\n}) => {\r\n  const handleActionClick = (action: ActionDefinition) => {\r\n    onActionSelected(itemId, action);\r\n    onClose(); // Close the menu after action selection\r\n  };\r\n\r\n  return (\r\n    <Menu\r\n      anchorEl={anchorEl}\r\n      open={open}\r\n      onClose={onClose}\r\n      MenuListProps={{\r\n        'aria-labelledby': `actions-button-${itemId}`,\r\n        dense: true,\r\n      }}\r\n      PaperProps={{\r\n        sx: { minWidth: 180 },\r\n      }}\r\n    >\r\n      {actions.map((action, index) => (\r\n        <MenuItem \r\n          key={action.id} \r\n          onClick={() => handleActionClick(action)}\r\n        >\r\n          {action.icon && (\r\n            <ListItemIcon sx={{ minWidth: 'auto', mr: 1.5, alignItems: 'center', color: 'inherit' }}> \r\n              {/* Instantiate directly using the type */}\r\n              {React.createElement(action.icon, { fontSize: \"small\" })}\r\n            </ListItemIcon>\r\n          )}\r\n          <ListItemText primaryTypographyProps={{ variant: 'body2' }}>\r\n             {action.label}\r\n           </ListItemText>\r\n        </MenuItem>\r\n      ))}\r\n    </Menu>\r\n  );\r\n};\r\n\r\nexport default ActionMenu; ","import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Select, MenuItem, FormControl, InputLabel, Typography,\n  FormHelperText, Box\n} from '@mui/material';\nimport { StockItem } from './types';\n\ninterface ResolveIssueModalProps {\n  isOpen: boolean;\n  item: StockItem; // Pass the item for context\n  onSubmit: (outcome: string, note?: string) => void;\n  onClose: () => void;\n}\n\nconst RESOLUTION_OUTCOMES = [\n  \"Item Accepted / Kept As Is\",\n  \"Item Repaired / Refurbished\",\n  \"Partial Refund Received\",\n  \"Returned to Supplier\",\n  \"Disposed Of\",\n  \"Other\" // Allows adding notes for specifics\n];\n\nconst ResolveIssueModal: React.FC<ResolveIssueModalProps> = ({ isOpen, item, onSubmit, onClose }) => {\n  const [outcome, setOutcome] = useState('');\n  const [note, setNote] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    setError(''); // Clear previous error\n    if (!outcome) {\n      setError('Please select a resolution outcome.');\n      return;\n    }\n    onSubmit(outcome, note.trim() || undefined); // Pass note only if it has content\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Resolve Issue for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {/* Display existing issue description */}\n        {item && (\n          <Box sx={(theme) => ({\n             mb: 2, \n             p: 1.5, \n             backgroundColor: theme.palette.action.selected || theme.palette.grey[100], \n             border: `1px solid ${theme.palette.divider}`,\n             borderRadius: 1 \n            })}>\n            <Typography variant=\"subtitle2\" gutterBottom>Original Issue:</Typography>\n            <Typography variant=\"body2\">{item.issueDescription}</Typography>\n          </Box>\n        )}\n\n        {/* Resolution Outcome Select */}\n        <FormControl fullWidth error={!!error} sx={{ mb: 2 }} variant=\"outlined\" size=\"small\">\n          <InputLabel id=\"resolution-outcome-label\">Resolution Outcome *</InputLabel>\n          <Select\n            labelId=\"resolution-outcome-label\"\n            id=\"resolutionOutcome\"\n            value={outcome}\n            label=\"Resolution Outcome *\"\n            onChange={(e) => {\n              setOutcome(e.target.value as string);\n              if (error) setError(''); // Clear error on change\n            }}\n          >\n            <MenuItem value=\"\" disabled><em>-- Select an Outcome --</em></MenuItem>\n            {RESOLUTION_OUTCOMES.map(opt => (\n              <MenuItem key={opt} value={opt}>{opt}</MenuItem>\n            ))}\n          </Select>\n          {error && <FormHelperText>{error}</FormHelperText>}\n        </FormControl>\n\n        {/* Resolution Notes TextField */}\n        <TextField\n          id=\"resolutionNotes\"\n          label=\"Resolution Notes (Optional)\"\n          multiline\n          rows={3}\n          fullWidth\n          value={note}\n          onChange={(e) => setNote(e.target.value)}\n          placeholder=\"e.g., Supplier issued refund, repaired screen...\"\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Resolution\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ResolveIssueModal;","import React, { useState, useEffect } from 'react';\nimport {\n  TextField,\n  Button,\n  Box,\n  FormControlLabel,\n  Checkbox,\n  MenuItem,\n  Typography,\n  IconButton\n} from '@mui/material';\nimport CloseIcon from '@mui/icons-material/Close';\nimport { StockItem, PurchaseStatus, Destination } from './types';\n\ninterface AddItemFormProps {\n  onSave: (newItemOrUpdate: Omit<StockItem, 'id' | 'currentStatus' | 'dateDelivered' | 'processorNotes' | 'issueDescription'> & { isFlagged: boolean }) => void;\n  onClose: () => void;\n  initialData?: StockItem | null;\n  firstInputRef?: React.RefObject<HTMLInputElement | null>;\n}\n\nconst AddItemForm: React.FC<AddItemFormProps> = ({ onSave, onClose, initialData, firstInputRef }) => {\n  const isEditing = !!initialData;\n\n  // Initialize state for each form field\n  const [purchaseStatus, setPurchaseStatus] = useState<PurchaseStatus>(initialData?.purchaseStatus || 'Purchased');\n  const [deliveryName, setDeliveryName] = useState(initialData?.deliveryName || '');\n  const [productName, setProductName] = useState(initialData?.productName || '');\n  const [quantity, setQuantity] = useState<number | ''>(initialData?.quantity || '');\n  const [pricePerItem, setPricePerItem] = useState<number | ''>(initialData?.pricePerItem || '');\n  const [orderNumber, setOrderNumber] = useState(initialData?.orderNumber || '');\n  const [orderDate, setOrderDate] = useState(() => (initialData?.orderDate || new Date().toISOString().split('T')[0]));\n  const [seller, setSeller] = useState(initialData?.seller || '');\n  const [isVatRegistered, setIsVatRegistered] = useState<'Yes' | 'No' | 'Unknown'>(initialData?.isVatRegistered || 'Unknown');\n  const [destination, setDestination] = useState<Destination>(initialData?.destination || '');\n  const [asinSku, setAsinSku] = useState(initialData?.asinSku || '');\n  const [acquisitionNotes, setAcquisitionNotes] = useState(initialData?.acquisitionNotes || '');\n  const [isFlagged, setIsFlagged] = useState(initialData?.isFlagged || false);\n\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  // Populate state if initialData changes (needed if modal reuses component instance)\n  useEffect(() => {\n    if (initialData) {\n      setPurchaseStatus(initialData.purchaseStatus || 'Purchased');\n      setDeliveryName(initialData.deliveryName || '');\n      setProductName(initialData.productName || '');\n      setQuantity(initialData.quantity || '');\n      setPricePerItem(initialData.pricePerItem || '');\n      setOrderNumber(initialData.orderNumber || '');\n      setOrderDate(initialData.orderDate || new Date().toISOString().split('T')[0]);\n      setSeller(initialData.seller || '');\n      setIsVatRegistered(initialData.isVatRegistered || 'Unknown');\n      setDestination(initialData.destination || '');\n      setAsinSku(initialData.asinSku || '');\n      setAcquisitionNotes(initialData.acquisitionNotes || '');\n      setIsFlagged(initialData.isFlagged || false);\n      setErrors({}); // Clear errors when loading new data\n    } else {\n      // Reset form if initialData becomes null (e.g., switching from edit to add)\n      // Optional: Add logic here to reset all fields if needed\n    }\n  }, [initialData]); // Re-run effect if initialData changes\n\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n    if (!deliveryName.trim()) newErrors.deliveryName = 'Delivery Name is required.';\n    if (!productName.trim()) newErrors.productName = 'Product Name is required.';\n    if (quantity === '' || quantity <= 0) newErrors.quantity = 'Quantity must be a positive number.';\n    if (pricePerItem === '' || pricePerItem < 0) newErrors.pricePerItem = 'Price must be zero or positive.';\n    if (!orderDate) newErrors.orderDate = 'Order Date is required.';\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = (event: React.FormEvent) => {\n    event.preventDefault();\n    console.log('AddItemForm: handleSubmit', { deliveryName, productName, quantity, pricePerItem, orderDate, seller, destination, acquisitionNotes, isFlagged });\n    const isValid = validateForm();\n    console.log('AddItemForm: validation result', isValid, errors);\n    if (isValid) {\n      console.log('AddItemForm: form valid, calling onSave');\n      onSave({\n        purchaseStatus,\n        deliveryName,\n        productName,\n        quantity: Number(quantity),\n        pricePerItem: Number(pricePerItem),\n        orderNumber: orderNumber || undefined,\n        orderDate,\n        seller: seller || undefined,\n        isVatRegistered: isVatRegistered === 'Unknown' ? undefined : isVatRegistered,\n        destination: destination || undefined,\n        asinSku: asinSku || undefined,\n        acquisitionNotes: acquisitionNotes || undefined,\n        isFlagged: isFlagged,\n      });\n    } else {\n      console.log('AddItemForm: form invalid, errors:', errors);\n    }\n  };\n\n  return (\n    <Box component=\"form\" onSubmit={handleSubmit} id=\"add-item-form\" noValidate sx={{ p: 3, display: 'flex', flexDirection: 'column', height: '100%' }}>\n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\n        <Typography variant=\"h6\">{isEditing ? 'Edit Stock Item' : 'Add New Stock Item'}</Typography>\n        <IconButton onClick={onClose} aria-label=\"Close\">\n          <CloseIcon />\n        </IconButton>\n      </Box>\n\n      <Box sx={{ flexGrow: 1, overflowY: 'auto', pr: 1 }}>\n        <TextField\n          inputRef={firstInputRef}\n          required\n          fullWidth\n          id=\"deliveryName\"\n          label=\"Delivery Name\"\n          name=\"deliveryName\"\n          value={deliveryName}\n          onChange={(e) => setDeliveryName(e.target.value)}\n          error={!!errors.deliveryName}\n          helperText={errors.deliveryName}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        />\n\n        <TextField\n          required\n          fullWidth\n          id=\"productName\"\n          label=\"Product Name\"\n          name=\"productName\"\n          value={productName}\n          onChange={(e) => setProductName(e.target.value)}\n          error={!!errors.productName}\n          helperText={errors.productName}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        />\n\n        <TextField\n          required\n          fullWidth\n          id=\"quantity\"\n          label=\"Quantity\"\n          name=\"quantity\"\n          type=\"number\"\n          value={quantity}\n          onChange={(e) => setQuantity(e.target.value === '' ? '' : Number(e.target.value))}\n          error={!!errors.quantity}\n          helperText={errors.quantity}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n          InputProps={{\n            inputProps: { min: 1 },\n          }}\n        />\n\n        <TextField\n          required\n          fullWidth\n          id=\"pricePerItem\"\n          label=\"Price Per Item\"\n          name=\"pricePerItem\"\n          type=\"number\"\n          value={pricePerItem}\n          onChange={(e) => setPricePerItem(e.target.value === '' ? '' : Number(e.target.value))}\n          error={!!errors.pricePerItem}\n          helperText={errors.pricePerItem}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n          InputProps={{\n            inputProps: { min: 0 },\n          }}\n        />\n\n        <TextField\n          required\n          fullWidth\n          id=\"orderDate\"\n          label=\"Order Date\"\n          name=\"orderDate\"\n          type=\"date\"\n          value={orderDate}\n          onChange={(e) => setOrderDate(e.target.value)}\n          error={!!errors.orderDate}\n          helperText={errors.orderDate}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n          InputLabelProps={{\n            shrink: true,\n          }}\n        />\n\n        <TextField\n          select\n          fullWidth\n          id=\"purchaseStatus\"\n          label=\"Purchase Status\"\n          name=\"purchaseStatus\"\n          value={purchaseStatus}\n          onChange={(e) => setPurchaseStatus(e.target.value as PurchaseStatus)}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n          SelectProps={{\n          }}\n        >\n          <MenuItem value=\"Purchased\">Purchased</MenuItem>\n          <MenuItem value=\"Ordered\">Ordered</MenuItem>\n          <MenuItem value=\"Return Expected\">Return Expected</MenuItem>\n        </TextField>\n\n        <TextField\n          fullWidth\n          id=\"orderNumber\"\n          label=\"Order Number\"\n          name=\"orderNumber\"\n          value={orderNumber}\n          onChange={(e) => setOrderNumber(e.target.value)}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        />\n\n        <TextField\n          fullWidth\n          id=\"seller\"\n          label=\"Seller / Source\"\n          name=\"seller\"\n          value={seller}\n          onChange={(e) => setSeller(e.target.value)}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        />\n\n        <TextField\n          select\n          fullWidth\n          id=\"isVatRegistered\"\n          label=\"Seller VAT Registered?\"\n          name=\"isVatRegistered\"\n          value={isVatRegistered}\n          onChange={(e) => setIsVatRegistered(e.target.value as 'Yes' | 'No' | 'Unknown')}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        >\n          <MenuItem value=\"Unknown\">Unknown</MenuItem>\n          <MenuItem value=\"Yes\">Yes</MenuItem>\n          <MenuItem value=\"No\">No</MenuItem>\n        </TextField>\n\n        <TextField\n          select\n          fullWidth\n          id=\"destination\"\n          label=\"Planned Destination\"\n          name=\"destination\"\n          value={destination}\n          onChange={(e) => setDestination(e.target.value)}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        >\n          <MenuItem value=\"\">_Not Set_</MenuItem>\n          <MenuItem value=\"FBA Prep\">FBA Prep</MenuItem>\n          <MenuItem value=\"Local Stock Shelf A\">Local Stock Shelf A</MenuItem>\n          <MenuItem value=\"Refurbish Pile\">Refurbish Pile</MenuItem>\n          <MenuItem value=\"Return to Supplier\">Return to Supplier</MenuItem>\n        </TextField>\n\n        <TextField\n          fullWidth\n          id=\"asinSku\"\n          label=\"ASIN / SKU\"\n          name=\"asinSku\"\n          value={asinSku}\n          onChange={(e) => setAsinSku(e.target.value)}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        />\n\n        <TextField\n          fullWidth\n          multiline\n          rows={3}\n          id=\"acquisitionNotes\"\n          label=\"Acquisition Notes\"\n          name=\"acquisitionNotes\"\n          value={acquisitionNotes}\n          onChange={(e) => setAcquisitionNotes(e.target.value)}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n        />\n\n        <FormControlLabel\n          control={\n            <Checkbox\n              checked={isFlagged}\n              onChange={(e) => setIsFlagged(e.target.checked)}\n              name=\"isFlagged\"\n              color=\"secondary\"\n            />\n          }\n          label=\"Flag this item for attention\"\n          sx={{ mb: 1 }}\n        />\n      </Box>\n\n      <Box sx={{ mt: 2, pt: 2, borderTop: 1, borderColor: 'divider', display: 'flex', justifyContent: 'flex-end', gap: 1 }}>\n        <Button onClick={onClose} variant=\"outlined\">Cancel</Button>\n        <Button type=\"submit\" variant=\"contained\">\n          {isEditing ? 'Save Changes' : 'Add Item'}\n        </Button>\n      </Box>\n    </Box>\n  );\n};\n\nexport default AddItemForm;","import React from 'react';\r\nimport {\r\n  AppBar,\r\n  Toolbar,\r\n  TextField,\r\n  Button,\r\n  IconButton,\r\n  Box,\r\n  InputAdornment,\r\n  Tooltip,\r\n  Chip,\r\n} from '@mui/material';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\nimport HistoryIcon from '@mui/icons-material/History';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport { ItemStatus } from './types';\r\n\r\n// Define the props interface for ControlSurface\r\ninterface ControlSurfaceProps {\r\n  onAddItem: () => void;\r\n  onOpenSettings: () => void;\r\n  onOpenActivity: () => void;\r\n  searchTerm: string;\r\n  onSearchTermChange: (value: string) => void;\r\n  showFlaggedOnly: boolean;\r\n  onShowFlaggedOnlyChange: (checked: boolean) => void;\r\n  currentFilter: ItemStatus | 'All' | 'Late' | 'Archived';\r\n  onCurrentFilterChange: (newFilter: ItemStatus | 'All' | 'Late' | 'Archived') => void;\r\n}\r\n\r\n// Define types for filter values including 'Flagged'\r\n// type FilterValue = ItemStatus | 'All' | 'Late' | 'Archived';\r\n// type CombinedFilterValue = FilterValue | 'Flagged';\r\n\r\nconst ControlSurface: React.FC<ControlSurfaceProps> = ({\r\n  onAddItem,\r\n  onOpenSettings,\r\n  onOpenActivity,\r\n  searchTerm,\r\n  onSearchTermChange,\r\n  showFlaggedOnly,\r\n  onShowFlaggedOnlyChange,\r\n  currentFilter,\r\n  onCurrentFilterChange,\r\n}) => {\r\n  const handleSearchChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    onSearchTermChange(event.target.value);\r\n  };\r\n\r\n  // Define all filter options including 'Flagged'\r\n  const statusFilterOptions: Array<ItemStatus | 'All' | 'Late' | 'Archived'> = [\r\n    'All',\r\n    'Pending Delivery',\r\n    'Delivered',\r\n    'Issue',\r\n    'Late',\r\n    'Archived',\r\n  ];\r\n\r\n  // Handler for clicking a status filter chip\r\n  const handleStatusChipClick = (filterValue: ItemStatus | 'All' | 'Late' | 'Archived') => {\r\n    onCurrentFilterChange(filterValue);\r\n  };\r\n\r\n  // Handler for clicking the 'Flagged' chip\r\n  const handleFlaggedChipClick = () => {\r\n    onShowFlaggedOnlyChange(!showFlaggedOnly);\r\n  };\r\n\r\n  return (\r\n    <AppBar position=\"static\" color=\"default\" elevation={0} sx={{ borderBottom: '1px solid', borderColor: 'divider' }}>\r\n      {/* Use Toolbar for better alignment and structure */}\r\n      <Toolbar disableGutters sx={{ p: 1, display: 'flex', flexWrap: 'wrap', gap: 1.5, alignItems: 'center' }}>\r\n        {/* Top Bar Actions (Aligned Left) */}\r\n        <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\r\n          <Button\r\n            variant=\"contained\"\r\n            startIcon={<AddIcon />}\r\n            onClick={onAddItem}\r\n            size=\"medium\" // Ensure consistent button size\r\n          >\r\n            Add Item\r\n          </Button>\r\n          <Tooltip title=\"Table Settings\">\r\n            <IconButton size=\"medium\" onClick={onOpenSettings} aria-label=\"Table Settings\">\r\n              <SettingsIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n          <Tooltip title=\"User Activity Log\">\r\n            <IconButton size=\"medium\" onClick={onOpenActivity} aria-label=\"User Activity Log\">\r\n              <HistoryIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n        </Box>\r\n\r\n        {/* Spacer - Adjust as needed or remove if middle alignment is desired */}\r\n        {/* <Box sx={{ flexGrow: 1 }} /> */}\r\n\r\n        {/* Search Field (Center or Right aligned group) */}\r\n        <TextField\r\n          variant=\"outlined\"\r\n          size=\"small\"\r\n          placeholder=\"Search Items\"\r\n          value={searchTerm}\r\n          onChange={handleSearchChange}\r\n          InputProps={{\r\n            startAdornment: (\r\n              <InputAdornment position=\"start\">\r\n                <SearchIcon color=\"action\" fontSize=\"small\"/>\r\n              </InputAdornment>\r\n            ),\r\n          }}\r\n          sx={{ minWidth: '250px', maxWidth: '400px', flexGrow: { xs: 1, md: 0 } }} // Allow grow on small screens\r\n        />\r\n\r\n        {/* Filter Chips Area */}\r\n        <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap', alignItems: 'center', flexGrow: 1, justifyContent: { xs: 'flex-start', md: 'flex-end'} }}>\r\n          {/* Status Filter Chips */}\r\n          {statusFilterOptions.map((filter) => {\r\n            const isSelected = currentFilter === filter;\r\n            return (\r\n              <Chip\r\n                key={filter}\r\n                label={filter}\r\n                size=\"small\"\r\n                clickable\r\n                variant={isSelected ? 'filled' : 'outlined'}\r\n                color={isSelected ? 'primary' : 'default'}\r\n                onClick={() => handleStatusChipClick(filter)}\r\n                // Optional: Add icon to selected chip\r\n                // icon={isSelected ? <CheckCircleOutlineIcon fontSize=\"small\" /> : undefined}\r\n                sx={{ fontWeight: isSelected ? 600 : 400 }} // Slightly bolder selected chip\r\n              />\r\n            );\r\n          })}\r\n\r\n          {/* Flagged Filter Chip */}\r\n          <Chip\r\n            key=\"flagged\"\r\n            label=\"Flagged\"\r\n            size=\"small\"\r\n            clickable\r\n            variant={showFlaggedOnly ? 'filled' : 'outlined'}\r\n            color={showFlaggedOnly ? 'secondary' : 'default'} // Use secondary color for flagged?\r\n            onClick={handleFlaggedChipClick}\r\n            // Optional: Add icon\r\n            // icon={showFlaggedOnly ? <FlagIcon fontSize=\"small\" /> : undefined}\r\n            sx={{ fontWeight: showFlaggedOnly ? 600 : 400 }}\r\n          />\r\n        </Box>\r\n\r\n        {/* Remove the Box with Tabs */}\r\n      </Toolbar>\r\n    </AppBar>\r\n  );\r\n};\r\n\r\nexport default ControlSurface; ","import { StockItem, ItemStatus, ActionDefinition, ColumnConfig } from './types';\r\n// Import necessary MUI Icons\r\nimport FlagIcon from '@mui/icons-material/Flag';\r\nimport ArchiveIcon from '@mui/icons-material/Archive';\r\nimport UnarchiveIcon from '@mui/icons-material/Unarchive';\r\nimport ReportProblemIcon from '@mui/icons-material/ReportProblem';\r\nimport NoteAddIcon from '@mui/icons-material/NoteAdd';\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport UpdateIcon from '@mui/icons-material/Update';\r\nimport VisibilityIcon from '@mui/icons-material/Visibility';\r\nimport DoDisturbIcon from '@mui/icons-material/DoDisturb';\r\n\r\n// --- Column Configuration ---\r\nexport const ALL_COLUMNS: ColumnConfig[] = [\r\n  { id: 'orderDate', label: 'Order Date' },\r\n  { id: 'quantity', label: 'Qty' },\r\n  { id: 'productName', label: 'Product Name' },\r\n  { id: 'deliveryName', label: 'Delivery Name' },\r\n  { id: 'pricePerItem', label: 'Price/Item' },\r\n  { id: 'seller', label: 'Seller/Source' },\r\n  { id: 'destination', label: 'Destination' },\r\n  { id: 'asinSku', label: 'ASIN/SKU' },\r\n  { id: 'purchaseStatus', label: 'Purchase Status' },\r\n  { id: 'orderNumber', label: 'Order #' },\r\n  { id: 'currentStatus', label: 'Status' },\r\n  { id: 'isFlagged', label: 'Flagged' },\r\n  { id: 'acquisitionNotes', label: 'Acquisition Notes' },\r\n  { id: 'issueDescription', label: 'Issue Description' },\r\n  { id: 'dateDelivered', label: 'Date Delivered' },\r\n  { id: 'actions', label: 'Actions' },\r\n];\r\n\r\nexport const DEFAULT_VISIBLE_COLUMN_IDS: Array<ColumnConfig['id']> = [\r\n  'orderDate', \r\n  'quantity', \r\n  'productName', \r\n  'deliveryName', \r\n  'currentStatus', \r\n  'actions',\r\n];\r\n\r\nexport const LOCAL_STORAGE_KEY_VISIBLE_COLUMNS = 'incomingTool_visibleColumns';\r\n\r\n// --- Action Configuration ---\r\n\r\n// Define base actions with icons (assigning component type)\r\nconst editAction: Partial<ActionDefinition> = { id: 'Edit Item', label: 'Edit', description: 'Edit item details', icon: EditIcon };\r\nconst flagAction: Partial<ActionDefinition> = { id: 'Flag Item', label: 'Flag', description: 'Flag this item for attention', icon: FlagIcon };\r\nconst unflagAction: Partial<ActionDefinition> = { id: 'Unflag Item', label: 'Unflag', description: 'Remove the flag from this item', icon: DoDisturbIcon };\r\nconst archiveAction: Partial<ActionDefinition> = { id: 'Archive', label: 'Archive', description: 'Archive this item', icon: ArchiveIcon };\r\nconst unarchiveAction: Partial<ActionDefinition> = { id: 'Unarchive Item', label: 'Unarchive', description: 'Restore this item from archive', icon: UnarchiveIcon };\r\nconst reportIssueAction: Partial<ActionDefinition> = { id: 'Report Issue', label: 'Report Issue', description: 'Report an issue with this item', icon: ReportProblemIcon };\r\nconst addNoteAction: Partial<ActionDefinition> = { id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history', icon: NoteAddIcon };\r\nconst markDeliveredAction: Partial<ActionDefinition> = { id: 'Mark as Delivered', label: 'Mark as Delivered', description: 'Update status to Delivered', icon: CheckCircleIcon };\r\nconst resolveIssueAction: Partial<ActionDefinition> = { id: 'Resolve Issue', label: 'Resolve Issue', description: 'Mark the issue as resolved', icon: CheckCircleIcon };\r\nconst addIssueUpdateAction: Partial<ActionDefinition> = { id: 'Add Issue Update', label: 'Add Issue Update', description: 'Add an update note to the ongoing issue', icon: UpdateIcon };\r\nconst viewDetailsAction: Partial<ActionDefinition> = { id: 'View Details', label: 'View Details', description: 'View full item details', icon: VisibilityIcon };\r\n\r\nexport const getAvailableActions = (status: ItemStatus, isFlagged?: boolean): ActionDefinition[] => {\r\n  let actions: ActionDefinition[] = [];\r\n\r\n  // Always include View Details as the first action (if applicable)\r\n  actions.push(viewDetailsAction as ActionDefinition);\r\n\r\n  // Determine Flag/Unflag action\r\n  const flagToggleAction = isFlagged ? unflagAction : flagAction;\r\n\r\n  switch (status) {\r\n    case 'Pending Delivery':\r\n    case 'Late': // Combine Late and Pending\r\n      actions.push(markDeliveredAction as ActionDefinition);\r\n      actions.push(reportIssueAction as ActionDefinition);\r\n      actions.push(addNoteAction as ActionDefinition);\r\n      actions.push(editAction as ActionDefinition);\r\n      break;\r\n    case 'Delivered':\r\n      actions.push(archiveAction as ActionDefinition);\r\n      actions.push(reportIssueAction as ActionDefinition);\r\n      actions.push(addNoteAction as ActionDefinition);\r\n      actions.push(editAction as ActionDefinition);\r\n      break;\r\n    case 'Issue':\r\n      actions.push(resolveIssueAction as ActionDefinition);\r\n      actions.push(addIssueUpdateAction as ActionDefinition);\r\n      actions.push(archiveAction as ActionDefinition);\r\n      actions.push(addNoteAction as ActionDefinition);\r\n      actions.push(editAction as ActionDefinition);\r\n      break;\r\n    case 'Archived':\r\n      actions.push(unarchiveAction as ActionDefinition);\r\n      actions.push(addNoteAction as ActionDefinition);\r\n      break;\r\n    default:\r\n      actions.push(addNoteAction as ActionDefinition);\r\n      break;\r\n  }\r\n\r\n  // Add Flag/Unflag action if not archived\r\n  if (status !== 'Archived') {\r\n    actions.splice(1, 0, flagToggleAction as ActionDefinition);\r\n  }\r\n\r\n  return actions;\r\n}; ","import React, { useState, useEffect } from 'react';\r\nimport { getFirestore, collection, query, where, orderBy, onSnapshot, Timestamp } from 'firebase/firestore';\r\nimport {\r\n  Box,\r\n  Typography,\r\n  Button,\r\n  List,\r\n  ListItem,\r\n  ListItemText,\r\n  CircularProgress,\r\n  Alert,\r\n  Stack,\r\n  useTheme,\r\n  Divider,\r\n  IconButton\r\n} from '@mui/material';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport { StockItem, ActivityEvent, ActionDefinition, LogActionData, ActivityEventType } from './types';\r\nimport { getAvailableActions } from './config'; // For action buttons\r\n\r\n// Helper function to format optional fields\r\nconst formatValue = (value: string | number | undefined | null, theme: any, prefix = '', suffix = '') => {\r\n  if (value === undefined || value === null || value === '') {\r\n    return <Typography component=\"span\" sx={{ color: theme.palette.text.disabled }}>N/A</Typography>; // Indicate if not available\r\n  }\r\n  return `${prefix}${value}${suffix}`;\r\n};\r\n\r\n// Helper function to format an activity event into a readable string\r\nconst formatActivityEvent = (event: ActivityEvent): string => {\r\n  const time = new Date(event.timestamp).toLocaleString();\r\n  switch (event.type) {\r\n    case 'CREATED':\r\n      return `${time}: Item Created`;\r\n    case 'EDITED':\r\n      const fields = event.details.changedFields?.join(', ') || 'details';\r\n      return `${time}: Item Edited (${fields} changed)`;\r\n    case 'STATUS_CHANGED':\r\n      return `${time}: Status changed from ${event.details.previousStatus || '?'} to ${event.details.newStatus || '?'}`;\r\n    case 'FLAG_TOGGLED':\r\n      return `${time}: Item ${event.details.isFlagged ? 'Flagged' : 'Unflagged'}`;\r\n    case 'ISSUE_REPORTED':\r\n      return `${time}: Issue Reported: ${event.details.issueDescription || ''}`;\r\n    case 'ISSUE_UPDATE_ADDED':\r\n      return `${time}: Issue Update Added: ${event.details.note || ''}`;\r\n    case 'ISSUE_RESOLVED':\r\n      return `${time}: Issue Resolved (Outcome: ${event.details.resolutionOutcome || 'N/A'}${event.details.note ? ` - Note: ${event.details.note}` : ''})`;\r\n    case 'NOTE_ADDED': // For general notes in future\r\n      return `${time}: Note Added: ${event.details.note || ''}`;\r\n    default:\r\n      return `${time}: Unknown action`;\r\n  }\r\n};\r\n\r\n// Helper function to map LogActionData from Firestore to the local ActivityEvent format\r\nconst mapLogToAction = (log: LogActionData): ActivityEvent | null => {\r\n  // Handle Firestore Timestamp or ISO string\r\n  const timestamp = log.timestamp instanceof Timestamp\r\n    ? log.timestamp.toDate().toISOString()\r\n    : (typeof log.timestamp === 'string' ? log.timestamp : new Date().toISOString());\r\n\r\n  const userId = log.userId || 'system'; // Default if userId is missing\r\n\r\n  let type: ActivityEventType | null = null;\r\n  let details: ActivityEvent['details'] = {};\r\n\r\n  // Map central log action strings to local ActivityEventType\r\n  switch (log.action) {\r\n    case 'item.create':\r\n      type = 'CREATED';\r\n      break;\r\n    case 'item.update.fields':\r\n      type = 'EDITED';\r\n      // Attempt to get changed fields by comparing before/after, fallback to details or generic message\r\n      const changed = log.before && log.after\r\n        ? Object.keys(log.after).filter(key => log.before && log.after && JSON.stringify(log.before[key]) !== JSON.stringify(log.after[key]))\r\n        : (log.details?.changedFields || ['details']);\r\n      details = { changedFields: changed };\r\n      break;\r\n    case 'item.update.status.Delivered':\r\n      type = 'STATUS_CHANGED';\r\n      details = { previousStatus: log.before?.currentStatus, newStatus: 'Delivered' };\r\n      break;\r\n    case 'item.update.status.Archived':\r\n      type = 'STATUS_CHANGED';\r\n      details = { previousStatus: log.before?.currentStatus, newStatus: 'Archived' };\r\n      break;\r\n    // TODO: Add mappings for other specific status changes if implemented (e.g., 'Pending Delivery', 'Issue')\r\n    case 'item.update.flag':\r\n      type = 'FLAG_TOGGLED';\r\n      details = { isFlagged: log.after?.isFlagged };\r\n      break;\r\n    case 'item.update.issue.report':\r\n      type = 'ISSUE_REPORTED';\r\n      details = { issueDescription: log.details?.description || log.details?.issueDescription }; // Allow for variations\r\n      break;\r\n    case 'item.update.issue.resolve':\r\n      type = 'ISSUE_RESOLVED';\r\n      details = { resolutionOutcome: log.details?.outcome, note: log.details?.note };\r\n      break;\r\n    case 'item.update.issue.update': // Action name used in handleSaveIssueUpdate via updateItemAndLog\r\n      type = 'ISSUE_UPDATE_ADDED';\r\n      details = { note: log.details?.note };\r\n      break;\r\n    case 'item.add_note': // Action name used in handleSaveNote via updateItemAndLog\r\n      type = 'NOTE_ADDED';\r\n      details = { note: log.details?.note };\r\n      break;\r\n    // Add more mappings if other log.action values exist\r\n    default:\r\n      console.warn(`Unhandled log action type for UI mapping: ${log.action}`);\r\n      return null; // Don't display unmapped actions for now\r\n  }\r\n\r\n  if (!type) return null;\r\n\r\n  return {\r\n    timestamp,\r\n    userId,\r\n    // userName: // Optional: Could fetch/join user name later if needed\r\n    type,\r\n    details\r\n  };\r\n};\r\n\r\ninterface ItemDetailDrawerProps {\r\n  item: StockItem;\r\n  orgId: string;\r\n  onClose: () => void;\r\n  onActionSelected: (itemId: string, action: ActionDefinition) => void;\r\n}\r\n\r\nconst ItemDetailDrawer: React.FC<ItemDetailDrawerProps> = ({ item, orgId, onClose, onActionSelected }) => {\r\n  // State for fetched logs\r\n  const [activityEvents, setActivityEvents] = useState<ActivityEvent[]>([]);\r\n  const [loadingLogs, setLoadingLogs] = useState<boolean>(true);\r\n  const [logError, setLogError] = useState<string | null>(null);\r\n\r\n  // Actions toolbar\r\n  const availableActions = getAvailableActions(item.currentStatus, item.isFlagged);\r\n\r\n  // Get theme here\r\n  const theme = useTheme();\r\n\r\n  // Fetch logs when the drawer opens or item/orgId changes\r\n  useEffect(() => {\r\n    if (!item?.id || !orgId) { // Ensure we have item ID and orgId prop\r\n      setLoadingLogs(false);\r\n      setLogError(\"Missing item or organization ID for fetching logs.\");\r\n      return;\r\n    }\r\n\r\n    setActivityEvents([]); // Clear previous logs\r\n    setLoadingLogs(true);\r\n    setLogError(null);\r\n    const db = getFirestore();\r\n    const entityPath = `stockItems/${item.id}`;\r\n    // Query the 'logs' collection using the orgId prop\r\n    const logsRef = collection(db, `orgs/${orgId}/logs`);\r\n    const q = query(logsRef, where('entityPath', '==', entityPath), orderBy('timestamp', 'desc'));\r\n\r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      // Map the document data directly to LogActionData, assuming data matches the interface\r\n      const fetchedLogs = snapshot.docs.map(doc => ({ ...doc.data() } as LogActionData));\r\n\r\n      // Map LogActionData to ActivityEvent for display\r\n      const mappedEvents = fetchedLogs\r\n        .map(mapLogToAction)\r\n        .filter((event): event is ActivityEvent => event !== null); // Filter out nulls and type guard\r\n\r\n      setActivityEvents(mappedEvents);\r\n      setLoadingLogs(false);\r\n    }, (error) => {\r\n      console.error(\"Error fetching logs: \", error);\r\n      setLogError(`Failed to fetch activity log: ${error.message}`);\r\n      setLoadingLogs(false);\r\n    });\r\n\r\n    // Cleanup listener on unmount or when item changes\r\n    return () => unsubscribe();\r\n  }, [item?.id, orgId]); // Re-run if item ID or orgId prop changes\r\n\r\n  return (\r\n    <Box sx={{ p: 3, display: 'flex', flexDirection: 'column', height: '100%' }}>\r\n      {/* Header */}\r\n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\r\n        <Typography variant=\"h6\">{item.productName} - Details</Typography>\r\n        <IconButton onClick={onClose} aria-label=\"Close\">\r\n          <CloseIcon />\r\n        </IconButton>\r\n      </Box>\r\n\r\n      {/* Scrollable Content Area */}\r\n      <Box sx={{ flexGrow: 1, overflowY: 'auto', pr: 1 /* Add padding for scrollbar */ }}>\r\n          {/* Action Buttons Toolbar */}\r\n          <Box sx={{ mb: 2, borderBottom: 1, borderColor: 'divider', pb: 2 }}>\r\n            <Typography variant=\"subtitle2\" gutterBottom sx={{ fontWeight: 'bold' }}>Actions</Typography>\r\n            <Stack direction=\"row\" spacing={1} flexWrap=\"wrap\"> {/* Use Stack for layout */}\r\n              {availableActions.map(action => {\r\n                const IconComponent = action.icon; // Get icon component type\r\n                // Don't show 'view_details' action inside the details view itself\r\n                if (action.id === 'view_details') return null;\r\n                return (\r\n                  <Button\r\n                    key={action.id}\r\n                    variant=\"outlined\"\r\n                    size=\"small\"\r\n                    onClick={() => onActionSelected(item.id, action)}\r\n                    startIcon={IconComponent ? React.createElement(IconComponent, { fontSize: \"inherit\" }) : undefined}\r\n                  >\r\n                    {action.label}\r\n                  </Button>\r\n                );\r\n              })}\r\n            </Stack>\r\n          </Box>\r\n\r\n          {/* Item Details Section */}\r\n          <Box sx={{ mb: 2, borderBottom: 1, borderColor: 'divider', pb: 2 }}>\r\n              <Typography variant=\"subtitle2\" gutterBottom sx={{ fontWeight: 'bold' }}>Details</Typography>\r\n               <Typography variant=\"body2\">ID: {formatValue(item.id, theme)}</Typography>\r\n               <Typography variant=\"body2\">Delivery Name: {formatValue(item.deliveryName, theme)}</Typography>\r\n               <Typography variant=\"body2\">Product Name: {formatValue(item.productName, theme)}</Typography>\r\n               <Typography variant=\"body2\">Quantity: {formatValue(item.quantity, theme)}</Typography>\r\n               <Typography variant=\"body2\">Price/Item: {formatValue(item.pricePerItem, theme, '$')}</Typography> {/* Assuming USD */}\r\n               <Typography variant=\"body2\">Order #: {formatValue(item.orderNumber, theme)}</Typography>\r\n               <Typography variant=\"body2\">Order Date: {formatValue(item.orderDate ? new Date(item.orderDate).toLocaleDateString() : null, theme)}</Typography>\r\n               <Typography variant=\"body2\">Seller: {formatValue(item.seller, theme)}</Typography>\r\n               <Typography variant=\"body2\">Purchase Status: {formatValue(item.purchaseStatus, theme)}</Typography>\r\n               <Typography variant=\"body2\">Current Status: {formatValue(item.currentStatus, theme)}</Typography>\r\n               <Typography variant=\"body2\">Date Delivered: {formatValue(item.dateDelivered ? new Date(item.dateDelivered).toLocaleDateString() : null, theme)}</Typography>\r\n               <Typography variant=\"body2\">Destination: {formatValue(item.destination, theme)}</Typography>\r\n               <Typography variant=\"body2\">ASIN/SKU: {formatValue(item.asinSku, theme)}</Typography>\r\n               <Typography variant=\"body2\">Flagged: {formatValue(item.isFlagged ? 'Yes' : 'No', theme)}</Typography>\r\n               <Typography variant=\"body2\">VAT Registered: {formatValue(item.isVatRegistered, theme)}</Typography>\r\n               <Typography variant=\"body2\">Acquisition Notes: {formatValue(item.acquisitionNotes, theme)}</Typography>\r\n               <Typography variant=\"body2\">Processor Notes: {formatValue(item.processorNotes, theme)}</Typography>\r\n               {item.currentStatus === 'Issue' && (\r\n                 <Typography variant=\"body2\" color=\"error\">Issue Description: {formatValue(item.issueDescription, theme)}</Typography>\r\n               )}\r\n           </Box>\r\n\r\n          {/* Activity Log Section */}\r\n          <Box>\r\n            <Typography variant=\"subtitle2\" gutterBottom sx={{ fontWeight: 'bold' }}>Activity Log</Typography>\r\n            {loadingLogs ? (\r\n              <CircularProgress size={24} />\r\n            ) : logError ? (\r\n              <Alert severity=\"error\">{logError}</Alert>\r\n            ) : activityEvents.length > 0 ? (\r\n              <List dense disablePadding>\r\n                {activityEvents.map((event, index) => (\r\n                  <React.Fragment key={`${event.timestamp}-${index}`}> \r\n                    <ListItem disableGutters sx={{ py: 0.5 }}>\r\n                      <ListItemText \r\n                        primary={formatActivityEvent(event)} \r\n                        primaryTypographyProps={{ variant: 'body2' }}\r\n                        secondary={`User: ${event.userId}`}\r\n                        secondaryTypographyProps={{ variant: 'caption' }}\r\n                      />\r\n                    </ListItem>\r\n                    {index < activityEvents.length - 1 && <Divider component=\"li\" variant=\"inset\" />}\r\n                  </React.Fragment>\r\n                ))}\r\n              </List>\r\n            ) : (\r\n              <Typography variant=\"body2\" color=\"text.secondary\">No activity recorded.</Typography>\r\n            )}\r\n          </Box>\r\n      </Box>\r\n\r\n      {/* Footer Actions - Only Close Button */}\r\n      <Box sx={{ mt: 2, pt: 2, borderTop: 1, borderColor: 'divider', display: 'flex', justifyContent: 'flex-end' }}>\r\n        <Button onClick={onClose} variant=\"outlined\">Close</Button>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default ItemDetailDrawer; ","import { initializeApp } from 'firebase/app';\nimport { getAuth } from 'firebase/auth';\nimport { getFirestore } from 'firebase/firestore';\nimport React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n} from '@dnd-kit/core';\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n  horizontalListSortingStrategy,\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\nimport { restrictToHorizontalAxis } from '@dnd-kit/modifiers'; // Import the modifier\nimport { StockItem, ItemStatus, ActivityEvent, ActivityEventType, ActionDefinition } from './types'; // Import the interface\nimport AddItemForm from './AddItemForm'; // Import the form component\nimport ItemDetailDrawer from './ItemDetailDrawer'; // Import the new Drawer component\nimport ReportIssueModal from './ReportIssueModal'; // Import the new modal\nimport AddUpdateModal from './AddUpdateModal'; // Import the new modal\nimport ResolveIssueModal from './ResolveIssueModal'; // Import the new modal\nimport TableSettingsModal from './TableSettingsModal'; // Import the new modal\nimport UserActivityView from './UserActivityView'; // Import the new component\nimport {\n  collection,\n  doc,\n  addDoc,\n  updateDoc,\n  serverTimestamp,\n} from 'firebase/firestore';\nimport { User as FirebaseUser } from \"firebase/auth\"; // Import Auth related types and functions\nimport { LogActionData } from 'shell-log-service'; // Import only the type, not the function\nimport { Box, IconButton, Typography, Menu, MenuItem, LinearProgress, Alert, useTheme, useMediaQuery, Paper, Card, CardContent, Table, TableBody, TableCell, TableContainer, TableHead, TableRow, ListItemIcon, ListItemText, Snackbar, AlertProps, Drawer } from '@mui/material'; // Removed unused Dialog*, List*, MuiSwitch, CardActions\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport FlagIcon from '@mui/icons-material/Flag';\nimport ArchiveIcon from '@mui/icons-material/Archive';\nimport UnarchiveIcon from '@mui/icons-material/Unarchive';\nimport ReportProblemIcon from '@mui/icons-material/ReportProblem';\nimport NoteAddIcon from '@mui/icons-material/NoteAdd';\nimport { db, auth } from 'shell/firebase'; // IMPORT SHARED INSTANCES FROM SHELL\nimport { useStockItems } from './hooks/useStockItems'; // IMPORT THE HOOK\nimport StockItemList from './StockItemList';\nimport ControlSurface from './ControlSurface';\nimport { useSnackbar } from './hooks/useSnackbar'; // Import the hook\nimport SnackbarAlert from './components/SnackbarAlert'; // Import the component\nimport { ColumnConfig } from './types'; // Import ColumnConfig from types.ts\nimport { removeUndefinedFields, createActivityEvent } from './utils'; // isItemLate not used directly in ToolApp\nimport { ALL_COLUMNS, DEFAULT_VISIBLE_COLUMN_IDS, LOCAL_STORAGE_KEY_VISIBLE_COLUMNS, getAvailableActions } from './config';\nimport { ActionMenu } from './ActionMenu'; // IMPORT ActionMenu component\n\nconsole.log('[IncomingTool] ToolApp.tsx: Top level, imported db is:', db); // Log db right after import\n\n// Define the props interface for ToolApp\nexport interface ToolAppProps {\n  user: FirebaseUser | null; // Use FirebaseUser type\n  org: any; // Replace 'any' with a specific org type if available\n  permissions: string[];\n  logAction?: (data: LogActionData) => Promise<void>; // Add logAction prop\n}\n\n// --- Main Tool Component ---\n\nconst ToolApp: React.FC<ToolAppProps> = ({ user, org, permissions, logAction }) => {\n  // Log received props, especially logAction\n  console.log('ToolApp Props Received:', { user, orgId: org?.id, permissions, logActionExists: !!logAction });\n  console.log('ToolApp using imported db:', db); // Log the imported db instance\n  console.log('ToolApp using imported auth:', auth); // Log the imported auth instance\n\n  // --- Use the custom hook for item data and filtering --- \n  const {\n    items, // Use 'items' which represents the filtered list\n    allItems, // Represents non-archived items from the hook\n    archivedItems, // Get archived items from the hook state\n    loading,\n    error,\n    searchTerm,\n    currentFilter,\n    showFlaggedOnly,\n    setSearchTerm,\n    setCurrentFilter,\n    setShowFlaggedOnly,\n    setError // Use the setError from the hook\n  } = useStockItems(org?.id);\n\n  // Log hook return values for debugging\n  console.log('[IncomingTool] useStockItems returned:', { loading, error, items_length: items?.length, allItems_length: allItems?.length, currentFilter, showFlaggedOnly, searchTerm });\n\n  // --- END hook usage ---\n  \n  // --- State Variables remaining in ToolApp ---\n  const [selectedItemDetailsDrawerData, setSelectedItemDetailsDrawerData] = useState<StockItem | null>(null); \n  const [isAddItemDrawerOpen, setIsAddItemDrawerOpen] = useState<boolean>(false); // RENAMED State\n  const [editingItem, setEditingItem] = useState<StockItem | null>(null); \n  const [reportingIssueItem, setReportingIssueItem] = useState<StockItem | null>(null);\n  const [addingUpdateItem, setAddingUpdateItem] = useState<StockItem | null>(null);\n  const [resolvingIssueItem, setResolvingIssueItem] = useState<StockItem | null>(null);\n  const [isSettingsModalOpen, setIsSettingsModalOpen] = useState(false); \n  const [itemForNote, setItemForNote] = useState<StockItem | null>(null); \n  const [isUserActivityViewOpen, setIsUserActivityViewOpen] = useState<boolean>(false); \n  const [visibleColumnIds, setVisibleColumnIds] = useState<Array<ColumnConfig['id']>>(() => {\n    try {\n      const stored = localStorage.getItem(LOCAL_STORAGE_KEY_VISIBLE_COLUMNS);\n      const parsed = stored ? JSON.parse(stored) : DEFAULT_VISIBLE_COLUMN_IDS;\n      return Array.isArray(parsed) ? parsed : DEFAULT_VISIBLE_COLUMN_IDS;\n    } catch (error) {\n      console.error(\"Error reading visible columns from localStorage\", error);\n      return DEFAULT_VISIBLE_COLUMN_IDS;\n    }\n  });\n  // Action Menu State\n  const [openMenuId, setOpenMenuId] = useState<string | null>(null);\n  const [menuAnchorEl, setMenuAnchorEl] = useState<null | HTMLElement>(null);\n  // --- END remaining state ---\n  \n  // Save visible columns to localStorage effect\n  useEffect(() => {\n        localStorage.setItem(LOCAL_STORAGE_KEY_VISIBLE_COLUMNS, JSON.stringify(visibleColumnIds));\n  }, [visibleColumnIds]);\n\n  // Derive visible columns config\n  const visibleColumns = visibleColumnIds\n      .map(id => ALL_COLUMNS.find(col => col.id === id))\n      .filter((col): col is ColumnConfig => col !== undefined); \n\n  // --- State Variables ---\n  const { snackbar, showSnackbar, closeSnackbar } = useSnackbar();\n  // --- END state ---\n\n  // --- Snackbar Helper --- \n  const handleSnackbarClose = (event?: React.SyntheticEvent | Event, reason?: string) => {\n    if (reason === 'clickaway') {\n      return;\n    }\n    closeSnackbar();\n  };\n  // --- END Snackbar Helper ---\n\n  // Centralized function to update item - uses `allItems` from hook now\n  const updateItemAndLog = useCallback(async (itemId: string, userId: string | undefined, changes: Partial<StockItem>, event: ActivityEvent, successMessage?: string) => {\n    console.log('[IncomingTool] updateItemAndLog: Checking db and org.id:', { db_instance: db, org_id: org?.id });\n    if (!db || !org?.id || !userId) {\n      console.error('Cannot update item: Missing configuration.', { db: !!db, orgId: org?.id, userId });\n      setError('Cannot update item: Missing configuration.'); // Use setError from hook\n      showSnackbar('Cannot update item: Missing configuration.', 'error'); // Add snackbar for config error\n      return;\n    }\n    console.log(`[IncomingTool] updateItemAndLog: Preparing to update item ${itemId} in org ${org.id}`);\n    const itemRef = doc(db, 'orgs', org.id, 'stockItems', itemId);\n    const itemBefore = allItems.find(i => i.id === itemId); // Find in allItems from hook\n    if (!itemBefore) {\n        console.error(`Item ${itemId} not found for update`);\n        setError(`Item ${itemId} not found.`);\n        showSnackbar(`Item ${itemId} not found.`, 'error'); // Add snackbar for not found error\n        return;\n    }\n\n    // Combine updates with new activity event and timestamp\n    const finalUpdates = removeUndefinedFields({\n      ...changes,\n      lastUpdated: serverTimestamp(),\n    });\n\n    const itemAfter = { ...itemBefore, ...finalUpdates }; // Approximate state after update\n\n    try {\n      await updateDoc(itemRef, finalUpdates);\n      console.log(`Item ${itemId} updated successfully.`);\n      // SHOW SUCCESS SNACKBAR\n      showSnackbar(successMessage || 'Item updated successfully.', 'success'); \n\n      // Log the generic update action\n      console.log('updateItemAndLog: Attempting to log action. logAction available?', !!logAction);\n      if (logAction) {\n        // Determine standardized action name\n        let actionName: string;\n        try {\n          if (event.type === 'EDITED') {\n            actionName = 'item.update.fields';\n          } else if (event.type === 'FLAG_TOGGLED') {\n            actionName = 'item.update.flag';\n          } else if (event.type === 'STATUS_CHANGED') {\n            const newStatus = event.details?.newStatus?.toLowerCase() || 'unknown';\n            actionName = `item.update.status.${newStatus}`;\n          } else if (event.type === 'ISSUE_REPORTED') {\n            actionName = 'item.update.issue.report';\n          } else if (event.type === 'ISSUE_RESOLVED') {\n            actionName = 'item.update.issue.resolve';\n          } else if (event.type === 'ISSUE_UPDATE_ADDED') {\n            actionName = 'item.update.issue.update';\n          } else if (event.type === 'NOTE_ADDED') {\n            actionName = 'item.add_note';\n          } else {\n            actionName = event.type; // Fallback\n          }\n        } catch (nameError) {\n          console.error('Error deriving action name for logging:', nameError);\n          actionName = event.type;\n        }\n\n        // Construct the data payload ensuring types match LogActionData\n        const logData: LogActionData = {\n           orgId: org.id,\n           toolKey: 'incomingtool',\n           action: actionName, // actionName is now guaranteed to be string\n           entityPath: `stockItems/${itemId}`,\n           // Conditionally add before/after/details if they exist\n           ...(itemBefore !== undefined && { before: itemBefore }),\n           ...(itemAfter !== undefined && { after: itemAfter }),\n           ...(event.details !== undefined && { details: event.details })\n        };\n\n        await logAction(logData); // Pass the correctly typed object\n\n      }\n\n    } catch (e) {\n      console.error(`Error updating item ${itemId}:`, e);\n      setError(`Failed to update item: ${(e as Error).message}`);\n      // SHOW ERROR SNACKBAR\n      showSnackbar(`Failed to update item: ${(e as Error).message}`, 'error');\n      // REMOVED: throw e; // Don't re-throw, let snackbar handle user feedback\n    }\n  }, [org, allItems, logAction, setError]); // Removed showSnackbar from deps as it relies on state setters only\n\n  // Item action handler\n  const handleItemAction = useCallback(async (itemId: string, action: ActionDefinition) => {\n    console.log(`Action: ${action.label} on item ${itemId}`);\n    const item = allItems.find(i => i.id === itemId) || archivedItems.find(i => i.id === itemId);\n\n    if (!item) {\n      console.error(`Item ${itemId} not found for action ${action.id}.`);\n      setError(`Item ${itemId} not found.`);\n      showSnackbar(`Item ${itemId} not found.`, 'error');\n      return;\n    }\n\n    try { // Wrap actions that call updateItemAndLog in try/catch\n      switch (action.id) {\n        case 'Edit Item':\n          setEditingItem(item);\n          setIsAddItemDrawerOpen(true);\n          break;\n        case 'Flag Item':\n        case 'Unflag Item':\n          const newFlagState = action.id === 'Flag Item';\n          await updateItemAndLog(itemId, user?.uid,\n            { isFlagged: newFlagState },\n            createActivityEvent(user?.uid || '', 'FLAG_TOGGLED', { isFlagged: newFlagState }),\n            `Item ${newFlagState ? 'flagged' : 'unflagged'}.` // Custom success message\n          );\n          break;\n        case 'Mark as Delivered':\n          if (item.currentStatus !== 'Delivered') {\n            await updateItemAndLog(itemId, user?.uid,\n              { currentStatus: 'Delivered', dateDelivered: new Date().toISOString() },\n              createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: item.currentStatus, newStatus: 'Delivered' }),\n              'Item marked as Delivered.'\n            );\n          }\n          break;\n        case 'Archive':\n           if (item.currentStatus !== 'Archived') {\n            const prevStatus = item.currentStatus;\n            await updateItemAndLog(itemId, user?.uid,\n              { currentStatus: 'Archived', previousStatus: prevStatus },\n              createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: prevStatus, newStatus: 'Archived' }),\n              'Item archived.'\n            );\n           }\n          break;\n        case 'Unarchive Item':\n          if (item.currentStatus === 'Archived') {\n             const restoredStatus = item.previousStatus || 'Delivered';\n             await updateItemAndLog(itemId, user?.uid,\n               { currentStatus: restoredStatus, previousStatus: undefined },\n               createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: 'Archived', newStatus: restoredStatus }),\n               'Item unarchived.'\n             );\n          }\n          break;\n         case 'Report Issue': \n           setSelectedItemDetailsDrawerData(null);\n           setReportingIssueItem(item);\n           break;\n         case 'Resolve Issue': \n           setSelectedItemDetailsDrawerData(null);\n           setResolvingIssueItem(item);\n           break;\n         case 'Add Issue Update':\n           setSelectedItemDetailsDrawerData(null);\n           setAddingUpdateItem(item);\n           break;\n         case 'Add Note':\n            setItemForNote(item);\n            break;\n        // No default needed as actions come from getAvailableActions\n      }\n    } catch (e) {\n        // Catch errors from updateItemAndLog if it re-throws (it doesn't now)\n        // Or handle errors specific to this level if any\n        console.error(`Error performing action ${action.label} on item ${itemId}:`, e);\n        // showSnackbar(`Action failed: ${(e as Error).message}`, 'error'); // Already handled in updateItemAndLog\n    }\n  }, [user?.uid, allItems, archivedItems, updateItemAndLog, setError, setSelectedItemDetailsDrawerData, setReportingIssueItem, setResolvingIssueItem, setAddingUpdateItem, setItemForNote]); // Removed state setters not used in switch\n\n  // --- RESTORED MODAL HANDLERS ---\n  const handleSaveItem = async (newItemOrUpdate: Omit<StockItem, 'id' | 'activityLog' | 'lastUpdated' | 'currentStatus' | 'dateDelivered'>, itemId?: string) => { \n    if (!user?.uid || !org?.id || !db) {\n      setError('Missing user, org, or DB connection.');\n      showSnackbar('Save failed: Missing user, org, or DB connection.', 'error');\n      return;\n    }\n\n    // We need to handle potential missing fields if editing vs adding\n    // This might require more complex logic or adjusting AddItemForm\n    // For now, assume newItemOrUpdate contains necessary fields, add placeholders for required ones if adding\n    const dataToSave = removeUndefinedFields({\n      ...newItemOrUpdate,\n          lastUpdated: serverTimestamp(),\n        });\n\n    try {\n      if (itemId) { // Editing existing item\n        console.log(`[IncomingTool] handleSaveItem: Updating item ${itemId}`);\n        const itemRef = doc(db, 'orgs', org.id, 'stockItems', itemId);\n        // Use correct field name: changedFields\n        const event = createActivityEvent(user.uid, 'EDITED', { changedFields: Object.keys(newItemOrUpdate) });\n        // Pass the potentially incomplete data - ensure updateItemAndLog handles partial updates\n        await updateItemAndLog(itemId, user.uid, dataToSave, event, 'Item updated successfully.'); \n      } else { // Adding new item\n        console.log('[IncomingTool] handleSaveItem: Adding new item');\n        const collectionRef = collection(db, 'orgs', org.id, 'stockItems');\n        // Add required fields not expected from AddItemForm's type inference\n        const completeNewItemData = {\n          ...dataToSave,\n          currentStatus: 'Pending Delivery' as ItemStatus, // Default status\n          activityLog: [createActivityEvent(user.uid, 'CREATED')],\n          orgId: org.id,\n        };\n        const docRef = await addDoc(collectionRef, completeNewItemData);\n        console.log('[IncomingTool] handleSaveItem: Item added with ID:', docRef.id);\n        showSnackbar('Item added successfully.', 'success'); // Snackbar for add\n        if (logAction) {\n          await logAction({\n            orgId: org.id,\n            toolKey: 'incomingtool',\n            action: 'item.create',\n            entityPath: `stockItems/${docRef.id}`,\n            after: { id: docRef.id, ...completeNewItemData }\n          });\n        }\n      }\n      setIsAddItemDrawerOpen(false);\n      setEditingItem(null);\n    } catch (e) {\n      console.error(\"Error saving item:\", e);\n      setError(`Failed to save item: ${(e as Error).message}`);\n      // Error snackbar is shown within updateItemAndLog if it fails there\n      // Show snackbar here only if addDoc fails\n      if (!itemId) {\n          showSnackbar(`Failed to add item: ${(e as Error).message}`, 'error');\n      }\n    }\n  };\n\n  const handleSaveReportIssue = async (itemId: string, issueDescValue: string, userId: string) => { // Renamed param\n    // Use correct field name: issueDescription\n    const event = createActivityEvent(userId, 'ISSUE_REPORTED', { issueDescription: issueDescValue });\n    await updateItemAndLog(itemId, userId, \n      { currentStatus: 'Issue', issueDescription: issueDescValue }, // Save the description\n      event,\n      'Issue reported successfully.'\n    );\n    setReportingIssueItem(null); // Close modal\n  };\n\n  const handleSaveIssueUpdate = async (itemId: string, note: string, userId: string) => {\n    const event = createActivityEvent(userId, 'ISSUE_UPDATE_ADDED', { note }); // 'note' is correct\n    await updateItemAndLog(itemId, userId, \n        { /* No direct field changes */ }, \n        event,\n        'Issue update added.'\n    );\n    console.warn(\"Issue update note logged, but not stored directly on item field in this basic implementation.\");\n    setAddingUpdateItem(null); // Close modal\n  };\n\n  const handleSaveResolveIssue = async (itemId: string, resolutionNoteValue: string, userId: string) => { \n    const item = allItems.find(i => i.id === itemId);\n    if (!item) return;\n    const resolvedStatus: ItemStatus = 'Delivered'; // Simple assumption\n    // Use correct field name: resolutionOutcome\n    const event = createActivityEvent(userId, 'ISSUE_RESOLVED', { resolutionOutcome: resolutionNoteValue });\n    await updateItemAndLog(itemId, userId, \n      { currentStatus: resolvedStatus, issueDescription: 'Resolved: ' + resolutionNoteValue }, \n      event,\n      'Issue resolved successfully.'\n    );\n    setResolvingIssueItem(null); // Close modal\n  };\n\n  const handleSaveNote = async (itemId: string, note: string, userId: string) => {\n    const event = createActivityEvent(userId, 'NOTE_ADDED', { note }); // 'note' is correct\n     await updateItemAndLog(itemId, userId, \n        { /* No direct field changes */ }, \n        event,\n        'Note added successfully.'\n     );\n     console.warn(\"General note logged, but not stored directly on item field.\");\n    setItemForNote(null); // Close modal\n  };\n  // --- END RESTORED MODAL HANDLERS ---\n\n  // Other handlers (handleSaveReportIssue, handleSaveIssueUpdate, etc.) - use `allItems` from hook if needed\n  // ... other handlers ...\n\n  const handleViewDetails = useCallback((itemId: string) => {\n    const item = allItems.find(i => i.id === itemId); // Find in allItems from hook\n    if (!item) {\n      console.error(\"Item not found for viewing details:\", itemId);\n      setError('Item not found.'); // Use setError state setter\n      return;\n    }\n    console.log(\"Viewing details for:\", item);\n    if (!org) {\n      console.error(\"Org ID is missing, cannot fetch logs.\");\n      setError('Organization context is missing.'); // Use setError state setter\n      return;\n    }\n    setSelectedItemDetailsDrawerData(item); // Use setSelectedItemDetailsDrawerData state setter\n    // TODO: Focus management - consider focusing the modal or close button\n  }, [org, allItems, setError]); // Add setError if used\n\n  // --- Handler for opening the action menu ---\n  const handleMenuOpen = (event: React.MouseEvent<HTMLElement>, item: StockItem) => { // Modified to accept 'item'\n    setMenuAnchorEl(event.currentTarget);\n    setOpenMenuId(item.id); // Use item.id here\n  };\n\n  // --- RENDER LOGIC --- \n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\n\n  // --- Mobile Item Card Component (REMOVED - Moved to StockItemList) ---\n  // interface MobileItemCardProps { ... } // REMOVED\n  // const MobileItemCard: React.FC<MobileItemCardProps> = ({ ... }) => { ... }; // REMOVED\n\n  // renderActionMenu\n  const renderActionMenu = () => {\n    if (!openMenuId) return null;\n    const item = allItems.find(i => i.id === openMenuId); // Find in allItems from hook\n    if (!item) return null; // Handle case where item might not be found\n    const actions = getAvailableActions(item.currentStatus, item.isFlagged);\n    return (\n      <ActionMenu\n        itemId={item.id}\n        actions={actions}\n        onActionSelected={handleItemAction}\n        anchorEl={menuAnchorEl}\n        open={Boolean(menuAnchorEl && openMenuId === item.id)} // Ensure menu opens for the correct item\n        onClose={() => setMenuAnchorEl(null)} // Simple close handler\n      />\n    );\n  };\n\n  // Main return statement\n  return (\n    <Box sx={{ p: isMobile ? 1 : 2 }}>\n      {/* --- USE ControlSurface Component --- */}\n      <ControlSurface\n        onAddItem={() => {\n          setEditingItem(null);\n          setIsAddItemDrawerOpen(true);\n        }}\n        onOpenSettings={() => setIsSettingsModalOpen(true)}\n        onOpenActivity={() => setIsUserActivityViewOpen(true)}\n        searchTerm={searchTerm}\n        onSearchTermChange={setSearchTerm}\n        showFlaggedOnly={showFlaggedOnly}\n        onShowFlaggedOnlyChange={setShowFlaggedOnly}\n        currentFilter={currentFilter}\n        onCurrentFilterChange={setCurrentFilter}\n      />\n\n      {/* Error/Loading Messages */} \n      {error && <Alert severity=\"error\" onClose={() => setError(null)} sx={{ /* ... */ }}>{error}</Alert>} \n      {loading && <LinearProgress sx={{ position: 'absolute', top: 0, left: 0, right: 0 }} />} \n      \n      {/* Stock List Display */} \n      <StockItemList \n        items={items} \n        loading={loading}\n        isMobile={isMobile}\n        visibleColumns={visibleColumns}\n        visibleColumnIds={visibleColumnIds}\n        onColumnOrderChange={(newOrder) => setVisibleColumnIds(newOrder)} // Pass setter directly or wrapped handler\n        onViewDetails={handleViewDetails}\n        onMenuOpen={handleMenuOpen}\n      />\n      \n      {/* Modals */}\n      {/* Add/Edit Item Drawer */}\n      <Drawer\n        anchor=\"right\"\n        open={isAddItemDrawerOpen}\n        onClose={() => setIsAddItemDrawerOpen(false)}\n        PaperProps={{\n          sx: { \n            width: { xs: '90%', sm: '500px', md: '600px' },\n            // Add padding inside the drawer paper itself if AddItemForm doesn't handle it\n            // p: 3 // Example padding, adjust as needed\n          }\n        }}\n      >\n        <AddItemForm \n          onClose={() => setIsAddItemDrawerOpen(false)}\n          onSave={handleSaveItem} \n          initialData={editingItem}\n        />\n      </Drawer>\n\n      {/* Item Details Drawer */}\n      <Drawer\n        anchor=\"right\"\n        open={!!selectedItemDetailsDrawerData} // Open if there's data\n        onClose={() => setSelectedItemDetailsDrawerData(null)}\n        PaperProps={{ sx: { width: '90%', maxWidth: '600px' } }} // Adjust width as needed\n      >\n        {/* Render ItemDetailDrawer only when open and data is available */}\n        {selectedItemDetailsDrawerData && (\n          <ItemDetailDrawer\n            item={selectedItemDetailsDrawerData}\n            orgId={org?.id || ''} // Pass orgId\n            onClose={() => setSelectedItemDetailsDrawerData(null)}\n            onActionSelected={handleItemAction} // Pass action handler\n          />\n        )}\n      </Drawer>\n\n      {/* Report Issue Modal */}\n      {reportingIssueItem && (\n        <ReportIssueModal \n          isOpen={!!reportingIssueItem}\n          onClose={() => setReportingIssueItem(null)} \n          item={reportingIssueItem}\n          onSubmit={(description: string) => \n            handleSaveReportIssue(reportingIssueItem.id, description, user?.uid || '')\n          }\n        />\n      )}\n      \n      {/* Add Issue Update Modal - Rename onSave to onSubmit */}\n      {addingUpdateItem && (\n        <AddUpdateModal \n           isOpen={!!addingUpdateItem}\n          onClose={() => setAddingUpdateItem(null)} \n           item={addingUpdateItem} // REVERTED to 'item'\n           // Pass lambda calling correct handler\n           onSubmit={(note: string) => \n            handleSaveIssueUpdate(addingUpdateItem.id, note, user?.uid || '')\n           }\n           // userId={user?.uid} // REMOVED\n         />\n      )}\n\n      {/* Resolve Issue Modal - Rename onSave to onSubmit */}\n      {resolvingIssueItem && (\n        <ResolveIssueModal \n            isOpen={!!resolvingIssueItem}\n          onClose={() => setResolvingIssueItem(null)} \n            item={resolvingIssueItem} // REVERTED to 'item'\n            // Pass lambda calling correct handler\n            onSubmit={(outcome: string, note?: string) => \n              handleSaveResolveIssue(resolvingIssueItem.id, outcome, user?.uid || '') // Pass item id, outcome as note, user id\n            }\n            // userId={user?.uid} // REMOVED\n          />\n      )}\n\n      {/* Add Note Modal (if separate from AddUpdateModal) - Rename onSave to onSubmit */}\n      {itemForNote && (\n        <AddUpdateModal \n            isOpen={!!itemForNote}\n            onClose={() => setItemForNote(null)} \n            item={itemForNote} // REVERTED to 'item'\n             // Pass lambda calling correct handler\n            onSubmit={(note: string) => \n              handleSaveNote(itemForNote.id, note, user?.uid || '')\n            }\n            // userId={user?.uid} // REMOVED\n            // isNoteOnly={true} // REMOVED - AddUpdateModal doesn't have this prop\n         />\n      )}\n\n      {/* Table Settings Modal - Fix props */}\n      <TableSettingsModal\n        isOpen={isSettingsModalOpen}\n        onClose={() => setIsSettingsModalOpen(false)}\n        allColumns={ALL_COLUMNS.filter(c => c.id !== 'actions')} // Exclude 'actions' column\n        initialVisibleColumns={visibleColumns} // RENAMED prop, using derived object array\n        onSave={setVisibleColumnIds} // RENAMED prop, handler is correct\n      />\n\n      {/* User Activity View Drawer/Modal - Fix props */}\n        <UserActivityView\n        isOpen={isUserActivityViewOpen}\n          db={db}\n        orgId={org?.id}\n          onClose={() => setIsUserActivityViewOpen(false)}\n        />\n      {/* --- END RESTORED MODALS --- */}\n\n      {/* Render Action Menu */}\n      {renderActionMenu()}\n\n      {/* Snackbar Component - Use hook state and imported Alert component */}\n      <Snackbar \n        open={snackbar.open} \n        autoHideDuration={6000} \n        onClose={handleSnackbarClose}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }} \n      >\n        {/* Use ternary operator, rendering undefined when message is empty */}\n        {snackbar.message ? (\n            <SnackbarAlert onClose={handleSnackbarClose} severity={snackbar.severity || 'info'} sx={{ width: '100%' }}>\n              {snackbar.message}\n            </SnackbarAlert>\n        ) : undefined}\n      </Snackbar>\n    </Box>\n  );\n}\n\nexport default ToolApp;","import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Typography\n} from '@mui/material';\nimport { StockItem } from './types'; // Import StockItem if needed for context\n\ninterface ReportIssueModalProps {\n  isOpen: boolean;\n  item: StockItem; // Pass the item for context\n  onSubmit: (description: string) => void;\n  onClose: () => void;\n}\n\nconst ReportIssueModal: React.FC<ReportIssueModalProps> = ({ isOpen, item, onSubmit, onClose }) => {\n  const [description, setDescription] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    if (!description.trim()) {\n      setError('Please enter a description of the issue.');\n      return;\n    }\n    onSubmit(description);\n    onClose(); // Close modal after successful submission\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Report Issue for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        <TextField\n          autoFocus\n          id=\"issueDescription\"\n          label=\"Describe the Issue *\"\n          type=\"text\"\n          fullWidth\n          multiline\n          rows={4}\n          variant=\"outlined\"\n          size=\"small\"\n          sx={{ mb: 2 }}\n          value={description}\n          onChange={(e) => {\n            setDescription(e.target.value);\n            if (error) setError(''); // Clear error on type\n          }}\n          error={!!error}\n          helperText={error || 'Please provide details about the problem.'}\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Issue Report\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ReportIssueModal;","import { StockItem, ItemStatus, ActivityEvent, ActivityEventType } from './types';\r\n\r\n// Utility to remove undefined fields before saving to Firestore\r\nexport function removeUndefinedFields(obj: Record<string, any>) {\r\n  return Object.fromEntries(Object.entries(obj).filter(([_, v]) => v !== undefined));\r\n}\r\n\r\n// Function to check if an item is considered late\r\nexport const isItemLate = (item: StockItem): boolean => {\r\n  if (item.currentStatus !== 'Pending Delivery') {\r\n    return false;\r\n  }\r\n  // Ensure orderDate is valid before creating a Date object\r\n  if (!item.orderDate || isNaN(new Date(item.orderDate).getTime())) {\r\n      console.warn(\"Invalid or missing orderDate for late check:\", item.id);\r\n      return false; \r\n  }\r\n  const orderDate = new Date(item.orderDate);\r\n  const sevenDaysAgo = new Date();\r\n  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\r\n  return orderDate < sevenDaysAgo;\r\n};\r\n\r\n// Function to create a new ActivityEvent\r\nexport const createActivityEvent = (\r\n  userId: string, \r\n  type: ActivityEventType,\r\n  details: ActivityEvent['details'] = {}\r\n): ActivityEvent => ({\r\n  timestamp: new Date().toISOString(),\r\n  type,\r\n  userId,\r\n  details,\r\n}); ","import React from 'react';\r\nimport MuiAlert, { AlertProps } from '@mui/material/Alert';\r\n\r\n// Define the SnackbarAlert component using forwardRef\r\nconst SnackbarAlert = React.forwardRef<HTMLDivElement, AlertProps>(\r\n  function SnackbarAlert(props, ref) {\r\n    // Use the standard imported MuiAlert\r\n    return <MuiAlert elevation={6} ref={ref} variant=\"filled\" {...props} />;\r\n  }\r\n);\r\n\r\nexport default SnackbarAlert;\r\n\r\n// Add empty export to ensure it's treated as a module under --isolatedModules\r\nexport {}; ","import React, { useState, useEffect, Fragment } from 'react';\nimport { \n  getFirestore, collection, query, where, orderBy, limit, onSnapshot, Timestamp, \n  getDocs, QuerySnapshot, QueryDocumentSnapshot, FirestoreError, Firestore \n} from 'firebase/firestore';\nimport { \n  Dialog, DialogTitle, DialogContent, DialogActions, \n  Button, Typography, Box, CircularProgress, List, ListItem, ListItemText, Divider \n} from '@mui/material';\nimport { LogActionData, ActionDefinition } from './types'; \n\ninterface UserActivityViewProps {\n  isOpen: boolean;\n  db: Firestore;\n  orgId: string;\n  onClose: () => void;\n}\n\nconst getActionDescription = (log: LogActionData): string => {\n  switch (log.action) {\n    case 'item.create':\n      return 'Item created';\n    case 'item.update.fields': {\n      if (log.before && log.after) {\n        const fields = (log.details?.changedFields as string[] | undefined)\n          || Object.keys(log.after).filter(k => JSON.stringify(log.before?.[k]) !== JSON.stringify(log.after?.[k]));\n        if (fields.length) {\n          const changes = fields.map(f => `${f}: ${log.before?.[f]} → ${log.after?.[f]}`);\n          return `Edited ${changes.join(', ')}`;\n        }\n      }\n      const simple = (log.details?.changedFields as string[] | undefined)?.join(', ');\n      return simple ? `Edited fields: ${simple}` : 'Item edited';\n    }\n    default:\n      if (log.action.startsWith('item.update.status.')) {\n        const oldStat = log.details?.previousStatus || (log.before?.currentStatus as string) || 'Unknown';\n        const newStat = log.details?.newStatus || log.action.replace('item.update.status.', '');\n        return `Status changed: ${oldStat} → ${newStat}`;\n      }\n      if (log.action === 'item.update.flag') {\n        const flagged = log.details?.isFlagged;\n        return flagged ? 'Item flagged' : 'Item unflagged';\n      }\n      if (log.action === 'item.update.issue.report') {\n        return `Issue reported: ${log.details?.description || log.details?.issueDescription || ''}`;\n      }\n      if (log.action === 'item.update.issue.update') {\n        return `Issue update added: ${log.details?.note || ''}`;\n      }\n      if (log.action === 'item.update.issue.resolve') {\n        return `Issue resolved: ${log.details?.resolutionOutcome || ''}`;\n      }\n      if (log.action === 'item.add_note') {\n        return `Note added: ${log.details?.note || ''}`;\n      }\n      return log.action;\n  }\n};\n\nconst UserActivityView: React.FC<UserActivityViewProps> = ({ isOpen, db, orgId, onClose }) => {\n  const [logs, setLogs] = useState<LogActionData[]>([]);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [error, setError] = useState<string | null>(null);\n  const [members, setMembers] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    if (!orgId) return;\n    const membersRef = collection(db, `orgs/${orgId}/members`);\n    getDocs(membersRef)\n      .then((snapshot: QuerySnapshot) => {\n        const map: Record<string, string> = {};\n        snapshot.docs.forEach((doc: QueryDocumentSnapshot) => {\n          const data: any = doc.data();\n          map[doc.id] = data.email || doc.id;\n        });\n        setMembers(map);\n      })\n      .catch((err: FirestoreError) => console.error('Error fetching members:', err));\n  }, [orgId, db, setMembers]);\n\n  useEffect(() => {\n    if (!orgId) {\n      setError('Organization ID is required.');\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    const logsRef = collection(db, `orgs/${orgId}/logs`);\n    const q = query(\n      logsRef,\n      where('tool', '==', 'incomingtool'),\n      orderBy('ts', 'desc'),\n      limit(100)\n    );\n\n    const unsubscribe = onSnapshot(q, (snapshot: QuerySnapshot) => {\n      const fetchedLogs = snapshot.docs.map(doc => {\n        const d = doc.data() as any;\n        return {\n          orgId,\n          toolKey: d.toolKey || d.tool,\n          action: d.action,\n          entityPath: d.entityPath,\n          timestamp: d.timestamp || d.ts,\n          userId: d.userId || d.uid,\n          userEmail: d.email, \n          before: d.before,\n          after: d.after,\n          details: d.details,\n        } as LogActionData;\n      });\n      const relevantLogs = fetchedLogs.filter(log => log.action !== 'app-loaded');\n      setLogs(relevantLogs);\n      setLoading(false);\n    }, (err) => {\n      console.error(\"Error fetching user activity logs: \", err); \n      const firestoreError = err as FirestoreError; \n      setError(`Failed to load activity logs: ${firestoreError.message}`);\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [orgId, db, setLogs]);\n\n  const renderLogEntryContent = (log: LogActionData) => {\n    const time = log.timestamp instanceof Timestamp\n      ? log.timestamp.toDate().toLocaleString()\n      : typeof log.timestamp === 'string'\n      ? new Date(log.timestamp).toLocaleString()\n      : 'Invalid Date';\n    const user = log.userEmail || members[log.userId || ''] || log.userId || 'system';\n    const actionDesc = getActionDescription(log);\n    const parts = log.entityPath.split('/');\n    const entityId = parts.length >= 2 ? parts[1] : '';\n    const qty = log.before?.quantity;\n    const name = log.before?.productName as string | undefined;\n    const entityLabel = qty && name\n      ? `${qty}x ${name}`\n      : ((log.before?.deliveryName as string) || name || entityId);\n\n    return (\n      <ListItemText\n        primary={\n          <Fragment>\n            <Typography sx={{ display: 'inline' }} component=\"span\" variant=\"body2\" color=\"text.primary\">\n              {time} - {actionDesc} by {user}\n            </Typography>\n            <Typography \n              component=\"span\" \n              variant=\"body2\" \n              sx={{ ml: 1, color: 'text.secondary' }}\n            >\n              {entityLabel}\n            </Typography>\n          </Fragment>\n        }\n      />\n    );\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"md\" fullWidth scroll=\"paper\">\n      <DialogTitle>\n        <Typography variant=\"h6\">User Activity Log</Typography>\n        <Typography variant=\"caption\">Last 100 entries</Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {loading && (\n          <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '200px' }}> \n            <CircularProgress />\n          </Box>\n        )}\n        {error && (\n          <Typography color=\"error\" sx={{ textAlign: 'center', mt: 2 }}>\n            {error}\n          </Typography>\n        )}\n        {!loading && !error && (\n          <List dense sx={{ width: '100%', bgcolor: 'background.paper', p: 0 }}> \n            {logs.length === 0 ? (\n              <ListItem>\n                <ListItemText primary=\"No activity logs found.\" />\n              </ListItem>\n            ) : (\n              logs.map((log, index) => (\n                <Fragment key={`${log.timestamp}-${index}-${log.action}`}> \n                  <ListItem alignItems=\"flex-start\" sx={{ py: 1.5 }}> \n                    {renderLogEntryContent(log)}\n                  </ListItem>\n                  {index < logs.length - 1 && <Divider variant=\"inset\" component=\"li\" />} \n                </Fragment>\n              ))\n            )}\n          </List>\n        )}\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"primary\">\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default UserActivityView;\n","import React, { useState, useEffect } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, Typography, FormGroup, FormControlLabel, Checkbox, Box\n} from '@mui/material';\nimport { ColumnConfig } from './types';\n\ninterface TableSettingsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  allColumns: ColumnConfig[];\n  initialVisibleColumns: ColumnConfig[];\n  onSave: (newVisibleColumnIds: Array<ColumnConfig['id']>) => void;\n}\n\n// --- Main Modal Component ---\nconst TableSettingsModal: React.FC<TableSettingsModalProps> = ({\n  isOpen,\n  onClose,\n  allColumns,\n  initialVisibleColumns,\n  onSave\n}) => {\n  // State to track checked status of each column ID\n  const [checkedState, setCheckedState] = useState<Record<ColumnConfig['id'], boolean>>(() =>\n    // Initialize state using Object.fromEntries for correct typing\n    Object.fromEntries(\n        allColumns.map(col => [col.id, false])\n    ) as Record<ColumnConfig['id'], boolean>\n  );\n\n  // Initialize or update checked state when modal opens or initialVisibleColumns change\n  useEffect(() => {\n    if (isOpen) {\n        const visibleIds = new Set(initialVisibleColumns.map(col => col.id));\n        // Create the updated state object directly using Object.fromEntries\n        const updatedCheckedState = Object.fromEntries(\n            allColumns.map(col => [col.id, visibleIds.has(col.id)])\n        ) as Record<ColumnConfig['id'], boolean>;\n        setCheckedState(updatedCheckedState);\n    }\n  }, [isOpen, initialVisibleColumns, allColumns]);\n\n  const handleCheckboxChange = (columnId: ColumnConfig['id']) => {\n      setCheckedState(prevState => ({\n          ...prevState,\n          [columnId]: !prevState[columnId]\n      }));\n  };\n\n  const handleSaveChanges = () => {\n    // Filter all column IDs to get only the ones that are checked\n    const newVisibleColumnIds = allColumns\n        .map(col => col.id)\n        .filter(id => checkedState[id]);\n    onSave(newVisibleColumnIds); // Pass the array of visible IDs\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"xs\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Configure Table Columns</Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        <Typography variant=\"body2\" gutterBottom>\n          Select the columns you want to display:\n        </Typography>\n        <Box sx={{ maxHeight: '60vh', overflowY: 'auto', pr: 1 }}> {/* Scrollable Box */}\n          <FormGroup>\n            {allColumns.map(col => (\n              <FormControlLabel\n                key={col.id}\n                control={\n                  <Checkbox\n                    checked={checkedState[col.id] || false}\n                    onChange={() => handleCheckboxChange(col.id)}\n                    disabled={col.id === 'actions'} // Optionally disable toggling\n                  />\n                }\n                label={col.label}\n              />\n            ))}\n          </FormGroup>\n        </Box>\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSaveChanges} variant=\"contained\" color=\"primary\">\n          Save Settings\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default TableSettingsModal;","import React from 'react';\r\nimport {\r\n  DndContext,\r\n  closestCenter,\r\n  KeyboardSensor,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  DragEndEvent,\r\n} from '@dnd-kit/core';\r\nimport {\r\n  arrayMove,\r\n  SortableContext,\r\n  sortableKeyboardCoordinates,\r\n  useSortable,\r\n  horizontalListSortingStrategy,\r\n} from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\nimport { restrictToHorizontalAxis } from '@dnd-kit/modifiers';\r\nimport { StockItem, ItemStatus, ColumnConfig } from './types'; // Import ColumnConfig from types\r\nimport {\r\n  Box,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow,\r\n  Paper,\r\n  Typography,\r\n  IconButton,\r\n  Card,\r\n  CardContent,\r\n  Chip, // Import Chip\r\n} from '@mui/material';\r\nimport { Theme, useTheme } from '@mui/material/styles';\r\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\r\nimport FlagIcon from '@mui/icons-material/Flag'; // Ensure FlagIcon is imported\r\nimport { isItemLate } from './utils'; // Import isItemLate from utils\r\n\r\n// --- Helper Function for Status Chip --- (Consider moving to utils.ts later)\r\ntype ChipColor = 'default' | 'primary' | 'secondary' | 'error' | 'info' | 'success' | 'warning';\r\ninterface StatusChipProps {\r\n  color: ChipColor;\r\n  variant: 'filled' | 'outlined';\r\n}\r\n\r\nconst getStatusChipProps = (status: ItemStatus): StatusChipProps => {\r\n  switch (status) {\r\n    case 'Delivered':\r\n      return { color: 'success', variant: 'filled' };\r\n    case 'Issue':\r\n      return { color: 'error', variant: 'filled' };\r\n    case 'Late':\r\n      return { color: 'warning', variant: 'filled' };\r\n    case 'Pending Delivery':\r\n      return { color: 'info', variant: 'outlined' };\r\n    case 'Archived':\r\n      return { color: 'default', variant: 'outlined' };\r\n    default:\r\n      return { color: 'default', variant: 'outlined' };\r\n  }\r\n};\r\n\r\n// --- Draggable Header Component ---\r\ninterface DraggableHeaderProps {\r\n  column: ColumnConfig;\r\n}\r\n\r\nconst DraggableHeader: React.FC<DraggableHeaderProps> = ({ column }) => {\r\n  const {\r\n    attributes,\r\n    listeners,\r\n    setNodeRef,\r\n    transform,\r\n    transition,\r\n    isDragging,\r\n  } = useSortable({ id: column.id });\r\n\r\n  const style: React.CSSProperties = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition,\r\n    opacity: isDragging ? 0.5 : 1,\r\n    cursor: 'grab',\r\n    touchAction: 'none',\r\n  };\r\n\r\n  const isNumeric = ['quantity', 'pricePerItem'].includes(column.id);\r\n\r\n  return (\r\n    <TableCell\r\n      ref={setNodeRef}\r\n      style={style}\r\n      {...attributes}\r\n      {...listeners}\r\n      align={isNumeric ? 'right' : 'left'}\r\n      padding={column.id === 'actions' ? 'checkbox' : 'normal'} // Apply checkbox padding for actions column\r\n      sx={{\r\n        whiteSpace: 'nowrap',\r\n        // Removed bgcolor: isDragging - Handled by theme/MUI defaults ideally\r\n        // Removed specific width settings for now, rely on content or Table layout\r\n      }}\r\n    >\r\n      {column.label}\r\n    </TableCell>\r\n  );\r\n};\r\n\r\n// --- Mobile Item Card Component ---\r\ninterface MobileItemCardProps {\r\n  item: StockItem;\r\n  onViewDetails: (itemId: string) => void;\r\n  onActionClick: (event: React.MouseEvent<HTMLElement>, item: StockItem) => void;\r\n  theme: Theme;\r\n}\r\n\r\nconst MobileItemCard: React.FC<MobileItemCardProps> = ({ item, onViewDetails, onActionClick, theme }) => {\r\n  // Basic mobile card remains, using new status chip\r\n  const statusProps = getStatusChipProps(item.currentStatus);\r\n  return (\r\n    <Card\r\n      variant=\"outlined\"\r\n      sx={{ mb: 1, cursor: 'pointer', '&:hover': { bgcolor: 'action.hover' } }}\r\n      onClick={() => onViewDetails(item.id)}\r\n    >\r\n      <CardContent sx={{ pb: '8px !important', position: 'relative' }}>\r\n        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n          <Box sx={{ flexGrow: 1, mr: 1, display: 'flex', alignItems: 'center', gap: 0.5 }}>\r\n             {item.isFlagged && <FlagIcon sx={{ color: 'secondary.main', fontSize: '1rem' }} />}\r\n             <Typography variant=\"subtitle1\" component=\"div\" sx={{ fontWeight: 'bold', lineHeight: 1.3 }}>\r\n              {item.productName || item.deliveryName || 'Unnamed Item'}\r\n            </Typography>\r\n          </Box>\r\n          <IconButton size=\"small\" onClick={(e) => { e.stopPropagation(); onActionClick(e, item); }} sx={{ position: 'absolute', top: 4, right: 4 }}>\r\n            <MoreVertIcon />\r\n          </IconButton>\r\n        </Box>\r\n        <Chip label={item.currentStatus} size=\"small\" color={statusProps.color} variant={statusProps.variant} sx={{ mr: 1, mt: 0.5, mb: 0.5 }}/>\r\n        <Typography variant=\"body2\" color=\"text.secondary\" display=\"inline\">\r\n          Qty: {item.quantity ?? 'N/A'} | Seller: {item.seller || 'N/A'}\r\n        </Typography>\r\n        <Typography variant=\"body2\" color=\"text.secondary\" display=\"block\" sx={{ fontSize: '0.8rem' }}>\r\n          Order Date: {item.orderDate ? new Date(item.orderDate).toLocaleDateString() : 'N/A'}\r\n        </Typography>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\n// --- StockItemList Component ---\r\ninterface StockItemListProps {\r\n  items: StockItem[];\r\n  loading: boolean;\r\n  isMobile: boolean;\r\n  visibleColumns: ColumnConfig[];\r\n  visibleColumnIds: Array<ColumnConfig['id']>;\r\n  onColumnOrderChange: (newColumnIds: Array<ColumnConfig['id']>) => void;\r\n  onViewDetails: (itemId: string) => void;\r\n  onMenuOpen: (event: React.MouseEvent<HTMLElement>, item: StockItem) => void;\r\n}\r\n\r\nconst StockItemList: React.FC<StockItemListProps> = ({\r\n  items,\r\n  loading,\r\n  isMobile,\r\n  visibleColumns,\r\n  visibleColumnIds,\r\n  onColumnOrderChange,\r\n  onViewDetails,\r\n  onMenuOpen\r\n}) => {\r\n  const sensors = useSensors(\r\n    useSensor(PointerSensor),\r\n    useSensor(KeyboardSensor, {\r\n      coordinateGetter: sortableKeyboardCoordinates,\r\n    })\r\n  );\r\n\r\n  const handleDragEnd = (event: DragEndEvent) => {\r\n    const { active, over } = event;\r\n    if (over && active.id !== over.id) {\r\n      const oldIndex = visibleColumnIds.indexOf(active.id as (keyof StockItem | 'actions'));\r\n      const newIndex = visibleColumnIds.indexOf(over.id as (keyof StockItem | 'actions'));\r\n      if (oldIndex === -1 || newIndex === -1) {\r\n        console.error('Dragged item ID not found in visible columns', { activeId: active.id, overId: over.id });\r\n        return;\r\n      }\r\n      const newOrder = arrayMove(visibleColumnIds, oldIndex, newIndex);\r\n      onColumnOrderChange(newOrder);\r\n    }\r\n  };\r\n\r\n  const theme = useTheme();\r\n\r\n  // --- Render Logic ---\r\n  if (loading) {\r\n    return <Typography>Loading items...</Typography>; // Add Skeleton later\r\n  }\r\n\r\n  // Mobile View\r\n  if (isMobile) {\r\n    return (\r\n      <Box sx={{ pt: 1 }}> {/* Add padding top */} \r\n        {items.map((item) => (\r\n            <MobileItemCard\r\n              key={item.id}\r\n              item={item}\r\n              onViewDetails={onViewDetails}\r\n              onActionClick={onMenuOpen}\r\n              theme={theme}\r\n            />\r\n        ))}\r\n        {items.length === 0 && !loading && (\r\n           <Typography align=\"center\" sx={{ mt: 4, color: 'text.secondary' }}>\r\n             No items match the current filters.\r\n           </Typography>\r\n         )}\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  // Desktop View (Table)\r\n  return (\r\n    <DndContext\r\n      sensors={sensors}\r\n      collisionDetection={closestCenter}\r\n      onDragEnd={handleDragEnd}\r\n      modifiers={[restrictToHorizontalAxis]}\r\n    >\r\n      <TableContainer component={Paper} elevation={1} sx={{ mt: 2 }}> {/* Add margin top */}\r\n        <Table size=\"small\">\r\n          <TableHead sx={{ bgcolor: 'grey.100' }}> {/* Apply Head Styling */}\r\n            <TableRow>\r\n              <SortableContext items={visibleColumnIds} strategy={horizontalListSortingStrategy}>\r\n                {visibleColumns.map((col) => (\r\n                  <DraggableHeader key={col.id} column={col} />\r\n                ))}\r\n              </SortableContext>\r\n            </TableRow>\r\n          </TableHead>\r\n          <TableBody>\r\n            {items.map((item) => {\r\n              const isLate = isItemLate(item); // Check if late\r\n              const statusProps = getStatusChipProps(item.currentStatus); // Get status chip props\r\n\r\n              return (\r\n                <TableRow\r\n                  key={item.id}\r\n                  hover\r\n                  onClick={() => onViewDetails(item.id)}\r\n                  sx={{\r\n                    cursor: 'pointer',\r\n                    bgcolor: 'background.paper', // Remove background logic\r\n                    '&:hover': { bgcolor: 'action.hover' }, // Standard hover\r\n                    '&:last-child td, &:last-child th': { border: 0 }, // Remove last border\r\n                    ...(isLate && { borderLeft: 3, borderColor: 'warning.main' }), // Apply late indicator\r\n                  }}\r\n                >\r\n                  {visibleColumns.map((column) => {\r\n                    const cellValue = item[column.id as keyof StockItem] ?? '';\r\n                    const isNumeric = ['quantity', 'pricePerItem'].includes(column.id);\r\n\r\n                    return (\r\n                      <TableCell\r\n                        key={column.id}\r\n                        align={isNumeric ? 'right' : 'left'}\r\n                        padding={column.id === 'actions' ? 'checkbox' : 'normal'}\r\n                        sx={{\r\n                          whiteSpace: 'nowrap',\r\n                          overflow: 'hidden',\r\n                          textOverflow: 'ellipsis',\r\n                        }}\r\n                      >\r\n                        {column.id === 'actions' ? (\r\n                          <IconButton size=\"small\" onClick={(e) => { e.stopPropagation(); onMenuOpen(e, item); }} color=\"inherit\">\r\n                            <MoreVertIcon fontSize=\"small\" />\r\n                          </IconButton>\r\n                        ) : column.id === 'currentStatus' ? (\r\n                          <Chip label={item.currentStatus} size=\"small\" color={statusProps.color} variant={statusProps.variant} />\r\n                        ) : column.id === 'isFlagged' ? (\r\n                          item.isFlagged ? <FlagIcon sx={{ fontSize: '1rem', color: 'secondary.main', display:'block', margin:'auto' }} /> : null\r\n                        ) : column.id === 'orderDate' || column.id === 'dateDelivered' ? (\r\n                          cellValue ? new Date(cellValue as string).toLocaleDateString() : ''\r\n                        ) : (\r\n                          ['deliveryName', 'productName'].includes(column.id) ? (\r\n                            <Box component=\"span\" sx={{ display: 'flex', alignItems: 'center', gap: 0.5 }}>\r\n                              {item.isFlagged && <FlagIcon sx={{ color: 'secondary.main', fontSize: '1rem' }} />}\r\n                              {cellValue}\r\n                            </Box>\r\n                          ) : (\r\n                            cellValue\r\n                          )\r\n                        )}\r\n                      </TableCell>\r\n                    );\r\n                  })}\r\n                </TableRow>\r\n              );\r\n            })}\r\n          </TableBody>\r\n        </Table>\r\n        {items.length === 0 && !loading && (\r\n          <Typography align=\"center\" sx={{ p: 4, color: 'text.secondary' }}>\r\n             No items match the current filters.\r\n           </Typography>\r\n         )}\r\n      </TableContainer>\r\n    </DndContext>\r\n  );\r\n};\r\n\r\nexport default StockItemList; "],"names":["useStockItems","orgId","nonArchivedItems","setNonArchivedItems","useState","mainLoading","setMainLoading","mainError","setMainError","archivedItems","setArchivedItems","archivedLoading","setArchivedLoading","archivedError","setArchivedError","searchTerm","setSearchTerm","currentFilter","setCurrentFilter","showFlaggedOnly","setShowFlaggedOnly","loading","error","useEffect","console","log","db_instance","db","org_id","warn","q","query","collection","where","orderBy","unsubscribe","onSnapshot","snapshot","items","docs","map","docSnap","data","id","err","message","qArchived","unsubscribeArchived","filteredItems","useMemo","filter","item","_item$deliveryName","_item$productName","_item$seller","_item$asinSku","lowerSearchTerm","toLowerCase","matchesSearch","deliveryName","includes","productName","seller","asinSku","matchesFilter","itemToCheck","currentStatus","orderDate","Date","sevenDaysAgo","setDate","getDate","e","checkItemLate","matchesFlag","isFlagged","allItems","setError","useSnackbar","open","setOpen","setMessage","severity","setSeverity","snackbar","showSnackbar","useCallback","msg","sev","arguments","length","undefined","closeSnackbar","_ref","isOpen","onSubmit","onClose","note","setNote","_jsxs","Dialog","maxWidth","fullWidth","children","DialogTitle","_jsx","Typography","variant","color","sx","fontStyle","DialogContent","dividers","issueDescription","Box","theme","mb","p","backgroundColor","palette","action","selected","grey","border","divider","borderRadius","gutterBottom","component","noWrap","TextField","autoFocus","label","type","multiline","rows","size","value","onChange","target","helperText","placeholder","DialogActions","padding","Button","onClick","handleSubmit","trim","ActionMenu","itemId","actions","onActionSelected","anchorEl","Menu","MenuListProps","dense","PaperProps","minWidth","index","MenuItem","handleActionClick","icon","ListItemIcon","mr","alignItems","React","fontSize","ListItemText","primaryTypographyProps","RESOLUTION_OUTCOMES","outcome","setOutcome","FormControl","InputLabel","Select","labelId","disabled","opt","FormHelperText","onSave","initialData","firstInputRef","isEditing","purchaseStatus","setPurchaseStatus","setDeliveryName","setProductName","quantity","setQuantity","pricePerItem","setPricePerItem","orderNumber","setOrderNumber","setOrderDate","toISOString","split","setSeller","isVatRegistered","setIsVatRegistered","destination","setDestination","setAsinSku","acquisitionNotes","setAcquisitionNotes","setIsFlagged","errors","setErrors","event","preventDefault","isValid","validateForm","newErrors","Object","keys","Number","noValidate","display","flexDirection","height","justifyContent","IconButton","CloseIcon","flexGrow","overflowY","pr","inputRef","required","name","InputProps","inputProps","min","InputLabelProps","shrink","select","SelectProps","FormControlLabel","control","Checkbox","checked","mt","pt","borderTop","borderColor","gap","onAddItem","onOpenSettings","onOpenActivity","onSearchTermChange","onShowFlaggedOnlyChange","onCurrentFilterChange","AppBar","position","elevation","borderBottom","Toolbar","disableGutters","flexWrap","startIcon","AddIcon","Tooltip","title","SettingsIcon","HistoryIcon","startAdornment","InputAdornment","SearchIcon","xs","md","isSelected","Chip","clickable","fontWeight","handleFlaggedChipClick","ALL_COLUMNS","DEFAULT_VISIBLE_COLUMN_IDS","LOCAL_STORAGE_KEY_VISIBLE_COLUMNS","editAction","description","EditIcon","flagAction","FlagIcon","unflagAction","DoDisturbIcon","archiveAction","ArchiveIcon","unarchiveAction","UnarchiveIcon","reportIssueAction","ReportProblemIcon","addNoteAction","NoteAddIcon","markDeliveredAction","CheckCircleIcon","resolveIssueAction","addIssueUpdateAction","UpdateIcon","viewDetailsAction","VisibilityIcon","getAvailableActions","status","push","flagToggleAction","splice","formatValue","prefix","suffix","text","formatActivityEvent","_event$details$change","time","timestamp","toLocaleString","details","changedFields","join","previousStatus","newStatus","resolutionOutcome","mapLogToAction","_log$details","_log$before","_log$before2","_log$after","_log$details2","_log$details3","_log$details4","_log$details5","_log$details6","_log$details7","Timestamp","toDate","userId","before","after","key","JSON","stringify","activityEvents","setActivityEvents","loadingLogs","setLoadingLogs","logError","setLogError","availableActions","useTheme","getFirestore","entityPath","logsRef","mappedEvents","doc","pb","Stack","direction","spacing","IconComponent","toLocaleDateString","dateDelivered","processorNotes","CircularProgress","Alert","List","disablePadding","ListItem","py","primary","secondary","secondaryTypographyProps","Divider","user","org","permissions","logAction","logActionExists","auth","items_length","allItems_length","selectedItemDetailsDrawerData","setSelectedItemDetailsDrawerData","isAddItemDrawerOpen","setIsAddItemDrawerOpen","editingItem","setEditingItem","reportingIssueItem","setReportingIssueItem","addingUpdateItem","setAddingUpdateItem","resolvingIssueItem","setResolvingIssueItem","isSettingsModalOpen","setIsSettingsModalOpen","itemForNote","setItemForNote","isUserActivityViewOpen","setIsUserActivityViewOpen","visibleColumnIds","setVisibleColumnIds","stored","localStorage","getItem","parsed","parse","Array","isArray","openMenuId","setOpenMenuId","menuAnchorEl","setMenuAnchorEl","setItem","visibleColumns","find","col","handleSnackbarClose","reason","updateItemAndLog","async","changes","successMessage","itemRef","itemBefore","i","finalUpdates","removeUndefinedFields","lastUpdated","serverTimestamp","itemAfter","updateDoc","actionName","_event$details","_event$details$newSta","nameError","logData","toolKey","handleItemAction","newFlagState","uid","createActivityEvent","prevStatus","restoredStatus","handleViewDetails","isMobile","useMediaQuery","breakpoints","down","ControlSurface","LinearProgress","top","left","right","StockItemList","onColumnOrderChange","newOrder","onViewDetails","onMenuOpen","handleMenuOpen","currentTarget","Drawer","anchor","width","sm","AddItemForm","newItemOrUpdate","dataToSave","collectionRef","completeNewItemData","activityLog","docRef","addDoc","ItemDetailDrawer","ReportIssueModal","issueDescValue","handleSaveReportIssue","AddUpdateModal","handleSaveIssueUpdate","ResolveIssueModal","resolutionNoteValue","handleSaveResolveIssue","handleSaveNote","TableSettingsModal","allColumns","c","initialVisibleColumns","UserActivityView","renderActionMenu","Boolean","Snackbar","autoHideDuration","anchorOrigin","vertical","horizontal","SnackbarAlert","setDescription","obj","fromEntries","entries","_","v","isItemLate","isNaN","getTime","props","ref","MuiAlert","logs","setLogs","setLoading","members","setMembers","membersRef","getDocs","then","forEach","email","catch","limit","relevantLogs","d","tool","ts","userEmail","renderLogEntryContent","_log$before4","_log$before5","_log$before6","actionDesc","_log$details2$changed","fields","k","f","_log$after2","simple","_log$before3","_log$details8","_log$details9","_log$details10","startsWith","replace","getActionDescription","parts","entityId","qty","entityLabel","Fragment","ml","scroll","minHeight","textAlign","bgcolor","checkedState","setCheckedState","visibleIds","Set","updatedCheckedState","has","maxHeight","FormGroup","handleCheckboxChange","columnId","prevState","handleSaveChanges","newVisibleColumnIds","getStatusChipProps","DraggableHeader","column","attributes","listeners","setNodeRef","transform","transition","isDragging","useSortable","style","CSS","Transform","toString","opacity","cursor","touchAction","isNumeric","TableCell","align","whiteSpace","MobileItemCard","_ref2","_item$quantity","onActionClick","statusProps","Card","CardContent","lineHeight","stopPropagation","MoreVertIcon","_ref3","sensors","useSensors","useSensor","PointerSensor","KeyboardSensor","coordinateGetter","sortableKeyboardCoordinates","DndContext","collisionDetection","closestCenter","onDragEnd","active","over","oldIndex","indexOf","newIndex","activeId","overId","arrayMove","modifiers","restrictToHorizontalAxis","TableContainer","Paper","Table","TableHead","TableRow","SortableContext","strategy","horizontalListSortingStrategy","TableBody","isLate","hover","borderLeft","_item","cellValue","overflow","textOverflow","margin"],"sourceRoot":""}