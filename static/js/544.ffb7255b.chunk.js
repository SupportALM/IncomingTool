"use strict";(self.webpackChunkincoming_tool=self.webpackChunkincoming_tool||[]).push([[544],{1453:(e,t,i)=>{i.d(t,{A:()=>h});var n=i(8613),s=i.n(n),r=i(8517),l=i(1911),o=i(4199),a=i(7775),d=i(5895),c=i(2967),u=i(2571),p=i(8263),x=i(5557),m=i(579);const h=e=>{let{item:t,onSubmit:i,onClose:h,open:g}=e;const[v,b]=(0,n.useState)(""),[f,A]=(0,n.useState)("");s().useEffect((()=>{g||(b(""),A(""))}),[g]);return t&&g?(0,m.jsxs)(r.A,{open:g,onClose:h,maxWidth:"sm",fullWidth:!0,children:[(0,m.jsx)(l.A,{children:"Add Issue Update"}),(0,m.jsxs)(o.A,{children:[(0,m.jsxs)(a.A,{sx:{mb:2},children:["For item: ",(0,m.jsxs)(d.A,{component:"span",sx:{fontStyle:"italic",fontWeight:"medium"},children:[t.productName," - ",t.deliveryName]})]}),t.issueDescription&&(0,m.jsxs)(c.A,{sx:{mb:2,p:1.5,background:e=>e.palette.grey[100],border:e=>`1px solid ${e.palette.grey[300]}`,borderRadius:1},children:[(0,m.jsx)(d.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:"Initial Issue:"}),(0,m.jsx)(d.A,{variant:"body2",children:t.issueDescription})]}),(0,m.jsx)(u.A,{autoFocus:!0,required:!0,margin:"dense",id:"updateNote",label:"Update Note",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:v,onChange:e=>{b(e.target.value),f&&A("")},error:!!f,helperText:f,placeholder:"e.g., Contacted seller, awaiting response..."})]}),(0,m.jsxs)(p.A,{sx:{px:3,pb:2},children:[(0,m.jsx)(x.A,{onClick:h,color:"secondary",children:"Cancel"}),(0,m.jsx)(x.A,{onClick:()=>{v.trim()?i(v):A("Please enter an update note.")},variant:"contained",color:"primary",children:"Save Update Note"})]})]}):null}},2630:(e,t,i)=>{i.d(t,{A:()=>j});var n=i(8613),s=i.n(n),r=i(8517),l=i(1911),o=i(4199),a=i(7775),d=i(5895),c=i(2967),u=i(3863),p=i(5809),x=i(4553),m=i(8889),h=i(468),g=i(2571),v=i(8263),b=i(5557),f=i(579);const A=["Item Accepted / Kept As Is","Item Repaired / Refurbished","Partial Refund Received","Returned to Supplier","Disposed Of","Other"],j=e=>{let{item:t,onSubmit:i,onClose:j,open:y}=e;const[S,I]=(0,n.useState)(""),[C,k]=(0,n.useState)(""),[D,w]=(0,n.useState)("");s().useEffect((()=>{y||(I(""),k(""),w(""))}),[y]);return y&&t?(0,f.jsxs)(r.A,{open:y,onClose:j,maxWidth:"sm",fullWidth:!0,children:[(0,f.jsxs)(l.A,{children:["Resolve Issue for: ",t.productName," - ",t.deliveryName]}),(0,f.jsxs)(o.A,{children:[(0,f.jsxs)(a.A,{sx:{mb:2},children:["For item: ",(0,f.jsxs)(d.A,{component:"span",sx:{fontStyle:"italic",fontWeight:"medium"},children:[t.productName," - ",t.deliveryName]})]}),t.issueDescription&&(0,f.jsxs)(c.A,{sx:{mb:2,p:1.5,background:e=>e.palette.grey[100],border:e=>`1px solid ${e.palette.grey[300]}`,borderRadius:1},children:[(0,f.jsx)(d.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:"Initial Issue:"}),(0,f.jsx)(d.A,{variant:"body2",children:t.issueDescription})]}),(0,f.jsxs)(u.A,{fullWidth:!0,margin:"normal",required:!0,error:!!D,children:[(0,f.jsx)(p.A,{id:"resolution-outcome-label",children:"Resolution Outcome"}),(0,f.jsxs)(x.A,{labelId:"resolution-outcome-label",id:"resolutionOutcome",value:S,label:"Resolution Outcome",onChange:e=>{I(e.target.value),D&&w("")},children:[(0,f.jsx)(m.A,{value:"",disabled:!0,children:(0,f.jsx)("em",{children:"-- Select an Outcome --"})}),A.map((e=>(0,f.jsx)(m.A,{value:e,children:e},e)))]}),D&&(0,f.jsx)(h.A,{children:D})]}),(0,f.jsx)(g.A,{margin:"normal",id:"resolutionNotes",label:"Resolution Notes (Optional)",type:"text",fullWidth:!0,multiline:!0,rows:3,variant:"outlined",value:C,onChange:e=>k(e.target.value),placeholder:"e.g., Supplier issued refund, repaired screen..."})]}),(0,f.jsxs)(v.A,{sx:{px:3,pb:2},children:[(0,f.jsx)(b.A,{onClick:j,color:"secondary",children:"Cancel"}),(0,f.jsx)(b.A,{onClick:()=>{S?i(S,C.trim()||void 0):w("Please select a resolution outcome.")},variant:"contained",color:"primary",children:"Save Resolution"})]})]}):null}},3368:(e,t,i)=>{i.d(t,{A:()=>j});var n=i(8613),s=i(3287),r=i(6647),l=i(8517),o=i(1911),a=i(4199),d=i(2967),c=i(2571),u=i(3863),p=i(5809),x=i(4553),m=i(8889),h=i(468),g=i(8263),v=i(5557),b=i(7347),f=i(579);const A=e=>{let{text:t}=e;return(0,f.jsx)(s.A,{title:t,arrow:!0,children:(0,f.jsx)(r.A,{size:"small",sx:{ml:.5,verticalAlign:"middle"},children:(0,f.jsx)(b.A,{fontSize:"inherit"})})})},j=e=>{let{open:t,onClose:i,onSubmit:s,itemToEdit:r,user:b,orgId:j}=e;const y=!!r,S=(0,n.useRef)(null),I=(0,n.useCallback)((()=>({purchaseStatus:(null===r||void 0===r?void 0:r.purchaseStatus)||"Purchased",deliveryName:(null===r||void 0===r?void 0:r.deliveryName)||"",productName:(null===r||void 0===r?void 0:r.productName)||"",quantity:(null===r||void 0===r?void 0:r.quantity)||"",purchasePrice:(null===r||void 0===r?void 0:r.pricePerItem)||"",salesPrice:(null===r||void 0===r?void 0:r.salesPrice)||"",orderNumber:(null===r||void 0===r?void 0:r.orderNumber)||"",orderDate:(null===r||void 0===r?void 0:r.orderDate)||(new Date).toISOString().split("T")[0],supplier:(null===r||void 0===r?void 0:r.seller)||"",isVatRegistered:(null===r||void 0===r?void 0:r.isVatRegistered)||"Unknown",destination:(null===r||void 0===r?void 0:r.destination)||"",asinSku:(null===r||void 0===r?void 0:r.asinSku)||"",acquisitionNotes:(null===r||void 0===r?void 0:r.acquisitionNotes)||"",isFlagged:(null===r||void 0===r?void 0:r.isFlagged)||!1})),[r]),[C,k]=(0,n.useState)(I()),[D,w]=(0,n.useState)({});(0,n.useEffect)((()=>{t&&(k(I()),w({}),setTimeout((()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.focus()}),100))}),[r,t,I]);const N=e=>{const t=e.target,i=t.name;let n=t.value;"isFlagged"===i?n="true"===t.value:t instanceof HTMLInputElement&&"checkbox"===t.type&&(n=t.checked),k((e=>({...e,[i]:n}))),D[i]&&w((e=>{const t={...e};return delete t[i],t}))},E=e=>{if(e.preventDefault(),(()=>{const e={};return C.deliveryName.trim()||(e.deliveryName="Delivery Name is required."),C.productName.trim()||(e.productName="Product Name is required."),(""===C.quantity||Number(C.quantity)<=0)&&(e.quantity="Quantity must be a positive number."),(""===C.purchasePrice||Number(C.purchasePrice)<0)&&(e.purchasePrice="Purchase Price must be zero or positive."),""!==C.salesPrice&&Number(C.salesPrice)<0&&(e.salesPrice="Sales Price cannot be negative."),C.orderDate||(e.orderDate="Order Date is required."),C.supplier.trim()||(e.supplier="Supplier is required."),w(e),0===Object.keys(e).length})()){const e={...C,quantity:Number(C.quantity),pricePerItem:Number(C.purchasePrice),salesPrice:""===C.salesPrice?null:Number(C.salesPrice),seller:C.supplier};delete e.purchasePrice,delete e.supplier,s(e),i()}};return(0,f.jsxs)(l.A,{open:t,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,f.jsx)(o.A,{children:y?"Edit Stock Item":"Add New Stock Item"}),(0,f.jsx)(a.A,{children:(0,f.jsx)(d.A,{component:"form",onSubmit:E,noValidate:!0,sx:{mt:1},children:(0,f.jsxs)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:1},children:[(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,f.jsx)(c.A,{inputRef:S,autoFocus:!0,margin:"dense",name:"deliveryName",label:"Delivery Name",type:"text",fullWidth:!0,value:C.deliveryName,onChange:N,error:!!D.deliveryName,helperText:D.deliveryName||"Group items arriving together (e.g., eBay Batch Apr 16)",InputProps:{endAdornment:(0,f.jsx)(A,{text:"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16"})},required:!0})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",name:"productName",label:"Product Name",type:"text",fullWidth:!0,value:C.productName,onChange:N,error:!!D.productName,helperText:D.productName||"The common name of the item (e.g., Blue Widget Model X)",InputProps:{endAdornment:(0,f.jsx)(A,{text:"The common name of the item. Example: Blue Widget Model X"})},required:!0})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"calc(50% - 8px)",sm:"calc(25% - 12px)"},flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",name:"quantity",label:"Quantity",type:"number",fullWidth:!0,value:C.quantity,onChange:N,error:!!D.quantity,helperText:D.quantity||"How many units?",InputProps:{inputProps:{min:1},endAdornment:(0,f.jsx)(A,{text:"How many units of this item are included? Example: 50"})},required:!0})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"calc(50% - 8px)",sm:"calc(25% - 12px)"},flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",name:"purchasePrice",label:"Purchase Price",type:"number",fullWidth:!0,value:C.purchasePrice,onChange:N,error:!!D.purchasePrice,helperText:D.purchasePrice||"Cost per single unit (excl. VAT)",InputProps:{inputProps:{min:0,step:"0.01"},endAdornment:(0,f.jsx)(A,{text:"The cost for one single unit, excluding VAT. Example: 10.42"})},required:!0})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"calc(50% - 8px)",sm:"calc(25% - 12px)"},flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",name:"salesPrice",label:"Sales Price (Optional)",type:"number",fullWidth:!0,value:C.salesPrice,onChange:N,error:!!D.salesPrice,helperText:D.salesPrice||"Optional: The target selling price for one single unit, including VAT. Example: 19.99",InputProps:{inputProps:{min:0,step:"0.01"},endAdornment:(0,f.jsx)(A,{text:"Optional: The target selling price for one single unit, including VAT. Example: 19.99"})}})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",label:"Order Number (Optional)",name:"orderNumber",value:C.orderNumber,onChange:N,fullWidth:!0,error:!!D.orderNumber,helperText:D.orderNumber})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",name:"orderDate",label:"Order Date",type:"date",fullWidth:!0,value:C.orderDate,onChange:N,error:!!D.orderDate,helperText:D.orderDate||"The date the order was placed.",InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,f.jsx)(A,{text:"The date the item was purchased or the return initiated."})},required:!0})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"calc(50% - 8px)",sm:"calc(25% - 12px)"},flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",label:"Supplier",name:"supplier",value:C.supplier,onChange:N,fullWidth:!0,error:!!D.supplier,helperText:D.supplier||"Who did you buy this from? (e.g., eBay Seller name, Amazon)",InputProps:{endAdornment:(0,f.jsx)(A,{text:"The name of the seller or store you purchased from. Example: JohnDoe123 (eBay)"})},required:!0})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",label:"ASIN/SKU (Optional)",name:"asinSku",value:C.asinSku,onChange:N,fullWidth:!0,error:!!D.asinSku,helperText:D.asinSku||"Optional: Amazon ASIN or your internal SKU",InputProps:{endAdornment:(0,f.jsx)(A,{text:"Optional: Amazon Standard Identification Number (ASIN) or your internal Stock Keeping Unit (SKU). Example: B076MX3KCY"})}})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,f.jsxs)(u.A,{fullWidth:!0,margin:"dense",error:!!D.destination,children:[(0,f.jsx)(p.A,{id:"destination-label",children:"Destination (Optional)"}),(0,f.jsxs)(x.A,{labelId:"destination-label",label:"Destination (Optional)",name:"destination",value:C.destination,onChange:N,children:[(0,f.jsx)(m.A,{value:"",children:"Select Destination"}),(0,f.jsx)(m.A,{value:"Warehouse A",children:"Warehouse A"}),(0,f.jsx)(m.A,{value:"Warehouse B",children:"Warehouse B"}),(0,f.jsx)(m.A,{value:"Prep Center",children:"Prep Center"})]}),D.destination&&(0,f.jsx)(h.A,{children:D.destination})]})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,f.jsxs)(u.A,{fullWidth:!0,margin:"dense",error:!!D.isVatRegistered,children:[(0,f.jsx)(p.A,{id:"vat-registered-label",children:"VAT Registered? (Optional)"}),(0,f.jsxs)(x.A,{labelId:"vat-registered-label",label:"VAT Registered? (Optional)",name:"isVatRegistered",value:C.isVatRegistered,onChange:N,children:[(0,f.jsx)(m.A,{value:"Unknown",children:"Unknown"}),(0,f.jsx)(m.A,{value:"Yes",children:"Yes"}),(0,f.jsx)(m.A,{value:"No",children:"No"})]}),D.isVatRegistered&&(0,f.jsx)(h.A,{children:D.isVatRegistered})]})}),(0,f.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,f.jsxs)(u.A,{fullWidth:!0,margin:"dense",error:!!D.isFlagged,children:[(0,f.jsx)(p.A,{id:"is-flagged-label",children:"Flag Item?"}),(0,f.jsxs)(x.A,{labelId:"is-flagged-label",label:"Flag Item?",name:"isFlagged",value:C.isFlagged?"true":"false",onChange:N,children:[(0,f.jsx)(m.A,{value:"false",children:"No"}),(0,f.jsx)(m.A,{value:"true",children:"Yes"})]}),D.isFlagged&&(0,f.jsx)(h.A,{children:D.isFlagged})]})}),(0,f.jsx)(d.A,{sx:{flexBasis:"100%",flexGrow:1},children:(0,f.jsx)(c.A,{margin:"dense",label:"Acquisition Notes (Optional)",name:"acquisitionNotes",value:C.acquisitionNotes,onChange:N,fullWidth:!0,multiline:!0,rows:3,error:!!D.acquisitionNotes,helperText:D.acquisitionNotes||"Optional: Any other details about purchase/item condition",InputProps:{endAdornment:(0,f.jsx)(A,{text:"Optional notes about the purchase, condition, or source. Example: Slight box damage, bought in auction."})}})})]})})}),(0,f.jsxs)(g.A,{children:[(0,f.jsx)(v.A,{onClick:i,color:"secondary",children:"Cancel"}),(0,f.jsx)(v.A,{type:"submit",onClick:E,variant:"contained",color:"primary",children:y?"Update Item":"Add Item"})]})]})}},3691:(e,t,i)=>{i.d(t,{A:()=>I});var n=i(8613),s=i(9550),r=i(5929),l=i(5895),o=i(8517),a=i(1911),d=i(6647),c=i(4199),u=i(2967),p=i(4527),x=i(549),m=i(4225),h=i(2959),g=i(6185),v=i(8263),b=i(5557),f=i(7421),A=i(579);const j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e||null===e||""===e?(0,A.jsx)(l.A,{component:"span",sx:{color:"text.secondary",fontStyle:"italic"},children:"N/A"}):"boolean"===typeof e?e?"Yes":"No":`${t}${e}${i}`},y=e=>{var t;const i=new Date(e.timestamp).toLocaleString();switch(e.type){case"CREATED":return`${i}: Item Created`;case"EDITED":return`${i}: Item Edited (${(null===(t=e.details.changedFields)||void 0===t?void 0:t.join(", "))||"details"} changed)`;case"STATUS_CHANGED":return`${i}: Status changed from ${e.details.previousStatus||"?"} to ${e.details.newStatus||"?"}`;case"FLAG_TOGGLED":return`${i}: Item ${e.details.isFlagged?"Flagged":"Unflagged"}`;case"ISSUE_REPORTED":return`${i}: Issue Reported: ${e.details.issueDescription||""}`;case"ISSUE_UPDATE_ADDED":return`${i}: Issue Update Added: ${e.details.note||""}`;case"ISSUE_RESOLVED":return`${i}: Issue Resolved (Outcome: ${e.details.resolutionOutcome||"N/A"}${e.details.note?` - Note: ${e.details.note}`:""}`;case"NOTE_ADDED":return`${i}: Note Added: ${e.details.note||""}`;default:return`${i}: Unknown action`}},S=e=>{var t,i,n,r,l,o,a,d,c,u;const p=e.timestamp instanceof s.Dc?e.timestamp.toDate().toISOString():"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),x=e.userId||"system";let m=null,h={};switch(e.action){case"item.create":m="CREATED";break;case"item.update.fields":m="EDITED";h={changedFields:e.before&&e.after?Object.keys(e.after).filter((t=>e.before&&e.after&&JSON.stringify(e.before[t])!==JSON.stringify(e.after[t]))):(null===(t=e.details)||void 0===t?void 0:t.changedFields)||["details"]};break;case"item.update.status.Delivered":m="STATUS_CHANGED",h={previousStatus:null===(i=e.before)||void 0===i?void 0:i.currentStatus,newStatus:"Delivered"};break;case"item.update.status.Archived":m="STATUS_CHANGED",h={previousStatus:null===(n=e.before)||void 0===n?void 0:n.currentStatus,newStatus:"Archived"};break;case"item.update.flag":m="FLAG_TOGGLED",h={isFlagged:null===(r=e.after)||void 0===r?void 0:r.isFlagged};break;case"item.update.issue.report":m="ISSUE_REPORTED",h={issueDescription:(null===(l=e.details)||void 0===l?void 0:l.description)||(null===(o=e.details)||void 0===o?void 0:o.issueDescription)};break;case"item.update.issue.resolve":m="ISSUE_RESOLVED",h={resolutionOutcome:null===(a=e.details)||void 0===a?void 0:a.outcome,note:null===(d=e.details)||void 0===d?void 0:d.note};break;case"item.update.issue.update":m="ISSUE_UPDATE_ADDED",h={note:null===(c=e.details)||void 0===c?void 0:c.note};break;case"item.add_note":m="NOTE_ADDED",h={note:null===(u=e.details)||void 0===u?void 0:u.note};break;default:return console.warn(`Unhandled log action type for UI mapping: ${e.action}`),null}return m?{timestamp:p,userId:x,type:m,details:h}:null},I=e=>{let{item:t,orgId:i,onClose:I,onActionSelected:C,open:k}=e;const[D,w]=(0,n.useState)([]),[N,E]=(0,n.useState)(!0),[P,W]=(0,n.useState)(null);if((0,n.useEffect)((()=>{if(null===t||void 0===t||!t.id||!i)return E(!1),void W("Missing item or organization ID for fetching logs.");w([]),E(!0),W(null);const e=(0,s.aU)(),n=`stockItems/${t.id}`,r=(0,s.rJ)(e,`orgs/${i}/logs`),l=(0,s.P)(r,(0,s._M)("entityPath","==",n),(0,s.My)("timestamp","desc")),o=(0,s.aQ)(l,(e=>{const t=e.docs.map((e=>({...e.data()}))).map(S).filter((e=>null!==e));w(t),E(!1)}),(e=>{console.error("Error fetching logs: ",e),W(`Failed to fetch activity log: ${e.message}`),E(!1)}));return()=>o()}),[null===t||void 0===t?void 0:t.id,i]),!k||!t)return null;const O=(0,r.getAvailableActions)(t.currentStatus,t.isFlagged);return(0,A.jsxs)(o.A,{open:k,onClose:I,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[" ",(0,A.jsxs)(a.A,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,A.jsxs)(l.A,{variant:"h6",children:["Item Details: ",t.productName]}),(0,A.jsx)(d.A,{"aria-label":"close",onClick:I,sx:{color:e=>e.palette.grey[500]},children:(0,A.jsx)(f.A,{})})]}),(0,A.jsxs)(c.A,{dividers:!0,sx:{pt:2},children:[" ",(0,A.jsxs)(u.A,{sx:{mb:2},children:[(0,A.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"Key Information"}),(0,A.jsxs)(u.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:1},children:[(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Delivery Name:"})," ",j(t.deliveryName)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Product Name:"})," ",j(t.productName)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Status:"})," ",j(t.currentStatus)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Quantity:"})," ",j(t.quantity)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Price/Item:"})," ",j(t.pricePerItem,"$")]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Order Date:"})," ",j(t.orderDate?new Date(t.orderDate).toLocaleDateString():null)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Seller:"})," ",j(t.seller)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Order #:"})," ",j(t.orderNumber)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Destination:"})," ",j(t.destination)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Flagged:"})," ",j(t.isFlagged)]})]})]}),(t.issueDescription||t.acquisitionNotes)&&(0,A.jsxs)(u.A,{sx:{mb:2},children:[(0,A.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"Notes & Issues"}),t.issueDescription&&(0,A.jsxs)(u.A,{sx:{mb:1,p:1,background:e=>e.palette.warning.light,border:e=>`1px solid ${e.palette.warning.light}`,borderRadius:1},children:[(0,A.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold"},children:"Issue:"}),(0,A.jsx)(l.A,{variant:"body2",children:t.issueDescription})]}),t.acquisitionNotes&&(0,A.jsxs)(u.A,{sx:{mb:1},children:[(0,A.jsx)(l.A,{variant:"body2",sx:{fontWeight:"bold"},children:"Acquisition Notes:"}),(0,A.jsx)(l.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:t.acquisitionNotes})]})]}),(0,A.jsx)(p.A,{sx:{my:2}}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"Activity History"}),N?(0,A.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",my:2},children:(0,A.jsx)(x.A,{size:24})}):P?(0,A.jsxs)(l.A,{color:"error",variant:"body2",children:["Error loading history: ",P]}):0===D.length?(0,A.jsx)(l.A,{variant:"body2",sx:{color:"text.secondary"},children:"No activity history found for this item."}):(0,A.jsx)(m.A,{dense:!0,disablePadding:!0,children:D.map(((e,t)=>(0,A.jsx)(h.Ay,{disableGutters:!0,sx:{borderBottom:"1px dashed #eee",pb:.5,mb:.5},children:(0,A.jsx)(g.A,{primary:y(e),primaryTypographyProps:{variant:"body2"}})},t)))})]})]}),(0,A.jsxs)(v.A,{sx:{p:2,borderTop:e=>`1px solid ${e.palette.divider}`},children:[O.map((e=>(0,A.jsx)(b.A,{variant:"Edit Item"===e||"Resolve Issue"===e?"contained":"outlined",size:"small",onClick:()=>C(t.id||"",e),children:e},e))),(0,A.jsx)(b.A,{onClick:I,sx:{ml:"auto"},children:"Close"})," "]})]})}},5929:(e,t,i)=>{i.r(t),i.d(t,{ActionMenu:()=>V,default:()=>J,getAvailableActions:()=>G});var n=i(9550),s=i(8613),r=i(4705),l=i(8677),o=i(2789),a=i(3368),d=i(3691),c=i(5982),u=i(1453),p=i(2630),x=i(7694),m=i(7553),h=i(2571),g=i(2967),v=i(8229),b=i(6687),f=i(5557),A=i(2523),j=i(6859),y=i(2011),S=i(4755),I=i(1399),C=i(9841),k=i(2731),D=i(9651),w=i(6647),N=i(6623),E=i(8889),P=i(5511),W=i(2950),O=i(2043),T=i(579);function R(e){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,i]=e;return void 0!==i})))}const $=e=>{let{onSearch:t,inputRef:i}=e;return(0,T.jsx)(h.A,{inputRef:i,fullWidth:!0,variant:"outlined",placeholder:"Search by Delivery Name or Product Name...",onChange:e=>t(e.target.value),sx:{mb:2}})},F=e=>{let{currentFilter:t,onFilterChange:i}=e;return(0,T.jsx)(g.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,T.jsx)(v.A,{value:t,onChange:(e,t)=>{i(t)},"aria-label":"Stock item status filter",variant:"scrollable",scrollButtons:"auto",children:["All","Pending Delivery","Delivered","Issue","Late","Archived"].map((e=>(0,T.jsx)(b.A,{label:e,value:e},e)))})})},U=e=>{let{onClick:t}=e;return(0,T.jsx)(f.A,{variant:"contained",color:"primary",startIcon:(0,T.jsx)(W.A,{}),onClick:t,sx:{mb:2},children:"Add Stock Item"})},q=e=>{if("Pending Delivery"!==e.currentStatus)return!1;const t=new Date(e.orderDate),i=new Date;return i.setDate(i.getDate()-7),t<i},B=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:(new Date).toISOString(),type:t,userId:e,details:i}},G=(e,t)=>{let i=[];switch(e){case"Pending Delivery":case"Late":i=["Mark as Delivered","Report Issue","View Details","Edit Item","Add Note"];break;case"Delivered":i=["Archive","Report Issue","View Details","Edit Item","Add Note"];break;case"Issue":i=["Resolve Issue","Add Issue Update","Archive","View Details","Edit Item","Add Note"];break;default:i=["View Details"]}return"Archived"!==e&&i.unshift(t?"Unflag Item":"Flag Item"),i},V=e=>{let{itemId:t,actions:i,onActionSelected:n,onClose:r}=e;const l=(0,s.useRef)(null);return(0,s.useEffect)((()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[r]),(0,T.jsx)("div",{ref:l,style:{position:"absolute",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",boxShadow:"0 2px 5px rgba(0,0,0,0.15)",zIndex:10,minWidth:"150px",marginTop:"2px"},children:i.map((e=>(0,T.jsx)("button",{onClick:()=>n(t,e),style:{display:"block",width:"100%",padding:"8px 12px",border:"none",background:"none",textAlign:"left",cursor:"pointer"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#f0f0f0",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",children:e},e)))})},L=[{id:"orderDate",label:"Order Date"},{id:"quantity",label:"Qty"},{id:"productName",label:"Product Name"},{id:"deliveryName",label:"Delivery Name"},{id:"pricePerItem",label:"Price/Item"},{id:"seller",label:"Seller/Source"},{id:"destination",label:"Destination"},{id:"asinSku",label:"ASIN/SKU"},{id:"purchaseStatus",label:"Purchase Status"},{id:"orderNumber",label:"Order #"},{id:"currentStatus",label:"Status"},{id:"isFlagged",label:"Flagged"},{id:"acquisitionNotes",label:"Acquisition Notes"},{id:"issueDescription",label:"Issue Description"},{id:"dateDelivered",label:"Date Delivered"},{id:"actions",label:"Actions"}],M=["orderDate","quantity","productName","deliveryName","currentStatus","actions"],_=e=>{let{col:t}=e;const{attributes:i,listeners:n,setNodeRef:s,transform:r,transition:a,isDragging:d}=(0,l.gl)({id:t.id}),c={transform:o.Ks.Translate.toString(r),transition:a,opacity:d?.8:1,zIndex:d?10:1,cursor:"move",border:"1px solid #ccc",padding:"8px",textAlign:"actions"===t.id?"center":"left",backgroundColor:d?"#e0e0e0":"#f2f2f2"};return(0,T.jsx)("th",{ref:s,style:c,...i,...n,children:t.label})},z=e=>{var t,i;let{items:n,visibleColumns:o,onActionSelected:a,onViewDetails:d,onColumnReorder:c,selectedRowIndex:u=-1}=e;const[p,x]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),g=()=>{x(null),h(null)},v=(0,r.FR)((0,r.MS)(r.AN),(0,r.MS)(r.uN,{coordinateGetter:l.JR})),b=o.map((e=>e.id));return(0,T.jsxs)(A.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,T.jsxs)(j.A,{sx:{maxHeight:"calc(100vh - 300px)"},children:[" ",(0,T.jsx)(r.Mp,{sensors:v,collisionDetection:r.fp,onDragEnd:c,children:(0,T.jsxs)(y.A,{stickyHeader:!0,"aria-label":"stock items table",children:[(0,T.jsx)(S.A,{children:(0,T.jsx)(l.gB,{items:b,strategy:l.m$,children:o.map((e=>(0,T.jsx)(_,{col:e},e.id)))})}),(0,T.jsx)(I.A,{children:0===n.length?(0,T.jsx)(C.A,{children:(0,T.jsx)(k.A,{colSpan:o.length,align:"center",children:"No items found."})}):n.map(((e,t)=>{const i="Pending Delivery"===e.currentStatus&&q(e),n=((e,t,i)=>{const n=i?{borderLeft:"3px solid red"}:{};let s={};if("Pending Delivery"===e&&t)s={backgroundColor:"#cce5ff",color:"#004085"};else switch(e){case"Pending Delivery":s={backgroundColor:"#fff3cd",color:"#856404"};break;case"Delivered":s={backgroundColor:"#d4edda",color:"#155724"};break;case"Issue":s={backgroundColor:"#f8d7da",color:"#721c24"};break;case"Archived":s={backgroundColor:"#e2e3e5",color:"#383d41"};break;default:s={}}return{...s,...n}})(e.currentStatus,i,e.isFlagged);G(e.currentStatus,e.isFlagged);return(0,T.jsx)(C.A,{hover:!0,onClick:()=>d(e.id||""),sx:{cursor:"pointer",backgroundColor:t===u?e=>(0,D.X4)(e.palette.primary.light,.1):"inherit","&:last-child td, &:last-child th":{border:0},...n},children:o.map((t=>{if("actions"===t.id)return(0,T.jsx)(k.A,{align:"right",onClick:e=>e.stopPropagation(),sx:{py:.5},children:(0,T.jsx)(w.A,{"aria-label":"actions",size:"small",onClick:t=>{return i=t,n=e.id||"",x(i.currentTarget),void h(n);var i,n},children:(0,T.jsx)(O.A,{fontSize:"small"})})},t.id);const i=e[t.id];let n=i;return"orderDate"===t.id||"deliveryDate"===t.id?n=i?new Date(i).toLocaleDateString():"N/A":"boolean"===typeof i?n=i?"Yes":"No":null!==i&&void 0!==i&&""!==i||(n="-"),(0,T.jsxs)(k.A,{sx:{py:1},children:[" ",n]},t.id)}))},e.id)}))})]})})]}),(0,T.jsx)(N.A,{anchorEl:p,open:Boolean(p),onClose:g,children:m&&G((null===(t=n.find((e=>e.id===m)))||void 0===t?void 0:t.currentStatus)||"Pending Delivery",null===(i=n.find((e=>e.id===m)))||void 0===i?void 0:i.isFlagged).map((e=>(0,T.jsx)(E.A,{onClick:()=>(e=>{m&&a(m,e),g()})(e),children:e},e)))})]})},K=e=>{let{isChecked:t,onChange:i}=e;return(0,T.jsxs)("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center"},children:[" ",(0,T.jsx)("label",{htmlFor:"flagToggle",style:{marginRight:"8px",fontWeight:"bold"},children:"Show Flagged Only:"}),(0,T.jsx)("input",{type:"checkbox",id:"flagToggle",checked:t,onChange:e=>i(e.target.checked),style:{width:"20px",height:"20px"}})]})},H=e=>{let{onClose:t}=e;return(0,T.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,T.jsxs)("div",{style:{background:"white",padding:32,borderRadius:8,minWidth:400},children:[(0,T.jsx)("h3",{children:"Keyboard Shortcuts"}),(0,T.jsxs)("ul",{style:{lineHeight:2},children:[(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"/"})," \u2014 Focus search bar"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"a"})," \u2014 Add new item"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"c"})," \u2014 Open columns/settings"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"f"})," \u2014 Toggle flagged only"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"1-6"})," \u2014 Switch filter tabs"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"?"})," \u2014 Show this help"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"Arrow Up/Down"})," \u2014 Move row selection"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"Enter/o"})," \u2014 View details for selected row"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"e"})," \u2014 Edit selected row"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"r"})," \u2014 Report issue for selected row"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"l"})," \u2014 Flag/unflag selected row"]}),(0,T.jsxs)("li",{children:[(0,T.jsx)("b",{children:"Esc"})," \u2014 Close any open modal"]})]}),(0,T.jsx)("button",{autoFocus:!0,onClick:t,style:{marginTop:16,padding:"8px 20px"},children:"Close"})]})})},J=e=>{let{user:t,org:i,permissions:o,logAction:h}=e;const[v,b]=(0,s.useState)([]),[f,A]=(0,s.useState)(!0),[j,y]=(0,s.useState)(null),[S,I]=(0,s.useState)("All"),[C,k]=(0,s.useState)(""),[D,w]=(0,s.useState)(!1),[N,E]=(0,s.useState)((()=>{const e=localStorage.getItem("visibleStockColumns");if(e)try{const t=JSON.parse(e),i=L.filter((e=>t.includes(e.id)));return i.length>0?i:M.map((e=>L.find((t=>t.id===e))))}catch(t){return console.error("Failed to parse saved columns:",t),M.map((e=>L.find((t=>t.id===e))))}return M.map((e=>L.find((t=>t.id===e))))})),W=(0,s.useRef)(null),[O,G]=(0,s.useState)(!1),[V,_]=(0,s.useState)(!1),[J,Y]=(0,s.useState)(-1),[Q,X]=(0,s.useState)(null),[Z,ee]=(0,s.useState)(!1),[te,ie]=(0,s.useState)(!1),[ne,se]=(0,s.useState)(!1),[re,le]=(0,s.useState)(!1),[oe,ae]=(0,s.useState)(!1),[de,ce]=(0,s.useState)(!1),[ue,pe]=(0,s.useState)(!1),xe=(0,n.aU)(),me=async(e,s,r)=>{if(!t||null===i||void 0===i||!i.id||!h)return console.error("User, Org ID, or logAction function is not available."),void y("Cannot perform action: Missing user or configuration.");const l=(0,n.H9)(xe,`orgs/${i.id}/stockItems`,e),o=v.find((t=>t.id===e));try{const a=R(s);await(0,n.mZ)(l,{...a,lastModified:(0,n.O5)(),lastModifiedBy:t.uid});const d={userId:t.uid,orgId:i.id,entityPath:`stockItems/${e}`,timestamp:(0,n.O5)(),...r,before:r.action.startsWith("item.update")?R(o||{}):void 0,after:r.action.startsWith("item.update")?R(a):void 0};await h(d),console.log(`Action logged: ${r.action} for item ${e}`)}catch(a){console.error("Error updating item or logging action:",a),y(`Failed to ${r.action.replace("item.","")}. Please try again.`)}};(0,s.useEffect)((()=>{}),[i]);(0,r.FR)((0,r.MS)(r.AN),(0,r.MS)(r.uN,{coordinateGetter:l.JR}));const he=(0,s.useCallback)((e=>{const{active:t,over:i}=e;t.id!==(null===i||void 0===i?void 0:i.id)&&E((e=>{const n=e.findIndex((e=>e.id===t.id)),s=e.findIndex((e=>e.id===(null===i||void 0===i?void 0:i.id)));return(0,l.be)(e,n,s)}))}),[]),ge=()=>{ie(!1),X(null)},ve=()=>{se(!1),X(null)},be=()=>{le(!1),X(null)},fe=()=>{ae(!1),X(null)},Ae=()=>{ce(!1)},je=async e=>{if(!t||null===i||void 0===i||!i.id||!h)return console.error("User, Org ID, or logAction function is not available."),void y("Cannot perform action: Missing user or configuration.");const s=await(0,n.gS)((0,n.rJ)(xe,`orgs/${i.id}/stockItems`),{...e,currentStatus:"Pending Delivery",isFlagged:!1,lastModified:(0,n.O5)(),lastModifiedBy:t.uid,activityLog:[B(t.uid,"CREATED")]}),r={userId:t.uid,orgId:i.id,toolKey:"incoming-tool",entityPath:`stockItems/${s.id}`,action:"item.create",timestamp:(0,n.O5)()};await h(r),console.log(`Action logged: item.create for item ${s.id}`),fe()},ye=(e,t)=>{const i=v.find((t=>t.id===e));if(i)switch(X(i),t){case"View Details":ee(!0);break;case"Edit Item":ae(!0);break;case"Add Issue Update":ie(!0);break;case"Resolve Issue":se(!0);break;case"Report Issue":le(!0);break;case"Flag Item":case"Unflag Item":me(e,{isFlagged:"Flag Item"===t},{toolKey:"incoming-tool",action:"item.update.flag",details:{flagged:"Flag Item"===t}}),X(null);break;case"Mark as Delivered":me(e,{currentStatus:"Delivered",dateDelivered:(new Date).toISOString()},{toolKey:"incoming-tool",action:"item.update.status.Delivered",details:{previousStatus:i.currentStatus}}),X(null);break;case"Archive":me(e,{currentStatus:"Archived"},{toolKey:"incoming-tool",action:"item.update.status.Archived",details:{previousStatus:i.currentStatus}}),X(null);break;default:console.warn(`Unhandled action: ${t}`),X(null)}},Se=e=>{const t=v.find((t=>t.id===e));t&&(X(t),ee(!0))},Ie=v.map((e=>({...e,isLate:q(e)}))).filter((e=>{}));return(0,T.jsxs)(P.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[j&&(0,T.jsx)(g.A,{sx:{mb:2,p:2,backgroundColor:"#f8d7da",color:"#721c24",borderRadius:1},children:j}),(0,T.jsx)($,{onSearch:k,inputRef:W}),(0,T.jsx)(F,{currentFilter:S,onFilterChange:I}),(0,T.jsx)(U,{onClick:()=>ae(!0)}),(0,T.jsx)(K,{isChecked:!1,onChange:()=>console.log("Flag toggle changed")}),(0,T.jsx)(z,{items:Ie,visibleColumns:N,onActionSelected:ye,onViewDetails:Se,onColumnReorder:he,selectedRowIndex:J}),oe&&t&&(0,T.jsx)(a.A,{open:oe,itemToEdit:Q,onSubmit:e=>Q?(async(e,t)=>{v.find((t=>t.id===e))?(await me(e,t,{toolKey:"incoming-tool",action:"item.update.fields",details:{updatedFields:Object.keys(t)}}),fe()):y("Could not find item to update.")})(Q.id||"",e):je,onClose:fe,user:t,orgId:null===i||void 0===i?void 0:i.id}),(0,T.jsx)(d.A,{open:Z,item:Q,orgId:null===i||void 0===i?void 0:i.id,onClose:()=>{ee(!1),X(null)},onActionSelected:ye}),(0,T.jsx)(u.A,{open:te,item:Q,onClose:ge,onSubmit:async e=>{null!==Q&&void 0!==Q&&Q.id&&(await me(Q.id,{},{toolKey:"incoming-tool",action:"item.update.issue.update",details:{note:e}}),ge())}}),(0,T.jsx)(p.A,{open:ne,item:Q,onClose:ve,onSubmit:async(e,t)=>{null!==Q&&void 0!==Q&&Q.id&&(await me(Q.id,{currentStatus:"Delivered",issueDescription:void 0},{toolKey:"incoming-tool",action:"item.update.issue.resolve",details:{resolutionOutcome:e,note:t,previousStatus:Q.currentStatus}}),ve())}}),re&&Q&&(0,T.jsx)(c.A,{item:Q,onSubmit:e=>(async(e,t)=>{var i;await me(e,{currentStatus:"Issue",issueDescription:t},{toolKey:"incoming-tool",action:"item.update.issue.report",details:{description:t,previousStatus:null===(i=v.find((t=>t.id===e)))||void 0===i?void 0:i.currentStatus}}),be()})(Q.id,e),onClose:be}),de&&(0,T.jsx)(x.A,{isOpen:de,allColumns:L,initialVisibleColumns:N,onSave:e=>{localStorage.setItem("visibleStockColumns",JSON.stringify(e)),E(L.filter((t=>e.includes(t.id)))),Ae()},onClose:Ae}),ue&&(0,T.jsx)(H,{onClose:()=>{pe(!1)}}),V&&(0,T.jsx)(m.A,{orgId:null===i||void 0===i?void 0:i.id,onClose:()=>{},onEntityClick:e=>{console.log("User Activity View - Entity Clicked:",e);const t=e.split("/")[1];t&&Se(t)},onActionSelected:(e,t)=>{console.log("User Activity View - Action Selected:",e,t),ye(e,t)}})]})}},5982:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(8613),s=i(579);const r=e=>{let{item:t,onSubmit:i,onClose:r}=e;const[l,o]=(0,n.useState)(""),[a,d]=(0,n.useState)("");return(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:r,children:(0,s.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",maxWidth:"500px",width:"90%",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{children:"Report Issue for:"}),(0,s.jsxs)("p",{style:{margin:"5px 0 15px 0",fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]}),(0,s.jsx)("label",{htmlFor:"issueDescription",style:{fontWeight:"bold"},children:"Describe the Issue:"}),(0,s.jsx)("textarea",{id:"issueDescription",value:l,onChange:e=>{o(e.target.value),a&&d("")},style:{width:"calc(100% - 16px)",padding:"8px",minHeight:"80px",marginTop:"5px"},rows:4}),a&&(0,s.jsx)("div",{style:{color:"red",fontSize:"0.8em",marginTop:"4px"},children:a}),(0,s.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,s.jsx)("button",{type:"button",onClick:r,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:()=>{l.trim()?i(l):d("Please enter a description of the issue.")},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Issue Report"})]})]})})}},7553:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(8613),s=i(9550),r=i(579);const l=e=>{let{orgId:t,onClose:i,onEntityClick:l,onActionSelected:o}=e;const[a,d]=(0,n.useState)([]),[c,u]=(0,n.useState)(!0),[p,x]=(0,n.useState)(null),[m,h]=(0,n.useState)({});(0,n.useEffect)((()=>{if(!t)return;const e=(0,s.aU)(),i=(0,s.rJ)(e,`orgs/${t}/members`);(0,s.GG)(i).then((e=>{const t={};e.docs.forEach((e=>{const i=e.data();t[e.id]=i.email||e.id})),h(t)})).catch((e=>console.error("Error fetching members:",e)))}),[t]),(0,n.useEffect)((()=>{if(!t)return x("Organization ID is required."),void u(!1);u(!0),x(null);const e=(0,s.aU)(),i=(0,s.rJ)(e,`orgs/${t}/logs`),n=(0,s.P)(i,(0,s._M)("tool","==","incomingtool"),(0,s.My)("ts","desc"),(0,s.AB)(100)),r=(0,s.aQ)(n,(e=>{const i=e.docs.map((e=>{const i=e.data();return{orgId:t,toolKey:i.toolKey||i.tool,action:i.action,entityPath:i.entityPath,timestamp:i.timestamp||i.ts,userId:i.userId||i.uid,userEmail:i.email,before:i.before,after:i.after,details:i.details}})).filter((e=>"app-loaded"!==e.action));d(i),u(!1)}),(e=>{console.error("Error fetching user activity logs: ",e),x(`Failed to load activity logs: ${e.message}`),u(!1)}));return()=>r()}),[t]);const g=e=>{var t,i,n;const o=e.timestamp instanceof s.Dc?e.timestamp.toDate().toLocaleString():"string"===typeof e.timestamp?new Date(e.timestamp).toLocaleString():"Invalid Date",a=e.userEmail||m[e.userId||""]||e.userId||"system",d=(e=>{switch(e.action){case"item.create":return"Item created";case"item.update.fields":{var t,i;if(e.before&&e.after){var n;const t=(null===(n=e.details)||void 0===n?void 0:n.changedFields)||Object.keys(e.after).filter((t=>{var i,n;return JSON.stringify(null===(i=e.before)||void 0===i?void 0:i[t])!==JSON.stringify(null===(n=e.after)||void 0===n?void 0:n[t])}));if(t.length)return`Edited ${t.map((t=>{var i,n;return`${t}: ${null===(i=e.before)||void 0===i?void 0:i[t]} \u2192 ${null===(n=e.after)||void 0===n?void 0:n[t]}`})).join(", ")}`}const s=null===(t=e.details)||void 0===t||null===(i=t.changedFields)||void 0===i?void 0:i.join(", ");return s?`Edited fields: ${s}`:"Item edited"}default:var s,r,l,o,a,d,c,u,p;return e.action.startsWith("item.update.status.")?`Status changed: ${(null===(s=e.details)||void 0===s?void 0:s.previousStatus)||(null===(r=e.before)||void 0===r?void 0:r.currentStatus)||"Unknown"} \u2192 ${(null===(l=e.details)||void 0===l?void 0:l.newStatus)||e.action.replace("item.update.status.","")}`:"item.update.flag"===e.action?(null===(o=e.details)||void 0===o?void 0:o.isFlagged)?"Item flagged":"Item unflagged":"item.update.issue.report"===e.action?`Issue reported: ${(null===(a=e.details)||void 0===a?void 0:a.description)||(null===(d=e.details)||void 0===d?void 0:d.issueDescription)||""}`:"item.update.issue.update"===e.action?`Issue update added: ${(null===(c=e.details)||void 0===c?void 0:c.note)||""}`:"item.update.issue.resolve"===e.action?`Issue resolved: ${(null===(u=e.details)||void 0===u?void 0:u.resolutionOutcome)||""}`:"item.add_note"===e.action?`Note added: ${(null===(p=e.details)||void 0===p?void 0:p.note)||""}`:e.action}})(e),c=e.entityPath.split("/"),u=c.length>=2?c[1]:"",p=null===(t=e.before)||void 0===t?void 0:t.quantity,x=null===(i=e.before)||void 0===i?void 0:i.productName,h=p&&x?`${p}x ${x}`:(null===(n=e.before)||void 0===n?void 0:n.deliveryName)||x||u;return(0,r.jsxs)("span",{children:[o,": ",d," by ",a," ",(0,r.jsx)("a",{href:"#",style:{textDecoration:"underline",cursor:"pointer"},onClick:e=>{e.preventDefault(),l(u)},children:h})]})},v={marginBottom:"5px",paddingBottom:"5px",borderBottom:"1px dashed #eee",fontSize:"0.9em"};return(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:40},onClick:i,children:(0,r.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",border:"1px solid #ccc",borderRadius:"8px",width:"80%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h3",{children:"User Activity Log (Last 100 entries)"}),c&&(0,r.jsx)("div",{children:"Loading logs..."}),p&&(0,r.jsx)("div",{style:{color:"red"},children:p}),!c&&!p&&(0,r.jsxs)("div",{style:{flexGrow:1,overflowY:"auto",border:"1px solid #eee",padding:"10px",marginTop:"15px"},children:[0===a.length&&(0,r.jsx)("div",{children:"No activity logs found."}),a.map(((e,t)=>(0,r.jsx)("div",{style:v,children:g(e)},`${e.timestamp}-${t}`)))]}),(0,r.jsx)("div",{style:{marginTop:"20px",textAlign:"right"},children:(0,r.jsx)("button",{onClick:i,style:{padding:"8px 15px",fontWeight:"bold"},children:"Close"})})]})})}},7694:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(8613),s=i(579);const r=e=>{let{isOpen:t,onClose:i,allColumns:r,initialVisibleColumns:l,onSave:o}=e;const[a,d]=(0,n.useState)((()=>Object.fromEntries(r.map((e=>[e.id,!1])))));(0,n.useEffect)((()=>{if(t){const e=new Set(l.map((e=>e.id))),t=Object.fromEntries(r.map((t=>[t.id,e.has(t.id)])));d(t)}}),[t,l,r]);if(!t)return null;const c={padding:"8px 12px",display:"flex",alignItems:"center"},u={marginLeft:"10px",cursor:"pointer"};return(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},onClick:i,children:(0,s.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",width:"400px",maxWidth:"90%",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{children:"Configure Table Columns"}),(0,s.jsx)("p",{children:"Select the columns you want to display:"}),(0,s.jsx)("div",{style:{flexGrow:1,overflowY:"auto",padding:"10px 0",border:"1px solid #eee",borderRadius:"4px",marginBottom:"15px"},children:r.map((e=>(0,s.jsxs)("div",{style:c,children:[(0,s.jsx)("input",{type:"checkbox",id:`col-checkbox-${e.id}`,checked:a[e.id]||!1,onChange:()=>{return t=e.id,void d((e=>({...e,[t]:!e[t]})));var t},disabled:"actions"===e.id}),(0,s.jsx)("label",{htmlFor:`col-checkbox-${e.id}`,style:u,children:e.label})]},e.id)))}),(0,s.jsxs)("div",{style:{marginTop:"auto",textAlign:"right",borderTop:"1px solid #eee",paddingTop:"15px"},children:[(0,s.jsx)("button",{type:"button",onClick:i,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:()=>{const e=r.map((e=>e.id)).filter((e=>a[e]));o(e)},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Column Settings"})]})]})})}}}]);
//# sourceMappingURL=544.ffb7255b.chunk.js.map