{"version":3,"file":"static/js/935.8d29e465.chunk.js","mappings":"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","sources":["hooks/useStockItems.ts","AddUpdateModal.tsx","ActionMenu.tsx","ResolveIssueModal.tsx","AddItemForm.tsx","ItemDetailModal.tsx","FilterControls.tsx","config.ts","ToolApp.tsx","ReportIssueModal.tsx","utils.ts","UserActivityView.tsx","TableSettingsModal.tsx","StockItemList.tsx","TopBar.tsx"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react';\r\nimport { collection, query, where, orderBy, onSnapshot, Query } from 'firebase/firestore';\r\nimport { db } from 'shell/firebase'; // Assuming db is correctly imported via MF\r\nimport { StockItem, ItemStatus } from '../types';\r\n\r\n// Helper function (can be moved to utils if preferred)\r\nconst isItemLate = (item: StockItem): boolean => {\r\n  if (item.currentStatus !== 'Pending Delivery') {\r\n    return false;\r\n  }\r\n  const orderDate = new Date(item.orderDate);\r\n  const sevenDaysAgo = new Date();\r\n  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\r\n  return orderDate < sevenDaysAgo;\r\n};\r\n\r\nexport const useStockItems = (orgId: string | undefined) => {\r\n  // State for non-archived items\r\n  const [nonArchivedItems, setNonArchivedItems] = useState<StockItem[]>([]);\r\n  const [mainLoading, setMainLoading] = useState<boolean>(true);\r\n  const [mainError, setMainError] = useState<string | null>(null);\r\n\r\n  // State for archived items\r\n  const [archivedItems, setArchivedItems] = useState<StockItem[]>([]);\r\n  const [archivedLoading, setArchivedLoading] = useState<boolean>(true);\r\n  const [archivedError, setArchivedError] = useState<string | null>(null);\r\n\r\n  // Filter state remains the same\r\n  const [searchTerm, setSearchTerm] = useState<string>('');\r\n  const [currentFilter, setCurrentFilter] = useState<ItemStatus | 'All'>('All');\r\n  const [showFlaggedOnly, setShowFlaggedOnly] = useState<boolean>(false);\r\n\r\n  // Combined loading and error state for the hook consumer\r\n  const loading = mainLoading || archivedLoading;\r\n  const error = mainError || archivedError;\r\n\r\n  // --- Firestore Real-time Sync for Non-Archived Items ---\r\n  useEffect(() => {\r\n    console.log('[useStockItems] Non-Archived Listener: Checking db and orgId:', { db_instance: db, org_id: orgId });\r\n    if (!db || !orgId) {\r\n      console.warn('[useStockItems] Non-Archived Listener: db or orgId is missing, skipping Firestore query.');\r\n      setMainLoading(false);\r\n      if (!orgId) setNonArchivedItems([]);\r\n      return;\r\n    }\r\n\r\n    setMainLoading(true);\r\n    setMainError(null);\r\n    console.log(`[useStockItems] Non-Archived Listener: Setting up listener for orgs/${orgId}/stockItems (non-archived)`);\r\n    \r\n    // Query for non-archived items\r\n    const q = query(\r\n        collection(db, 'orgs', orgId, 'stockItems') as Query<StockItem>, // Cast for type safety with Firestore V9\r\n        where(\"currentStatus\", \"!=\", \"Archived\"), \r\n        orderBy(\"currentStatus\"), // Order by status first to group non-archived logically?\r\n        orderBy('orderDate', 'desc') // Then by order date\r\n    );\r\n    \r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      console.log('[useStockItems] Non-Archived Listener: Received snapshot.');\r\n      const items: StockItem[] = snapshot.docs.map(docSnap => ({ ...docSnap.data(), id: docSnap.id }));\r\n      setNonArchivedItems(items);\r\n      setMainLoading(false);\r\n    }, (err) => {\r\n      console.error('[useStockItems] Non-Archived Listener: Snapshot error:', err);\r\n      setMainError('Failed to load items: ' + (err as Error).message);\r\n      setMainLoading(false);\r\n    });\r\n\r\n    return () => {\r\n      console.log('[useStockItems] Non-Archived Listener: Cleaning up listener.');\r\n      unsubscribe();\r\n    };\r\n  }, [orgId]);\r\n\r\n  // --- Firestore Real-time Sync for Archived Items ---\r\n  useEffect(() => {\r\n    console.log('[useStockItems] Archived Listener: Checking db and orgId:', { db_instance: db, org_id: orgId });\r\n    if (!db || !orgId) {\r\n      console.warn('[useStockItems] Archived Listener: db or orgId is missing, skipping Firestore query.');\r\n      setArchivedLoading(false);\r\n      if (!orgId) setArchivedItems([]);\r\n      return;\r\n    }\r\n\r\n    setArchivedLoading(true);\r\n    setArchivedError(null);\r\n    console.log(`[useStockItems] Archived Listener: Setting up listener for orgs/${orgId}/stockItems (archived)`);\r\n    \r\n    // Query for archived items\r\n    const qArchived = query(\r\n        collection(db, 'orgs', orgId, 'stockItems') as Query<StockItem>,\r\n        where(\"currentStatus\", \"==\", \"Archived\"), \r\n        orderBy('orderDate', 'desc')\r\n    );\r\n    \r\n    const unsubscribeArchived = onSnapshot(qArchived, (snapshot) => {\r\n      console.log('[useStockItems] Archived Listener: Received snapshot.');\r\n      const items: StockItem[] = snapshot.docs.map(docSnap => ({ ...docSnap.data(), id: docSnap.id }));\r\n      setArchivedItems(items);\r\n      setArchivedLoading(false);\r\n    }, (err) => {\r\n      console.error('[useStockItems] Archived Listener: Snapshot error:', err);\r\n      setArchivedError('Failed to load archived items: ' + (err as Error).message);\r\n      setArchivedLoading(false);\r\n    });\r\n\r\n    return () => {\r\n      console.log('[useStockItems] Archived Listener: Cleaning up listener.');\r\n      unsubscribeArchived();\r\n    };\r\n  }, [orgId]);\r\n\r\n  // --- Filtering Logic (Updated) ---\r\n  const filteredItems = useMemo(() => {\r\n    // Determine the source list based on the current filter\r\n    const sourceItems = currentFilter === 'Archived' ? archivedItems : nonArchivedItems;\r\n\r\n    return sourceItems.filter(item => {\r\n      const lowerSearchTerm = searchTerm.toLowerCase();\r\n      const matchesSearch = (\r\n        (item.deliveryName?.toLowerCase().includes(lowerSearchTerm)) ||\r\n        (item.productName?.toLowerCase().includes(lowerSearchTerm)) ||\r\n        (item.seller?.toLowerCase().includes(lowerSearchTerm)) ||\r\n        (item.asinSku?.toLowerCase().includes(lowerSearchTerm))\r\n      );\r\n        \r\n      // Filter logic based on the already selected source list\r\n      let matchesFilter = false;\r\n      if (currentFilter === 'All' || currentFilter === 'Archived') {\r\n          // If 'All', we use nonArchivedItems (already filtered by query)\r\n          // If 'Archived', we use archivedItems (already filtered by query)\r\n          matchesFilter = true;\r\n      } else if (currentFilter === 'Late') {\r\n          matchesFilter = isItemLate(item); // isItemLate only makes sense for non-archived items\r\n      } else {\r\n          matchesFilter = item.currentStatus === currentFilter;\r\n      }\r\n\r\n      const matchesFlag = !showFlaggedOnly || item.isFlagged === true;\r\n\r\n      return matchesFilter && matchesSearch && matchesFlag;\r\n    });\r\n  }, [nonArchivedItems, archivedItems, searchTerm, currentFilter, showFlaggedOnly]); // Include both lists in dependencies\r\n\r\n  return {\r\n    // Provide access to both lists if needed externally, though ToolApp mainly uses `items`\r\n    allItems: nonArchivedItems, \r\n    archivedItems: archivedItems, \r\n    items: filteredItems, // The items to display based on currentFilter\r\n    loading,\r\n    error,\r\n    searchTerm,\r\n    currentFilter,\r\n    showFlaggedOnly,\r\n    setSearchTerm,\r\n    setCurrentFilter,\r\n    setShowFlaggedOnly,\r\n    setError: (err: string | null) => { // Allow clearing both errors\r\n        setMainError(err);\r\n        setArchivedError(err);\r\n    }\r\n  };\r\n}; ","import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Typography, Box\n} from '@mui/material';\nimport { StockItem } from './types';\n\ninterface AddUpdateModalProps {\n  isOpen: boolean;\n  item: StockItem; // Pass the item for context\n  onSubmit: (note: string) => void;\n  onClose: () => void;\n}\n\nconst AddUpdateModal: React.FC<AddUpdateModalProps> = ({ isOpen, item, onSubmit, onClose }) => {\n  const [note, setNote] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    if (!note.trim()) {\n      setError('Please enter an update note.');\n      return;\n    }\n    onSubmit(note);\n    onClose(); // Close modal on successful submission\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Add Issue Update for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {/* Display existing issue description for context */} \n        {item.issueDescription && (\n          <Box sx={{ mb: 2, p: 1.5, background: '#f8f9fa', border: '1px solid #dee2e6', borderRadius: 1 }}>\n            <Typography variant=\"body2\"><strong>Initial Issue:</strong> {item.issueDescription}</Typography>\n          </Box>\n        )}\n\n        {/* Update Note TextField */} \n        <TextField\n          autoFocus\n          margin=\"dense\"\n          id=\"updateNote\"\n          label=\"Update Note *\"\n          type=\"text\"\n          fullWidth\n          multiline\n          rows={4}\n          variant=\"outlined\"\n          value={note}\n          onChange={(e) => {\n            setNote(e.target.value);\n            if (error) setError(''); // Clear error on type\n          }}\n          error={!!error}\n          helperText={error || 'Enter details about the update.'}\n          placeholder=\"e.g., Contacted seller, awaiting response...\"\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Update Note\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default AddUpdateModal; ","import React from 'react';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  ListItemIcon,\r\n  ListItemText,\r\n} from '@mui/material';\r\nimport { ActionDefinition } from './types'; // Assuming types.ts is in the same directory\r\n\r\n// Interface (Moved from ToolApp.tsx)\r\nexport interface ActionMenuProps {\r\n  itemId: string;\r\n  actions: ActionDefinition[];\r\n  onActionSelected: (itemId: string, action: ActionDefinition) => void;\r\n  onClose: () => void;\r\n  anchorEl: null | HTMLElement;\r\n  open: boolean;\r\n}\r\n\r\n// Component (Moved from ToolApp.tsx)\r\nexport const ActionMenu: React.FC<ActionMenuProps> = ({ \r\n  itemId, \r\n  actions, \r\n  onActionSelected, \r\n  onClose, \r\n  anchorEl, \r\n  open \r\n}) => {\r\n  const handleActionClick = (action: ActionDefinition) => {\r\n    onActionSelected(itemId, action);\r\n    onClose(); // Close the menu after action selection\r\n  };\r\n\r\n  return (\r\n    <Menu\r\n      anchorEl={anchorEl}\r\n      open={open}\r\n      onClose={onClose}\r\n      MenuListProps={{\r\n        'aria-labelledby': `actions-button-${itemId}`, // Improve accessibility\r\n      }}\r\n    >\r\n      {actions.map(action => (\r\n        <MenuItem \r\n          key={action.id} \r\n          onClick={() => handleActionClick(action)}\r\n        >\r\n          {action.icon && (\r\n            <ListItemIcon sx={{ minWidth: '32px' }}> \r\n              {action.icon}\r\n            </ListItemIcon>\r\n          )}\r\n          <ListItemText primary={action.label} />\r\n        </MenuItem>\r\n      ))}\r\n    </Menu>\r\n  );\r\n};\r\n\r\nexport default ActionMenu; ","import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Select, MenuItem, FormControl, InputLabel, Typography,\n  FormHelperText, Box\n} from '@mui/material';\nimport { StockItem } from './types';\n\ninterface ResolveIssueModalProps {\n  isOpen: boolean;\n  item: StockItem; // Pass the item for context\n  onSubmit: (outcome: string, note?: string) => void;\n  onClose: () => void;\n}\n\nconst RESOLUTION_OUTCOMES = [\n  \"Item Accepted / Kept As Is\",\n  \"Item Repaired / Refurbished\",\n  \"Partial Refund Received\",\n  \"Returned to Supplier\",\n  \"Disposed Of\",\n  \"Other\" // Allows adding notes for specifics\n];\n\nconst ResolveIssueModal: React.FC<ResolveIssueModalProps> = ({ isOpen, item, onSubmit, onClose }) => {\n  const [outcome, setOutcome] = useState('');\n  const [note, setNote] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    setError(''); // Clear previous error\n    if (!outcome) {\n      setError('Please select a resolution outcome.');\n      return;\n    }\n    onSubmit(outcome, note.trim() || undefined); // Pass note only if it has content\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Resolve Issue for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {/* Display existing issue description */}\n        {item.issueDescription && (\n          <Box sx={{ mb: 2, p: 1.5, background: '#f8f9fa', border: '1px solid #dee2e6', borderRadius: 1 }}>\n            <Typography variant=\"body2\"><strong>Initial Issue:</strong> {item.issueDescription}</Typography>\n          </Box>\n        )}\n\n        {/* Resolution Outcome Select */}\n        <FormControl fullWidth error={!!error} sx={{ mb: 2 }}>\n          <InputLabel id=\"resolution-outcome-label\">Resolution Outcome *</InputLabel>\n          <Select\n            labelId=\"resolution-outcome-label\"\n            id=\"resolutionOutcome\"\n            value={outcome}\n            label=\"Resolution Outcome *\"\n            onChange={(e) => {\n              setOutcome(e.target.value as string);\n              if (error) setError(''); // Clear error on change\n            }}\n          >\n            <MenuItem value=\"\" disabled><em>-- Select an Outcome --</em></MenuItem>\n            {RESOLUTION_OUTCOMES.map(opt => (\n              <MenuItem key={opt} value={opt}>{opt}</MenuItem>\n            ))}\n          </Select>\n          {error && <FormHelperText>{error}</FormHelperText>}\n        </FormControl>\n\n        {/* Resolution Notes TextField */}\n        <TextField\n          id=\"resolutionNotes\"\n          label=\"Resolution Notes (Optional)\"\n          multiline\n          rows={3}\n          fullWidth\n          value={note}\n          onChange={(e) => setNote(e.target.value)}\n          placeholder=\"e.g., Supplier issued refund, repaired screen...\"\n          variant=\"outlined\"\n          sx={{ mb: 2 }}\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Resolution\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ResolveIssueModal;","import React, { useState, useEffect } from 'react';\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  Button,\n  Tooltip,\n  IconButton,\n  Box,\n  FormControlLabel,\n  Checkbox,\n  MenuItem,\n} from '@mui/material';\nimport InfoOutlinedIcon from '@mui/icons-material/InfoOutlined';\nimport { StockItem, PurchaseStatus, Destination } from './types';\n\ninterface AddItemFormProps {\n  isOpen: boolean;\n  onSave: (newItemOrUpdate: Omit<StockItem, 'id' | 'currentStatus' | 'dateDelivered' | 'processorNotes' | 'issueDescription'> & { isFlagged: boolean }) => void;\n  onClose: () => void;\n  initialData?: StockItem | null;\n  firstInputRef?: React.RefObject<HTMLInputElement | null>;\n}\n\nconst AddItemForm: React.FC<AddItemFormProps> = ({ isOpen, onSave, onClose, initialData, firstInputRef }) => {\n  const isEditing = !!initialData;\n\n  // Initialize state for each form field\n  const [purchaseStatus, setPurchaseStatus] = useState<PurchaseStatus>(initialData?.purchaseStatus || 'Purchased');\n  const [deliveryName, setDeliveryName] = useState(initialData?.deliveryName || '');\n  const [productName, setProductName] = useState(initialData?.productName || '');\n  const [quantity, setQuantity] = useState<number | ''>(initialData?.quantity || '');\n  const [pricePerItem, setPricePerItem] = useState<number | ''>(initialData?.pricePerItem || '');\n  const [orderNumber, setOrderNumber] = useState(initialData?.orderNumber || '');\n  const [orderDate, setOrderDate] = useState(() => (initialData?.orderDate || new Date().toISOString().split('T')[0]));\n  const [seller, setSeller] = useState(initialData?.seller || '');\n  const [isVatRegistered, setIsVatRegistered] = useState<'Yes' | 'No' | 'Unknown'>(initialData?.isVatRegistered || 'Unknown');\n  const [destination, setDestination] = useState<Destination>(initialData?.destination || '');\n  const [asinSku, setAsinSku] = useState(initialData?.asinSku || '');\n  const [acquisitionNotes, setAcquisitionNotes] = useState(initialData?.acquisitionNotes || '');\n  const [isFlagged, setIsFlagged] = useState(initialData?.isFlagged || false);\n\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  // Populate state if initialData changes (needed if modal reuses component instance)\n  useEffect(() => {\n    if (initialData) {\n      setPurchaseStatus(initialData.purchaseStatus || 'Purchased');\n      setDeliveryName(initialData.deliveryName || '');\n      setProductName(initialData.productName || '');\n      setQuantity(initialData.quantity || '');\n      setPricePerItem(initialData.pricePerItem || '');\n      setOrderNumber(initialData.orderNumber || '');\n      setOrderDate(initialData.orderDate || new Date().toISOString().split('T')[0]);\n      setSeller(initialData.seller || '');\n      setIsVatRegistered(initialData.isVatRegistered || 'Unknown');\n      setDestination(initialData.destination || '');\n      setAsinSku(initialData.asinSku || '');\n      setAcquisitionNotes(initialData.acquisitionNotes || '');\n      setIsFlagged(initialData.isFlagged || false);\n      setErrors({}); // Clear errors when loading new data\n    } else {\n      // Reset form if initialData becomes null (e.g., switching from edit to add)\n      // Optional: Add logic here to reset all fields if needed\n    }\n  }, [initialData]); // Re-run effect if initialData changes\n\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n    if (!deliveryName.trim()) newErrors.deliveryName = 'Delivery Name is required.';\n    if (!productName.trim()) newErrors.productName = 'Product Name is required.';\n    if (quantity === '' || quantity <= 0) newErrors.quantity = 'Quantity must be a positive number.';\n    if (pricePerItem === '' || pricePerItem < 0) newErrors.pricePerItem = 'Price must be zero or positive.';\n    if (!orderDate) newErrors.orderDate = 'Order Date is required.';\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = (event: React.FormEvent) => {\n    event.preventDefault();\n    console.log('AddItemForm: handleSubmit', { deliveryName, productName, quantity, pricePerItem, orderDate, seller, destination, acquisitionNotes, isFlagged });\n    const isValid = validateForm();\n    console.log('AddItemForm: validation result', isValid, errors);\n    if (isValid) {\n      console.log('AddItemForm: form valid, calling onSave');\n      onSave({\n        purchaseStatus,\n        deliveryName,\n        productName,\n        quantity: Number(quantity),\n        pricePerItem: Number(pricePerItem),\n        orderNumber: orderNumber || undefined,\n        orderDate,\n        seller: seller || undefined,\n        isVatRegistered: isVatRegistered === 'Unknown' ? undefined : isVatRegistered,\n        destination: destination || undefined,\n        asinSku: asinSku || undefined,\n        acquisitionNotes: acquisitionNotes || undefined,\n        isFlagged: isFlagged,\n      });\n    } else {\n      console.log('AddItemForm: form invalid, errors:', errors);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>{isEditing ? 'Edit Stock Item' : 'Add New Stock Item'}</DialogTitle>\n      <DialogContent>\n        <Box component=\"form\" onSubmit={handleSubmit} id=\"add-item-form\" noValidate sx={{ mt: 1 }}>\n          <TextField\n            inputRef={firstInputRef}\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"deliveryName\"\n            label=\"Delivery Name\"\n            name=\"deliveryName\"\n            value={deliveryName}\n            onChange={(e) => setDeliveryName(e.target.value)}\n            error={!!errors.deliveryName}\n            helperText={errors.deliveryName}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          <TextField\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"productName\"\n            label=\"Product Name\"\n            name=\"productName\"\n            value={productName}\n            onChange={(e) => setProductName(e.target.value)}\n            error={!!errors.productName}\n            helperText={errors.productName}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"The common name of the item. Example: Blue Widget Model X\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          <TextField\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"quantity\"\n            label=\"Quantity\"\n            name=\"quantity\"\n            type=\"number\"\n            value={quantity}\n            onChange={(e) => setQuantity(e.target.value === '' ? '' : Number(e.target.value))}\n            error={!!errors.quantity}\n            helperText={errors.quantity}\n            InputProps={{\n              inputProps: { min: 1 },\n              endAdornment: (\n                <Tooltip title=\"How many units of this item are included? Example: 50\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          <TextField\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"pricePerItem\"\n            label=\"Price Per Item\"\n            name=\"pricePerItem\"\n            type=\"number\"\n            value={pricePerItem}\n            onChange={(e) => setPricePerItem(e.target.value === '' ? '' : Number(e.target.value))}\n            error={!!errors.pricePerItem}\n            helperText={errors.pricePerItem}\n            InputProps={{\n              inputProps: { min: 0, step: 0.01 },\n              endAdornment: (\n                <Tooltip title=\"The cost for one single unit. Example: 12.50\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          <TextField\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"orderDate\"\n            label=\"Order Date\"\n            name=\"orderDate\"\n            type=\"date\"\n            value={orderDate}\n            onChange={(e) => setOrderDate(e.target.value)}\n            error={!!errors.orderDate}\n            helperText={errors.orderDate}\n            InputLabelProps={{ shrink: true }}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"The date the item was purchased or the return initiated.\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Add Remaining Fields Below */}\n\n          {/* Purchase Status */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"purchaseStatus\"\n            label=\"Purchase Status\"\n            name=\"purchaseStatus\"\n            select\n            value={purchaseStatus}\n            onChange={(e) => setPurchaseStatus(e.target.value as PurchaseStatus)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"What is the origin of this item?\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          >\n            <MenuItem value=\"Purchased\">Purchased</MenuItem>\n            <MenuItem value=\"Ordered\">Ordered</MenuItem>\n            <MenuItem value=\"Return Expected\">Return Expected</MenuItem>\n          </TextField>\n\n          {/* Order Number */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"orderNumber\"\n            label=\"Order Number\"\n            name=\"orderNumber\"\n            value={orderNumber}\n            onChange={(e) => setOrderNumber(e.target.value)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: External reference like eBay order ID or PO number. Example: 12-34567-89012\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Seller / Source */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"seller\"\n            label=\"Seller / Source\"\n            name=\"seller\"\n            value={seller}\n            onChange={(e) => setSeller(e.target.value)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Who did this item come from? Example: ebay_seller_123 or Customer Name (Return)\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Seller VAT Registered? */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"isVatRegistered\"\n            label=\"Seller VAT Registered?\"\n            name=\"isVatRegistered\"\n            select\n            value={isVatRegistered}\n            onChange={(e) => setIsVatRegistered(e.target.value as 'Yes' | 'No' | 'Unknown')}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Is the seller registered for VAT?\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          >\n            <MenuItem value=\"Unknown\">Unknown</MenuItem>\n            <MenuItem value=\"Yes\">Yes</MenuItem>\n            <MenuItem value=\"No\">No</MenuItem>\n          </TextField>\n\n          {/* Planned Destination */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"destination\"\n            label=\"Planned Destination\"\n            name=\"destination\"\n            select\n            value={['FBA Prep', 'Local Stock Shelf A', 'Refurbish Pile', 'Return to Supplier'].includes(destination) ? destination : 'Other'}\n            onChange={(e) => {\n              if (e.target.value === 'Other') {\n                setDestination(''); // Clear if switching to Other for custom input\n              } else {\n                setDestination(e.target.value as Destination);\n              }\n            }}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Where is this item intended to go after processing? Example: FBA Prep\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          >\n            <MenuItem value=\"FBA Prep\">FBA Prep</MenuItem>\n            <MenuItem value=\"Local Stock Shelf A\">Local Stock Shelf A</MenuItem>\n            <MenuItem value=\"Refurbish Pile\">Refurbish Pile</MenuItem>\n            <MenuItem value=\"Return to Supplier\">Return to Supplier</MenuItem>\n            <MenuItem value=\"Other\">Other (Specify Below)</MenuItem>\n          </TextField>\n\n          {/* Conditionally render TextField for custom destination */}\n          {destination === '' && (\n            <TextField\n              margin=\"dense\" // Use dense margin for tighter spacing\n              fullWidth\n              id=\"customDestination\"\n              label=\"Specify Destination\"\n              name=\"customDestination\"\n              value={destination} // Bind to the same state\n              onChange={(e) => setDestination(e.target.value)} // Update the same state\n              required // Make required if 'Other' logic implies specification\n              error={!!errors.destination} // Potentially add validation for custom dest\n              helperText={errors.destination}\n            />\n          )}\n\n          {/* ASIN / SKU */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"asinSku\"\n            label=\"ASIN / SKU\"\n            name=\"asinSku\"\n            value={asinSku}\n            onChange={(e) => setAsinSku(e.target.value)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Amazon ASIN or internal SKU. Helps link inventory. Example: B0C1EXAMPLE / BLUE-WIDGET-XL\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Acquisition Notes */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"acquisitionNotes\"\n            label=\"Acquisition Notes\"\n            name=\"acquisitionNotes\"\n            value={acquisitionNotes}\n            onChange={(e) => setAcquisitionNotes(e.target.value)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Any specific notes from the purchase, order, or return request. Example: Seller mentioned slight scratch.\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Flag Checkbox */}\n          <FormControlLabel\n            control={\n              <Checkbox\n                id=\"isFlagged\"\n                checked={isFlagged}\n                onChange={(e) => setIsFlagged(e.target.checked)}\n                name=\"isFlagged\"\n              />\n            }\n            label={\n              <Box component=\"span\" sx={{ display: 'flex', alignItems: 'center' }}>\n                Flag this item for follow-up\n                <Tooltip title=\"Check this box to mark the item with a flag for easy filtering later.\">\n                  {/* Wrap icon in IconButton for better accessibility/hover */}\n                  <IconButton size=\"small\" edge=\"end\" sx={{ ml: 0.5 }}>\n                    <InfoOutlinedIcon fontSize=\"inherit\" />\n                  </IconButton>\n                </Tooltip>\n              </Box>\n            }\n            sx={{ mt: 1 }} // Add some top margin\n          />\n        </Box>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose}>Cancel</Button>\n        <Button type=\"submit\" form=\"add-item-form\" variant=\"contained\" onClick={handleSubmit}>\n          {isEditing ? 'Save Changes' : 'Add Item'}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default AddItemForm;","import React, { useState, useEffect } from 'react';\nimport { getFirestore, collection, query, where, orderBy, onSnapshot, Timestamp } from 'firebase/firestore';\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  Typography,\n  Box,\n  List,\n  ListItem,\n  ListItemText,\n  Divider,\n  CircularProgress,\n  Alert,\n  Stack\n} from '@mui/material';\nimport { StockItem, ActivityEvent, LogActionData, ActivityEventType, ActionDefinition } from './types';\nimport { getAvailableActions } from './config'; // For action buttons\n\n// Helper function to format optional fields\nconst formatValue = (value: string | number | undefined | null, prefix = '', suffix = '') => {\n  if (value === undefined || value === null || value === '') {\n    return <span style={{ color: '#888' }}>N/A</span>; // Indicate if not available\n  }\n  return `${prefix}${value}${suffix}`;\n};\n\n// Helper function to format an activity event into a readable string\nconst formatActivityEvent = (event: ActivityEvent): string => {\n  const time = new Date(event.timestamp).toLocaleString();\n  switch (event.type) {\n    case 'CREATED':\n      return `${time}: Item Created`;\n    case 'EDITED':\n      const fields = event.details.changedFields?.join(', ') || 'details';\n      return `${time}: Item Edited (${fields} changed)`;\n    case 'STATUS_CHANGED':\n      return `${time}: Status changed from ${event.details.previousStatus || '?'} to ${event.details.newStatus || '?'}`;\n    case 'FLAG_TOGGLED':\n      return `${time}: Item ${event.details.isFlagged ? 'Flagged' : 'Unflagged'}`;\n    case 'ISSUE_REPORTED':\n      return `${time}: Issue Reported: ${event.details.issueDescription || ''}`;\n    case 'ISSUE_UPDATE_ADDED':\n      return `${time}: Issue Update Added: ${event.details.note || ''}`;\n    case 'ISSUE_RESOLVED':\n      return `${time}: Issue Resolved (Outcome: ${event.details.resolutionOutcome || 'N/A'}${event.details.note ? ` - Note: ${event.details.note}` : ''}`;\n    case 'NOTE_ADDED': // For general notes in future\n      return `${time}: Note Added: ${event.details.note || ''}`;\n    default:\n      return `${time}: Unknown action`;\n  }\n};\n\n// Helper function to map LogActionData from Firestore to the local ActivityEvent format\nconst mapLogToAction = (log: LogActionData): ActivityEvent | null => {\n  // Handle Firestore Timestamp or ISO string\n  const timestamp = log.timestamp instanceof Timestamp\n    ? log.timestamp.toDate().toISOString()\n    : (typeof log.timestamp === 'string' ? log.timestamp : new Date().toISOString());\n\n  const userId = log.userId || 'system'; // Default if userId is missing\n\n  let type: ActivityEventType | null = null;\n  let details: ActivityEvent['details'] = {};\n\n  // Map central log action strings to local ActivityEventType\n  switch (log.action) {\n    case 'item.create':\n      type = 'CREATED';\n      break;\n    case 'item.update.fields':\n      type = 'EDITED';\n      // Attempt to get changed fields by comparing before/after, fallback to details or generic message\n      const changed = log.before && log.after\n        ? Object.keys(log.after).filter(key => log.before && log.after && JSON.stringify(log.before[key]) !== JSON.stringify(log.after[key]))\n        : (log.details?.changedFields || ['details']);\n      details = { changedFields: changed };\n      break;\n    case 'item.update.status.Delivered':\n      type = 'STATUS_CHANGED';\n      details = { previousStatus: log.before?.currentStatus, newStatus: 'Delivered' };\n      break;\n    case 'item.update.status.Archived':\n      type = 'STATUS_CHANGED';\n      details = { previousStatus: log.before?.currentStatus, newStatus: 'Archived' };\n      break;\n    // TODO: Add mappings for other specific status changes if implemented (e.g., 'Pending Delivery', 'Issue')\n    case 'item.update.flag':\n      type = 'FLAG_TOGGLED';\n      details = { isFlagged: log.after?.isFlagged };\n      break;\n    case 'item.update.issue.report':\n      type = 'ISSUE_REPORTED';\n      details = { issueDescription: log.details?.description || log.details?.issueDescription }; // Allow for variations\n      break;\n    case 'item.update.issue.resolve':\n      type = 'ISSUE_RESOLVED';\n      details = { resolutionOutcome: log.details?.outcome, note: log.details?.note };\n      break;\n    case 'item.update.issue.update': // Action name used in handleSaveIssueUpdate via updateItemAndLog\n      type = 'ISSUE_UPDATE_ADDED';\n      details = { note: log.details?.note };\n      break;\n    case 'item.add_note': // Action name used in handleSaveNote via updateItemAndLog\n      type = 'NOTE_ADDED';\n      details = { note: log.details?.note };\n      break;\n    // Add more mappings if other log.action values exist\n    default:\n      console.warn(`Unhandled log action type for UI mapping: ${log.action}`);\n      return null; // Don't display unmapped actions for now\n  }\n\n  if (!type) return null;\n\n  return {\n    timestamp,\n    userId,\n    // userName: // Optional: Could fetch/join user name later if needed\n    type,\n    details\n  };\n};\n\ninterface ItemDetailModalProps {\n  isOpen: boolean;\n  item: StockItem;\n  orgId: string;\n  onClose: () => void;\n  closeButtonRef?: React.RefObject<HTMLButtonElement | null>;\n  onActionSelected: (itemId: string, action: ActionDefinition) => void;\n}\n\nconst ItemDetailModal: React.FC<ItemDetailModalProps> = ({ isOpen, item, orgId, onClose, closeButtonRef, onActionSelected }) => {\n  // State for fetched logs\n  const [activityEvents, setActivityEvents] = useState<ActivityEvent[]>([]);\n  const [loadingLogs, setLoadingLogs] = useState<boolean>(true);\n  const [logError, setLogError] = useState<string | null>(null);\n\n  // Actions toolbar\n  const availableActions = getAvailableActions(item.currentStatus, item.isFlagged);\n\n  // Fetch logs when the modal opens or item/orgId changes\n  useEffect(() => {\n    if (!item?.id || !orgId) { // Ensure we have item ID and orgId prop\n      setLoadingLogs(false);\n      setLogError(\"Missing item or organization ID for fetching logs.\");\n      return;\n    }\n\n    setActivityEvents([]); // Clear previous logs\n    setLoadingLogs(true);\n    setLogError(null);\n    const db = getFirestore();\n    const entityPath = `stockItems/${item.id}`;\n    // Query the 'logs' collection using the orgId prop\n    const logsRef = collection(db, `orgs/${orgId}/logs`);\n    const q = query(logsRef, where('entityPath', '==', entityPath), orderBy('timestamp', 'desc'));\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      // Map the document data directly to LogActionData, assuming data matches the interface\n      const fetchedLogs = snapshot.docs.map(doc => ({ ...doc.data() } as LogActionData));\n\n      // Map LogActionData to ActivityEvent for display\n      const mappedEvents = fetchedLogs\n        .map(mapLogToAction)\n        .filter((event): event is ActivityEvent => event !== null); // Filter out nulls and type guard\n\n      setActivityEvents(mappedEvents);\n      setLoadingLogs(false);\n    }, (error) => {\n      console.error(\"Error fetching logs: \", error);\n      setLogError(`Failed to fetch activity log: ${error.message}`);\n      setLoadingLogs(false);\n    });\n\n    // Cleanup listener on unmount or when item changes\n    return () => unsubscribe();\n  }, [item?.id, orgId]); // Re-run if item ID or orgId prop changes\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"md\" fullWidth scroll=\"paper\">\n      <DialogTitle>\n        {item.productName} - Details\n      </DialogTitle>\n      <DialogContent dividers={true}> {/* dividers add padding and lines */}\n        {/* Action Buttons Toolbar */}\n        <Box sx={{ mb: 2, borderBottom: 1, borderColor: 'divider', pb: 2 }}>\n          <Typography variant=\"h6\" gutterBottom>Actions</Typography>\n          <Stack direction=\"row\" spacing={1} flexWrap=\"wrap\"> {/* Use Stack for layout */}\n            {availableActions.map(action => (\n              <Button\n                key={action.id}\n                variant=\"contained\"\n                size=\"small\"\n                onClick={() => onActionSelected(item.id, action)}\n                title={action.description} // Tooltip via title attribute\n                // sx={{ mb: 1 }} // Add margin bottom if wrapping occurs\n              >\n                {action.label}\n              </Button>\n            ))}\n            {availableActions.length === 0 && (\n              <Typography variant=\"body2\" color=\"textSecondary\">\n                No actions available for current status.\n              </Typography>\n            )}\n          </Stack>\n        </Box>\n\n        {/* Item Details Section */}\n        <Box sx={{ mb: 2, borderBottom: 1, borderColor: 'divider', pb: 1 }}>\n          <Typography variant=\"h6\">Details</Typography>\n          {/* Use List for better structure */}\n          <List dense> {/* dense reduces padding */}\n            {/* Map item properties to ListItems */}\n            <ListItem key=\"id\">\n              <ListItemText primary=\"ID\" secondary={item.id} />\n            </ListItem>\n            <ListItem key=\"currentStatus\">\n              <ListItemText primary=\"Current Status\" secondary={formatValue(item.currentStatus)} />\n            </ListItem>\n            <ListItem key=\"isFlagged\">\n              <ListItemText primary=\"Flagged\" secondary={item.isFlagged ? 'Yes' : 'No'} />\n            </ListItem>\n            <ListItem key=\"deliveryName\">\n              <ListItemText primary=\"Delivery Name\" secondary={formatValue(item.deliveryName)} />\n            </ListItem>\n            <ListItem key=\"productName\">\n              <ListItemText primary=\"Product Name\" secondary={formatValue(item.productName)} />\n            </ListItem>\n            <ListItem key=\"quantity\">\n              <ListItemText primary=\"Quantity\" secondary={formatValue(item.quantity)} />\n            </ListItem>\n            <ListItem key=\"pricePerItem\">\n              <ListItemText primary=\"Price Per Item\" secondary={formatValue(item.pricePerItem, '£')} />\n            </ListItem>\n            <ListItem key=\"orderDate\">\n              <ListItemText primary=\"Order Date\" secondary={formatValue(item.orderDate)} />\n            </ListItem>\n            <ListItem key=\"purchaseStatus\">\n              <ListItemText primary=\"Purchase Status\" secondary={formatValue(item.purchaseStatus)} />\n            </ListItem>\n            <ListItem key=\"orderNumber\">\n              <ListItemText primary=\"Order Number\" secondary={formatValue(item.orderNumber)} />\n            </ListItem>\n            <ListItem key=\"seller\">\n              <ListItemText primary=\"Seller / Source\" secondary={formatValue(item.seller)} />\n            </ListItem>\n            <ListItem key=\"isVatRegistered\">\n              <ListItemText primary=\"VAT Registered?\" secondary={formatValue(item.isVatRegistered)} />\n            </ListItem>\n            <ListItem key=\"destination\">\n              <ListItemText primary=\"Destination\" secondary={formatValue(item.destination)} />\n            </ListItem>\n            <ListItem key=\"asinSku\">\n              <ListItemText primary=\"ASIN / SKU\" secondary={formatValue(item.asinSku)} />\n            </ListItem>\n            <ListItem key=\"acquisitionNotes\">\n              <ListItemText primary=\"Acquisition Notes\" secondary={formatValue(item.acquisitionNotes)} sx={{ whiteSpace: 'pre-wrap' }} />\n            </ListItem>\n            <ListItem key=\"dateDelivered\">\n              <ListItemText primary=\"Date Delivered\" secondary={item.dateDelivered ? new Date(item.dateDelivered).toLocaleString() : formatValue(null)} />\n            </ListItem>\n            <ListItem key=\"processorNotes\">\n              <ListItemText primary=\"Processor Notes\" secondary={formatValue(item.processorNotes)} sx={{ whiteSpace: 'pre-wrap' }} />\n            </ListItem>\n            <ListItem key=\"issueDescription\">\n              <ListItemText primary=\"Issue Description\" secondary={formatValue(item.issueDescription)} sx={{ whiteSpace: 'pre-wrap' }} />\n            </ListItem>\n          </List>\n        </Box>\n\n        {/* History/Activity Log Section */}\n        <Box>\n          <Typography variant=\"h6\">Activity Log</Typography>\n          {loadingLogs && <CircularProgress size={24} sx={{ display: 'block', margin: '20px auto' }} />}\n          {logError && <Alert severity=\"error\">Error loading history: {logError}</Alert>}\n          {!loadingLogs && !logError && activityEvents.length === 0 && (\n            <Typography variant=\"body2\" color=\"textSecondary\" sx={{ mt: 2 }}>\n              No activity recorded.\n            </Typography>\n          )}\n          {!loadingLogs && !logError && activityEvents.length > 0 && (\n            <List dense>\n              {activityEvents.map((event, index) => (\n                <React.Fragment key={event.timestamp}> { /* Use timestamp as key */ }\n                  <ListItem>\n                    <ListItemText \n                      primary={formatActivityEvent(event)} \n                      primaryTypographyProps={{ variant: 'body2' }} \n                    />\n                  </ListItem>\n                  {index < activityEvents.length - 1 && <Divider component=\"li\" />} \n                </React.Fragment>\n              ))}\n            </List>\n          )}\n        </Box>\n      </DialogContent>\n      <DialogActions>\n        <Button ref={closeButtonRef} onClick={onClose}>Close</Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ItemDetailModal;","import React from 'react';\r\nimport {\r\n  Box,\r\n  TextField,\r\n  Typography,\r\n  Checkbox,\r\n  FormControlLabel,\r\n  Tabs,\r\n  Tab,\r\n} from '@mui/material';\r\nimport { ItemStatus } from './types'; // Assuming types.ts is in the same directory\r\n\r\ninterface FilterControlsProps {\r\n  searchTerm: string;\r\n  onSearchTermChange: (term: string) => void;\r\n  showFlaggedOnly: boolean;\r\n  onShowFlaggedOnlyChange: (checked: boolean) => void;\r\n  currentFilter: ItemStatus | 'All';\r\n  onCurrentFilterChange: (filter: ItemStatus | 'All') => void;\r\n}\r\n\r\nconst FilterControls: React.FC<FilterControlsProps> = ({\r\n  searchTerm,\r\n  onSearchTermChange,\r\n  showFlaggedOnly,\r\n  onShowFlaggedOnlyChange,\r\n  currentFilter,\r\n  onCurrentFilterChange,\r\n}) => {\r\n  return (\r\n    // Wrap both sections in a Fragment or Box\r\n    <React.Fragment>\r\n      {/* Search and Flag Toggle Controls */}\r\n      <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>\r\n        <TextField\r\n          label=\"Search Items\"\r\n          variant=\"outlined\"\r\n          size=\"small\"\r\n          fullWidth\r\n          sx={{ flexGrow: 1 }}\r\n          value={searchTerm}\r\n          onChange={(e) => onSearchTermChange(e.target.value)}\r\n        />\r\n        <FormControlLabel \r\n          control={\r\n            <Checkbox \r\n              checked={showFlaggedOnly}\r\n              onChange={(e) => onShowFlaggedOnlyChange(e.target.checked)}\r\n              size=\"small\" \r\n            />\r\n          }\r\n          label={<Typography variant=\"body2\">Show Flagged Only</Typography>}\r\n          sx={{ mr: 0, whiteSpace: 'nowrap' }} // Prevent wrap\r\n        />\r\n      </Box>\r\n\r\n      {/* Filter Tabs */}\r\n      <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 2 }}>\r\n        <Tabs \r\n          value={currentFilter}\r\n          // Type assertion needed for MUI Tabs onChange event\r\n          onChange={(event, newValue: ItemStatus | 'All') => onCurrentFilterChange(newValue)} \r\n          variant=\"scrollable\"\r\n          scrollButtons=\"auto\"\r\n          allowScrollButtonsMobile \r\n          aria-label=\"Stock item status filter\"\r\n        >\r\n          <Tab label=\"All\" value=\"All\" />\r\n          <Tab label=\"Pending\" value=\"Pending Delivery\" />\r\n          <Tab label=\"Delivered\" value=\"Delivered\" />\r\n          <Tab label=\"Issue\" value=\"Issue\" />\r\n          <Tab label=\"Late\" value=\"Late\" />\r\n          <Tab label=\"Archived\" value=\"Archived\" />\r\n        </Tabs>\r\n      </Box>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default FilterControls; ","import React from 'react'; // Needed for JSX in ActionDefinition icons\r\nimport { StockItem, ItemStatus, ActionDefinition } from './types';\r\nimport { ColumnConfig } from './StockItemList'; // Import from StockItemList now\r\n// Import necessary MUI Icons\r\nimport FlagIcon from '@mui/icons-material/Flag';\r\nimport ArchiveIcon from '@mui/icons-material/Archive';\r\nimport UnarchiveIcon from '@mui/icons-material/Unarchive';\r\nimport ReportProblemIcon from '@mui/icons-material/ReportProblem';\r\nimport NoteAddIcon from '@mui/icons-material/NoteAdd';\r\n\r\n// --- Column Configuration ---\r\nexport const ALL_COLUMNS: ColumnConfig[] = [\r\n  { id: 'orderDate', label: 'Order Date' },\r\n  { id: 'quantity', label: 'Qty' },\r\n  { id: 'productName', label: 'Product Name' },\r\n  { id: 'deliveryName', label: 'Delivery Name' },\r\n  { id: 'pricePerItem', label: 'Price/Item' },\r\n  { id: 'seller', label: 'Seller/Source' },\r\n  { id: 'destination', label: 'Destination' },\r\n  { id: 'asinSku', label: 'ASIN/SKU' },\r\n  { id: 'purchaseStatus', label: 'Purchase Status' },\r\n  { id: 'orderNumber', label: 'Order #' },\r\n  { id: 'currentStatus', label: 'Status' },\r\n  { id: 'isFlagged', label: 'Flagged' },\r\n  { id: 'acquisitionNotes', label: 'Acquisition Notes' },\r\n  { id: 'issueDescription', label: 'Issue Description' },\r\n  { id: 'dateDelivered', label: 'Date Delivered' },\r\n  { id: 'actions', label: 'Actions' },\r\n];\r\n\r\nexport const DEFAULT_VISIBLE_COLUMN_IDS: Array<ColumnConfig['id']> = [\r\n  'orderDate', \r\n  'quantity', \r\n  'productName', \r\n  'deliveryName', \r\n  'currentStatus', \r\n  'actions',\r\n];\r\n\r\nexport const LOCAL_STORAGE_KEY_VISIBLE_COLUMNS = 'incomingTool_visibleColumns';\r\n\r\n// --- Action Configuration ---\r\n\r\n// Define icons as variables first\r\n// const reportIssueIcon = <ReportProblemIcon fontSize=\"small\" />;\r\n// const addNoteIcon = <NoteAddIcon fontSize=\"small\" />;\r\n// const archiveIcon = <ArchiveIcon fontSize=\"small\" />;\r\n// const unarchiveIcon = <UnarchiveIcon fontSize=\"small\" />;\r\n// const flagIcon = <FlagIcon fontSize=\"small\" />;\r\n// const unflagIcon = <FlagIcon fontSize=\"small\" color=\"disabled\" />;\r\n\r\nexport const getAvailableActions = (status: ItemStatus, isFlagged?: boolean): ActionDefinition[] => {\r\n  let actions: ActionDefinition[] = [];\r\n  switch (status) {\r\n    case 'Pending Delivery':\r\n      actions = [\r\n        { id: 'Mark as Delivered', label: 'Mark as Delivered', description: 'Update status to Delivered' },\r\n        { id: 'Report Issue', label: 'Report Issue', description: 'Report an issue with this item' },\r\n        { id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history' },\r\n      ]; break;\r\n    case 'Delivered':\r\n      actions = [\r\n        { id: 'Archive', label: 'Archive', description: 'Archive this item' },\r\n        { id: 'Report Issue', label: 'Report Issue', description: 'Report an issue with this item' },\r\n        { id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history' },\r\n      ]; break;\r\n    case 'Issue':\r\n      actions = [\r\n        { id: 'Resolve Issue', label: 'Resolve Issue', description: 'Mark the issue as resolved' },\r\n        { id: 'Add Issue Update', label: 'Add Issue Update', description: 'Add an update note to the ongoing issue' },\r\n        { id: 'Archive', label: 'Archive', description: 'Archive this item' },\r\n        { id: 'Add Note', label: 'Add Note', description: 'Add a general note to the item history' },\r\n      ]; break;\r\n    case 'Late':\r\n      actions = [\r\n        { id: 'Mark as Delivered', label: 'Mark as Delivered', description: 'Update status to Delivered' },\r\n        { id: 'Report Issue', label: 'Report Issue', description: 'Report an issue with this item' },\r\n        { id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history' },\r\n      ]; break;\r\n    case 'Archived':\r\n      actions = [\r\n        { id: 'Unarchive Item', label: 'Unarchive', description: 'Restore this item from archive' },\r\n        { id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history' },\r\n      ]; break;\r\n    default:\r\n      actions = [{ id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history' }]; break;\r\n  }\r\n  // Always add Flag/Unflag action at the start if not archived\r\n  if (status !== 'Archived') {\r\n    actions.unshift(\r\n      isFlagged\r\n        ? { id: 'action_unflag', label: 'Unflag', description: 'Remove the flag from this item' }\r\n        : { id: 'action_flag', label: 'Flag', description: 'Flag this item for attention' }\r\n    );\r\n  }\r\n  return actions;\r\n}; ","import { initializeApp } from 'firebase/app';\nimport { getAuth } from 'firebase/auth';\nimport { getFirestore } from 'firebase/firestore';\nimport React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n} from '@dnd-kit/core';\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n  horizontalListSortingStrategy,\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\nimport { restrictToHorizontalAxis } from '@dnd-kit/modifiers'; // Import the modifier\nimport { StockItem, ItemStatus, ActivityEvent, ActivityEventType, ActionDefinition } from './types'; // Import the interface\nimport AddItemForm from './AddItemForm'; // Import the form component\nimport ItemDetailModal from './ItemDetailModal'; // Import the details modal\nimport ReportIssueModal from './ReportIssueModal'; // Import the new modal\nimport AddUpdateModal from './AddUpdateModal'; // Import the new modal\nimport ResolveIssueModal from './ResolveIssueModal'; // Import the new modal\nimport TableSettingsModal from './TableSettingsModal'; // Import the new modal\nimport UserActivityView from './UserActivityView'; // Import the new component\nimport {\n  collection,\n  doc,\n  addDoc,\n  updateDoc,\n  serverTimestamp,\n} from 'firebase/firestore';\nimport { User as FirebaseUser } from \"firebase/auth\"; // Import Auth related types and functions\nimport { LogActionData } from 'shell-log-service'; // Import only the type, not the function\nimport { Box, IconButton, Typography, Menu, MenuItem, LinearProgress, Alert, useTheme, useMediaQuery, Paper, Card, CardContent, Table, TableBody, TableCell, TableContainer, TableHead, TableRow, ListItemIcon, ListItemText } from '@mui/material'; // Removed unused Dialog*, List*, MuiSwitch, CardActions\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport FlagIcon from '@mui/icons-material/Flag';\nimport ArchiveIcon from '@mui/icons-material/Archive';\nimport UnarchiveIcon from '@mui/icons-material/Unarchive';\nimport ReportProblemIcon from '@mui/icons-material/ReportProblem';\nimport NoteAddIcon from '@mui/icons-material/NoteAdd';\nimport { db, auth } from 'shell/firebase'; // IMPORT SHARED INSTANCES FROM SHELL\nimport { useStockItems } from './hooks/useStockItems'; // IMPORT THE HOOK\nimport StockItemList from './StockItemList'; // IMPORT THE NEW COMPONENT\nimport { ColumnConfig } from './StockItemList'; // Import ColumnConfig from the new location\nimport FilterControls from './FilterControls'; // IMPORT FilterControls\nimport { removeUndefinedFields, createActivityEvent } from './utils'; // isItemLate not used directly in ToolApp\nimport { ALL_COLUMNS, DEFAULT_VISIBLE_COLUMN_IDS, LOCAL_STORAGE_KEY_VISIBLE_COLUMNS, getAvailableActions } from './config';\nimport TopBar from './TopBar'; // IMPORT TopBar\nimport { ActionMenu } from './ActionMenu'; // IMPORT ActionMenu component\n\nconsole.log('[IncomingTool] ToolApp.tsx: Top level, imported db is:', db); // Log db right after import\n\n// Define the props interface for ToolApp\nexport interface ToolAppProps {\n  user: FirebaseUser | null; // Use FirebaseUser type\n  org: any; // Replace 'any' with a specific org type if available\n  permissions: string[];\n  logAction?: (data: LogActionData) => Promise<void>; // Add logAction prop\n}\n\n// --- Main Tool Component ---\n\nconst ToolApp: React.FC<ToolAppProps> = ({ user, org, permissions, logAction }) => {\n  // Log received props, especially logAction\n  console.log('ToolApp Props Received:', { user, orgId: org?.id, permissions, logActionExists: !!logAction });\n  console.log('ToolApp using imported db:', db); // Log the imported db instance\n  console.log('ToolApp using imported auth:', auth); // Log the imported auth instance\n\n  // --- Use the custom hook for item data and filtering --- \n  const {\n    items, // Use 'items' which represents the filtered list\n    allItems, // Represents non-archived items from the hook\n    archivedItems, // Get archived items from the hook state\n    loading,\n    error,\n    searchTerm,\n    currentFilter,\n    showFlaggedOnly,\n    setSearchTerm,\n    setCurrentFilter,\n    setShowFlaggedOnly,\n    setError // Use the setError from the hook\n  } = useStockItems(org?.id);\n\n  // Log hook return values for debugging\n  console.log('[IncomingTool] useStockItems returned:', { loading, error, items_length: items?.length, allItems_length: allItems?.length, currentFilter, showFlaggedOnly, searchTerm });\n\n  // --- END hook usage ---\n  \n  // --- State Variables remaining in ToolApp ---\n  const [selectedItemDetails, setSelectedItemDetails] = useState<StockItem | null>(null); \n  const [isAddItemModalOpen, setIsAddItemModalOpen] = useState<boolean>(false); \n  const [editingItem, setEditingItem] = useState<StockItem | null>(null); \n  const [reportingIssueItem, setReportingIssueItem] = useState<StockItem | null>(null);\n  const [addingUpdateItem, setAddingUpdateItem] = useState<StockItem | null>(null);\n  const [resolvingIssueItem, setResolvingIssueItem] = useState<StockItem | null>(null);\n  const [isSettingsModalOpen, setIsSettingsModalOpen] = useState(false); \n  const [itemForNote, setItemForNote] = useState<StockItem | null>(null); \n  const [isUserActivityViewOpen, setIsUserActivityViewOpen] = useState<boolean>(false); \n  const [visibleColumnIds, setVisibleColumnIds] = useState<Array<ColumnConfig['id']>>(() => {\n    try {\n      const stored = localStorage.getItem(LOCAL_STORAGE_KEY_VISIBLE_COLUMNS);\n      const parsed = stored ? JSON.parse(stored) : DEFAULT_VISIBLE_COLUMN_IDS;\n      return Array.isArray(parsed) ? parsed : DEFAULT_VISIBLE_COLUMN_IDS;\n    } catch (error) {\n      console.error(\"Error reading visible columns from localStorage\", error);\n      return DEFAULT_VISIBLE_COLUMN_IDS;\n    }\n  });\n  // Action Menu State\n  const [openMenuId, setOpenMenuId] = useState<string | null>(null);\n  const [menuAnchorEl, setMenuAnchorEl] = useState<null | HTMLElement>(null);\n  // --- END remaining state ---\n  \n  // Save visible columns to localStorage effect\n  useEffect(() => {\n        localStorage.setItem(LOCAL_STORAGE_KEY_VISIBLE_COLUMNS, JSON.stringify(visibleColumnIds));\n  }, [visibleColumnIds]);\n\n  // Derive visible columns config\n  const visibleColumns = visibleColumnIds\n      .map(id => ALL_COLUMNS.find(col => col.id === id))\n      .filter((col): col is ColumnConfig => col !== undefined); \n\n  // Centralized function to update item - uses `allItems` from hook now\n  const updateItemAndLog = useCallback(async (itemId: string, userId: string | undefined, changes: Partial<StockItem>, event: ActivityEvent) => {\n    console.log('[IncomingTool] updateItemAndLog: Checking db and org.id:', { db_instance: db, org_id: org?.id });\n    if (!db || !org?.id || !userId) {\n      console.error('Cannot update item: Missing configuration.', { db: !!db, orgId: org?.id, userId });\n      setError('Cannot update item: Missing configuration.'); // Use setError from hook\n      return;\n    }\n    console.log(`[IncomingTool] updateItemAndLog: Preparing to update item ${itemId} in org ${org.id}`);\n    const itemRef = doc(db, 'orgs', org.id, 'stockItems', itemId);\n    const itemBefore = allItems.find(i => i.id === itemId); // Find in allItems from hook\n    if (!itemBefore) {\n        console.error(`Item ${itemId} not found for update`);\n        setError(`Item ${itemId} not found.`);\n        return;\n    }\n\n    // Combine updates with new activity event and timestamp\n    const finalUpdates = removeUndefinedFields({\n      ...changes,\n      lastUpdated: serverTimestamp(),\n    });\n\n    const itemAfter = { ...itemBefore, ...finalUpdates }; // Approximate state after update\n\n    try {\n      await updateDoc(itemRef, finalUpdates);\n      console.log(`Item ${itemId} updated successfully.`);\n\n      // Log the generic update action\n      console.log('updateItemAndLog: Attempting to log action. logAction available?', !!logAction);\n      if (logAction) {\n        // Determine standardized action name\n        let actionName: string;\n        try {\n          if (event.type === 'EDITED') {\n            actionName = 'item.update.fields';\n          } else if (event.type === 'FLAG_TOGGLED') {\n            actionName = 'item.update.flag';\n          } else if (event.type === 'STATUS_CHANGED') {\n            const newStatus = event.details?.newStatus?.toLowerCase() || 'unknown';\n            actionName = `item.update.status.${newStatus}`;\n          } else if (event.type === 'ISSUE_REPORTED') {\n            actionName = 'item.update.issue.report';\n          } else if (event.type === 'ISSUE_RESOLVED') {\n            actionName = 'item.update.issue.resolve';\n          } else if (event.type === 'ISSUE_UPDATE_ADDED') {\n            actionName = 'item.update.issue.update';\n          } else if (event.type === 'NOTE_ADDED') {\n            actionName = 'item.add_note';\n          } else {\n            actionName = event.type; // Fallback\n          }\n        } catch (nameError) {\n          console.error('Error deriving action name for logging:', nameError);\n          actionName = event.type;\n        }\n\n        // Construct the data payload ensuring types match LogActionData\n        const logData: LogActionData = {\n           orgId: org.id,\n           toolKey: 'incomingtool',\n           action: actionName, // actionName is now guaranteed to be string\n           entityPath: `stockItems/${itemId}`,\n           // Conditionally add before/after/details if they exist\n           ...(itemBefore !== undefined && { before: itemBefore }),\n           ...(itemAfter !== undefined && { after: itemAfter }),\n           ...(event.details !== undefined && { details: event.details })\n        };\n\n        await logAction(logData); // Pass the correctly typed object\n\n      }\n\n    } catch (e) {\n      console.error(`Error updating item ${itemId}:`, e);\n      setError(`Failed to update item: ${(e as Error).message}`);\n      throw e; // Re-throw error to be caught by calling handler if needed\n    }\n  }, [org, allItems, logAction, setError]); // Add setError to dependencies\n\n  // Item action handler\n  const handleItemAction = useCallback(async (itemId: string, action: ActionDefinition) => {\n    console.log(`Action: ${action.label} on item ${itemId}`);\n    // Search non-archived items first\n    const item = allItems.find(i => i.id === itemId); \n    \n    if (!item) {\n        // If not found in non-archived and action is Unarchive, search archived items\n        if (action.id === 'Unarchive Item') {\n            // Use archivedItems state variable here\n            const archivedItem = archivedItems.find(i => i.id === itemId);\n            if (!archivedItem) {\n                console.error(`Item ${itemId} not found in non-archived or archived items.`);\n                setError(`Item ${itemId} not found.`);\n                return;\n            }\n            // If found in archived, proceed with unarchive logic using archivedItem\n            const restoredStatus = archivedItem.previousStatus || 'Delivered'; // Fallback to Delivered\n            await updateItemAndLog(itemId, user?.uid,\n              { currentStatus: restoredStatus, previousStatus: undefined }, \n              createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: 'Archived', newStatus: restoredStatus })\n            );\n        } else {\n             // If not found and action is not Unarchive, it's an error\n             console.error(`Item ${itemId} not found for action ${action.id}.`);\n             setError(`Item ${itemId} not found.`);\n        }\n        return; // Exit handler\n    }\n\n    // If item WAS found in non-archived list, proceed with normal actions\n    switch (action.id) {\n      case 'Edit Item':\n        setEditingItem(item);\n        setIsAddItemModalOpen(true);\n        break;\n      case 'Flag Item':\n      case 'Unflag Item':\n        const newFlagState = action.id === 'Flag Item';\n        await updateItemAndLog(itemId, user?.uid, \n          { isFlagged: newFlagState }, \n          createActivityEvent(user?.uid || '', 'FLAG_TOGGLED', { isFlagged: newFlagState })\n        );\n        break;\n      case 'Mark as Delivered':\n        if (item.currentStatus !== 'Delivered') {\n          await updateItemAndLog(itemId, user?.uid,\n            { currentStatus: 'Delivered', dateDelivered: new Date().toISOString() },\n            createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: item.currentStatus, newStatus: 'Delivered' })\n          );\n        }\n        break;\n      case 'Archive':\n         if (item.currentStatus !== 'Archived') {\n          // Store previous status before archiving\n          const prevStatus = item.currentStatus;\n          await updateItemAndLog(itemId, user?.uid, \n            { currentStatus: 'Archived', previousStatus: prevStatus }, // Save previous status\n            createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: prevStatus, newStatus: 'Archived' })\n          );\n         }\n        break;\n      case 'Unarchive Item': // Add case for unarchiving\n        if (item.currentStatus === 'Archived') {\n           const restoredStatus = item.previousStatus || 'Delivered'; // Fallback to Delivered\n           await updateItemAndLog(itemId, user?.uid,\n             { currentStatus: restoredStatus, previousStatus: undefined }, \n             createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: 'Archived', newStatus: restoredStatus })\n           );\n        }\n        break;\n      case 'Add Note': // New case for adding a general note\n        setItemForNote(item); // Set the item context for the modal\n        break;\n      case 'Report Issue': // Close detail view & open report modal\n        setSelectedItemDetails(null);\n        setReportingIssueItem(item);\n        break;\n      case 'Resolve Issue': // Close detail view & open resolve modal\n        setSelectedItemDetails(null);\n        setResolvingIssueItem(item);\n        break;\n      case 'Add Issue Update': // Close detail view & open add-note modal\n        setSelectedItemDetails(null);\n        setAddingUpdateItem(item);\n        break;\n      case 'View Details': // Open item detail modal\n        setSelectedItemDetails(item);\n        break;\n      // Default case for actions handled elsewhere or needing no state change here (like View Details)\n    }\n  }, [user?.uid, allItems, archivedItems, updateItemAndLog, setEditingItem, setIsAddItemModalOpen, setReportingIssueItem, setAddingUpdateItem, setResolvingIssueItem, setSelectedItemDetails, setError]);\n\n  // --- RESTORED MODAL HANDLERS ---\n  const handleSaveItem = async (newItemOrUpdate: Omit<StockItem, 'id' | 'activityLog' | 'lastUpdated' | 'currentStatus' | 'dateDelivered'>, itemId?: string) => { \n    if (!user?.uid || !org?.id || !db) {\n      setError('Missing user, org, or DB connection.');\n      return;\n    }\n\n    // We need to handle potential missing fields if editing vs adding\n    // This might require more complex logic or adjusting AddItemForm\n    // For now, assume newItemOrUpdate contains necessary fields, add placeholders for required ones if adding\n    const dataToSave = removeUndefinedFields({\n      ...newItemOrUpdate,\n          lastUpdated: serverTimestamp(),\n        });\n\n    try {\n      if (itemId) { // Editing existing item\n        console.log(`[IncomingTool] handleSaveItem: Updating item ${itemId}`);\n        const itemRef = doc(db, 'orgs', org.id, 'stockItems', itemId);\n        // Use correct field name: changedFields\n        const event = createActivityEvent(user.uid, 'EDITED', { changedFields: Object.keys(newItemOrUpdate) });\n        // Pass the potentially incomplete data - ensure updateItemAndLog handles partial updates\n        await updateItemAndLog(itemId, user.uid, dataToSave, event); \n      } else { // Adding new item\n        console.log('[IncomingTool] handleSaveItem: Adding new item');\n        const collectionRef = collection(db, 'orgs', org.id, 'stockItems');\n        // Add required fields not expected from AddItemForm's type inference\n        const completeNewItemData = {\n          ...dataToSave,\n          currentStatus: 'Pending Delivery' as ItemStatus, // Default status\n          activityLog: [createActivityEvent(user.uid, 'CREATED')],\n          orgId: org.id,\n        };\n        const docRef = await addDoc(collectionRef, completeNewItemData);\n        console.log('[IncomingTool] handleSaveItem: Item added with ID:', docRef.id);\n        if (logAction) {\n          await logAction({\n            orgId: org.id,\n            toolKey: 'incomingtool',\n            action: 'item.create',\n            entityPath: `stockItems/${docRef.id}`,\n            after: { id: docRef.id, ...completeNewItemData }\n          });\n        }\n      }\n      setIsAddItemModalOpen(false);\n    setEditingItem(null);\n    } catch (e) {\n      console.error(\"Error saving item:\", e);\n      setError(`Failed to save item: ${(e as Error).message}`);\n    }\n  };\n\n  const handleSaveReportIssue = async (itemId: string, issueDescValue: string, userId: string) => { // Renamed param\n    // Use correct field name: issueDescription\n    const event = createActivityEvent(userId, 'ISSUE_REPORTED', { issueDescription: issueDescValue });\n    await updateItemAndLog(itemId, userId, \n      { currentStatus: 'Issue', issueDescription: issueDescValue }, // Save the description\n      event\n    );\n    setReportingIssueItem(null); // Close modal\n  };\n\n  const handleSaveIssueUpdate = async (itemId: string, note: string, userId: string) => {\n    const event = createActivityEvent(userId, 'ISSUE_UPDATE_ADDED', { note }); // 'note' is correct\n    await updateItemAndLog(itemId, userId, \n        { /* No direct field changes */ }, \n        event\n    );\n    console.warn(\"Issue update note logged, but not stored directly on item field in this basic implementation.\");\n    setAddingUpdateItem(null); // Close modal\n  };\n\n  const handleSaveResolveIssue = async (itemId: string, resolutionNoteValue: string, userId: string) => { \n    const item = allItems.find(i => i.id === itemId);\n    if (!item) return;\n    const resolvedStatus: ItemStatus = 'Delivered'; // Simple assumption\n    // Use correct field name: resolutionOutcome\n    const event = createActivityEvent(userId, 'ISSUE_RESOLVED', { resolutionOutcome: resolutionNoteValue });\n    await updateItemAndLog(itemId, userId, \n      { currentStatus: resolvedStatus, issueDescription: 'Resolved: ' + resolutionNoteValue }, \n      event\n    );\n    setResolvingIssueItem(null); // Close modal\n  };\n\n  const handleSaveNote = async (itemId: string, note: string, userId: string) => {\n    const event = createActivityEvent(userId, 'NOTE_ADDED', { note }); // 'note' is correct\n     await updateItemAndLog(itemId, userId, \n        { /* No direct field changes */ }, \n        event\n     );\n     console.warn(\"General note logged, but not stored directly on item field.\");\n    setItemForNote(null); // Close modal\n  };\n  // --- END RESTORED MODAL HANDLERS ---\n\n  // Other handlers (handleSaveReportIssue, handleSaveIssueUpdate, etc.) - use `allItems` from hook if needed\n  // ... other handlers ...\n\n  const handleViewDetails = useCallback((itemId: string) => {\n    const item = allItems.find(i => i.id === itemId); // Find in allItems from hook\n    if (!item) {\n      console.error(\"Item not found for viewing details:\", itemId);\n      setError('Item not found.'); // Use setError state setter\n      return;\n    }\n    console.log(\"Viewing details for:\", item);\n    if (!org) {\n      console.error(\"Org ID is missing, cannot fetch logs.\");\n      setError('Organization context is missing.'); // Use setError state setter\n      return;\n    }\n    setSelectedItemDetails(item); // Use setSelectedItemDetails state setter\n    // TODO: Focus management - consider focusing the modal or close button\n  }, [org, allItems, setError]); // Add setError if used\n\n  // --- Handler for opening the action menu ---\n  const handleMenuOpen = (event: React.MouseEvent<HTMLElement>, item: StockItem) => { // Modified to accept 'item'\n    setMenuAnchorEl(event.currentTarget);\n    setOpenMenuId(item.id); // Use item.id here\n  };\n\n  // --- RENDER LOGIC --- \n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\n\n  // --- Mobile Item Card Component (REMOVED - Moved to StockItemList) ---\n  // interface MobileItemCardProps { ... } // REMOVED\n  // const MobileItemCard: React.FC<MobileItemCardProps> = ({ ... }) => { ... }; // REMOVED\n\n  // renderActionMenu\n  const renderActionMenu = () => {\n    if (!openMenuId) return null;\n    const item = allItems.find(i => i.id === openMenuId); // Find in allItems from hook\n    if (!item) return null; // Handle case where item might not be found\n    const actions = getAvailableActions(item.currentStatus, item.isFlagged);\n    return (\n      <ActionMenu\n        itemId={item.id}\n        actions={actions}\n        onActionSelected={handleItemAction}\n        anchorEl={menuAnchorEl}\n        open={Boolean(menuAnchorEl && openMenuId === item.id)} // Ensure menu opens for the correct item\n        onClose={() => setMenuAnchorEl(null)} // Simple close handler\n      />\n    );\n  };\n\n  // Main return statement\n  return (\n    <Box sx={{ p: isMobile ? 1 : 2 }}>\n      {/* --- USE TopBar Component --- */}\n      <TopBar \n        onAddItem={() => {\n          setEditingItem(null); // Ensure adding\n          setIsAddItemModalOpen(true);\n        }}\n        onOpenSettings={() => setIsSettingsModalOpen(true)}\n        onOpenActivity={() => setIsUserActivityViewOpen(true)}\n      />\n      {/* --- END TopBar Component --- */}\n\n      {/* Error/Loading Messages */} \n      {error && <Alert severity=\"error\" onClose={() => setError(null)} sx={{ /* ... */ }}>{error}</Alert>} \n      {loading && <LinearProgress sx={{ position: 'absolute', top: 0, left: 0, right: 0 }} />} \n      \n      {/* --- USE FilterControls Component --- */}\n      <FilterControls \n        searchTerm={searchTerm}\n        onSearchTermChange={setSearchTerm}\n        showFlaggedOnly={showFlaggedOnly}\n        onShowFlaggedOnlyChange={setShowFlaggedOnly}\n        currentFilter={currentFilter}\n        onCurrentFilterChange={setCurrentFilter}\n      />\n      {/* --- END FilterControls Component --- */}\n\n      {/* Stock List Display */} \n      <StockItemList \n        items={items} \n        loading={loading}\n        isMobile={isMobile}\n        visibleColumns={visibleColumns}\n        visibleColumnIds={visibleColumnIds}\n        onColumnOrderChange={(newOrder) => setVisibleColumnIds(newOrder)} // Pass setter directly or wrapped handler\n        onViewDetails={handleViewDetails}\n        onMenuOpen={handleMenuOpen}\n      />\n      \n      {/* Modals */}\n      {/* Add/Edit Item Modal */}\n        <AddItemForm \n        isOpen={isAddItemModalOpen}\n        onClose={() => setIsAddItemModalOpen(false)}\n        onSave={handleSaveItem} \n        initialData={editingItem}\n      />\n\n      {/* Item Details Modal */}\n      {selectedItemDetails && (\n        <ItemDetailModal \n          isOpen={!!selectedItemDetails}\n          onClose={() => setSelectedItemDetails(null)}\n          item={selectedItemDetails} \n          orgId={org?.id}\n          onActionSelected={handleItemAction}\n        />\n      )}\n\n      {/* Report Issue Modal */}\n      {reportingIssueItem && (\n        <ReportIssueModal \n          isOpen={!!reportingIssueItem}\n          onClose={() => setReportingIssueItem(null)} \n          item={reportingIssueItem}\n          onSubmit={(description: string) => \n            handleSaveReportIssue(reportingIssueItem.id, description, user?.uid || '')\n          }\n        />\n      )}\n      \n      {/* Add Issue Update Modal - Rename onSave to onSubmit */}\n      {addingUpdateItem && (\n        <AddUpdateModal \n           isOpen={!!addingUpdateItem}\n          onClose={() => setAddingUpdateItem(null)} \n           item={addingUpdateItem} // REVERTED to 'item'\n           // Pass lambda calling correct handler\n           onSubmit={(note: string) => \n            handleSaveIssueUpdate(addingUpdateItem.id, note, user?.uid || '')\n           }\n           // userId={user?.uid} // REMOVED\n         />\n      )}\n\n      {/* Resolve Issue Modal - Rename onSave to onSubmit */}\n      {resolvingIssueItem && (\n        <ResolveIssueModal \n            isOpen={!!resolvingIssueItem}\n          onClose={() => setResolvingIssueItem(null)} \n            item={resolvingIssueItem} // REVERTED to 'item'\n            // Pass lambda calling correct handler\n            onSubmit={(outcome: string, note?: string) => \n              handleSaveResolveIssue(resolvingIssueItem.id, outcome, user?.uid || '') // Pass item id, outcome as note, user id\n            }\n            // userId={user?.uid} // REMOVED\n          />\n      )}\n\n      {/* Add Note Modal (if separate from AddUpdateModal) - Rename onSave to onSubmit */}\n      {itemForNote && (\n        <AddUpdateModal \n            isOpen={!!itemForNote}\n            onClose={() => setItemForNote(null)} \n            item={itemForNote} // REVERTED to 'item'\n             // Pass lambda calling correct handler\n            onSubmit={(note: string) => \n              handleSaveNote(itemForNote.id, note, user?.uid || '')\n            }\n            // userId={user?.uid} // REMOVED\n            // isNoteOnly={true} // REMOVED - AddUpdateModal doesn't have this prop\n         />\n      )}\n\n      {/* Table Settings Modal - Fix props */}\n      <TableSettingsModal\n        isOpen={isSettingsModalOpen}\n        onClose={() => setIsSettingsModalOpen(false)}\n        allColumns={ALL_COLUMNS.filter(c => c.id !== 'actions')} // Exclude 'actions' column\n        initialVisibleColumns={visibleColumns} // RENAMED prop, using derived object array\n        onSave={setVisibleColumnIds} // RENAMED prop, handler is correct\n      />\n\n      {/* User Activity View Drawer/Modal - Fix props */}\n        <UserActivityView\n        isOpen={isUserActivityViewOpen}\n          db={db}\n        orgId={org?.id}\n          onClose={() => setIsUserActivityViewOpen(false)}\n        />\n      {/* --- END RESTORED MODALS --- */}\n\n      {/* Render Action Menu */}\n      {renderActionMenu()}\n    </Box>\n  );\n}\n\nexport default ToolApp;","import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Typography\n} from '@mui/material';\nimport { StockItem } from './types'; // Import StockItem if needed for context\n\ninterface ReportIssueModalProps {\n  isOpen: boolean;\n  item: StockItem; // Pass the item for context\n  onSubmit: (description: string) => void;\n  onClose: () => void;\n}\n\nconst ReportIssueModal: React.FC<ReportIssueModalProps> = ({ isOpen, item, onSubmit, onClose }) => {\n  const [description, setDescription] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    if (!description.trim()) {\n      setError('Please enter a description of the issue.');\n      return;\n    }\n    onSubmit(description);\n    onClose(); // Close modal after successful submission\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Report Issue for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        <TextField\n          autoFocus\n          margin=\"dense\"\n          id=\"issueDescription\"\n          label=\"Describe the Issue *\"\n          type=\"text\"\n          fullWidth\n          multiline\n          rows={4}\n          variant=\"outlined\"\n          value={description}\n          onChange={(e) => {\n            setDescription(e.target.value);\n            if (error) setError(''); // Clear error on type\n          }}\n          error={!!error}\n          helperText={error || 'Please provide details about the problem.'}\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Issue Report\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ReportIssueModal;","import { StockItem, ItemStatus, ActivityEvent, ActivityEventType } from './types';\r\n\r\n// Utility to remove undefined fields before saving to Firestore\r\nexport function removeUndefinedFields(obj: Record<string, any>) {\r\n  return Object.fromEntries(Object.entries(obj).filter(([_, v]) => v !== undefined));\r\n}\r\n\r\n// Function to check if an item is considered late\r\nexport const isItemLate = (item: StockItem): boolean => {\r\n  if (item.currentStatus !== 'Pending Delivery') {\r\n    return false;\r\n  }\r\n  // Ensure orderDate is valid before creating a Date object\r\n  if (!item.orderDate || isNaN(new Date(item.orderDate).getTime())) {\r\n      console.warn(\"Invalid or missing orderDate for late check:\", item.id);\r\n      return false; \r\n  }\r\n  const orderDate = new Date(item.orderDate);\r\n  const sevenDaysAgo = new Date();\r\n  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\r\n  return orderDate < sevenDaysAgo;\r\n};\r\n\r\n// Function to create a new ActivityEvent\r\nexport const createActivityEvent = (\r\n  userId: string, \r\n  type: ActivityEventType,\r\n  details: ActivityEvent['details'] = {}\r\n): ActivityEvent => ({\r\n  timestamp: new Date().toISOString(),\r\n  type,\r\n  userId,\r\n  details,\r\n}); ","import React, { useState, useEffect, Fragment } from 'react';\nimport { \n  getFirestore, collection, query, where, orderBy, limit, onSnapshot, Timestamp, \n  getDocs, QuerySnapshot, QueryDocumentSnapshot, FirestoreError, Firestore \n} from 'firebase/firestore';\nimport { \n  Dialog, DialogTitle, DialogContent, DialogActions, \n  Button, Typography, Box, CircularProgress, List, ListItem, ListItemText, Divider \n} from '@mui/material';\nimport { LogActionData, ActionDefinition } from './types'; \n\ninterface UserActivityViewProps {\n  isOpen: boolean;\n  db: Firestore;\n  orgId: string;\n  onClose: () => void;\n}\n\nconst getActionDescription = (log: LogActionData): string => {\n  switch (log.action) {\n    case 'item.create':\n      return 'Item created';\n    case 'item.update.fields': {\n      if (log.before && log.after) {\n        const fields = (log.details?.changedFields as string[] | undefined)\n          || Object.keys(log.after).filter(k => JSON.stringify(log.before?.[k]) !== JSON.stringify(log.after?.[k]));\n        if (fields.length) {\n          const changes = fields.map(f => `${f}: ${log.before?.[f]} → ${log.after?.[f]}`);\n          return `Edited ${changes.join(', ')}`;\n        }\n      }\n      const simple = (log.details?.changedFields as string[] | undefined)?.join(', ');\n      return simple ? `Edited fields: ${simple}` : 'Item edited';\n    }\n    default:\n      if (log.action.startsWith('item.update.status.')) {\n        const oldStat = log.details?.previousStatus || (log.before?.currentStatus as string) || 'Unknown';\n        const newStat = log.details?.newStatus || log.action.replace('item.update.status.', '');\n        return `Status changed: ${oldStat} → ${newStat}`;\n      }\n      if (log.action === 'item.update.flag') {\n        const flagged = log.details?.isFlagged;\n        return flagged ? 'Item flagged' : 'Item unflagged';\n      }\n      if (log.action === 'item.update.issue.report') {\n        return `Issue reported: ${log.details?.description || log.details?.issueDescription || ''}`;\n      }\n      if (log.action === 'item.update.issue.update') {\n        return `Issue update added: ${log.details?.note || ''}`;\n      }\n      if (log.action === 'item.update.issue.resolve') {\n        return `Issue resolved: ${log.details?.resolutionOutcome || ''}`;\n      }\n      if (log.action === 'item.add_note') {\n        return `Note added: ${log.details?.note || ''}`;\n      }\n      return log.action;\n  }\n};\n\nconst UserActivityView: React.FC<UserActivityViewProps> = ({ isOpen, db, orgId, onClose }) => {\n  const [logs, setLogs] = useState<LogActionData[]>([]);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [error, setError] = useState<string | null>(null);\n  const [members, setMembers] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    if (!orgId) return;\n    const membersRef = collection(db, `orgs/${orgId}/members`);\n    getDocs(membersRef)\n      .then((snapshot: QuerySnapshot) => {\n        const map: Record<string, string> = {};\n        snapshot.docs.forEach((doc: QueryDocumentSnapshot) => {\n          const data: any = doc.data();\n          map[doc.id] = data.email || doc.id;\n        });\n        setMembers(map);\n      })\n      .catch((err: FirestoreError) => console.error('Error fetching members:', err));\n  }, [orgId, db, setMembers]);\n\n  useEffect(() => {\n    if (!orgId) {\n      setError('Organization ID is required.');\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    const logsRef = collection(db, `orgs/${orgId}/logs`);\n    const q = query(\n      logsRef,\n      where('tool', '==', 'incomingtool'),\n      orderBy('ts', 'desc'),\n      limit(100)\n    );\n\n    const unsubscribe = onSnapshot(q, (snapshot: QuerySnapshot) => {\n      const fetchedLogs = snapshot.docs.map(doc => {\n        const d = doc.data() as any;\n        return {\n          orgId,\n          toolKey: d.toolKey || d.tool,\n          action: d.action,\n          entityPath: d.entityPath,\n          timestamp: d.timestamp || d.ts,\n          userId: d.userId || d.uid,\n          userEmail: d.email, \n          before: d.before,\n          after: d.after,\n          details: d.details,\n        } as LogActionData;\n      });\n      const relevantLogs = fetchedLogs.filter(log => log.action !== 'app-loaded');\n      setLogs(relevantLogs);\n      setLoading(false);\n    }, (err) => {\n      console.error(\"Error fetching user activity logs: \", err); \n      const firestoreError = err as FirestoreError; \n      setError(`Failed to load activity logs: ${firestoreError.message}`);\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [orgId, db, setLogs]);\n\n  const renderLogEntryContent = (log: LogActionData) => {\n    const time = log.timestamp instanceof Timestamp\n      ? log.timestamp.toDate().toLocaleString()\n      : typeof log.timestamp === 'string'\n      ? new Date(log.timestamp).toLocaleString()\n      : 'Invalid Date';\n    const user = log.userEmail || members[log.userId || ''] || log.userId || 'system';\n    const actionDesc = getActionDescription(log);\n    const parts = log.entityPath.split('/');\n    const entityId = parts.length >= 2 ? parts[1] : '';\n    const qty = log.before?.quantity;\n    const name = log.before?.productName as string | undefined;\n    const entityLabel = qty && name\n      ? `${qty}x ${name}`\n      : ((log.before?.deliveryName as string) || name || entityId);\n\n    return (\n      <ListItemText\n        primary={\n          <Fragment>\n            <Typography sx={{ display: 'inline' }} component=\"span\" variant=\"body2\" color=\"text.primary\">\n              {time} - {actionDesc} by {user}\n            </Typography>\n            <Typography \n              component=\"span\" \n              variant=\"body2\" \n              sx={{ ml: 1, color: 'text.secondary' }}\n            >\n              {entityLabel}\n            </Typography>\n          </Fragment>\n        }\n      />\n    );\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"md\" fullWidth scroll=\"paper\">\n      <DialogTitle>\n        <Typography variant=\"h6\">User Activity Log</Typography>\n        <Typography variant=\"caption\">Last 100 entries</Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {loading && (\n          <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '200px' }}> \n            <CircularProgress />\n          </Box>\n        )}\n        {error && (\n          <Typography color=\"error\" sx={{ textAlign: 'center', mt: 2 }}>\n            {error}\n          </Typography>\n        )}\n        {!loading && !error && (\n          <List dense sx={{ width: '100%', bgcolor: 'background.paper', p: 0 }}> \n            {logs.length === 0 ? (\n              <ListItem>\n                <ListItemText primary=\"No activity logs found.\" />\n              </ListItem>\n            ) : (\n              logs.map((log, index) => (\n                <Fragment key={`${log.timestamp}-${index}-${log.action}`}> \n                  <ListItem alignItems=\"flex-start\" sx={{ py: 1.5 }}> \n                    {renderLogEntryContent(log)}\n                  </ListItem>\n                  {index < logs.length - 1 && <Divider variant=\"inset\" component=\"li\" />} \n                </Fragment>\n              ))\n            )}\n          </List>\n        )}\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"primary\">\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default UserActivityView;\n","import React, { useState, useEffect } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, Typography, FormGroup, FormControlLabel, Checkbox, Box\n} from '@mui/material';\nimport { ColumnConfig } from './StockItemList'; // Update import location for ColumnConfig\n\ninterface TableSettingsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  allColumns: ColumnConfig[];\n  initialVisibleColumns: ColumnConfig[];\n  onSave: (newVisibleColumnIds: Array<ColumnConfig['id']>) => void;\n}\n\n// --- Main Modal Component ---\nconst TableSettingsModal: React.FC<TableSettingsModalProps> = ({\n  isOpen,\n  onClose,\n  allColumns,\n  initialVisibleColumns,\n  onSave\n}) => {\n  // State to track checked status of each column ID\n  const [checkedState, setCheckedState] = useState<Record<ColumnConfig['id'], boolean>>(() =>\n    // Initialize state using Object.fromEntries for correct typing\n    Object.fromEntries(\n        allColumns.map(col => [col.id, false])\n    ) as Record<ColumnConfig['id'], boolean>\n  );\n\n  // Initialize or update checked state when modal opens or initialVisibleColumns change\n  useEffect(() => {\n    if (isOpen) {\n        const visibleIds = new Set(initialVisibleColumns.map(col => col.id));\n        // Create the updated state object directly using Object.fromEntries\n        const updatedCheckedState = Object.fromEntries(\n            allColumns.map(col => [col.id, visibleIds.has(col.id)])\n        ) as Record<ColumnConfig['id'], boolean>;\n        setCheckedState(updatedCheckedState);\n    }\n  }, [isOpen, initialVisibleColumns, allColumns]);\n\n  const handleCheckboxChange = (columnId: ColumnConfig['id']) => {\n      setCheckedState(prevState => ({\n          ...prevState,\n          [columnId]: !prevState[columnId]\n      }));\n  };\n\n  const handleSaveChanges = () => {\n    // Filter all column IDs to get only the ones that are checked\n    const newVisibleColumnIds = allColumns\n        .map(col => col.id)\n        .filter(id => checkedState[id]);\n    onSave(newVisibleColumnIds); // Pass the array of visible IDs\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"xs\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Configure Table Columns</Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        <Typography variant=\"body2\" gutterBottom>\n          Select the columns you want to display:\n        </Typography>\n        <Box sx={{ maxHeight: '60vh', overflowY: 'auto', pr: 1 }}> {/* Scrollable Box */}\n          <FormGroup>\n            {allColumns.map(col => (\n              <FormControlLabel\n                key={col.id}\n                control={\n                  <Checkbox\n                    checked={checkedState[col.id] || false}\n                    onChange={() => handleCheckboxChange(col.id)}\n                    disabled={col.id === 'actions'} // Optionally disable toggling\n                  />\n                }\n                label={col.label}\n              />\n            ))}\n          </FormGroup>\n        </Box>\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSaveChanges} variant=\"contained\" color=\"primary\">\n          Save Settings\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default TableSettingsModal;","import React from 'react';\r\nimport {\r\n  DndContext,\r\n  closestCenter,\r\n  KeyboardSensor,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  DragEndEvent,\r\n} from '@dnd-kit/core';\r\nimport {\r\n  arrayMove,\r\n  SortableContext,\r\n  sortableKeyboardCoordinates,\r\n  useSortable,\r\n  horizontalListSortingStrategy,\r\n} from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\nimport { restrictToHorizontalAxis } from '@dnd-kit/modifiers';\r\nimport { StockItem } from './types'; // Assuming types.ts is in the same directory or adjust path\r\nimport {\r\n  Box,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow,\r\n  Paper,\r\n  Typography,\r\n  IconButton,\r\n  Card, \r\n  CardContent,\r\n  useTheme\r\n} from '@mui/material';\r\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\r\nimport FlagIcon from '@mui/icons-material/Flag';\r\n\r\n// --- Reused Interfaces/Types (from ToolApp) ---\r\nexport interface ColumnConfig { // Moved here\r\n  id: keyof StockItem | 'actions';\r\n  label: string;\r\n}\r\n\r\n// --- Draggable Header Component (Moved) ---\r\ninterface DraggableHeaderProps {\r\n  column: ColumnConfig;\r\n}\r\n\r\nconst DraggableHeader: React.FC<DraggableHeaderProps> = ({ column }) => {\r\n  const {\r\n    attributes,\r\n    listeners,\r\n    setNodeRef,\r\n    transform,\r\n    transition,\r\n    isDragging,\r\n  } = useSortable({ id: column.id });\r\n\r\n  const style: React.CSSProperties = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition,\r\n    opacity: isDragging ? 0.5 : 1,\r\n    touchAction: 'none',\r\n  };\r\n\r\n  const isNumeric = ['quantity', 'pricePerItem'].includes(column.id);\r\n\r\n  return (\r\n    <TableCell \r\n      ref={setNodeRef} \r\n      component=\"th\"\r\n      scope=\"col\" \r\n      style={style} \r\n      {...attributes} \r\n      {...listeners}\r\n      align={isNumeric ? 'right' : 'left'}\r\n      sx={{ \r\n        fontWeight: 'bold', \r\n        cursor: 'grab', \r\n        whiteSpace: 'nowrap',\r\n        bgcolor: isDragging ? '#e0e0e0' : 'background.paper',\r\n        ...(column.id === 'isFlagged' && { width: 50, p: '6px 8px' }),\r\n        ...(column.id === 'seller' && { minWidth: 140 }),\r\n        ...(column.id === 'deliveryName' && { minWidth: 160 }),\r\n        ...(column.id === 'quantity' && { width: 80 }),\r\n        ...(column.id === 'destination' && { minWidth: 110 }),\r\n        ...(column.id === 'pricePerItem' && { width: 100 }),\r\n        ...(column.id === 'orderNumber' && { width: 110 }),\r\n        ...(column.id === 'purchaseStatus' && { width: 110 }),\r\n        ...(column.id === 'orderDate' && { width: 110 }),\r\n        ...(column.id === 'asinSku' && { width: 120 }),\r\n        ...(column.id === 'productName' && { minWidth: 160 }),\r\n        ...(column.id === 'actions' && { width: 60, p: '6px 8px' }),\r\n        ...(column.id === 'currentStatus' && { width: 100 }),\r\n      }}\r\n    >\r\n      {column.label}\r\n    </TableCell>\r\n  );\r\n};\r\n\r\n// --- Mobile Item Card Component (Moved) ---\r\ninterface MobileItemCardProps {\r\n  item: StockItem;\r\n  onViewDetails: (itemId: string) => void;\r\n  onActionClick: (event: React.MouseEvent<HTMLElement>, item: StockItem) => void; // Changed prop name to match usage\r\n  cardSx?: object; // Add optional prop for background style\r\n}\r\n\r\nconst MobileItemCard: React.FC<MobileItemCardProps> = ({ item, onViewDetails, onActionClick, cardSx }) => {\r\n  return (\r\n    <Card sx={{ mb: 2, cursor: 'pointer', ...cardSx }} onClick={() => onViewDetails(item.id)}> \r\n      <CardContent sx={{ pb: '8px !important' }}> \r\n        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n          <Box sx={{ flexGrow: 1, mr: 1 }}>\r\n            <Typography variant=\"subtitle1\" component=\"div\" sx={{ fontWeight: 'bold', lineHeight: 1.3 }}>\r\n              {item.productName || item.deliveryName || 'Unnamed Item'}\r\n            </Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\">\r\n              Status: {item.currentStatus}\r\n            </Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\">\r\n              Qty: {item.quantity ?? 'N/A'} | Seller: {item.seller || 'N/A'}\r\n            </Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ fontSize: '0.8rem' }}>\r\n              Order Date: {item.orderDate ? new Date(item.orderDate).toLocaleDateString() : 'N/A'}\r\n            </Typography>\r\n          </Box>\r\n           <IconButton size=\"small\" onClick={(e) => {\r\n             e.stopPropagation(); \r\n             onActionClick(e, item);\r\n           }} sx={{ mt: -1, mr: -1 }}> \r\n             <MoreVertIcon />\r\n           </IconButton>\r\n         </Box>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\n// --- StockItemList Component ---\r\ninterface StockItemListProps {\r\n  items: StockItem[];\r\n  loading: boolean;\r\n  isMobile: boolean;\r\n  visibleColumns: ColumnConfig[];\r\n  visibleColumnIds: Array<ColumnConfig['id']>;\r\n  onColumnOrderChange: (newColumnIds: Array<ColumnConfig['id']>) => void;\r\n  onViewDetails: (itemId: string) => void;\r\n  onMenuOpen: (event: React.MouseEvent<HTMLElement>, item: StockItem) => void;\r\n}\r\n\r\nconst StockItemList: React.FC<StockItemListProps> = ({\r\n  items,\r\n  loading,\r\n  isMobile,\r\n  visibleColumns,\r\n  visibleColumnIds,\r\n  onColumnOrderChange,\r\n  onViewDetails,\r\n  onMenuOpen\r\n}) => {\r\n  const theme = useTheme();\r\n\r\n  // --- DND Logic (Moved) ---\r\n  const sensors = useSensors(\r\n    useSensor(PointerSensor),\r\n    useSensor(KeyboardSensor, {\r\n      coordinateGetter: sortableKeyboardCoordinates,\r\n    })\r\n  );\r\n\r\n  const handleDragEnd = (event: DragEndEvent) => {\r\n    const { active, over } = event;\r\n    if (over && active.id !== over.id) {\r\n      const oldIndex = visibleColumnIds.indexOf(active.id as (keyof StockItem | 'actions'));\r\n      const newIndex = visibleColumnIds.indexOf(over.id as (keyof StockItem | 'actions'));\r\n      if (oldIndex === -1 || newIndex === -1) {\r\n        console.error('Dragged item ID not found in visible columns', { activeId: active.id, overId: over.id });\r\n        return;\r\n      }\r\n      const newOrder = arrayMove(visibleColumnIds, oldIndex, newIndex);\r\n      onColumnOrderChange(newOrder); // Call prop to update state in parent\r\n    }\r\n  };\r\n  // --- END DND Logic ---\r\n\r\n  // Helper function to safely access potentially undefined theme properties\r\n  const getSafeColor = (path: string, fallback: string) => {\r\n      const keys = path.split('.');\r\n      let current: any = theme;\r\n      for (const key of keys) {\r\n          if (current && typeof current === 'object' && key in current) {\r\n              current = current[key];\r\n          } else {\r\n              console.warn(`Theme path \"${path}\" not found, using fallback \"${fallback}\".`);\r\n              return fallback;\r\n          }\r\n      }\r\n      return typeof current === 'string' ? current : fallback;\r\n  };\r\n\r\n  // Function to determine row style based on status\r\n  const getRowStyle = (status: StockItem['currentStatus']) => {\r\n    switch (status) {\r\n      case 'Delivered':\r\n        return { backgroundColor: getSafeColor('palette.success.light', '#c8e6c9') }; // Green\r\n      case 'Issue':\r\n        // Using error.light, often reddish/orange in themes, for issues\r\n        return { backgroundColor: getSafeColor('palette.error.light', '#ffccbc') }; // Red/Orange\r\n      case 'Late':\r\n        // Using warning.light, often yellow/amber in themes, for lateness\r\n        return { backgroundColor: getSafeColor('palette.warning.light', '#fff9c4') }; // Yellow/Amber\r\n      case 'Archived':\r\n        return { backgroundColor: getSafeColor('palette.grey.100', '#f5f5f5') }; // Light Grey\r\n      case 'Pending Delivery': // Explicitly handle default case\r\n      default:\r\n        return {}; // Default style (no background)\r\n    }\r\n  };\r\n\r\n  return (\r\n    <DndContext\r\n      sensors={sensors}\r\n      collisionDetection={closestCenter}\r\n      onDragEnd={handleDragEnd}\r\n      modifiers={[restrictToHorizontalAxis]} // Restrict dragging horizontally\r\n    >\r\n      {/* Desktop Table View */}\r\n      {!isMobile && (\r\n        <TableContainer component={Paper} sx={{ mt: 2, maxHeight: 'calc(100vh - 250px)', overflowY: 'auto' }}>\r\n          <Table stickyHeader size=\"small\">\r\n            <TableHead>\r\n              <TableRow>\r\n                <SortableContext items={visibleColumnIds} strategy={horizontalListSortingStrategy}>\r\n                  {visibleColumns.map(col => (\r\n                    <DraggableHeader key={col.id} column={col} />\r\n                  ))}\r\n                </SortableContext>\r\n              </TableRow>\r\n            </TableHead>\r\n            <TableBody>\r\n              {items.map((item) => (\r\n                <TableRow\r\n                  key={item.id}\r\n                  hover\r\n                  sx={{\r\n                    '& > *': { borderBottom: 'unset' },\r\n                    cursor: 'pointer',\r\n                    // Apply conditional background color\r\n                    ...getRowStyle(item.currentStatus),\r\n                    // Ensure hover effect still works well\r\n                    '&:hover': {\r\n                       // Use theme hover color if available, otherwise fallback\r\n                      backgroundColor: getSafeColor('palette.action.hover', 'rgba(0, 0, 0, 0.04)'),\r\n                    }\r\n                  }}\r\n                  onClick={() => onViewDetails(item.id)}\r\n                >\r\n                  {visibleColumns.map(column => (\r\n                    <TableCell \r\n                      key={column.id}\r\n                      align={['quantity', 'pricePerItem'].includes(column.id) ? 'right' : 'left'}\r\n                      sx={{ \r\n                        whiteSpace: 'nowrap', \r\n                        overflow: 'hidden', \r\n                        textOverflow: 'ellipsis', \r\n                        maxWidth: ['productName', 'deliveryName', 'seller'].includes(column.id) ? 200 : undefined,\r\n                        ...(column.id === 'isFlagged' && { p: '6px 8px', textAlign: 'center' }),\r\n                        ...(column.id === 'actions' && { p: '0px 8px', textAlign: 'center' }),\r\n                      }}\r\n                    >\r\n                      {column.id === 'actions' ? (\r\n                        <IconButton size=\"small\" onClick={(e) => { e.stopPropagation(); onMenuOpen(e, item); }}>\r\n                          <MoreVertIcon fontSize=\"small\" />\r\n                        </IconButton>\r\n                      ) : column.id === 'isFlagged' ? (\r\n                          item.isFlagged ? <FlagIcon fontSize=\"inherit\" color=\"error\" /> : null\r\n                      ) : column.id === 'orderDate' || column.id === 'dateDelivered' ? (\r\n                         item[column.id] ? new Date(item[column.id] as string).toLocaleDateString() : ''\r\n                      ) : (\r\n                        item[column.id as keyof StockItem] ?? ''\r\n                      )}\r\n                    </TableCell>\r\n                  ))}\r\n                </TableRow>\r\n              ))}\r\n              {items.length === 0 && !loading && (\r\n                <TableRow>\r\n                  <TableCell colSpan={visibleColumns.length} align=\"center\">\r\n                    No items match the current filter.\r\n                  </TableCell>\r\n                </TableRow>\r\n              )}\r\n            </TableBody>\r\n          </Table>\r\n        </TableContainer>\r\n      )}\r\n      {/* Mobile Card View */}\r\n      {isMobile && (\r\n        <Box sx={{ p: 1 }}> \r\n          {items.map((item) => (\r\n            <MobileItemCard \r\n              key={item.id} \r\n              item={item} \r\n              onViewDetails={onViewDetails}\r\n              onActionClick={onMenuOpen} // Pass onMenuOpen here\r\n              cardSx={getRowStyle(item.currentStatus)} // Calculate and pass style\r\n            />\r\n          ))}\r\n          {items.length === 0 && !loading && (\r\n             <Typography align=\"center\" sx={{ mt: 2, color: 'text.secondary' }}>\r\n               No items match the current filter.\r\n             </Typography>\r\n           )}\r\n        </Box>\r\n      )}\r\n    </DndContext>\r\n  );\r\n};\r\n\r\nexport default StockItemList; ","import React from 'react';\r\nimport {\r\n  Box,\r\n  Typography,\r\n  Button,\r\n  IconButton,\r\n  Tooltip,\r\n} from '@mui/material';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport SettingsIcon from '@mui/icons-material/Settings'; // Renamed for clarity\r\nimport HistoryIcon from '@mui/icons-material/History';\r\n\r\ninterface TopBarProps {\r\n  onAddItem: () => void;\r\n  onOpenSettings: () => void;\r\n  onOpenActivity: () => void;\r\n}\r\n\r\nconst TopBar: React.FC<TopBarProps> = ({\r\n  onAddItem,\r\n  onOpenSettings,\r\n  onOpenActivity,\r\n}) => {\r\n  return (\r\n    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n      <Typography variant=\"h6\">Stock Items</Typography>\r\n      <Box>\r\n        <Tooltip title=\"Add New Item\">\r\n          <Button\r\n            variant=\"contained\"\r\n            startIcon={<AddIcon />}\r\n            onClick={onAddItem}\r\n            sx={{ mr: 1 }}\r\n          >\r\n            Add Item\r\n          </Button>\r\n        </Tooltip>\r\n        <Tooltip title=\"Table Settings\">\r\n          <IconButton onClick={onOpenSettings} sx={{ mr: 1 }}>\r\n            <SettingsIcon />\r\n          </IconButton>\r\n        </Tooltip>\r\n        <Tooltip title=\"View User Activity\">\r\n          <IconButton onClick={onOpenActivity}>\r\n            <HistoryIcon />\r\n          </IconButton>\r\n        </Tooltip>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default TopBar; "],"names":["useStockItems","orgId","nonArchivedItems","setNonArchivedItems","useState","mainLoading","setMainLoading","mainError","setMainError","archivedItems","setArchivedItems","archivedLoading","setArchivedLoading","archivedError","setArchivedError","searchTerm","setSearchTerm","currentFilter","setCurrentFilter","showFlaggedOnly","setShowFlaggedOnly","loading","error","useEffect","console","log","db_instance","db","org_id","warn","q","query","collection","where","orderBy","unsubscribe","onSnapshot","snapshot","items","docs","map","docSnap","data","id","err","message","qArchived","unsubscribeArchived","filteredItems","useMemo","filter","item","_item$deliveryName","_item$productName","_item$seller","_item$asinSku","lowerSearchTerm","toLowerCase","matchesSearch","deliveryName","includes","productName","seller","asinSku","matchesFilter","currentStatus","orderDate","Date","sevenDaysAgo","setDate","getDate","isItemLate","matchesFlag","isFlagged","allItems","setError","_ref","isOpen","onSubmit","onClose","note","setNote","_jsxs","Dialog","open","maxWidth","fullWidth","children","DialogTitle","_jsx","Typography","variant","color","sx","fontStyle","DialogContent","dividers","issueDescription","Box","mb","p","background","border","borderRadius","TextField","autoFocus","margin","label","type","multiline","rows","value","onChange","e","target","helperText","placeholder","DialogActions","padding","Button","onClick","handleSubmit","trim","ActionMenu","itemId","actions","onActionSelected","anchorEl","Menu","MenuListProps","action","MenuItem","handleActionClick","icon","ListItemIcon","minWidth","ListItemText","primary","RESOLUTION_OUTCOMES","outcome","setOutcome","FormControl","InputLabel","Select","labelId","disabled","opt","FormHelperText","undefined","onSave","initialData","firstInputRef","isEditing","purchaseStatus","setPurchaseStatus","setDeliveryName","setProductName","quantity","setQuantity","pricePerItem","setPricePerItem","orderNumber","setOrderNumber","setOrderDate","toISOString","split","setSeller","isVatRegistered","setIsVatRegistered","destination","setDestination","setAsinSku","acquisitionNotes","setAcquisitionNotes","setIsFlagged","errors","setErrors","event","preventDefault","isValid","validateForm","newErrors","Object","keys","length","Number","component","noValidate","mt","inputRef","required","name","InputProps","endAdornment","Tooltip","title","IconButton","size","edge","InfoOutlinedIcon","fontSize","inputProps","min","step","InputLabelProps","shrink","select","FormControlLabel","control","Checkbox","checked","display","alignItems","ml","form","formatValue","prefix","arguments","suffix","style","formatActivityEvent","_event$details$change","time","timestamp","toLocaleString","details","changedFields","join","previousStatus","newStatus","resolutionOutcome","mapLogToAction","_log$details","_log$before","_log$before2","_log$after","_log$details2","_log$details3","_log$details4","_log$details5","_log$details6","_log$details7","Timestamp","toDate","userId","before","after","key","JSON","stringify","description","closeButtonRef","activityEvents","setActivityEvents","loadingLogs","setLoadingLogs","logError","setLogError","availableActions","getAvailableActions","getFirestore","entityPath","logsRef","mappedEvents","doc","scroll","borderBottom","borderColor","pb","gutterBottom","Stack","direction","spacing","flexWrap","List","dense","ListItem","secondary","whiteSpace","dateDelivered","processorNotes","CircularProgress","Alert","severity","index","React","primaryTypographyProps","Divider","ref","onSearchTermChange","onShowFlaggedOnlyChange","onCurrentFilterChange","gap","flexGrow","mr","Tabs","newValue","scrollButtons","allowScrollButtonsMobile","Tab","ALL_COLUMNS","DEFAULT_VISIBLE_COLUMN_IDS","LOCAL_STORAGE_KEY_VISIBLE_COLUMNS","status","unshift","user","org","permissions","logAction","logActionExists","auth","items_length","allItems_length","selectedItemDetails","setSelectedItemDetails","isAddItemModalOpen","setIsAddItemModalOpen","editingItem","setEditingItem","reportingIssueItem","setReportingIssueItem","addingUpdateItem","setAddingUpdateItem","resolvingIssueItem","setResolvingIssueItem","isSettingsModalOpen","setIsSettingsModalOpen","itemForNote","setItemForNote","isUserActivityViewOpen","setIsUserActivityViewOpen","visibleColumnIds","setVisibleColumnIds","stored","localStorage","getItem","parsed","parse","Array","isArray","openMenuId","setOpenMenuId","menuAnchorEl","setMenuAnchorEl","setItem","visibleColumns","find","col","updateItemAndLog","useCallback","async","changes","itemRef","itemBefore","i","finalUpdates","removeUndefinedFields","lastUpdated","serverTimestamp","itemAfter","updateDoc","actionName","_event$details","_event$details$newSta","nameError","logData","toolKey","handleItemAction","newFlagState","uid","createActivityEvent","prevStatus","restoredStatus","archivedItem","handleViewDetails","theme","useTheme","isMobile","useMediaQuery","breakpoints","down","TopBar","onAddItem","onOpenSettings","onOpenActivity","LinearProgress","position","top","left","right","FilterControls","StockItemList","onColumnOrderChange","newOrder","onViewDetails","onMenuOpen","handleMenuOpen","currentTarget","AddItemForm","newItemOrUpdate","dataToSave","collectionRef","completeNewItemData","activityLog","docRef","addDoc","ItemDetailModal","ReportIssueModal","issueDescValue","handleSaveReportIssue","AddUpdateModal","handleSaveIssueUpdate","ResolveIssueModal","resolutionNoteValue","handleSaveResolveIssue","handleSaveNote","TableSettingsModal","allColumns","c","initialVisibleColumns","UserActivityView","renderActionMenu","Boolean","setDescription","obj","fromEntries","entries","_","v","logs","setLogs","setLoading","members","setMembers","membersRef","getDocs","then","forEach","email","catch","limit","relevantLogs","d","tool","ts","userEmail","renderLogEntryContent","_log$before4","_log$before5","_log$before6","actionDesc","_log$details2$changed","fields","k","f","_log$after2","simple","_log$before3","_log$details8","_log$details9","_log$details10","startsWith","replace","getActionDescription","parts","entityId","qty","entityLabel","Fragment","justifyContent","minHeight","textAlign","width","bgcolor","py","checkedState","setCheckedState","visibleIds","Set","updatedCheckedState","has","maxHeight","overflowY","pr","FormGroup","handleCheckboxChange","columnId","prevState","handleSaveChanges","newVisibleColumnIds","DraggableHeader","column","attributes","listeners","setNodeRef","transform","transition","isDragging","useSortable","CSS","Transform","toString","opacity","touchAction","isNumeric","TableCell","scope","align","fontWeight","cursor","MobileItemCard","_ref2","_item$quantity","onActionClick","cardSx","Card","CardContent","lineHeight","toLocaleDateString","stopPropagation","MoreVertIcon","_ref3","sensors","useSensors","useSensor","PointerSensor","KeyboardSensor","coordinateGetter","sortableKeyboardCoordinates","getSafeColor","path","fallback","current","getRowStyle","backgroundColor","DndContext","collisionDetection","closestCenter","onDragEnd","active","over","oldIndex","indexOf","newIndex","activeId","overId","arrayMove","modifiers","restrictToHorizontalAxis","TableContainer","Paper","Table","stickyHeader","TableHead","TableRow","SortableContext","strategy","horizontalListSortingStrategy","TableBody","hover","_item","overflow","textOverflow","FlagIcon","colSpan","startIcon","AddIcon","SettingsIcon","HistoryIcon"],"sourceRoot":""}