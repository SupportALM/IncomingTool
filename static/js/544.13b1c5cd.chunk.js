"use strict";(self.webpackChunkincoming_tool=self.webpackChunkincoming_tool||[]).push([[544],{1453:(e,t,i)=>{i.d(t,{A:()=>p});var n=i(8613),s=i(8517),r=i(1911),o=i(5895),l=i(4199),a=i(2967),d=i(2571),c=i(8263),u=i(5557),m=i(579);const p=e=>{let{item:t,onSubmit:i,onClose:p}=e;const[h,v]=(0,n.useState)(""),[x,A]=(0,n.useState)("");return(0,m.jsxs)(s.A,{open:!0,onClose:p,maxWidth:"sm",fullWidth:!0,children:[(0,m.jsxs)(r.A,{children:[(0,m.jsx)(o.A,{variant:"h6",children:"Add Issue Update for:"}),(0,m.jsxs)(o.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]})]}),(0,m.jsxs)(l.A,{dividers:!0,children:[t.issueDescription&&(0,m.jsx)(a.A,{sx:{mb:2,p:1.5,background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:1},children:(0,m.jsxs)(o.A,{variant:"body2",children:[(0,m.jsx)("strong",{children:"Initial Issue:"})," ",t.issueDescription]})}),(0,m.jsx)(d.A,{autoFocus:!0,margin:"dense",id:"updateNote",label:"Update Note *",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:h,onChange:e=>{v(e.target.value),x&&A("")},error:!!x,helperText:x||"Enter details about the update.",placeholder:"e.g., Contacted seller, awaiting response..."})]}),(0,m.jsxs)(c.A,{sx:{padding:"16px 24px"},children:[(0,m.jsx)(u.A,{onClick:p,color:"secondary",children:"Cancel"}),(0,m.jsx)(u.A,{onClick:()=>{h.trim()?(i(h),p()):A("Please enter an update note.")},variant:"contained",color:"primary",children:"Save Update Note"})]})]})}},2630:(e,t,i)=>{i.d(t,{A:()=>f});var n=i(8613),s=i(8517),r=i(1911),o=i(5895),l=i(4199),a=i(2967),d=i(3863),c=i(5809),u=i(4553),m=i(8889),p=i(468),h=i(2571),v=i(8263),x=i(5557),A=i(579);const g=["Item Accepted / Kept As Is","Item Repaired / Refurbished","Partial Refund Received","Returned to Supplier","Disposed Of","Other"],f=e=>{let{item:t,onSubmit:i,onClose:f}=e;const[S,j]=(0,n.useState)(""),[y,b]=(0,n.useState)(""),[I,D]=(0,n.useState)("");return(0,A.jsxs)(s.A,{open:!0,onClose:f,maxWidth:"sm",fullWidth:!0,children:[(0,A.jsxs)(r.A,{children:[(0,A.jsx)(o.A,{variant:"h6",children:"Resolve Issue for:"}),(0,A.jsxs)(o.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]})]}),(0,A.jsxs)(l.A,{dividers:!0,children:[t.issueDescription&&(0,A.jsx)(a.A,{sx:{mb:2,p:1.5,background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:1},children:(0,A.jsxs)(o.A,{variant:"body2",children:[(0,A.jsx)("strong",{children:"Initial Issue:"})," ",t.issueDescription]})}),(0,A.jsxs)(d.A,{fullWidth:!0,error:!!I,sx:{mb:2},children:[(0,A.jsx)(c.A,{id:"resolution-outcome-label",children:"Resolution Outcome *"}),(0,A.jsxs)(u.A,{labelId:"resolution-outcome-label",id:"resolutionOutcome",value:S,label:"Resolution Outcome *",onChange:e=>{j(e.target.value),I&&D("")},children:[(0,A.jsx)(m.A,{value:"",disabled:!0,children:(0,A.jsx)("em",{children:"-- Select an Outcome --"})}),g.map((e=>(0,A.jsx)(m.A,{value:e,children:e},e)))]}),I&&(0,A.jsx)(p.A,{children:I})]}),(0,A.jsx)(h.A,{id:"resolutionNotes",label:"Resolution Notes (Optional)",multiline:!0,rows:3,fullWidth:!0,value:y,onChange:e=>b(e.target.value),placeholder:"e.g., Supplier issued refund, repaired screen...",variant:"outlined",sx:{mb:2}})]}),(0,A.jsxs)(v.A,{sx:{padding:"16px 24px"},children:[(0,A.jsx)(x.A,{onClick:f,color:"secondary",children:"Cancel"}),(0,A.jsx)(x.A,{onClick:()=>{D(""),S?i(S,y.trim()||void 0):D("Please select a resolution outcome.")},variant:"contained",color:"primary",children:"Save Resolution"})]})]})}},3368:(e,t,i)=>{i.d(t,{A:()=>g});var n=i(8613),s=i(8517),r=i(1911),o=i(4199),l=i(2967),a=i(2571),d=i(3287),c=i(6647),u=i(8889),m=i(5847),p=i(5303),h=i(8263),v=i(5557),x=i(7347),A=i(579);const g=e=>{let{onSave:t,onClose:i,initialData:g,firstInputRef:f}=e;const S=!!g,[j,y]=(0,n.useState)((null===g||void 0===g?void 0:g.purchaseStatus)||"Purchased"),[b,I]=(0,n.useState)((null===g||void 0===g?void 0:g.deliveryName)||""),[D,N]=(0,n.useState)((null===g||void 0===g?void 0:g.productName)||""),[C,k]=(0,n.useState)((null===g||void 0===g?void 0:g.quantity)||""),[w,E]=(0,n.useState)((null===g||void 0===g?void 0:g.pricePerItem)||""),[P,F]=(0,n.useState)((null===g||void 0===g?void 0:g.orderNumber)||""),[O,T]=(0,n.useState)((()=>(null===g||void 0===g?void 0:g.orderDate)||(new Date).toISOString().split("T")[0])),[R,$]=(0,n.useState)((null===g||void 0===g?void 0:g.seller)||""),[z,U]=(0,n.useState)((null===g||void 0===g?void 0:g.isVatRegistered)||"Unknown"),[W,q]=(0,n.useState)((null===g||void 0===g?void 0:g.destination)||""),[L,_]=(0,n.useState)((null===g||void 0===g?void 0:g.asinSku)||""),[G,B]=(0,n.useState)((null===g||void 0===g?void 0:g.acquisitionNotes)||""),[V,M]=(0,n.useState)((null===g||void 0===g?void 0:g.isFlagged)||!1),[H,K]=(0,n.useState)({});(0,n.useEffect)((()=>{g&&(y(g.purchaseStatus||"Purchased"),I(g.deliveryName||""),N(g.productName||""),k(g.quantity||""),E(g.pricePerItem||""),F(g.orderNumber||""),T(g.orderDate||(new Date).toISOString().split("T")[0]),$(g.seller||""),U(g.isVatRegistered||"Unknown"),q(g.destination||""),_(g.asinSku||""),B(g.acquisitionNotes||""),M(g.isFlagged||!1),K({}))}),[g]);const J=e=>{e.preventDefault(),console.log("AddItemForm: handleSubmit",{deliveryName:b,productName:D,quantity:C,pricePerItem:w,orderDate:O,seller:R,destination:W,acquisitionNotes:G,isFlagged:V});const i=(()=>{const e={};return b.trim()||(e.deliveryName="Delivery Name is required."),D.trim()||(e.productName="Product Name is required."),(""===C||C<=0)&&(e.quantity="Quantity must be a positive number."),(""===w||w<0)&&(e.pricePerItem="Price must be zero or positive."),O||(e.orderDate="Order Date is required."),K(e),0===Object.keys(e).length})();console.log("AddItemForm: validation result",i,H),i?(console.log("AddItemForm: form valid, calling onSave"),t({purchaseStatus:j,deliveryName:b,productName:D,quantity:Number(C),pricePerItem:Number(w),orderNumber:P||void 0,orderDate:O,seller:R||void 0,isVatRegistered:"Unknown"===z?void 0:z,destination:W||void 0,asinSku:L||void 0,acquisitionNotes:G||void 0,isFlagged:V})):console.log("AddItemForm: form invalid, errors:",H)};return(0,A.jsxs)(s.A,{open:!0,onClose:i,maxWidth:"sm",fullWidth:!0,children:[(0,A.jsx)(r.A,{children:S?"Edit Stock Item":"Add New Stock Item"}),(0,A.jsx)(o.A,{children:(0,A.jsxs)(l.A,{component:"form",onSubmit:J,id:"add-item-form",noValidate:!0,sx:{mt:1},children:[(0,A.jsx)(a.A,{inputRef:f,margin:"normal",required:!0,fullWidth:!0,id:"deliveryName",label:"Delivery Name",name:"deliveryName",value:b,onChange:e=>I(e.target.value),error:!!H.deliveryName,helperText:H.deliveryName,InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"productName",label:"Product Name",name:"productName",value:D,onChange:e=>N(e.target.value),error:!!H.productName,helperText:H.productName,InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"The common name of the item. Example: Blue Widget Model X",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"quantity",label:"Quantity",name:"quantity",type:"number",value:C,onChange:e=>k(""===e.target.value?"":Number(e.target.value)),error:!!H.quantity,helperText:H.quantity,InputProps:{inputProps:{min:1},endAdornment:(0,A.jsx)(d.A,{title:"How many units of this item are included? Example: 50",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"pricePerItem",label:"Price Per Item",name:"pricePerItem",type:"number",value:w,onChange:e=>E(""===e.target.value?"":Number(e.target.value)),error:!!H.pricePerItem,helperText:H.pricePerItem,InputProps:{inputProps:{min:0,step:.01},endAdornment:(0,A.jsx)(d.A,{title:"The cost for one single unit. Example: 12.50",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"orderDate",label:"Order Date",name:"orderDate",type:"date",value:O,onChange:e=>T(e.target.value),error:!!H.orderDate,helperText:H.orderDate,InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"The date the item was purchased or the return initiated.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"purchaseStatus",label:"Purchase Status",name:"purchaseStatus",select:!0,value:j,onChange:e=>y(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"What is the origin of this item?",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"Purchased",children:"Purchased"}),(0,A.jsx)(u.A,{value:"Ordered",children:"Ordered"}),(0,A.jsx)(u.A,{value:"Return Expected",children:"Return Expected"})]}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"orderNumber",label:"Order Number",name:"orderNumber",value:P,onChange:e=>F(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: External reference like eBay order ID or PO number. Example: 12-34567-89012",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"seller",label:"Seller / Source",name:"seller",value:R,onChange:e=>$(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Who did this item come from? Example: ebay_seller_123 or Customer Name (Return)",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"isVatRegistered",label:"Seller VAT Registered?",name:"isVatRegistered",select:!0,value:z,onChange:e=>U(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Is the seller registered for VAT?",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"Unknown",children:"Unknown"}),(0,A.jsx)(u.A,{value:"Yes",children:"Yes"}),(0,A.jsx)(u.A,{value:"No",children:"No"})]}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"destination",label:"Planned Destination",name:"destination",select:!0,value:["FBA Prep","Local Stock Shelf A","Refurbish Pile","Return to Supplier"].includes(W)?W:"Other",onChange:e=>{"Other"===e.target.value?q(""):q(e.target.value)},InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Where is this item intended to go after processing? Example: FBA Prep",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"FBA Prep",children:"FBA Prep"}),(0,A.jsx)(u.A,{value:"Local Stock Shelf A",children:"Local Stock Shelf A"}),(0,A.jsx)(u.A,{value:"Refurbish Pile",children:"Refurbish Pile"}),(0,A.jsx)(u.A,{value:"Return to Supplier",children:"Return to Supplier"}),(0,A.jsx)(u.A,{value:"Other",children:"Other (Specify Below)"})]}),""===W&&(0,A.jsx)(a.A,{margin:"dense",fullWidth:!0,id:"customDestination",label:"Specify Destination",name:"customDestination",value:W,onChange:e=>q(e.target.value),required:!0,error:!!H.destination,helperText:H.destination}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"asinSku",label:"ASIN / SKU",name:"asinSku",value:L,onChange:e=>_(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Amazon ASIN or internal SKU. Helps link inventory. Example: B0C1EXAMPLE / BLUE-WIDGET-XL",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"acquisitionNotes",label:"Acquisition Notes",name:"acquisitionNotes",value:G,onChange:e=>B(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Any specific notes from the purchase, order, or return request. Example: Seller mentioned slight scratch.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(x.A,{fontSize:"small"})})})}}),(0,A.jsx)(m.A,{control:(0,A.jsx)(p.A,{id:"isFlagged",checked:V,onChange:e=>M(e.target.checked),name:"isFlagged"}),label:(0,A.jsxs)(l.A,{component:"span",sx:{display:"flex",alignItems:"center"},children:["Flag this item for follow-up",(0,A.jsx)(d.A,{title:"Check this box to mark the item with a flag for easy filtering later.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",sx:{ml:.5},children:(0,A.jsx)(x.A,{fontSize:"inherit"})})})]}),sx:{mt:1}})]})}),(0,A.jsxs)(h.A,{children:[(0,A.jsx)(v.A,{onClick:i,children:"Cancel"}),(0,A.jsx)(v.A,{type:"submit",form:"add-item-form",variant:"contained",onClick:J,children:S?"Save Changes":"Add Item"})]})]})}},3691:(e,t,i)=>{i.d(t,{A:()=>D});var n=i(8613),s=i.n(n),r=i(8006),o=i(8517),l=i(1911),a=i(4199),d=i(2967),c=i(5895),u=i(9623),m=i(5557),p=i(4225),h=i(2959),v=i(6185),x=i(549),A=i(5359),g=i(4527),f=i(8263),S=i(5929),j=i(579);const y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e||null===e||""===e?(0,j.jsx)("span",{style:{color:"#888"},children:"N/A"}):`${t}${e}${i}`},b=e=>{var t;const i=new Date(e.timestamp).toLocaleString();switch(e.type){case"CREATED":return`${i}: Item Created`;case"EDITED":return`${i}: Item Edited (${(null===(t=e.details.changedFields)||void 0===t?void 0:t.join(", "))||"details"} changed)`;case"STATUS_CHANGED":return`${i}: Status changed from ${e.details.previousStatus||"?"} to ${e.details.newStatus||"?"}`;case"FLAG_TOGGLED":return`${i}: Item ${e.details.isFlagged?"Flagged":"Unflagged"}`;case"ISSUE_REPORTED":return`${i}: Issue Reported: ${e.details.issueDescription||""}`;case"ISSUE_UPDATE_ADDED":return`${i}: Issue Update Added: ${e.details.note||""}`;case"ISSUE_RESOLVED":return`${i}: Issue Resolved (Outcome: ${e.details.resolutionOutcome||"N/A"}${e.details.note?` - Note: ${e.details.note}`:""}`;case"NOTE_ADDED":return`${i}: Note Added: ${e.details.note||""}`;default:return`${i}: Unknown action`}},I=e=>{var t,i,n,s,o,l,a,d,c,u;const m=e.timestamp instanceof r.Timestamp?e.timestamp.toDate().toISOString():"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),p=e.userId||"system";let h=null,v={};switch(e.action){case"item.create":h="CREATED";break;case"item.update.fields":h="EDITED";v={changedFields:e.before&&e.after?Object.keys(e.after).filter((t=>e.before&&e.after&&JSON.stringify(e.before[t])!==JSON.stringify(e.after[t]))):(null===(t=e.details)||void 0===t?void 0:t.changedFields)||["details"]};break;case"item.update.status.Delivered":h="STATUS_CHANGED",v={previousStatus:null===(i=e.before)||void 0===i?void 0:i.currentStatus,newStatus:"Delivered"};break;case"item.update.status.Archived":h="STATUS_CHANGED",v={previousStatus:null===(n=e.before)||void 0===n?void 0:n.currentStatus,newStatus:"Archived"};break;case"item.update.flag":h="FLAG_TOGGLED",v={isFlagged:null===(s=e.after)||void 0===s?void 0:s.isFlagged};break;case"item.update.issue.report":h="ISSUE_REPORTED",v={issueDescription:(null===(o=e.details)||void 0===o?void 0:o.description)||(null===(l=e.details)||void 0===l?void 0:l.issueDescription)};break;case"item.update.issue.resolve":h="ISSUE_RESOLVED",v={resolutionOutcome:null===(a=e.details)||void 0===a?void 0:a.outcome,note:null===(d=e.details)||void 0===d?void 0:d.note};break;case"item.update.issue.update":h="ISSUE_UPDATE_ADDED",v={note:null===(c=e.details)||void 0===c?void 0:c.note};break;case"item.add_note":h="NOTE_ADDED",v={note:null===(u=e.details)||void 0===u?void 0:u.note};break;default:return console.warn(`Unhandled log action type for UI mapping: ${e.action}`),null}return h?{timestamp:m,userId:p,type:h,details:v}:null},D=e=>{let{item:t,orgId:i,onClose:D,closeButtonRef:N,onActionSelected:C}=e;const[k,w]=(0,n.useState)([]),[E,P]=(0,n.useState)(!0),[F,O]=(0,n.useState)(null),T=(0,S.getAvailableActions)(t.currentStatus,t.isFlagged);return(0,n.useEffect)((()=>{if(null===t||void 0===t||!t.id||!i)return P(!1),void O("Missing item or organization ID for fetching logs.");w([]),P(!0),O(null);const e=(0,r.getFirestore)(),n=`stockItems/${t.id}`,s=(0,r.collection)(e,`orgs/${i}/logs`),o=(0,r.query)(s,(0,r.where)("entityPath","==",n),(0,r.orderBy)("timestamp","desc")),l=(0,r.onSnapshot)(o,(e=>{const t=e.docs.map((e=>({...e.data()}))).map(I).filter((e=>null!==e));w(t),P(!1)}),(e=>{console.error("Error fetching logs: ",e),O(`Failed to fetch activity log: ${e.message}`),P(!1)}));return()=>l()}),[null===t||void 0===t?void 0:t.id,i]),(0,j.jsxs)(o.A,{open:!0,onClose:D,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[(0,j.jsxs)(l.A,{children:[t.productName," - Details"]}),(0,j.jsxs)(a.A,{dividers:!0,children:[" ",(0,j.jsxs)(d.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",pb:2},children:[(0,j.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Actions"}),(0,j.jsxs)(u.A,{direction:"row",spacing:1,flexWrap:"wrap",children:[" ",T.map((e=>(0,j.jsx)(m.A,{variant:"contained",size:"small",onClick:()=>C(t.id,e),title:e.description,children:e.label},e.id))),0===T.length&&(0,j.jsx)(c.A,{variant:"body2",color:"textSecondary",children:"No actions available for current status."})]})]}),(0,j.jsxs)(d.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",pb:1},children:[(0,j.jsx)(c.A,{variant:"h6",children:"Details"}),(0,j.jsxs)(p.A,{dense:!0,children:[" ",(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"ID",secondary:t.id})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Current Status",secondary:y(t.currentStatus)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Flagged",secondary:t.isFlagged?"Yes":"No"})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Delivery Name",secondary:y(t.deliveryName)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Product Name",secondary:y(t.productName)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Quantity",secondary:y(t.quantity)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Price Per Item",secondary:y(t.pricePerItem,"\xa3")})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Order Date",secondary:y(t.orderDate)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Purchase Status",secondary:y(t.purchaseStatus)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Order Number",secondary:y(t.orderNumber)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Seller / Source",secondary:y(t.seller)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"VAT Registered?",secondary:y(t.isVatRegistered)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Destination",secondary:y(t.destination)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"ASIN / SKU",secondary:y(t.asinSku)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Acquisition Notes",secondary:y(t.acquisitionNotes),sx:{whiteSpace:"pre-wrap"}})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Date Delivered",secondary:t.dateDelivered?new Date(t.dateDelivered).toLocaleString():y(null)})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Processor Notes",secondary:y(t.processorNotes),sx:{whiteSpace:"pre-wrap"}})}),(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:"Issue Description",secondary:y(t.issueDescription),sx:{whiteSpace:"pre-wrap"}})})]})]}),(0,j.jsxs)(d.A,{children:[(0,j.jsx)(c.A,{variant:"h6",children:"Activity Log"}),E&&(0,j.jsx)(x.A,{size:24,sx:{display:"block",margin:"20px auto"}}),F&&(0,j.jsxs)(A.A,{severity:"error",children:["Error loading history: ",F]}),!E&&!F&&0===k.length&&(0,j.jsx)(c.A,{variant:"body2",color:"textSecondary",sx:{mt:2},children:"No activity recorded."}),!E&&!F&&k.length>0&&(0,j.jsx)(p.A,{dense:!0,children:k.map(((e,t)=>(0,j.jsxs)(s().Fragment,{children:[(0,j.jsx)(h.Ay,{children:(0,j.jsx)(v.A,{primary:b(e),primaryTypographyProps:{variant:"body2"}})}),t<k.length-1&&(0,j.jsx)(g.A,{component:"li"})]},t)))})]})]}),(0,j.jsx)(f.A,{children:(0,j.jsx)(m.A,{ref:N,onClick:D,children:"Close"})})]})}},5929:(e,t,i)=>{i.r(t),i.d(t,{ActionMenu:()=>ne,default:()=>ae,getAvailableActions:()=>ie});var n=i(8613),s=i(9284),r=i(8677),o=i(1024),l=i(6800),a=i(3368),d=i(3691),c=i(5982),u=i(1453),m=i(2630),p=i(7694),h=i(7553),v=i(8006),x=i(6623),A=i(8889),g=i(9801),f=i(6185),S=i(2731),j=i(3287),y=i(2967),b=i(6647),I=i(5895),D=i(267),N=i(6748),C=i(6393),k=i(5495),w=i(5557),E=i(5359),P=i(1),F=i(2571),O=i(5847),T=i(5303),R=i(8229),$=i(6687),z=i(6859),U=i(2523),W=i(2011),q=i(4755),L=i(9841),_=i(1399),G=i(2043),B=i(2950),V=i(6936),M=i(2327),H=i(9161),K=i(9963),J=i(2422),Q=i(6384),Y=i(210),X=i(161),Z=i(579);function ee(e){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,i]=e;return void 0!==i})))}console.log("[IncomingTool] ToolApp.tsx: Top level, imported db is:",X.db);const te=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:(new Date).toISOString(),type:t,userId:e,details:i}},ie=(e,t)=>{let i=[];switch(e){case"Pending Delivery":case"Late":i=[{id:"Mark as Delivered",label:"Mark as Delivered",description:"Update status to Delivered"},{id:"Report Issue",label:"Report Issue",description:"Report an issue with this item",icon:(0,Z.jsx)(Q.A,{fontSize:"small"})},{id:"Add Note",label:"Add Note",description:"Add a note to the item history",icon:(0,Z.jsx)(Y.A,{fontSize:"small"})},{id:"Flag Item",label:"Flag",description:"Flag this item for attention",icon:(0,Z.jsx)(M.A,{fontSize:"small"})}];break;case"Delivered":i=[{id:"Archive",label:"Archive",description:"Archive this item",icon:(0,Z.jsx)(K.A,{fontSize:"small"})},{id:"Report Issue",label:"Report Issue",description:"Report an issue with this item",icon:(0,Z.jsx)(Q.A,{fontSize:"small"})},{id:"Add Note",label:"Add Note",description:"Add a note to the item history",icon:(0,Z.jsx)(Y.A,{fontSize:"small"})},{id:"Flag Item",label:"Flag",description:"Flag this item for attention",icon:(0,Z.jsx)(M.A,{fontSize:"small"})}];break;case"Issue":i=[{id:"Resolve Issue",label:"Resolve Issue",description:"Mark the issue as resolved"},{id:"Add Issue Update",label:"Add Issue Update",description:"Add an update note to the ongoing issue"},{id:"Archive",label:"Archive",description:"Archive this item",icon:(0,Z.jsx)(K.A,{fontSize:"small"})},{id:"Add Note",label:"Add Note",description:"Add a general note to the item history",icon:(0,Z.jsx)(Y.A,{fontSize:"small"})},{id:"Flag Item",label:"Flag",description:"Flag this item for attention",icon:(0,Z.jsx)(M.A,{fontSize:"small"})}];break;case"Archived":i=[{id:"Unarchive Item",label:"Unarchive",description:"Restore this item from archive",icon:(0,Z.jsx)(J.A,{fontSize:"small"})},{id:"Add Note",label:"Add Note",description:"Add a note to the item history",icon:(0,Z.jsx)(Y.A,{fontSize:"small"})}];break;default:i=[{id:"Add Note",label:"Add Note",description:"Add a note to the item history",icon:(0,Z.jsx)(Y.A,{fontSize:"small"})}]}return"Archived"!==e&&i.unshift(t?{id:"Unflag Item",label:"Unflag",description:"Remove the flag from this item",icon:(0,Z.jsx)(M.A,{fontSize:"small",color:"disabled"})}:{id:"Flag Item",label:"Flag",description:"Flag this item for attention",icon:(0,Z.jsx)(M.A,{fontSize:"small"})}),i},ne=e=>{let{itemId:t,actions:i,onActionSelected:n,onClose:s,anchorEl:r,open:o}=e;return(0,Z.jsx)(x.A,{anchorEl:r,open:o,onClose:s,MenuListProps:{"aria-labelledby":`actions-button-${t}`},children:i.map((e=>(0,Z.jsxs)(A.A,{onClick:()=>(e=>{n(t,e),s()})(e),children:[e.icon&&(0,Z.jsx)(g.A,{sx:{minWidth:"32px"},children:e.icon}),(0,Z.jsx)(f.A,{primary:e.label})]},e.id)))})},se=[{id:"orderDate",label:"Order Date"},{id:"quantity",label:"Qty"},{id:"productName",label:"Product Name"},{id:"deliveryName",label:"Delivery Name"},{id:"pricePerItem",label:"Price/Item"},{id:"seller",label:"Seller/Source"},{id:"destination",label:"Destination"},{id:"asinSku",label:"ASIN/SKU"},{id:"purchaseStatus",label:"Purchase Status"},{id:"orderNumber",label:"Order #"},{id:"currentStatus",label:"Status"},{id:"isFlagged",label:"Flagged"},{id:"acquisitionNotes",label:"Acquisition Notes"},{id:"issueDescription",label:"Issue Description"},{id:"dateDelivered",label:"Date Delivered"},{id:"actions",label:"Actions"}],re=["orderDate","quantity","productName","deliveryName","currentStatus","actions"],oe="incomingTool_visibleColumns",le=e=>{let{column:t}=e;const{attributes:i,listeners:n,setNodeRef:s,transform:l,transition:a,isDragging:d}=(0,r.gl)({id:t.id}),c={transform:o.Ks.Transform.toString(l),transition:a,opacity:d?.5:1,touchAction:"none"},u=["quantity","pricePerItem"].includes(t.id);return(0,Z.jsxs)(S.A,{ref:s,component:"th",scope:"col",style:c,...i,...n,align:u?"right":"left",sx:{fontWeight:"bold",cursor:"grab",whiteSpace:"nowrap",bgcolor:d?"#e0e0e0":"background.paper",..."isFlagged"===t.id&&{width:50,p:"6px 8px"},..."seller"===t.id&&{minWidth:140},..."deliveryName"===t.id&&{minWidth:160},..."quantity"===t.id&&{width:80},..."destination"===t.id&&{minWidth:110},..."pricePerItem"===t.id&&{width:100},..."orderNumber"===t.id&&{width:110},..."purchaseStatus"===t.id&&{width:110},..."orderDate"===t.id&&{width:110},..."asinSku"===t.id&&{width:120},..."productName"===t.id&&{minWidth:160},..."actions"===t.id&&{width:60,p:"6px 8px"},..."currentStatus"===t.id&&{width:100}},children:[t.label," "]})},ae=e=>{let{user:t,org:i,permissions:o,logAction:K}=e;console.log("ToolApp Props Received:",{user:t,orgId:null===i||void 0===i?void 0:i.id,permissions:o,logActionExists:!!K}),console.log("ToolApp using imported db:",X.db),console.log("ToolApp using imported auth:",X.auth);const[J,Q]=(0,n.useState)([]),[Y,ne]=(0,n.useState)(!0),[ae,de]=(0,n.useState)(null),[ce,ue]=(0,n.useState)(""),[me,pe]=(0,n.useState)("All"),[he,ve]=(0,n.useState)(null),[xe,Ae]=(0,n.useState)(!1),[ge,fe]=(0,n.useState)(!1),[Se,je]=(0,n.useState)(null),[ye,be]=(0,n.useState)(null),[Ie,De]=(0,n.useState)(null),[Ne,Ce]=(0,n.useState)(null),[ke,we]=(0,n.useState)(!1),[Ee,Pe]=(0,n.useState)(null),[Fe,Oe]=(0,n.useState)(!1),[Te,Re]=(0,n.useState)((()=>{try{const e=localStorage.getItem(oe),t=e?JSON.parse(e):re;return Array.isArray(t)?t:re}catch(ae){return console.error("Error reading visible columns from localStorage",ae),re}}));(0,n.useEffect)((()=>{try{localStorage.setItem(oe,JSON.stringify(Te))}catch(ae){console.error("Error saving visible columns to localStorage",ae)}}),[Te]);const $e=Te.map((e=>se.find((t=>t.id===e)))).filter((e=>void 0!==e)),ze=J.filter((e=>{const t=ce.toLowerCase(),i=e.deliveryName&&"string"===typeof e.deliveryName&&e.deliveryName.toLowerCase().includes(t)||e.productName&&"string"===typeof e.productName&&e.productName.toLowerCase().includes(t)||e.seller&&"string"===typeof e.seller&&e.seller.toLowerCase().includes(t)||e.asinSku&&"string"===typeof e.asinSku&&e.asinSku.toLowerCase().includes(t);let n=!1;n="All"===me||("Late"===me?(e=>{if("Pending Delivery"!==e.currentStatus)return!1;const t=new Date(e.orderDate),i=new Date;return i.setDate(i.getDate()-7),t<i})(e):e.currentStatus===me);const s=!ge||!0===e.isFlagged;return n&&i&&s}));(0,n.useEffect)((()=>{if(console.log("[IncomingTool] useEffect Firestore Sync: Checking db and org.id:",{db_instance:X.db,org_id:null===i||void 0===i?void 0:i.id}),!X.db||null===i||void 0===i||!i.id)return console.warn("[IncomingTool] useEffect Firestore Sync: db or org.id is missing, skipping Firestore query."),void ne(!1);ne(!0),de(null),console.log(`[IncomingTool] useEffect Firestore Sync: Setting up listener for orgs/${i.id}/stockItems`);const e=(0,v.query)((0,v.collection)(X.db,"orgs",i.id,"stockItems"),(0,v.orderBy)("orderDate","desc")),t=(0,v.onSnapshot)(e,(e=>{console.log("[IncomingTool] useEffect Firestore Sync: Received snapshot.");const t=e.docs.map((e=>({id:e.id,...e.data()})));Q(t),ne(!1)}),(e=>{console.error("[IncomingTool] useEffect Firestore Sync: Snapshot error:",e),de("Failed to load items: "+e.message),ne(!1)}));return()=>{console.log("[IncomingTool] useEffect Firestore Sync: Cleaning up listener."),t()}}),[null===i||void 0===i?void 0:i.id]);const Ue=(0,n.useCallback)((async(e,t,n,s)=>{if(console.log("[IncomingTool] updateItemAndLog: Checking db and org.id:",{db_instance:X.db,org_id:null===i||void 0===i?void 0:i.id}),!X.db||null===i||void 0===i||!i.id||!t)return console.error("Cannot update item: Missing configuration.",{db:!!X.db,orgId:null===i||void 0===i?void 0:i.id,userId:t}),void de("Cannot update item: Missing configuration.");console.log(`[IncomingTool] updateItemAndLog: Preparing to update item ${e} in org ${i.id}`);const r=(0,v.doc)(X.db,"orgs",i.id,"stockItems",e),o=J.find((t=>t.id===e));if(!o)return console.error(`Item ${e} not found for update`),void de(`Item ${e} not found.`);const l=ee({...n,lastUpdated:(0,v.serverTimestamp)()}),a={...o,...l};try{if(await(0,v.updateDoc)(r,l),console.log(`Item ${e} updated successfully.`),console.log("updateItemAndLog: Attempting to log action. logAction available?",!!K),K){let t;try{if("EDITED"===s.type)t="item.update.fields";else if("FLAG_TOGGLED"===s.type)t="item.update.flag";else if("STATUS_CHANGED"===s.type){var d,c;t=`item.update.status.${(null===(d=s.details)||void 0===d||null===(c=d.newStatus)||void 0===c?void 0:c.toLowerCase())||"unknown"}`}else t="ISSUE_REPORTED"===s.type?"item.update.issue.report":"ISSUE_RESOLVED"===s.type?"item.update.issue.resolve":"ISSUE_UPDATE_ADDED"===s.type?"item.update.issue.update":"NOTE_ADDED"===s.type?"item.add_note":s.type}catch(u){console.error("Error deriving action name for logging:",u),t=s.type}const n={orgId:i.id,toolKey:"incomingtool",action:t,entityPath:`stockItems/${e}`,...void 0!==o&&{before:o},...void 0!==a&&{after:a},...void 0!==s.details&&{details:s.details}};await K(n)}}catch(m){throw console.error(`Error updating item ${e}:`,m),de(`Failed to update item: ${m.message}`),m}}),[i,J,K]),We=(0,n.useCallback)((async(e,i)=>{console.log(`Action: ${i.label} on item ${e}`);const n=J.find((t=>t.id===e));if(n)switch(i.id){case"Edit Item":je(n),Ae(!0);break;case"Flag Item":case"Unflag Item":const s="Flag Item"===i.id;await Ue(e,null===t||void 0===t?void 0:t.uid,{isFlagged:s},te((null===t||void 0===t?void 0:t.uid)||"","FLAG_TOGGLED",{isFlagged:s}));break;case"Mark as Delivered":"Delivered"!==n.currentStatus&&await Ue(e,null===t||void 0===t?void 0:t.uid,{currentStatus:"Delivered",dateDelivered:(new Date).toISOString()},te((null===t||void 0===t?void 0:t.uid)||"","STATUS_CHANGED",{previousStatus:n.currentStatus,newStatus:"Delivered"}));break;case"Archive":"Archived"!==n.currentStatus&&await Ue(e,null===t||void 0===t?void 0:t.uid,{currentStatus:"Archived"},te((null===t||void 0===t?void 0:t.uid)||"","STATUS_CHANGED",{previousStatus:n.currentStatus,newStatus:"Archived"}));break;case"Add Note":Pe(n);break;case"Report Issue":ve(null),be(n);break;case"Resolve Issue":ve(null),Ce(n);break;case"Add Issue Update":ve(null),De(n);break;case"View Details":ve(n)}}),[null===t||void 0===t?void 0:t.uid,J,Ue,je,Ae,be,De,Ce,ve]),qe=(0,n.useCallback)((async e=>{if(!ye||null===i||void 0===i||!i.id)return;const n=ye.id;try{await Ue(n,null===t||void 0===t?void 0:t.uid,{currentStatus:"Issue",issueDescription:e},te((null===t||void 0===t?void 0:t.uid)||"","ISSUE_REPORTED",{issueDescription:e})),be(null)}catch(s){de("Failed to report issue: "+s.message)}}),[ye,null===i||void 0===i?void 0:i.id,null===t||void 0===t?void 0:t.uid,Ue,be,de]),Le=(0,n.useCallback)((async e=>{if(Ie)try{await Ue(Ie.id,null===t||void 0===t?void 0:t.uid,{},te((null===t||void 0===t?void 0:t.uid)||"","ISSUE_UPDATE_ADDED",{note:e})),De(null)}catch(i){}}),[Ie,Ue,De,null===t||void 0===t?void 0:t.uid]),_e=(0,n.useCallback)((async(e,t)=>{if(!Ne||null===i||void 0===i||!i.id||!X.db)return;const n=Ne.id;let s="Delivered";"Returned to Supplier"!==e&&"Disposed Of"!==e||(s="Archived");try{const r=(0,v.doc)(X.db,"orgs",i.id,"stockItems",n);await(0,v.updateDoc)(r,{currentStatus:s,lastUpdated:(0,v.serverTimestamp)()});const o=J.find((e=>e.id===n));console.log("handleSaveResolveIssue: Attempting to log action. logAction available?",!!K),K&&await K({orgId:i.id,toolKey:"incomingtool",action:"item.update.issue.resolve",entityPath:`stockItems/${n}`,before:o,after:{...o,currentStatus:s},details:{resolutionOutcome:e,note:t}}),Ce(null)}catch(r){de("Failed to resolve issue: "+r.message)}}),[Ne,null===i||void 0===i?void 0:i.id,J,K,Ce,de]),Ge=(0,n.useCallback)((()=>{Ae(!1),je(null)}),[Ae,je]),Be=(0,n.useCallback)((async e=>{if(console.log("ToolApp: current editingItem at save",Se),null===i||void 0===i||!i.id||!X.db)return console.error("ToolApp: Cannot save item because org.id or db is undefined",i),void de("Cannot save item: No organization selected or database unavailable.");console.log("ToolApp: handleSaveItem called",e);try{if(Se&&Se.id){const i=Se.id,n=Object.keys(e).filter((t=>Se.hasOwnProperty(t)&&Se[t]!==e[t]));"isFlagged"in e&&!n.includes("isFlagged")&&Se.isFlagged!==e.isFlagged&&n.push("isFlagged");const s=te((null===t||void 0===t?void 0:t.uid)||"","EDITED",{changedFields:n.length>0?n:void 0});await Ue(i,null===t||void 0===t?void 0:t.uid,e,s)}else{const t=ee({...e,currentStatus:"Pending Delivery",lastUpdated:(0,v.serverTimestamp)()}),n=await(0,v.addDoc)((0,v.collection)(X.db,"orgs",i.id,"stockItems"),t);console.log("handleSaveItem: Attempting to log action. logAction available?",!!K),K&&await K({orgId:i.id,toolKey:"incomingtool",action:"item.create",entityPath:`stockItems/${n.id}`,after:t})}Ge()}catch(n){console.error("Failed to save item",n),de("Failed to save item: "+n.message)}}),[Se,i,t,K,Ue,Ge,de]),Ve=(0,n.useCallback)((()=>{ve(null)}),[ve]),Me=(0,n.useRef)(void 0);(0,n.useEffect)((()=>{Me.current=null===i||void 0===i?void 0:i.id}),[i]);const He=(0,n.useCallback)((()=>{Me.current?(je(null),Ae(!0)):de("Cannot add item: Organization ID is missing.")}),[Ae,je,de]),Ke=(0,n.useCallback)((e=>{const t=J.find((t=>t.id===e));return t?(console.log("Viewing details for:",t),i?void ve(t):(console.error("Org ID is missing, cannot fetch logs."),void de("Organization context is missing."))):(console.error("Item not found for viewing details:",e),void de("Item not found."))}),[i,J,de]),Je=(0,n.useCallback)((async(e,i)=>{if(null===t||void 0===t||!t.uid)return console.error("User ID is missing, cannot save note."),void de("User ID is missing, cannot save note.");console.log(`Saving general note for item ${e}: ${i}`);try{const n=te(t.uid,"NOTE_ADDED",{note:i});await Ue(e,t.uid,{},n),console.log(`General note saved and logged for item ${e}`),Pe(null)}catch(n){console.error(`Error saving general note for item ${e}:`,n),de(`Failed to save note: ${n.message}`)}}),[null===t||void 0===t?void 0:t.uid,Ue]),[Qe,Ye]=(0,n.useState)(null),[Xe,Ze]=(0,n.useState)(null),et=(e,t)=>{Ze(e.currentTarget),Ye(t)},tt=()=>{Ze(null),Ye(null)},it=(e,t,i)=>{const n=e[t],s={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"};if("actions"===t)return(0,Z.jsx)(b.A,{"aria-label":"actions",size:"small",onClick:e=>{e.stopPropagation(),i(e)},children:(0,Z.jsx)(G.A,{fontSize:"inherit"})});if("currentStatus"===t)return(0,Z.jsx)(I.A,{variant:"body2",sx:{fontWeight:"medium",whiteSpace:"nowrap"},children:e.currentStatus});if("isFlagged"===t)return e.isFlagged?(0,Z.jsx)(M.A,{color:"error",fontSize:"small"}):null;let r;if("orderDate"===t&&n)try{r=new Date(n).toLocaleDateString()}catch(o){r=String(null!==n&&void 0!==n?n:"-")}else r="pricePerItem"===t&&"number"===typeof n?n.toFixed(2):void 0===n||null===n||""===n?"-":String(n);return["seller","deliveryName","productName","acquisitionNotes","asinSku","orderNumber","destination"].includes(t)?((e,t)=>(0,Z.jsx)(j.A,{title:String(null!==t&&void 0!==t?t:""),placement:"bottom-start",enterDelay:500,children:(0,Z.jsx)(y.A,{component:"span",sx:s,children:e})}))(r,n):(0,Z.jsx)(y.A,{component:"span",sx:{whiteSpace:"nowrap"},children:r})},nt=(0,s.FR)((0,s.MS)(s.AN),(0,s.MS)(s.uN,{coordinateGetter:r.JR})),st=(0,D.A)(),rt=(0,N.A)(st.breakpoints.down("sm")),ot=e=>{var t;let{item:i,onViewDetails:n,onActionClick:s}=e;return(0,Z.jsxs)(C.A,{sx:{mb:2,cursor:"pointer"},onClick:()=>n(i.id),children:[" ",(0,Z.jsxs)(k.A,{sx:{pb:"8px !important"},children:[" ",(0,Z.jsxs)(y.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,Z.jsxs)(y.A,{sx:{flexGrow:1,mr:1},children:[(0,Z.jsx)(I.A,{variant:"subtitle1",component:"div",sx:{fontWeight:"bold",lineHeight:1.3},children:i.productName||i.deliveryName||"Unnamed Item"}),(0,Z.jsxs)(I.A,{variant:"body2",color:"text.secondary",children:["Status: ",i.currentStatus]}),(0,Z.jsxs)(I.A,{variant:"body2",color:"text.secondary",children:["Qty: ",null!==(t=i.quantity)&&void 0!==t?t:"N/A"," | Seller: ",i.seller||"N/A"]}),(0,Z.jsxs)(I.A,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem"},children:["Order Date: ",i.orderDate?new Date(i.orderDate).toLocaleDateString():"N/A"]})]}),(0,Z.jsxs)(b.A,{size:"small",onClick:e=>{e.stopPropagation(),s(e,i)},sx:{mt:-1,mr:-1},children:[" ",(0,Z.jsx)(G.A,{})]})]})]})]})};return(0,Z.jsxs)(y.A,{sx:{display:"flex",flexDirection:"column",height:"100vh",p:{xs:1,sm:2,md:3}},children:[" ",(0,Z.jsxs)(y.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:{xs:1,sm:2},flexShrink:0},children:[(0,Z.jsx)(y.A,{sx:{flexGrow:1}})," ",(0,Z.jsx)(y.A,{children:rt?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(j.A,{title:"Add Item",children:(0,Z.jsx)(b.A,{color:"primary",onClick:He,sx:{mr:.5},children:(0,Z.jsx)(B.A,{})})}),(0,Z.jsx)(j.A,{title:"View Activity Log",children:(0,Z.jsx)(b.A,{color:"primary",onClick:()=>Oe(!0),sx:{mr:.5},children:(0,Z.jsx)(H.A,{})})}),(0,Z.jsx)(j.A,{title:"Settings",children:(0,Z.jsx)(b.A,{color:"primary",onClick:()=>we(!0),children:(0,Z.jsx)(V.A,{})})})]}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(w.A,{variant:"contained",startIcon:(0,Z.jsx)(B.A,{}),onClick:He,sx:{mr:1},children:"Add Item"}),(0,Z.jsx)(w.A,{variant:"outlined",onClick:()=>Oe(!0),sx:{mr:1},children:"Activity"}),(0,Z.jsx)(w.A,{variant:"outlined",onClick:()=>we(!0),startIcon:(0,Z.jsx)(V.A,{}),children:"Settings"})]})})]}),ae&&(0,Z.jsx)(E.A,{severity:"error",onClose:()=>de(null),sx:{mb:2,flexShrink:0},children:ae}),Y&&(0,Z.jsx)(P.A,{sx:{mb:2,flexShrink:0}}),(0,Z.jsxs)(y.A,{sx:{display:"flex",flexDirection:rt?"column":"row",alignItems:rt?"stretch":"center",mb:2,flexShrink:0},children:[(0,Z.jsx)(y.A,{sx:{flexGrow:rt?0:1,width:rt?"100%":"auto",mr:rt?0:2,mb:rt?1.5:0},children:(0,Z.jsx)(F.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Search by Delivery Name, Product Name, Seller, or ASIN/SKU...",value:ce,onChange:e=>ue(e.target.value)})}),(0,Z.jsx)(y.A,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-start",width:rt?"100%":"auto",ml:rt?0:2},children:(0,Z.jsx)(O.A,{control:(0,Z.jsx)(T.A,{checked:ge,onChange:e=>fe(e.target.checked),size:"small"}),label:(0,Z.jsx)(I.A,{variant:"body2",children:"Show Flagged Only"}),sx:{mr:0}})})]}),(0,Z.jsxs)(y.A,{sx:{flexShrink:0,mb:2},children:[" ",(0,Z.jsxs)(R.A,{value:me,onChange:(e,t)=>pe(t),"aria-label":"Item status filters",variant:rt?"scrollable":"standard",scrollButtons:!!rt&&"auto",allowScrollButtonsMobile:!0,sx:{borderBottom:1,borderColor:"divider",mb:2,flexShrink:0},children:[(0,Z.jsx)($.A,{label:"All",value:"All"}),(0,Z.jsx)($.A,{label:"Pending Delivery",value:"Pending Delivery"}),(0,Z.jsx)($.A,{label:"Delivered",value:"Delivered"}),(0,Z.jsx)($.A,{label:"Issue",value:"Issue"}),(0,Z.jsx)($.A,{label:"Archived",value:"Archived"})]})]}),(0,Z.jsxs)(s.Mp,{sensors:nt,collisionDetection:s.fp,onDragEnd:e=>{const{active:t,over:i}=e;i&&t.id!==i.id&&Re((e=>{const n=e.indexOf(t.id),s=e.indexOf(i.id);return(0,r.be)(e,n,s)}))},modifiers:[l.dU],children:[!rt&&(0,Z.jsxs)(z.A,{component:U.A,sx:{maxHeight:"100%"},children:[" ",(0,Z.jsxs)(W.A,{stickyHeader:!0,"aria-label":"sticky table",size:"small",children:[(0,Z.jsx)(q.A,{children:(0,Z.jsx)(L.A,{children:(0,Z.jsx)(r.gB,{items:$e.map((e=>e.id)),strategy:r.m$,children:$e.map((e=>(0,Z.jsx)(le,{column:e},e.id)))})})}),(0,Z.jsxs)(_.A,{children:[ze.map(((e,t)=>(0,Z.jsx)(L.A,{hover:!0,onClick:()=>Ke(e.id),sx:{cursor:"pointer"},children:$e.map((t=>(0,Z.jsx)(S.A,{align:["quantity","pricePerItem"].includes(t.id)?"right":"left",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"deliveryName"===t.id||"productName"===t.id?200:150,..."isFlagged"===t.id&&{width:50,p:"6px 8px"},..."actions"===t.id&&{width:50,p:"6px 8px"}},children:it(e,t.id,(t=>et(t,e.id)))},t.id)))},e.id))),0===ze.length&&(0,Z.jsx)(L.A,{children:(0,Z.jsx)(S.A,{colSpan:$e.length,align:"center",children:"No items match the current filter."})})]})]})]}),rt&&(0,Z.jsxs)(y.A,{sx:{p:1},children:[" ",ze.map((e=>(0,Z.jsx)(ot,{item:e,onViewDetails:Ke,onActionClick:(e,t)=>et(e,t.id)},e.id))),0===ze.length&&(0,Z.jsx)(I.A,{align:"center",sx:{mt:2,color:"text.secondary"},children:"No items match the current filter."})]})]}),xe&&(0,Z.jsx)(a.A,{onSave:Be,onClose:Ge,initialData:Se}),he&&(0,Z.jsx)(d.A,{item:he,orgId:i.id,onClose:Ve,onActionSelected:We}),ye&&(0,Z.jsx)(c.A,{item:ye,onSubmit:qe,onClose:()=>be(null)}),Ie&&(0,Z.jsx)(u.A,{item:Ie,onSubmit:Le,onClose:()=>De(null)}),Ne&&(0,Z.jsx)(m.A,{item:Ne,onSubmit:_e,onClose:()=>Ce(null)}),Ee&&(0,Z.jsx)(u.A,{item:Ee,onSubmit:e=>Je(Ee.id,e),onClose:()=>Pe(null)}),(0,Z.jsx)(p.A,{isOpen:ke,onClose:()=>we(!1),allColumns:se,initialVisibleColumns:$e,onSave:e=>{Re((t=>{const i=new Set(e);return[...t.filter((e=>i.has(e))),...e.filter((e=>!t.includes(e)))]})),we(!1)}}),Fe&&(null===i||void 0===i?void 0:i.id)&&(null===t||void 0===t?void 0:t.uid)&&X.db&&(0,Z.jsx)(h.A,{db:X.db,orgId:i.id,userId:t.uid,itemId:"",logAction:K,onClose:()=>Oe(!1),onEntityClick:Ke,onActionSelected:We}),(()=>{if(!Qe)return null;const e=J.find((e=>e.id===Qe));if(!e)return null;const t=ie(e.currentStatus,e.isFlagged);return(0,Z.jsx)(x.A,{anchorEl:Xe,open:Boolean(Qe),onClose:tt,MenuListProps:{"aria-labelledby":`actions-button-${Qe}`},children:t.map((e=>(0,Z.jsxs)(A.A,{onClick:()=>{Qe&&We(Qe,e)},children:[e.icon&&(0,Z.jsx)(g.A,{sx:{minWidth:"32px"},children:e.icon}),(0,Z.jsx)(f.A,{primary:e.label})]},e.id)))})})()]})}},5982:(e,t,i)=>{i.d(t,{A:()=>m});var n=i(8613),s=i(8517),r=i(1911),o=i(5895),l=i(4199),a=i(2571),d=i(8263),c=i(5557),u=i(579);const m=e=>{let{item:t,onSubmit:i,onClose:m}=e;const[p,h]=(0,n.useState)(""),[v,x]=(0,n.useState)("");return(0,u.jsxs)(s.A,{open:!0,onClose:m,maxWidth:"sm",fullWidth:!0,children:[(0,u.jsxs)(r.A,{children:[(0,u.jsx)(o.A,{variant:"h6",children:"Report Issue for:"}),(0,u.jsxs)(o.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]})]}),(0,u.jsx)(l.A,{dividers:!0,children:(0,u.jsx)(a.A,{autoFocus:!0,margin:"dense",id:"issueDescription",label:"Describe the Issue *",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:p,onChange:e=>{h(e.target.value),v&&x("")},error:!!v,helperText:v||"Please provide details about the problem."})}),(0,u.jsxs)(d.A,{sx:{padding:"16px 24px"},children:[(0,u.jsx)(c.A,{onClick:m,color:"secondary",children:"Cancel"}),(0,u.jsx)(c.A,{onClick:()=>{p.trim()?(i(p),m()):x("Please enter a description of the issue.")},variant:"contained",color:"primary",children:"Save Issue Report"})]})]})}},7553:(e,t,i)=>{i.d(t,{A:()=>g});var n=i(8613),s=i(8006),r=i(6185),o=i(5895),l=i(8517),a=i(1911),d=i(4199),c=i(2967),u=i(549),m=i(4225),p=i(2959),h=i(4527),v=i(8263),x=i(5557),A=i(579);const g=e=>{let{db:t,orgId:i,itemId:g,userId:f,onClose:S,onEntityClick:j,onActionSelected:y,logAction:b}=e;const[I,D]=(0,n.useState)([]),[N,C]=(0,n.useState)(!0),[k,w]=(0,n.useState)(null),[E,P]=(0,n.useState)({});(0,n.useEffect)((()=>{if(!i)return;const e=(0,s.collection)(t,`orgs/${i}/members`);(0,s.getDocs)(e).then((e=>{const t={};e.docs.forEach((e=>{const i=e.data();t[e.id]=i.email||e.id})),P(t)})).catch((e=>console.error("Error fetching members:",e)))}),[i,t,P]),(0,n.useEffect)((()=>{if(!i)return w("Organization ID is required."),void C(!1);C(!0),w(null);const e=(0,s.collection)(t,`orgs/${i}/logs`),n=(0,s.query)(e,(0,s.where)("tool","==","incomingtool"),(0,s.orderBy)("ts","desc"),(0,s.limit)(100)),r=(0,s.onSnapshot)(n,(e=>{const t=e.docs.map((e=>{const t=e.data();return{orgId:i,toolKey:t.toolKey||t.tool,action:t.action,entityPath:t.entityPath,timestamp:t.timestamp||t.ts,userId:t.userId||t.uid,userEmail:t.email,before:t.before,after:t.after,details:t.details}})).filter((e=>"app-loaded"!==e.action));D(t),C(!1)}),(e=>{console.error("Error fetching user activity logs: ",e);w(`Failed to load activity logs: ${e.message}`),C(!1)}));return()=>r()}),[i,t,D]);const F=e=>{var t,i,l;const a=e.timestamp instanceof s.Timestamp?e.timestamp.toDate().toLocaleString():"string"===typeof e.timestamp?new Date(e.timestamp).toLocaleString():"Invalid Date",d=e.userEmail||E[e.userId||""]||e.userId||"system",c=(e=>{switch(e.action){case"item.create":return"Item created";case"item.update.fields":{var t,i;if(e.before&&e.after){var n;const t=(null===(n=e.details)||void 0===n?void 0:n.changedFields)||Object.keys(e.after).filter((t=>{var i,n;return JSON.stringify(null===(i=e.before)||void 0===i?void 0:i[t])!==JSON.stringify(null===(n=e.after)||void 0===n?void 0:n[t])}));if(t.length)return`Edited ${t.map((t=>{var i,n;return`${t}: ${null===(i=e.before)||void 0===i?void 0:i[t]} \u2192 ${null===(n=e.after)||void 0===n?void 0:n[t]}`})).join(", ")}`}const s=null===(t=e.details)||void 0===t||null===(i=t.changedFields)||void 0===i?void 0:i.join(", ");return s?`Edited fields: ${s}`:"Item edited"}default:var s,r,o,l,a,d,c,u,m;return e.action.startsWith("item.update.status.")?`Status changed: ${(null===(s=e.details)||void 0===s?void 0:s.previousStatus)||(null===(r=e.before)||void 0===r?void 0:r.currentStatus)||"Unknown"} \u2192 ${(null===(o=e.details)||void 0===o?void 0:o.newStatus)||e.action.replace("item.update.status.","")}`:"item.update.flag"===e.action?(null===(l=e.details)||void 0===l?void 0:l.isFlagged)?"Item flagged":"Item unflagged":"item.update.issue.report"===e.action?`Issue reported: ${(null===(a=e.details)||void 0===a?void 0:a.description)||(null===(d=e.details)||void 0===d?void 0:d.issueDescription)||""}`:"item.update.issue.update"===e.action?`Issue update added: ${(null===(c=e.details)||void 0===c?void 0:c.note)||""}`:"item.update.issue.resolve"===e.action?`Issue resolved: ${(null===(u=e.details)||void 0===u?void 0:u.resolutionOutcome)||""}`:"item.add_note"===e.action?`Note added: ${(null===(m=e.details)||void 0===m?void 0:m.note)||""}`:e.action}})(e),u=e.entityPath.split("/"),m=u.length>=2?u[1]:"",p=null===(t=e.before)||void 0===t?void 0:t.quantity,h=null===(i=e.before)||void 0===i?void 0:i.productName,v=p&&h?`${p}x ${h}`:(null===(l=e.before)||void 0===l?void 0:l.deliveryName)||h||m;return(0,A.jsx)(r.A,{primary:(0,A.jsxs)(n.Fragment,{children:[(0,A.jsxs)(o.A,{sx:{display:"inline"},component:"span",variant:"body2",color:"text.primary",children:[a," - ",c," by ",d]}),(0,A.jsx)(o.A,{component:"span",variant:"body2",onClick:()=>j(m),sx:{ml:1,cursor:"pointer",color:"primary.main",textDecoration:"underline"},children:v})]})})};return(0,A.jsxs)(l.A,{open:!0,onClose:S,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[(0,A.jsxs)(a.A,{children:[(0,A.jsx)(o.A,{variant:"h6",children:"User Activity Log"}),(0,A.jsx)(o.A,{variant:"caption",children:"Last 100 entries"})]}),(0,A.jsxs)(d.A,{dividers:!0,children:[N&&(0,A.jsx)(c.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:(0,A.jsx)(u.A,{})}),k&&(0,A.jsx)(o.A,{color:"error",sx:{textAlign:"center",mt:2},children:k}),!N&&!k&&(0,A.jsx)(m.A,{dense:!0,sx:{width:"100%",bgcolor:"background.paper",p:0},children:0===I.length?(0,A.jsx)(p.Ay,{children:(0,A.jsx)(r.A,{primary:"No activity logs found."})}):I.map(((e,t)=>(0,A.jsxs)(n.Fragment,{children:[(0,A.jsx)(p.Ay,{alignItems:"flex-start",sx:{py:1.5},children:F(e)}),t<I.length-1&&(0,A.jsx)(h.A,{variant:"inset",component:"li"})]},`${e.timestamp}-${t}-${e.action}`)))})]}),(0,A.jsx)(v.A,{sx:{padding:"16px 24px"},children:(0,A.jsx)(x.A,{onClick:S,color:"primary",children:"Close"})})]})}},7694:(e,t,i)=>{i.d(t,{A:()=>v});var n=i(8613),s=i(8517),r=i(1911),o=i(5895),l=i(4199),a=i(2967),d=i(6679),c=i(5847),u=i(5303),m=i(8263),p=i(5557),h=i(579);const v=e=>{let{isOpen:t,onClose:i,allColumns:v,initialVisibleColumns:x,onSave:A}=e;const[g,f]=(0,n.useState)((()=>Object.fromEntries(v.map((e=>[e.id,!1])))));(0,n.useEffect)((()=>{if(t){const e=new Set(x.map((e=>e.id))),t=Object.fromEntries(v.map((t=>[t.id,e.has(t.id)])));f(t)}}),[t,x,v]);return(0,h.jsxs)(s.A,{open:t,onClose:i,maxWidth:"xs",fullWidth:!0,children:[(0,h.jsx)(r.A,{children:(0,h.jsx)(o.A,{variant:"h6",children:"Configure Table Columns"})}),(0,h.jsxs)(l.A,{dividers:!0,children:[(0,h.jsx)(o.A,{variant:"body2",gutterBottom:!0,children:"Select the columns you want to display:"}),(0,h.jsxs)(a.A,{sx:{maxHeight:"60vh",overflowY:"auto",pr:1},children:[" ",(0,h.jsx)(d.A,{children:v.map((e=>(0,h.jsx)(c.A,{control:(0,h.jsx)(u.A,{checked:g[e.id]||!1,onChange:()=>{return t=e.id,void f((e=>({...e,[t]:!e[t]})));var t},disabled:"actions"===e.id}),label:e.label},e.id)))})]})]}),(0,h.jsxs)(m.A,{sx:{padding:"16px 24px"},children:[(0,h.jsx)(p.A,{onClick:i,color:"secondary",children:"Cancel"}),(0,h.jsx)(p.A,{onClick:()=>{const e=v.map((e=>e.id)).filter((e=>g[e]));A(e)},variant:"contained",color:"primary",children:"Save Settings"})]})]})}}}]);
//# sourceMappingURL=544.13b1c5cd.chunk.js.map