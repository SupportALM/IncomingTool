"use strict";(self.webpackChunkincoming_tool=self.webpackChunkincoming_tool||[]).push([[544],{1453:(e,t,i)=>{i.d(t,{A:()=>l});var o=i(8613),s=i(579);const l=e=>{let{item:t,onSubmit:i,onClose:l}=e;const[n,r]=(0,o.useState)(""),[d,a]=(0,o.useState)("");return(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:l,children:(0,s.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",maxWidth:"500px",width:"90%",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{children:"Add Issue Update for:"}),(0,s.jsxs)("p",{style:{margin:"5px 0 15px 0",fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]}),t.issueDescription&&(0,s.jsxs)("div",{style:{marginBottom:"15px",padding:"10px",background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px"},children:[(0,s.jsx)("strong",{children:"Initial Issue:"})," ",t.issueDescription]}),(0,s.jsx)("label",{htmlFor:"updateNote",style:{fontWeight:"bold"},children:"Update Note:"}),(0,s.jsx)("textarea",{id:"updateNote",value:n,onChange:e=>{r(e.target.value),d&&a("")},style:{width:"calc(100% - 16px)",padding:"8px",minHeight:"80px",marginTop:"5px"},rows:4,placeholder:"e.g., Contacted seller, awaiting response..."}),d&&(0,s.jsx)("div",{style:{color:"red",fontSize:"0.8em",marginTop:"4px"},children:d}),(0,s.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,s.jsx)("button",{type:"button",onClick:l,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:()=>{n.trim()?i(n):a("Please enter an update note.")},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Update Note"})]})]})})}},2630:(e,t,i)=>{i.d(t,{A:()=>n});var o=i(8613),s=i(579);const l=["Item Accepted / Kept As Is","Item Repaired / Refurbished","Partial Refund Received","Returned to Supplier","Disposed Of","Other"],n=e=>{let{item:t,onSubmit:i,onClose:n}=e;const[r,d]=(0,o.useState)(""),[a,c]=(0,o.useState)(""),[u,p]=(0,o.useState)(""),g={marginBottom:"15px"},x={display:"block",marginBottom:"5px",fontWeight:"bold"},h={width:"calc(100% - 16px)",padding:"8px"};return(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:n,children:(0,s.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",maxWidth:"500px",width:"90%",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{children:"Resolve Issue for:"}),(0,s.jsxs)("p",{style:{margin:"5px 0 15px 0",fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]}),t.issueDescription&&(0,s.jsxs)("div",{style:{marginBottom:"15px",padding:"10px",background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px"},children:[(0,s.jsx)("strong",{children:"Initial Issue:"})," ",t.issueDescription]}),(0,s.jsxs)("div",{style:g,children:[(0,s.jsx)("label",{htmlFor:"resolutionOutcome",style:x,children:"Resolution Outcome:"}),(0,s.jsxs)("select",{id:"resolutionOutcome",value:r,onChange:e=>{d(e.target.value),u&&p("")},style:h,children:[(0,s.jsx)("option",{value:"",disabled:!0,children:"-- Select an Outcome --"}),l.map((e=>(0,s.jsx)("option",{value:e,children:e},e)))]}),u&&(0,s.jsx)("div",{style:{color:"red",fontSize:"0.8em",marginTop:"4px"},children:u})]}),(0,s.jsxs)("div",{style:g,children:[(0,s.jsx)("label",{htmlFor:"resolutionNotes",style:x,children:"Resolution Notes (Optional):"}),(0,s.jsx)("textarea",{id:"resolutionNotes",value:a,onChange:e=>c(e.target.value),style:{...h,minHeight:"60px"},rows:3,placeholder:"e.g., Supplier issued refund, repaired screen..."})]}),(0,s.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,s.jsx)("button",{type:"button",onClick:n,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:()=>{r?i(r,a.trim()||void 0):p("Please select a resolution outcome.")},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Resolution"})]})]})})}},3368:(e,t,i)=>{i.d(t,{A:()=>n});var o=i(8613),s=i(579);const l=e=>{let{text:t}=e;return(0,s.jsx)("span",{title:t,style:{cursor:"help",marginLeft:"4px",borderBottom:"1px dotted gray"},children:"?"})},n=e=>{let{onSave:t,onClose:i,initialData:n,firstInputRef:r}=e;const d=!!n,[a,c]=(0,o.useState)((null===n||void 0===n?void 0:n.purchaseStatus)||"Purchased"),[u,p]=(0,o.useState)((null===n||void 0===n?void 0:n.deliveryName)||""),[g,x]=(0,o.useState)((null===n||void 0===n?void 0:n.productName)||""),[h,m]=(0,o.useState)((null===n||void 0===n?void 0:n.quantity)||""),[v,y]=(0,o.useState)((null===n||void 0===n?void 0:n.pricePerItem)||""),[f,b]=(0,o.useState)((null===n||void 0===n?void 0:n.orderNumber)||""),[j,S]=(0,o.useState)((()=>(null===n||void 0===n?void 0:n.orderDate)||(new Date).toISOString().split("T")[0])),[D,I]=(0,o.useState)((null===n||void 0===n?void 0:n.seller)||""),[C,k]=(0,o.useState)((null===n||void 0===n?void 0:n.isVatRegistered)||"Unknown"),[A,E]=(0,o.useState)((null===n||void 0===n?void 0:n.destination)||""),[w,N]=(0,o.useState)((null===n||void 0===n?void 0:n.asinSku)||""),[F,R]=(0,o.useState)((null===n||void 0===n?void 0:n.acquisitionNotes)||""),[O,P]=(0,o.useState)((null===n||void 0===n?void 0:n.isFlagged)||!1),[T,$]=(0,o.useState)({});(0,o.useEffect)((()=>{n&&(c(n.purchaseStatus||"Purchased"),p(n.deliveryName||""),x(n.productName||""),m(n.quantity||""),y(n.pricePerItem||""),b(n.orderNumber||""),S(n.orderDate||(new Date).toISOString().split("T")[0]),I(n.seller||""),k(n.isVatRegistered||"Unknown"),E(n.destination||""),N(n.asinSku||""),R(n.acquisitionNotes||""),P(n.isFlagged||!1),$({}))}),[n]);const U={marginBottom:"15px"},L={display:"block",marginBottom:"5px",fontWeight:"bold"},_={width:"calc(100% - 16px)",padding:"8px"},B={color:"red",fontSize:"0.8em",marginTop:"4px"};return(0,s.jsxs)("div",{style:{backgroundColor:"white",padding:"20px",border:"1px solid #ccc",borderRadius:"8px",maxWidth:"500px",margin:"20px auto"},children:[" ",(0,s.jsx)("h3",{children:d?"Edit Stock Item":"Add New Stock Item"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("AddItemForm: handleSubmit",{deliveryName:u,productName:g,quantity:h,pricePerItem:v,orderDate:j,seller:D,destination:A,acquisitionNotes:F,isFlagged:O});const i=(()=>{const e={};return u.trim()||(e.deliveryName="Delivery Name is required."),g.trim()||(e.productName="Product Name is required."),(""===h||h<=0)&&(e.quantity="Quantity must be a positive number."),(""===v||v<0)&&(e.pricePerItem="Price must be zero or positive."),j||(e.orderDate="Order Date is required."),$(e),0===Object.keys(e).length})();console.log("AddItemForm: validation result",i,T),i?(console.log("AddItemForm: form valid, calling onSave"),t({purchaseStatus:a,deliveryName:u,productName:g,quantity:Number(h),pricePerItem:Number(v),orderNumber:f||void 0,orderDate:j,seller:D||void 0,isVatRegistered:"Unknown"===C?void 0:C,destination:A||void 0,asinSku:w||void 0,acquisitionNotes:F||void 0,isFlagged:O})):console.log("AddItemForm: form invalid, errors:",T)},children:[(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"deliveryName",children:["Delivery Name",(0,s.jsx)(l,{text:"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16"})]}),(0,s.jsx)("input",{ref:r,id:"deliveryName",type:"text",value:u,onChange:e=>p(e.target.value),style:_}),T.deliveryName&&(0,s.jsx)("div",{style:B,children:T.deliveryName})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"productName",children:["Product Name",(0,s.jsx)(l,{text:"The common name of the item. Example: Blue Widget Model X"})]}),(0,s.jsx)("input",{id:"productName",type:"text",value:g,onChange:e=>x(e.target.value),style:_}),T.productName&&(0,s.jsx)("div",{style:B,children:T.productName})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"quantity",children:["Quantity",(0,s.jsx)(l,{text:"How many units of this item are included? Example: 50"})]}),(0,s.jsx)("input",{id:"quantity",type:"number",value:h,onChange:e=>m(""===e.target.value?"":Number(e.target.value)),style:_,min:"1"}),T.quantity&&(0,s.jsx)("div",{style:B,children:T.quantity})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"pricePerItem",children:["Price Per Item",(0,s.jsx)(l,{text:"The cost for one single unit. Example: 12.50"})]}),(0,s.jsx)("input",{id:"pricePerItem",type:"number",value:v,onChange:e=>y(""===e.target.value?"":Number(e.target.value)),style:_,min:"0",step:"0.01"}),T.pricePerItem&&(0,s.jsx)("div",{style:B,children:T.pricePerItem})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"orderDate",children:["Order Date",(0,s.jsx)(l,{text:"The date the item was purchased or the return initiated."})]}),(0,s.jsx)("input",{id:"orderDate",type:"date",value:j,onChange:e=>S(e.target.value),style:_}),T.orderDate&&(0,s.jsx)("div",{style:B,children:T.orderDate})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"purchaseStatus",children:["Purchase Status",(0,s.jsx)(l,{text:"What is the origin of this item?"})]}),(0,s.jsxs)("select",{id:"purchaseStatus",value:a,onChange:e=>c(e.target.value),style:_,children:[(0,s.jsx)("option",{value:"Purchased",children:"Purchased"}),(0,s.jsx)("option",{value:"Ordered",children:"Ordered"}),(0,s.jsx)("option",{value:"Return Expected",children:"Return Expected"})]})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"orderNumber",children:["Order Number",(0,s.jsx)(l,{text:"Optional: External reference like eBay order ID or PO number. Example: 12-34567-89012"})]}),(0,s.jsx)("input",{id:"orderNumber",type:"text",value:f,onChange:e=>b(e.target.value),style:_})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"seller",children:["Seller / Source",(0,s.jsx)(l,{text:"Optional: Who did this item come from? Example: ebay_seller_123 or Customer Name (Return)"})]}),(0,s.jsx)("input",{id:"seller",type:"text",value:D,onChange:e=>I(e.target.value),style:_})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"isVatRegistered",children:["Seller VAT Registered?",(0,s.jsx)(l,{text:"Optional: Is the seller registered for VAT?"})]}),(0,s.jsxs)("select",{id:"isVatRegistered",value:C,onChange:e=>k(e.target.value),style:_,children:[(0,s.jsx)("option",{value:"Unknown",children:"Unknown"}),(0,s.jsx)("option",{value:"Yes",children:"Yes"}),(0,s.jsx)("option",{value:"No",children:"No"})]})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"destination",children:["Planned Destination",(0,s.jsx)(l,{text:"Optional: Where is this item intended to go after processing? Example: FBA Prep"})]}),(0,s.jsxs)("select",{value:["FBA Prep","Local Stock Shelf A","Refurbish Pile","Return to Supplier"].includes(A)?A:"Other",onChange:e=>{"Other"===e.target.value?E(""):E(e.target.value)},style:{..._,width:"auto",marginRight:"10px"},children:[(0,s.jsx)("option",{value:"FBA Prep",children:"FBA Prep"}),(0,s.jsx)("option",{value:"Local Stock Shelf A",children:"Local Stock Shelf A"}),(0,s.jsx)("option",{value:"Refurbish Pile",children:"Refurbish Pile"}),(0,s.jsx)("option",{value:"Return to Supplier",children:"Return to Supplier"}),(0,s.jsx)("option",{value:"Other",children:"Other (Specify Below)"})]}),(0,s.jsx)("input",{type:"text",placeholder:"Specify destination...",value:A,onChange:e=>E(e.target.value),style:{..._,width:"calc(50% - 26px)"}})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"asinSku",children:["ASIN / SKU",(0,s.jsx)(l,{text:"Optional: Amazon ASIN or internal SKU. Helps link inventory. Example: B0C1EXAMPLE / BLUE-WIDGET-XL"})]}),(0,s.jsx)("input",{id:"asinSku",type:"text",value:w,onChange:e=>N(e.target.value),style:_})]}),(0,s.jsxs)("div",{style:U,children:[(0,s.jsxs)("label",{style:L,htmlFor:"acquisitionNotes",children:["Acquisition Notes",(0,s.jsx)(l,{text:"Optional: Any specific notes from the purchase, order, or return request. Example: Seller mentioned slight scratch."})]}),(0,s.jsx)("textarea",{id:"acquisitionNotes",value:F,onChange:e=>R(e.target.value),style:{..._,height:"60px"}})]}),(0,s.jsxs)("div",{style:{...U,display:"flex",alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",id:"isFlagged",checked:O,onChange:e=>P(e.target.checked),style:{marginRight:"10px"}}),(0,s.jsxs)("label",{htmlFor:"isFlagged",style:{fontWeight:"normal"},children:[" ","Flag this item for follow-up",(0,s.jsx)(l,{text:"Check this box to mark the item with a flag for easy filtering later."})]})]}),(0,s.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,s.jsx)("button",{type:"button",onClick:i,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,s.jsx)("button",{type:"submit",style:{padding:"8px 15px",fontWeight:"bold"},children:d?"Update Item":"Save Item"})]})]})]})}},3691:(e,t,i)=>{i.d(t,{A:()=>c});var o=i(8613),s=i(1359),l=i(5929),n=i(579);const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e||null===e||""===e?(0,n.jsx)("span",{style:{color:"#888"},children:"N/A"}):`${t}${e}${i}`},d=e=>{var t;const i=new Date(e.timestamp).toLocaleString();switch(e.type){case"CREATED":return`${i}: Item Created`;case"EDITED":return`${i}: Item Edited (${(null===(t=e.details.changedFields)||void 0===t?void 0:t.join(", "))||"details"} changed)`;case"STATUS_CHANGED":return`${i}: Status changed from ${e.details.previousStatus||"?"} to ${e.details.newStatus||"?"}`;case"FLAG_TOGGLED":return`${i}: Item ${e.details.isFlagged?"Flagged":"Unflagged"}`;case"ISSUE_REPORTED":return`${i}: Issue Reported: ${e.details.issueDescription||""}`;case"ISSUE_UPDATE_ADDED":return`${i}: Issue Update Added: ${e.details.note||""}`;case"ISSUE_RESOLVED":return`${i}: Issue Resolved (Outcome: ${e.details.resolutionOutcome||"N/A"}${e.details.note?` - Note: ${e.details.note}`:""}`;case"NOTE_ADDED":return`${i}: Note Added: ${e.details.note||""}`;default:return`${i}: Unknown action`}},a=e=>{var t,i,o,l,n,r,d,a,c,u;const p=e.timestamp instanceof s.Dc?e.timestamp.toDate().toISOString():"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),g=e.userId||"system";let x=null,h={};switch(e.action){case"item.create":x="CREATED";break;case"item.update.fields":x="EDITED";h={changedFields:e.before&&e.after?Object.keys(e.after).filter((t=>e.before&&e.after&&JSON.stringify(e.before[t])!==JSON.stringify(e.after[t]))):(null===(t=e.details)||void 0===t?void 0:t.changedFields)||["details"]};break;case"item.update.status.Delivered":x="STATUS_CHANGED",h={previousStatus:null===(i=e.before)||void 0===i?void 0:i.currentStatus,newStatus:"Delivered"};break;case"item.update.status.Archived":x="STATUS_CHANGED",h={previousStatus:null===(o=e.before)||void 0===o?void 0:o.currentStatus,newStatus:"Archived"};break;case"item.update.flag":x="FLAG_TOGGLED",h={isFlagged:null===(l=e.after)||void 0===l?void 0:l.isFlagged};break;case"item.update.issue.report":x="ISSUE_REPORTED",h={issueDescription:(null===(n=e.details)||void 0===n?void 0:n.description)||(null===(r=e.details)||void 0===r?void 0:r.issueDescription)};break;case"item.update.issue.resolve":x="ISSUE_RESOLVED",h={resolutionOutcome:null===(d=e.details)||void 0===d?void 0:d.outcome,note:null===(a=e.details)||void 0===a?void 0:a.note};break;case"item.update.issue.update":x="ISSUE_UPDATE_ADDED",h={note:null===(c=e.details)||void 0===c?void 0:c.note};break;case"item.add_note":x="NOTE_ADDED",h={note:null===(u=e.details)||void 0===u?void 0:u.note};break;default:return console.warn(`Unhandled log action type for UI mapping: ${e.action}`),null}return x?{timestamp:p,userId:g,type:x,details:h}:null},c=e=>{let{item:t,orgId:i,onClose:c,closeButtonRef:u,onActionSelected:p}=e;const[g,x]=(0,o.useState)([]),[h,m]=(0,o.useState)(!0),[v,y]=(0,o.useState)(null),f=(0,l.getAvailableActions)(t.currentStatus,t.isFlagged),b={padding:"6px 12px",border:"1px solid #007bff",backgroundColor:"#007bff",color:"white",borderRadius:"4px",cursor:"pointer"},j={marginBottom:"8px",paddingBottom:"8px",borderBottom:"1px dashed #eee",fontSize:"0.9em"};return(0,o.useEffect)((()=>{if(null===t||void 0===t||!t.id||!i)return m(!1),void y("Missing item or organization ID for fetching logs.");x([]),m(!0),y(null);const e=(0,s.aU)(),o=`stockItems/${t.id}`,l=(0,s.rJ)(e,`orgs/${i}/logs`),n=(0,s.P)(l,(0,s._M)("entityPath","==",o),(0,s.My)("timestamp","desc")),r=(0,s.aQ)(n,(e=>{const t=e.docs.map((e=>({...e.data()}))).map(a).filter((e=>null!==e));x(t),m(!1)}),(e=>{console.error("Error fetching logs: ",e),y(`Failed to fetch activity log: ${e.message}`),m(!1)}));return()=>r()}),[null===t||void 0===t?void 0:t.id,i]),(0,n.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:30},onClick:c,children:[" ",(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",border:"1px solid #ccc",borderRadius:"8px",maxWidth:"600px",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[" ",(0,n.jsxs)("h3",{children:["Item Details: ",t.productName," - ",t.deliveryName]}),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginBottom:"15px"},children:f.map((e=>(0,n.jsx)("button",{style:b,onClick:()=>p(t.id,e),children:e},e)))}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"20px"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"ID:"})," ",t.id]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Status:"})," ",t.currentStatus]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Flagged:"})," ",t.isFlagged?"Yes":"No"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Product:"})," ",t.productName]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Delivery:"})," ",t.deliveryName]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Quantity:"})," ",t.quantity]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Price/Item:"})," ",r(t.pricePerItem,"\xa3")]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Order Date:"})," ",t.orderDate]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Purchase Status:"})," ",r(t.purchaseStatus)]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Order #:"})," ",r(t.orderNumber)]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Seller/Source:"})," ",r(t.seller)]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Destination:"})," ",r(t.destination)]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"ASIN/SKU:"})," ",r(t.asinSku)]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Acquisition Notes:"})," ",r(t.acquisitionNotes)]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Date Delivered:"})," ",r(t.dateDelivered?new Date(t.dateDelivered).toLocaleString():void 0)]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Issue Description:"})," ",r(t.issueDescription)]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Processor Notes:"})," ",r(t.processorNotes)]})]}),(0,n.jsxs)("details",{style:{marginTop:"20px"},children:[(0,n.jsx)("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"History / Activity Log"}),h&&(0,n.jsx)("div",{children:"Loading activity..."}),v&&(0,n.jsx)("div",{style:{color:"red"},children:v}),!h&&!v&&0===g.length&&(0,n.jsx)("div",{children:"No activity recorded."}),(0,n.jsx)("ul",{style:{paddingLeft:"20px",marginTop:"10px"},children:g.map(((e,t)=>(0,n.jsx)("li",{style:j,children:d(e)},t)))})]}),(0,n.jsx)("div",{style:{marginTop:"20px",textAlign:"right"},children:(0,n.jsx)("button",{ref:u,onClick:c,style:{padding:"8px 15px",fontWeight:"bold"},children:"Close"})})]})]})}},5929:(e,t,i)=>{i.r(t),i.d(t,{ActionMenu:()=>T,default:()=>H,getAvailableActions:()=>P});var o=i(1213),s=i(638),l=i(1359),n=i(8613),r=i(4705),d=i(8677),a=i(2789),c=i(3368),u=i(3691),p=i(5982),g=i(1453),x=i(2630),h=i(7694),m=i(9934),v=i(2571),y=i(2967),f=i(8229),b=i(6687),j=i(6623),S=i(8889),D=i(6647),I=i(5557),C=i(2043),k=i(2950),A=i(579);function E(e){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,i]=e;return void 0!==i})))}const w=e=>{let{onSearch:t,inputRef:i}=e;return(0,A.jsx)(v.A,{inputRef:i,fullWidth:!0,variant:"outlined",placeholder:"Search by Delivery Name or Product Name...",onChange:e=>t(e.target.value),sx:{mb:2}})},N=e=>{let{currentFilter:t,onFilterChange:i}=e;return(0,A.jsx)(y.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,A.jsx)(f.A,{value:t,onChange:(e,t)=>{i(t)},variant:"scrollable",scrollButtons:"auto","aria-label":"Stock item status filter tabs",children:["All","Pending Delivery","Delivered","Issue","Late","Archived"].map((e=>(0,A.jsx)(b.A,{label:e,value:e},e)))})})},F=e=>{if("Pending Delivery"!==e.currentStatus)return!1;const t=new Date(e.orderDate),i=new Date;return i.setDate(i.getDate()-7),t<i},R=(e,t,i)=>{const o=i?{borderLeft:"3px solid red"}:{};let s={};if("Pending Delivery"===e&&t)s={backgroundColor:"#cce5ff",color:"#004085"};else switch(e){case"Pending Delivery":s={backgroundColor:"#fff3cd",color:"#856404"};break;case"Delivered":s={backgroundColor:"#d4edda",color:"#155724"};break;case"Issue":s={backgroundColor:"#f8d7da",color:"#721c24"};break;case"Archived":s={backgroundColor:"#e2e3e5",color:"#383d41"};break;default:s={}}return{...s,...o}},O=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:(new Date).toISOString(),type:t,userId:e,details:i}},P=(e,t)=>{let i=[];switch(e){case"Pending Delivery":case"Late":i=["Mark as Delivered","Report Issue","View Details","Edit Item","Add Note"];break;case"Delivered":i=["Archive","Report Issue","View Details","Edit Item","Add Note"];break;case"Issue":i=["Resolve Issue","Add Issue Update","Archive","View Details","Edit Item","Add Note"];break;default:i=["View Details"]}return"Archived"!==e&&i.unshift(t?"Unflag Item":"Flag Item"),i},T=e=>{let{itemId:t,actions:i,onActionSelected:o,onClose:s,anchorEl:l,open:n}=e;return(0,A.jsx)(j.A,{anchorEl:l,open:n,onClose:s,MenuListProps:{"aria-labelledby":`actions-button-${t}`},children:i.map((e=>(0,A.jsx)(S.A,{onClick:()=>(e=>{o(t,e),s()})(e),children:e},e)))})},$=[{id:"orderDate",label:"Order Date"},{id:"quantity",label:"Qty"},{id:"productName",label:"Product Name"},{id:"deliveryName",label:"Delivery Name"},{id:"pricePerItem",label:"Price/Item"},{id:"seller",label:"Seller/Source"},{id:"destination",label:"Destination"},{id:"asinSku",label:"ASIN/SKU"},{id:"purchaseStatus",label:"Purchase Status"},{id:"orderNumber",label:"Order #"},{id:"currentStatus",label:"Status"},{id:"isFlagged",label:"Flagged"},{id:"acquisitionNotes",label:"Acquisition Notes"},{id:"issueDescription",label:"Issue Description"},{id:"dateDelivered",label:"Date Delivered"},{id:"actions",label:"Actions"}],U=["orderDate","quantity","productName","deliveryName","currentStatus","actions"],L="incomingTool_visibleColumns",_=e=>{let{col:t}=e;const{attributes:i,listeners:o,setNodeRef:s,transform:l,transition:n,isDragging:r}=(0,d.gl)({id:t.id}),c={transform:a.Ks.Translate.toString(l),transition:n,opacity:r?.8:1,zIndex:r?10:1,cursor:"move",border:"1px solid #ccc",padding:"8px",textAlign:"actions"===t.id?"center":"left",backgroundColor:r?"#e0e0e0":"#f2f2f2"};return(0,A.jsx)("th",{ref:s,style:c,...i,...o,children:t.label})},B=e=>{var t,i,o,s;let{items:l,visibleColumns:a,onActionSelected:c,onViewDetails:u,onColumnReorder:p,selectedRowIndex:g,openMenuId:x,menuAnchorEl:h,handleMenuOpen:m,handleMenuClose:v}=e;const[y,f]=(0,n.useState)(null),b=(0,r.FR)((0,r.MS)(r.AN),(0,r.MS)(r.uN,{coordinateGetter:d.JR})),j=(e,t)=>{const i=e=>"string"===typeof e||"number"===typeof e?e:"boolean"===typeof e?e?"Yes":"No":"-";switch(t){case"isFlagged":return(0,A.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px",textAlign:"center"},children:e.isFlagged?"\ud83d\udea9":""},t);case"actions":return(0,A.jsx)("td",{style:{border:"1px solid #ccc",padding:"0px",textAlign:"center",position:"relative"},onClick:e=>e.stopPropagation(),children:"Archived"!==e.currentStatus&&(0,A.jsx)(D.A,{"aria-label":`actions-for-${e.id}`,"aria-controls":`actions-menu-${e.id}`,"aria-haspopup":"true",onClick:t=>((e,t)=>{x===e?v():t&&m(t,e)})(e.id,t),children:(0,A.jsx)(C.A,{})})},"actions");case"currentStatus":const o=F(e);return(0,A.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px",...R(e.currentStatus,o,e.isFlagged)},onClick:e=>e.stopPropagation(),children:e.currentStatus},t);case"quantity":case"pricePerItem":const s=e[t];return(0,A.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px",textAlign:"right"},children:"number"===typeof s?s:"-"},t);case"dateDelivered":case"orderDate":const l=e[t],n="string"===typeof l&&l?new Date(l).toLocaleDateString():"-";return(0,A.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px"},children:n},t);case"acquisitionNotes":case"issueDescription":const r=e[t];return(0,A.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px"},children:"string"===typeof r?i(r):"-"},t);case"productName":case"deliveryName":case"seller":case"destination":case"asinSku":case"purchaseStatus":case"orderNumber":return(0,A.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px"},children:i(e[t])},t);default:return console.warn("Unhandled column ID in renderCellContent:",t),(0,A.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px"},children:"???"},t)}};return(0,A.jsxs)("div",{children:[(0,A.jsx)("h4",{children:"Stock & Processing List"}),(0,A.jsx)(r.Mp,{sensors:b,collisionDetection:r.fp,onDragEnd:p,children:(0,A.jsx)(d.gB,{items:a.map((e=>e.id)),strategy:d.m$,children:(0,A.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ccc"},children:[(0,A.jsx)("thead",{children:(0,A.jsx)("tr",{style:{backgroundColor:"#f2f2f2"},children:a.map((e=>(0,A.jsx)(_,{col:e},e.id)))})}),(0,A.jsx)("tbody",{children:l.length>0?l.map(((e,t)=>{const i=t===g;return(0,A.jsx)("tr",{style:i?{background:"#e3f0ff",outline:"2px solid #1976d2"}:{},children:a.map((t=>j(e,t.id)))},e.id)})):(0,A.jsx)("tr",{children:(0,A.jsx)("td",{colSpan:a.length,style:{border:"1px solid #ccc",padding:"16px",textAlign:"center"},children:"No items match the current filter."})})})]})})}),(0,A.jsx)(T,{itemId:x||"",actions:x?P(null!==(t=null===(i=l.find((e=>e.id===x)))||void 0===i?void 0:i.currentStatus)&&void 0!==t?t:"Pending Delivery",null!==(o=null===(s=l.find((e=>e.id===x)))||void 0===s?void 0:s.isFlagged)&&void 0!==o&&o):[],onActionSelected:c,onClose:v,anchorEl:h,open:Boolean(x)})]})},q=e=>{let{onClick:t}=e;return(0,A.jsx)(I.A,{variant:"contained",color:"primary",startIcon:(0,A.jsx)(k.A,{}),onClick:t,sx:{mb:2},children:"Add New Item"})},W=e=>{let{isChecked:t,onChange:i}=e;return(0,A.jsxs)("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center"},children:[" ",(0,A.jsx)("label",{htmlFor:"flagToggle",style:{marginRight:"8px",fontWeight:"bold"},children:"Show Flagged Only:"}),(0,A.jsx)("input",{type:"checkbox",id:"flagToggle",checked:t,onChange:e=>i(e.target.checked),style:{width:"20px",height:"20px"}})]})},M=e=>{let{onClose:t}=e;return(0,A.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,A.jsxs)("div",{style:{background:"white",padding:32,borderRadius:8,minWidth:400},children:[(0,A.jsx)("h3",{children:"Keyboard Shortcuts"}),(0,A.jsxs)("ul",{style:{lineHeight:2},children:[(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"/"})," \u2014 Focus search bar"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"a"})," \u2014 Add new item"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"c"})," \u2014 Open columns/settings"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"f"})," \u2014 Toggle flagged only"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"1-6"})," \u2014 Switch filter tabs"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"?"})," \u2014 Show this help"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"Arrow Up/Down"})," \u2014 Move row selection"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"Enter/o"})," \u2014 View details for selected row"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"e"})," \u2014 Edit selected row"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"r"})," \u2014 Report issue for selected row"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"l"})," \u2014 Flag/unflag selected row"]}),(0,A.jsxs)("li",{children:[(0,A.jsx)("b",{children:"Esc"})," \u2014 Close any open modal"]})]}),(0,A.jsx)("button",{autoFocus:!0,onClick:t,style:{marginTop:16,padding:"8px 20px"},children:"Close"})]})})},G={apiKey:"AIzaSyCC6x0MS2KOTIZtZUYh59KdsBos1fasNtA",authDomain:"hubalm.firebaseapp.com",projectId:"hubalm",storageBucket:"hubalm.firebasestorage.app",messagingSenderId:"201098929511",appId:"1:201098929511:web:a257c60dd4d6b4d2ab7bc2"};Object.entries(G).forEach((e=>{let[t,i]=e;if(!i)throw new Error(`Missing Firebase config value for ${t}. Did you set your .env file?`)}));const z=(0,o.Wp)(G),V=((0,s.xI)(z),(0,l.aU)(z)),H=e=>{let{user:t,org:i,permissions:o,logAction:s}=e;console.log("ToolApp Props Received:",{user:t,orgId:null===i||void 0===i?void 0:i.id,permissions:o,logActionExists:!!s});const[r,a]=(0,n.useState)(-1),[v,y]=(0,n.useState)(!1),[f,b]=(0,n.useState)([]),[j,S]=(0,n.useState)(!0),[D,I]=(0,n.useState)(null),[C,k]=(0,n.useState)(""),[R,P]=(0,n.useState)("Pending Delivery"),[T,_]=(0,n.useState)(null),[G,z]=(0,n.useState)(!1),[H,K]=(0,n.useState)(!1),[J,Y]=(0,n.useState)(null),[Q,X]=(0,n.useState)(null),[Z,ee]=(0,n.useState)(null),[te,ie]=(0,n.useState)(null),[oe,se]=(0,n.useState)(!1),[le,ne]=(0,n.useState)(!1),[re,de]=(0,n.useState)(null),[ae,ce]=(0,n.useState)(!1),[ue,pe]=(0,n.useState)((()=>{try{const e=localStorage.getItem(L),t=e?JSON.parse(e):U;return Array.isArray(t)?t:U}catch(D){return console.error("Error reading visible columns from localStorage",D),U}}));(0,n.useEffect)((()=>{try{localStorage.setItem(L,JSON.stringify(ue))}catch(D){console.error("Error saving visible columns to localStorage",D)}}),[ue]);const ge=ue.map((e=>$.find((t=>t.id===e)))).filter((e=>void 0!==e)),xe=f.filter((e=>{const t=!C||e.deliveryName.toLowerCase().includes(C.toLowerCase())||e.productName.toLowerCase().includes(C.toLowerCase());let i=!1;i="All"===R||("Late"===R?F(e):e.currentStatus===R);const o=!H||!0===e.isFlagged;return i&&t&&o}));(0,n.useEffect)((()=>{a((e=>0===xe.length?-1:e<0?0:e>=xe.length?xe.length-1:e))}),[xe]),(0,n.useEffect)((()=>{if(null===i||void 0===i||!i.id)return;S(!0),I(null);const e=(0,l.P)((0,l.rJ)(V,"orgs",i.id,"stockItems"),(0,l.My)("orderDate","desc")),t=(0,l.aQ)(e,(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));b(t),S(!1)}),(e=>{I("Failed to load items: "+e.message),S(!1)}));return()=>t()}),[null===i||void 0===i?void 0:i.id]);const he=(0,n.useCallback)((async(e,t,o,n)=>{if(!V||null===i||void 0===i||!i.id||!t)return console.error("Cannot update item: Missing configuration.",{db:!!V,orgId:null===i||void 0===i?void 0:i.id,userId:t}),void I("Cannot update item: Missing configuration.");const r=(0,l.H9)(V,"orgs",i.id,"stockItems",e),d=f.find((t=>t.id===e));if(!d)return console.error(`Item ${e} not found for update`),void I(`Item ${e} not found.`);const a=E({...o,lastUpdated:(0,l.O5)()}),c={...d,...a};try{if(await(0,l.mZ)(r,a),console.log(`Item ${e} updated successfully.`),console.log("updateItemAndLog: Attempting to log action. logAction available?",!!s),s){let t;try{if("EDITED"===n.type)t="item.update.fields";else if("FLAG_TOGGLED"===n.type)t="item.update.flag";else if("STATUS_CHANGED"===n.type){var u,p;t=`item.update.status.${(null===(u=n.details)||void 0===u||null===(p=u.newStatus)||void 0===p?void 0:p.toLowerCase())||"unknown"}`}else t="ISSUE_REPORTED"===n.type?"item.update.issue.report":"ISSUE_RESOLVED"===n.type?"item.update.issue.resolve":"ISSUE_UPDATE_ADDED"===n.type?"item.update.issue.update":"NOTE_ADDED"===n.type?"item.add_note":n.type}catch(g){console.error("Error deriving action name for logging:",g),t=n.type}const o={orgId:i.id,toolKey:"incomingtool",action:t,entityPath:`stockItems/${e}`,...void 0!==d&&{before:d},...void 0!==c&&{after:c},...void 0!==n.details&&{details:n.details}};await s(o)}}catch(x){throw console.error(`Error updating item ${e}:`,x),I(`Failed to update item: ${x.message}`),x}}),[i,f,s]),me=(0,n.useCallback)((async(e,i)=>{console.log(`Action: ${i} on item ${e}`);const o=f.find((t=>t.id===e));if(o)switch(i){case"Edit Item":Y(o),z(!0);break;case"Flag Item":case"Unflag Item":const s="Flag Item"===i;await he(e,null===t||void 0===t?void 0:t.uid,{isFlagged:s},O((null===t||void 0===t?void 0:t.uid)||"","FLAG_TOGGLED",{isFlagged:s}));break;case"Mark as Delivered":"Delivered"!==o.currentStatus&&await he(e,null===t||void 0===t?void 0:t.uid,{currentStatus:"Delivered",dateDelivered:(new Date).toISOString()},O((null===t||void 0===t?void 0:t.uid)||"","STATUS_CHANGED",{previousStatus:o.currentStatus,newStatus:"Delivered"}));break;case"Archive":"Archived"!==o.currentStatus&&await he(e,null===t||void 0===t?void 0:t.uid,{currentStatus:"Archived"},O((null===t||void 0===t?void 0:t.uid)||"","STATUS_CHANGED",{previousStatus:o.currentStatus,newStatus:"Archived"}));break;case"Add Note":de(o);break;case"Report Issue":_(null),X(o);break;case"Resolve Issue":_(null),ie(o);break;case"Add Issue Update":_(null),ee(o);break;case"View Details":_(o)}}),[null===t||void 0===t?void 0:t.uid,f,he,Y,z,X,ee,ie,_]),ve=(0,n.useCallback)((async e=>{if(!Q||null===i||void 0===i||!i.id)return;const o=Q.id;try{await he(o,null===t||void 0===t?void 0:t.uid,{currentStatus:"Issue",issueDescription:e},O((null===t||void 0===t?void 0:t.uid)||"","ISSUE_REPORTED",{issueDescription:e})),X(null)}catch(s){I("Failed to report issue: "+s.message)}}),[Q,null===i||void 0===i?void 0:i.id,null===t||void 0===t?void 0:t.uid,he,X,I]),ye=(0,n.useCallback)((async e=>{if(Z)try{await he(Z.id,null===t||void 0===t?void 0:t.uid,{},O((null===t||void 0===t?void 0:t.uid)||"","ISSUE_UPDATE_ADDED",{note:e})),ee(null)}catch(i){}}),[Z,he,ee,null===t||void 0===t?void 0:t.uid]),fe=(0,n.useCallback)((async(e,o)=>{if(!te||null===i||void 0===i||!i.id||!V)return;const n=te.id;let r="Delivered";"Returned to Supplier"!==e&&"Disposed Of"!==e||(r="Archived");O((null===t||void 0===t?void 0:t.uid)||"","ISSUE_RESOLVED",{resolutionOutcome:e,note:o});try{const t=(0,l.H9)(V,"orgs",i.id,"stockItems",n);await(0,l.mZ)(t,{currentStatus:r,lastUpdated:(0,l.O5)()});const d=f.find((e=>e.id===n));console.log("handleSaveResolveIssue: Attempting to log action. logAction available?",!!s),s&&await s({orgId:i.id,toolKey:"incomingtool",action:"item.update.issue.resolve",entityPath:`stockItems/${n}`,before:d,after:{...d,currentStatus:r},details:{resolutionOutcome:e,note:o}}),ie(null)}catch(d){I("Failed to resolve issue: "+d.message)}}),[te,null===i||void 0===i?void 0:i.id,null===t||void 0===t?void 0:t.uid,f,s,ie,I]),be=(0,n.useCallback)((()=>{z(!1),Y(null)}),[z,Y]),je=(0,n.useCallback)((async e=>{if(console.log("ToolApp: current editingItem at save",J),null===i||void 0===i||!i.id||!V)return console.error("ToolApp: Cannot save item because org.id or db is undefined",i),void I("Cannot save item: No organization selected or database unavailable.");console.log("ToolApp: handleSaveItem called",e);try{if(J&&J.id){const i=J.id,o=Object.keys(e).filter((t=>J.hasOwnProperty(t)&&J[t]!==e[t]));"isFlagged"in e&&!o.includes("isFlagged")&&J.isFlagged!==e.isFlagged&&o.push("isFlagged");const s=O((null===t||void 0===t?void 0:t.uid)||"","EDITED",{changedFields:o.length>0?o:void 0});await he(i,null===t||void 0===t?void 0:t.uid,e,s)}else{O((null===t||void 0===t?void 0:t.uid)||"","CREATED");const o=E({...e,currentStatus:"Pending Delivery",lastUpdated:(0,l.O5)()}),n=await(0,l.gS)((0,l.rJ)(V,"orgs",i.id,"stockItems"),o);console.log("handleSaveItem: Attempting to log action. logAction available?",!!s),s&&await s({orgId:i.id,toolKey:"incomingtool",action:"item.create",entityPath:`stockItems/${n.id}`,after:o})}be()}catch(o){console.error("Failed to save item",o),I("Failed to save item: "+o.message)}}),[J,i,t,s,he,be,I]),Se=(0,n.useCallback)((()=>{_(null)}),[_]),De=(0,n.useRef)(void 0);(0,n.useEffect)((()=>{De.current=null===i||void 0===i?void 0:i.id}),[i]);const Ie=(0,n.useCallback)((()=>{De.current?(Y(null),z(!0)):I("Cannot add item: Organization ID is missing.")}),[z,Y,I]),Ce=(0,n.useRef)(null),ke=e=>{const t=f.find((t=>t.id===e));t&&_(t)};(0,n.useEffect)((()=>{const e=e=>{var t;const i=e.target,o=i.tagName;if("INPUT"===o||"TEXTAREA"===o||i.isContentEditable)return;if(G||oe||T||Q||Z||te||v||ae)"Escape"===e.key&&(G&&z(!1),oe&&se(!1),T&&_(null),Q&&X(null),Z&&ee(null),te&&ie(null),v&&y(!1),ae&&ce(!1));else{if(e.key>="1"&&e.key<="6"){const t=["All","Pending Delivery","Delivered","Issue","Late","Archived"],i=parseInt(e.key,10)-1;if(i>=0&&i<t.length)return P(t[i]),void e.preventDefault()}if("?"===e.key)return y(!0),void e.preventDefault();if(xe.length>0){if("ArrowDown"===e.key)return a((e=>Math.min(xe.length-1,e<0?0:e+1))),void e.preventDefault();if("ArrowUp"===e.key)return a((e=>Math.max(0,e-1))),void e.preventDefault();if(("Enter"===e.key||"o"===e.key)&&r>=0&&r<xe.length)return _(xe[r]),void e.preventDefault();if("e"===e.key&&r>=0&&r<xe.length){const t=xe[r];return Y(t),z(!0),void e.preventDefault()}if("r"===e.key&&r>=0&&r<xe.length)return X(xe[r]),void e.preventDefault();if("l"===e.key&&r>=0&&r<xe.length){const t=xe[r];return me(t.id,t.isFlagged?"Unflag Item":"Flag Item"),void e.preventDefault()}}switch(e.key){case"/":e.preventDefault(),null===(t=Ce.current)||void 0===t||t.focus();break;case"a":case"A":J||Ie();break;case"c":case"C":se(!0)}}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[G,oe,T,Q,Z,te,v,ae,xe,r,J,me,P,Ie]);const Ae=(0,n.useCallback)((async(e,i)=>{if(null===t||void 0===t||!t.uid)return console.error("User ID is missing, cannot save note."),void I("User ID is missing, cannot save note.");console.log(`Saving general note for item ${e}: ${i}`);try{const o=O(t.uid,"NOTE_ADDED",{note:i});await he(e,t.uid,{},o),console.log(`General note saved and logged for item ${e}`),de(null)}catch(o){console.error(`Error saving general note for item ${e}:`,o),I(`Failed to save note: ${o.message}`)}}),[null===t||void 0===t?void 0:t.uid,he]),[Ee,we]=(0,n.useState)(null),[Ne,Fe]=(0,n.useState)(null);return(0,A.jsxs)("div",{style:{padding:24},children:[" ",(0,A.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,A.jsx)("h2",{children:"Incoming Stock Tool"}),(0,A.jsxs)("div",{children:[(0,A.jsx)("button",{onClick:()=>ce(!0),style:{marginRight:"10px"},children:"View User Activity"}),(0,A.jsx)("button",{onClick:()=>se(!0),children:"Table Settings"})]})]}),D&&(0,A.jsxs)("div",{style:{color:"red",marginBottom:"1rem"},children:["Error: ",D]}),j&&(0,A.jsx)("div",{style:{color:"blue",marginBottom:"1rem"},children:"Loading items..."}),(0,A.jsx)(q,{onClick:Ie}),(0,A.jsx)(w,{onSearch:e=>{k(e)},inputRef:Ce}),(0,A.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[(0,A.jsx)(N,{currentFilter:R,onFilterChange:e=>{P(e)}}),(0,A.jsx)(W,{isChecked:H,onChange:K})]}),(0,A.jsx)(B,{items:xe,visibleColumns:ge,onActionSelected:me,onViewDetails:ke,onColumnReorder:e=>{const{active:t,over:i}=e;i&&t.id!==i.id&&pe((e=>{const o=e.indexOf(t.id),s=e.indexOf(i.id);return(0,d.be)(e,o,s)}))},selectedRowIndex:r,openMenuId:Ee,menuAnchorEl:Ne,handleMenuOpen:(e,t)=>{Fe(e.currentTarget),we(t)},handleMenuClose:()=>{Fe(null),we(null)}}),G&&(0,A.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:20},children:[" ",(0,A.jsx)(c.A,{onSave:je,onClose:be,initialData:J})]}),T&&(0,A.jsx)(u.A,{item:T,orgId:i.id,onClose:Se,onActionSelected:me}),Q&&(0,A.jsx)(p.A,{item:Q,onSubmit:ve,onClose:()=>X(null)}),Z&&(0,A.jsx)(g.A,{item:Z,onSubmit:ye,onClose:()=>ee(null)}),te&&(0,A.jsx)(x.A,{item:te,onSubmit:fe,onClose:()=>ie(null)}),re&&(0,A.jsx)(g.A,{item:re,onSubmit:e=>Ae(re.id,e),onClose:()=>de(null)}),(0,A.jsx)(h.A,{isOpen:oe,onClose:()=>se(!1),allColumns:$,initialVisibleColumns:ge,onSave:e=>{pe((t=>{const i=new Set(e);return[...t.filter((e=>i.has(e))),...e.filter((e=>!t.includes(e)))]})),se(!1)}}),ae&&(null===i||void 0===i?void 0:i.id)&&(0,A.jsx)(m.A,{orgId:i.id,onClose:()=>ce(!1),onEntityClick:ke,onActionSelected:me}),v&&(0,A.jsx)(M,{onClose:()=>y(!1)})]})}},5982:(e,t,i)=>{i.d(t,{A:()=>l});var o=i(8613),s=i(579);const l=e=>{let{item:t,onSubmit:i,onClose:l}=e;const[n,r]=(0,o.useState)(""),[d,a]=(0,o.useState)("");return(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:l,children:(0,s.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",maxWidth:"500px",width:"90%",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{children:"Report Issue for:"}),(0,s.jsxs)("p",{style:{margin:"5px 0 15px 0",fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]}),(0,s.jsx)("label",{htmlFor:"issueDescription",style:{fontWeight:"bold"},children:"Describe the Issue:"}),(0,s.jsx)("textarea",{id:"issueDescription",value:n,onChange:e=>{r(e.target.value),d&&a("")},style:{width:"calc(100% - 16px)",padding:"8px",minHeight:"80px",marginTop:"5px"},rows:4}),d&&(0,s.jsx)("div",{style:{color:"red",fontSize:"0.8em",marginTop:"4px"},children:d}),(0,s.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,s.jsx)("button",{type:"button",onClick:l,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:()=>{n.trim()?i(n):a("Please enter a description of the issue.")},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Issue Report"})]})]})})}},7694:(e,t,i)=>{i.d(t,{A:()=>l});var o=i(8613),s=i(579);const l=e=>{let{isOpen:t,onClose:i,allColumns:l,initialVisibleColumns:n,onSave:r}=e;const[d,a]=(0,o.useState)((()=>Object.fromEntries(l.map((e=>[e.id,!1])))));(0,o.useEffect)((()=>{if(t){const e=new Set(n.map((e=>e.id))),t=Object.fromEntries(l.map((t=>[t.id,e.has(t.id)])));a(t)}}),[t,n,l]);if(!t)return null;const c={padding:"8px 12px",display:"flex",alignItems:"center"},u={marginLeft:"10px",cursor:"pointer"};return(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},onClick:i,children:(0,s.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",width:"400px",maxWidth:"90%",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{children:"Configure Table Columns"}),(0,s.jsx)("p",{children:"Select the columns you want to display:"}),(0,s.jsx)("div",{style:{flexGrow:1,overflowY:"auto",padding:"10px 0",border:"1px solid #eee",borderRadius:"4px",marginBottom:"15px"},children:l.map((e=>(0,s.jsxs)("div",{style:c,children:[(0,s.jsx)("input",{type:"checkbox",id:`col-checkbox-${e.id}`,checked:d[e.id]||!1,onChange:()=>{return t=e.id,void a((e=>({...e,[t]:!e[t]})));var t},disabled:"actions"===e.id}),(0,s.jsx)("label",{htmlFor:`col-checkbox-${e.id}`,style:u,children:e.label})]},e.id)))}),(0,s.jsxs)("div",{style:{marginTop:"auto",textAlign:"right",borderTop:"1px solid #eee",paddingTop:"15px"},children:[(0,s.jsx)("button",{type:"button",onClick:i,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:()=>{const e=l.map((e=>e.id)).filter((e=>d[e]));r(e)},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Column Settings"})]})]})})}},9934:(e,t,i)=>{i.d(t,{A:()=>n});var o=i(8613),s=i(1359),l=i(579);const n=e=>{let{orgId:t,onClose:i,onEntityClick:n,onActionSelected:r}=e;const[d,a]=(0,o.useState)([]),[c,u]=(0,o.useState)(!0),[p,g]=(0,o.useState)(null),[x,h]=(0,o.useState)({});(0,o.useEffect)((()=>{if(!t)return;const e=(0,s.aU)(),i=(0,s.rJ)(e,`orgs/${t}/members`);(0,s.GG)(i).then((e=>{const t={};e.docs.forEach((e=>{const i=e.data();t[e.id]=i.email||e.id})),h(t)})).catch((e=>console.error("Error fetching members:",e)))}),[t]),(0,o.useEffect)((()=>{if(!t)return g("Organization ID is required."),void u(!1);u(!0),g(null);const e=(0,s.aU)(),i=(0,s.rJ)(e,`orgs/${t}/logs`),o=(0,s.P)(i,(0,s._M)("tool","==","incomingtool"),(0,s.My)("ts","desc"),(0,s.AB)(100)),l=(0,s.aQ)(o,(e=>{const i=e.docs.map((e=>{const i=e.data();return{orgId:t,toolKey:i.toolKey||i.tool,action:i.action,entityPath:i.entityPath,timestamp:i.timestamp||i.ts,userId:i.userId||i.uid,userEmail:i.email,before:i.before,after:i.after,details:i.details}})).filter((e=>"app-loaded"!==e.action));a(i),u(!1)}),(e=>{console.error("Error fetching user activity logs: ",e),g(`Failed to load activity logs: ${e.message}`),u(!1)}));return()=>l()}),[t]);const m=e=>{var t,i,o;const r=e.timestamp instanceof s.Dc?e.timestamp.toDate().toLocaleString():"string"===typeof e.timestamp?new Date(e.timestamp).toLocaleString():"Invalid Date",d=e.userEmail||x[e.userId||""]||e.userId||"system",a=(e=>{switch(e.action){case"item.create":return"Item created";case"item.update.fields":{var t,i;if(e.before&&e.after){var o;const t=(null===(o=e.details)||void 0===o?void 0:o.changedFields)||Object.keys(e.after).filter((t=>{var i,o;return JSON.stringify(null===(i=e.before)||void 0===i?void 0:i[t])!==JSON.stringify(null===(o=e.after)||void 0===o?void 0:o[t])}));if(t.length)return`Edited ${t.map((t=>{var i,o;return`${t}: ${null===(i=e.before)||void 0===i?void 0:i[t]} \u2192 ${null===(o=e.after)||void 0===o?void 0:o[t]}`})).join(", ")}`}const s=null===(t=e.details)||void 0===t||null===(i=t.changedFields)||void 0===i?void 0:i.join(", ");return s?`Edited fields: ${s}`:"Item edited"}default:var s,l,n,r,d,a,c,u,p;return e.action.startsWith("item.update.status.")?`Status changed: ${(null===(s=e.details)||void 0===s?void 0:s.previousStatus)||(null===(l=e.before)||void 0===l?void 0:l.currentStatus)||"Unknown"} \u2192 ${(null===(n=e.details)||void 0===n?void 0:n.newStatus)||e.action.replace("item.update.status.","")}`:"item.update.flag"===e.action?(null===(r=e.details)||void 0===r?void 0:r.isFlagged)?"Item flagged":"Item unflagged":"item.update.issue.report"===e.action?`Issue reported: ${(null===(d=e.details)||void 0===d?void 0:d.description)||(null===(a=e.details)||void 0===a?void 0:a.issueDescription)||""}`:"item.update.issue.update"===e.action?`Issue update added: ${(null===(c=e.details)||void 0===c?void 0:c.note)||""}`:"item.update.issue.resolve"===e.action?`Issue resolved: ${(null===(u=e.details)||void 0===u?void 0:u.resolutionOutcome)||""}`:"item.add_note"===e.action?`Note added: ${(null===(p=e.details)||void 0===p?void 0:p.note)||""}`:e.action}})(e),c=e.entityPath.split("/"),u=c.length>=2?c[1]:"",p=null===(t=e.before)||void 0===t?void 0:t.quantity,g=null===(i=e.before)||void 0===i?void 0:i.productName,h=p&&g?`${p}x ${g}`:(null===(o=e.before)||void 0===o?void 0:o.deliveryName)||g||u;return(0,l.jsxs)("span",{children:[r,": ",a," by ",d," ",(0,l.jsx)("a",{href:"#",style:{textDecoration:"underline",cursor:"pointer"},onClick:e=>{e.preventDefault(),n(u)},children:h})]})},v={marginBottom:"5px",paddingBottom:"5px",borderBottom:"1px dashed #eee",fontSize:"0.9em"};return(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:40},onClick:i,children:(0,l.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",border:"1px solid #ccc",borderRadius:"8px",width:"80%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("h3",{children:"User Activity Log (Last 100 entries)"}),c&&(0,l.jsx)("div",{children:"Loading logs..."}),p&&(0,l.jsx)("div",{style:{color:"red"},children:p}),!c&&!p&&(0,l.jsxs)("div",{style:{flexGrow:1,overflowY:"auto",border:"1px solid #eee",padding:"10px",marginTop:"15px"},children:[0===d.length&&(0,l.jsx)("div",{children:"No activity logs found."}),d.map(((e,t)=>(0,l.jsx)("div",{style:v,children:m(e)},`${e.timestamp}-${t}`)))]}),(0,l.jsx)("div",{style:{marginTop:"20px",textAlign:"right"},children:(0,l.jsx)("button",{onClick:i,style:{padding:"8px 15px",fontWeight:"bold"},children:"Close"})})]})})}}}]);
//# sourceMappingURL=544.b7f5ccff.chunk.js.map