"use strict";(self.webpackChunkincoming_tool=self.webpackChunkincoming_tool||[]).push([[861],{1453:(e,t,i)=>{i.d(t,{A:()=>h});var s=i(8613),n=i.n(s),o=i(3023),r=i(1911),l=i(8776),a=i(9200),d=i(5895),c=i(3969),u=i(4343),p=i(5877),x=i(2097),m=i(579);const h=e=>{let{item:t,onSubmit:i,onClose:h,open:g}=e;const[v,f]=(0,s.useState)(""),[b,A]=(0,s.useState)("");n().useEffect((()=>{g||(f(""),A(""))}),[g]);return t&&g?(0,m.jsxs)(o.A,{open:g,onClose:h,maxWidth:"sm",fullWidth:!0,children:[(0,m.jsx)(r.A,{children:"Add Issue Update"}),(0,m.jsxs)(l.A,{children:[(0,m.jsxs)(a.A,{sx:{mb:2},children:["For item: ",(0,m.jsxs)(d.A,{component:"span",sx:{fontStyle:"italic",fontWeight:"medium"},children:[t.productName," - ",t.deliveryName]})]}),t.issueDescription&&(0,m.jsxs)(c.A,{sx:{mb:2,p:1.5,background:e=>e.palette.grey[100],border:e=>`1px solid ${e.palette.grey[300]}`,borderRadius:1},children:[(0,m.jsx)(d.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:"Initial Issue:"}),(0,m.jsx)(d.A,{variant:"body2",children:t.issueDescription})]}),(0,m.jsx)(u.A,{autoFocus:!0,required:!0,margin:"dense",id:"updateNote",label:"Update Note",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:v,onChange:e=>{f(e.target.value),b&&A("")},error:!!b,helperText:b,placeholder:"e.g., Contacted seller, awaiting response..."})]}),(0,m.jsxs)(p.A,{sx:{px:3,pb:2},children:[(0,m.jsx)(x.A,{onClick:h,color:"secondary",children:"Cancel"}),(0,m.jsx)(x.A,{onClick:()=>{v.trim()?i(v):A("Please enter an update note.")},variant:"contained",color:"primary",children:"Save Update Note"})]})]}):null}},2630:(e,t,i)=>{i.d(t,{A:()=>j});var s=i(8613),n=i.n(s),o=i(3023),r=i(1911),l=i(8776),a=i(9200),d=i(5895),c=i(3969),u=i(256),p=i(9067),x=i(4938),m=i(9441),h=i(2947),g=i(4343),v=i(5877),f=i(2097),b=i(579);const A=["Item Accepted / Kept As Is","Item Repaired / Refurbished","Partial Refund Received","Returned to Supplier","Disposed Of","Other"],j=e=>{let{item:t,onSubmit:i,onClose:j,open:y}=e;const[S,D]=(0,s.useState)(""),[I,C]=(0,s.useState)(""),[k,N]=(0,s.useState)("");n().useEffect((()=>{y||(D(""),C(""),N(""))}),[y]);return y&&t?(0,b.jsxs)(o.A,{open:y,onClose:j,maxWidth:"sm",fullWidth:!0,children:[(0,b.jsxs)(r.A,{children:["Resolve Issue for: ",t.productName," - ",t.deliveryName]}),(0,b.jsxs)(l.A,{children:[(0,b.jsxs)(a.A,{sx:{mb:2},children:["For item: ",(0,b.jsxs)(d.A,{component:"span",sx:{fontStyle:"italic",fontWeight:"medium"},children:[t.productName," - ",t.deliveryName]})]}),t.issueDescription&&(0,b.jsxs)(c.A,{sx:{mb:2,p:1.5,background:e=>e.palette.grey[100],border:e=>`1px solid ${e.palette.grey[300]}`,borderRadius:1},children:[(0,b.jsx)(d.A,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:"Initial Issue:"}),(0,b.jsx)(d.A,{variant:"body2",children:t.issueDescription})]}),(0,b.jsxs)(u.A,{fullWidth:!0,margin:"normal",required:!0,error:!!k,children:[(0,b.jsx)(p.A,{id:"resolution-outcome-label",children:"Resolution Outcome"}),(0,b.jsxs)(x.A,{labelId:"resolution-outcome-label",id:"resolutionOutcome",value:S,label:"Resolution Outcome",onChange:e=>{D(e.target.value),k&&N("")},children:[(0,b.jsx)(m.A,{value:"",disabled:!0,children:(0,b.jsx)("em",{children:"-- Select an Outcome --"})}),A.map((e=>(0,b.jsx)(m.A,{value:e,children:e},e)))]}),k&&(0,b.jsx)(h.A,{children:k})]}),(0,b.jsx)(g.A,{margin:"normal",id:"resolutionNotes",label:"Resolution Notes (Optional)",type:"text",fullWidth:!0,multiline:!0,rows:3,variant:"outlined",value:I,onChange:e=>C(e.target.value),placeholder:"e.g., Supplier issued refund, repaired screen..."})]}),(0,b.jsxs)(v.A,{sx:{px:3,pb:2},children:[(0,b.jsx)(f.A,{onClick:j,color:"secondary",children:"Cancel"}),(0,b.jsx)(f.A,{onClick:()=>{S?i(S,I.trim()||void 0):N("Please select a resolution outcome.")},variant:"contained",color:"primary",children:"Save Resolution"})]})]}):null}},3368:(e,t,i)=>{i.d(t,{A:()=>j});var s=i(8613),n=i(8065),o=i(2579),r=i(3023),l=i(1911),a=i(8776),d=i(3969),c=i(4343),u=i(256),p=i(9067),x=i(4938),m=i(9441),h=i(2947),g=i(5877),v=i(2097),f=i(9728),b=i(579);const A=e=>{let{text:t}=e;return(0,b.jsx)(n.A,{title:t,arrow:!0,children:(0,b.jsx)(o.A,{size:"small",sx:{ml:.5,verticalAlign:"middle"},children:(0,b.jsx)(f.A,{fontSize:"inherit"})})})},j=e=>{let{open:t,onClose:i,onSubmit:n,itemToEdit:o,user:f,orgId:j}=e;const y=!!o,S=(0,s.useRef)(null),D=(0,s.useCallback)((()=>({purchaseStatus:(null===o||void 0===o?void 0:o.purchaseStatus)||"Purchased",deliveryName:(null===o||void 0===o?void 0:o.deliveryName)||"",productName:(null===o||void 0===o?void 0:o.productName)||"",quantity:(null===o||void 0===o?void 0:o.quantity)||"",purchasePrice:(null===o||void 0===o?void 0:o.pricePerItem)||"",salesPrice:(null===o||void 0===o?void 0:o.salesPrice)||"",orderNumber:(null===o||void 0===o?void 0:o.orderNumber)||"",orderDate:(null===o||void 0===o?void 0:o.orderDate)||(new Date).toISOString().split("T")[0],supplier:(null===o||void 0===o?void 0:o.seller)||"",isVatRegistered:(null===o||void 0===o?void 0:o.isVatRegistered)||"Unknown",destination:(null===o||void 0===o?void 0:o.destination)||"",asinSku:(null===o||void 0===o?void 0:o.asinSku)||"",acquisitionNotes:(null===o||void 0===o?void 0:o.acquisitionNotes)||"",isFlagged:(null===o||void 0===o?void 0:o.isFlagged)||!1})),[o]),[I,C]=(0,s.useState)(D()),[k,N]=(0,s.useState)({});(0,s.useEffect)((()=>{t&&(C(D()),N({}),setTimeout((()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.focus()}),100))}),[o,t,D]);const w=e=>{const t=e.target,i=t.name;let s=t.value;"isFlagged"===i?s="true"===t.value:t instanceof HTMLInputElement&&"checkbox"===t.type&&(s=t.checked),C((e=>({...e,[i]:s}))),k[i]&&N((e=>{const t={...e};return delete t[i],t}))},E=e=>{if(e.preventDefault(),(()=>{const e={};return I.deliveryName.trim()||(e.deliveryName="Delivery Name is required."),I.productName.trim()||(e.productName="Product Name is required."),(""===I.quantity||Number(I.quantity)<=0)&&(e.quantity="Quantity must be a positive number."),(""===I.purchasePrice||Number(I.purchasePrice)<0)&&(e.purchasePrice="Purchase Price must be zero or positive."),""!==I.salesPrice&&Number(I.salesPrice)<0&&(e.salesPrice="Sales Price cannot be negative."),I.orderDate||(e.orderDate="Order Date is required."),I.supplier.trim()||(e.supplier="Supplier is required."),N(e),0===Object.keys(e).length})()){const e={...I,quantity:Number(I.quantity),pricePerItem:Number(I.purchasePrice),salesPrice:""===I.salesPrice?null:Number(I.salesPrice),seller:I.supplier};delete e.purchasePrice,delete e.supplier,n(e),i()}};return(0,b.jsxs)(r.A,{open:t,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,b.jsx)(l.A,{children:y?"Edit Stock Item":"Add New Stock Item"}),(0,b.jsx)(a.A,{children:(0,b.jsx)(d.A,{component:"form",onSubmit:E,noValidate:!0,sx:{mt:1},children:(0,b.jsxs)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:1},children:[(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,b.jsx)(c.A,{inputRef:S,autoFocus:!0,margin:"dense",name:"deliveryName",label:"Delivery Name",type:"text",fullWidth:!0,value:I.deliveryName,onChange:w,error:!!k.deliveryName,helperText:k.deliveryName||"Group items arriving together (e.g., eBay Batch Apr 16)",InputProps:{endAdornment:(0,b.jsx)(A,{text:"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16"})},required:!0})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",name:"productName",label:"Product Name",type:"text",fullWidth:!0,value:I.productName,onChange:w,error:!!k.productName,helperText:k.productName||"The common name of the item (e.g., Blue Widget Model X)",InputProps:{endAdornment:(0,b.jsx)(A,{text:"The common name of the item. Example: Blue Widget Model X"})},required:!0})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"calc(50% - 8px)",sm:"calc(25% - 12px)"},flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",name:"quantity",label:"Quantity",type:"number",fullWidth:!0,value:I.quantity,onChange:w,error:!!k.quantity,helperText:k.quantity||"How many units?",InputProps:{inputProps:{min:1},endAdornment:(0,b.jsx)(A,{text:"How many units of this item are included? Example: 50"})},required:!0})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"calc(50% - 8px)",sm:"calc(25% - 12px)"},flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",name:"purchasePrice",label:"Purchase Price",type:"number",fullWidth:!0,value:I.purchasePrice,onChange:w,error:!!k.purchasePrice,helperText:k.purchasePrice||"Cost per single unit (excl. VAT)",InputProps:{inputProps:{min:0,step:"0.01"},endAdornment:(0,b.jsx)(A,{text:"The cost for one single unit, excluding VAT. Example: 10.42"})},required:!0})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"calc(50% - 8px)",sm:"calc(25% - 12px)"},flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",name:"salesPrice",label:"Sales Price (Optional)",type:"number",fullWidth:!0,value:I.salesPrice,onChange:w,error:!!k.salesPrice,helperText:k.salesPrice||"Optional: The target selling price for one single unit, including VAT. Example: 19.99",InputProps:{inputProps:{min:0,step:"0.01"},endAdornment:(0,b.jsx)(A,{text:"Optional: The target selling price for one single unit, including VAT. Example: 19.99"})}})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",label:"Order Number (Optional)",name:"orderNumber",value:I.orderNumber,onChange:w,fullWidth:!0,error:!!k.orderNumber,helperText:k.orderNumber})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",name:"orderDate",label:"Order Date",type:"date",fullWidth:!0,value:I.orderDate,onChange:w,error:!!k.orderDate,helperText:k.orderDate||"The date the order was placed.",InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,b.jsx)(A,{text:"The date the item was purchased or the return initiated."})},required:!0})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"calc(50% - 8px)",sm:"calc(25% - 12px)"},flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",label:"Supplier",name:"supplier",value:I.supplier,onChange:w,fullWidth:!0,error:!!k.supplier,helperText:k.supplier||"Who did you buy this from? (e.g., eBay Seller name, Amazon)",InputProps:{endAdornment:(0,b.jsx)(A,{text:"The name of the seller or store you purchased from. Example: JohnDoe123 (eBay)"})},required:!0})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",label:"ASIN/SKU (Optional)",name:"asinSku",value:I.asinSku,onChange:w,fullWidth:!0,error:!!k.asinSku,helperText:k.asinSku||"Optional: Amazon ASIN or your internal SKU",InputProps:{endAdornment:(0,b.jsx)(A,{text:"Optional: Amazon Standard Identification Number (ASIN) or your internal Stock Keeping Unit (SKU). Example: B076MX3KCY"})}})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,b.jsxs)(u.A,{fullWidth:!0,margin:"dense",error:!!k.destination,children:[(0,b.jsx)(p.A,{id:"destination-label",children:"Destination (Optional)"}),(0,b.jsxs)(x.A,{labelId:"destination-label",label:"Destination (Optional)",name:"destination",value:I.destination,onChange:w,children:[(0,b.jsx)(m.A,{value:"",children:"Select Destination"}),(0,b.jsx)(m.A,{value:"Warehouse A",children:"Warehouse A"}),(0,b.jsx)(m.A,{value:"Warehouse B",children:"Warehouse B"}),(0,b.jsx)(m.A,{value:"Prep Center",children:"Prep Center"})]}),k.destination&&(0,b.jsx)(h.A,{children:k.destination})]})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,b.jsxs)(u.A,{fullWidth:!0,margin:"dense",error:!!k.isVatRegistered,children:[(0,b.jsx)(p.A,{id:"vat-registered-label",children:"VAT Registered? (Optional)"}),(0,b.jsxs)(x.A,{labelId:"vat-registered-label",label:"VAT Registered? (Optional)",name:"isVatRegistered",value:I.isVatRegistered,onChange:w,children:[(0,b.jsx)(m.A,{value:"Unknown",children:"Unknown"}),(0,b.jsx)(m.A,{value:"Yes",children:"Yes"}),(0,b.jsx)(m.A,{value:"No",children:"No"})]}),k.isVatRegistered&&(0,b.jsx)(h.A,{children:k.isVatRegistered})]})}),(0,b.jsx)(d.A,{sx:{flexBasis:{xs:"100%",sm:"calc(50% - 8px)"},flexGrow:1},children:(0,b.jsxs)(u.A,{fullWidth:!0,margin:"dense",error:!!k.isFlagged,children:[(0,b.jsx)(p.A,{id:"is-flagged-label",children:"Flag Item?"}),(0,b.jsxs)(x.A,{labelId:"is-flagged-label",label:"Flag Item?",name:"isFlagged",value:I.isFlagged?"true":"false",onChange:w,children:[(0,b.jsx)(m.A,{value:"false",children:"No"}),(0,b.jsx)(m.A,{value:"true",children:"Yes"})]}),k.isFlagged&&(0,b.jsx)(h.A,{children:k.isFlagged})]})}),(0,b.jsx)(d.A,{sx:{flexBasis:"100%",flexGrow:1},children:(0,b.jsx)(c.A,{margin:"dense",label:"Acquisition Notes (Optional)",name:"acquisitionNotes",value:I.acquisitionNotes,onChange:w,fullWidth:!0,multiline:!0,rows:3,error:!!k.acquisitionNotes,helperText:k.acquisitionNotes||"Optional: Any other details about purchase/item condition",InputProps:{endAdornment:(0,b.jsx)(A,{text:"Optional notes about the purchase, condition, or source. Example: Slight box damage, bought in auction."})}})})]})})}),(0,b.jsxs)(g.A,{children:[(0,b.jsx)(v.A,{onClick:i,color:"secondary",children:"Cancel"}),(0,b.jsx)(v.A,{type:"submit",onClick:E,variant:"contained",color:"primary",children:y?"Update Item":"Add Item"})]})]})}},3691:(e,t,i)=>{i.d(t,{A:()=>D});var s=i(8613),n=i(9550),o=i(5929),r=i(5895),l=i(3023),a=i(1911),d=i(2579),c=i(8776),u=i(3969),p=i(4527),x=i(172),m=i(5315),h=i(2455),g=i(6185),v=i(5877),f=i(2097),b=i(7421),A=i(579);const j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e||null===e||""===e?(0,A.jsx)(r.A,{component:"span",sx:{color:"text.secondary",fontStyle:"italic"},children:"N/A"}):"boolean"===typeof e?e?"Yes":"No":`${t}${e}${i}`},y=e=>{var t;const i=new Date(e.timestamp).toLocaleString();switch(e.type){case"CREATED":return`${i}: Item Created`;case"EDITED":return`${i}: Item Edited (${(null===(t=e.details.changedFields)||void 0===t?void 0:t.join(", "))||"details"} changed)`;case"STATUS_CHANGED":return`${i}: Status changed from ${e.details.previousStatus||"?"} to ${e.details.newStatus||"?"}`;case"FLAG_TOGGLED":return`${i}: Item ${e.details.isFlagged?"Flagged":"Unflagged"}`;case"ISSUE_REPORTED":return`${i}: Issue Reported: ${e.details.issueDescription||""}`;case"ISSUE_UPDATE_ADDED":return`${i}: Issue Update Added: ${e.details.note||""}`;case"ISSUE_RESOLVED":return`${i}: Issue Resolved (Outcome: ${e.details.resolutionOutcome||"N/A"}${e.details.note?` - Note: ${e.details.note}`:""}`;case"NOTE_ADDED":return`${i}: Note Added: ${e.details.note||""}`;default:return`${i}: Unknown action`}},S=e=>{var t,i,s,o,r,l,a,d,c,u;const p=e.timestamp instanceof n.Dc?e.timestamp.toDate().toISOString():"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),x=e.userId||"system";let m=null,h={};switch(e.action){case"item.create":m="CREATED";break;case"item.update.fields":m="EDITED";h={changedFields:e.before&&e.after?Object.keys(e.after).filter((t=>e.before&&e.after&&JSON.stringify(e.before[t])!==JSON.stringify(e.after[t]))):(null===(t=e.details)||void 0===t?void 0:t.changedFields)||["details"]};break;case"item.update.status.Delivered":m="STATUS_CHANGED",h={previousStatus:null===(i=e.before)||void 0===i?void 0:i.currentStatus,newStatus:"Delivered"};break;case"item.update.status.Archived":m="STATUS_CHANGED",h={previousStatus:null===(s=e.before)||void 0===s?void 0:s.currentStatus,newStatus:"Archived"};break;case"item.update.flag":m="FLAG_TOGGLED",h={isFlagged:null===(o=e.after)||void 0===o?void 0:o.isFlagged};break;case"item.update.issue.report":m="ISSUE_REPORTED",h={issueDescription:(null===(r=e.details)||void 0===r?void 0:r.description)||(null===(l=e.details)||void 0===l?void 0:l.issueDescription)};break;case"item.update.issue.resolve":m="ISSUE_RESOLVED",h={resolutionOutcome:null===(a=e.details)||void 0===a?void 0:a.outcome,note:null===(d=e.details)||void 0===d?void 0:d.note};break;case"item.update.issue.update":m="ISSUE_UPDATE_ADDED",h={note:null===(c=e.details)||void 0===c?void 0:c.note};break;case"item.add_note":m="NOTE_ADDED",h={note:null===(u=e.details)||void 0===u?void 0:u.note};break;default:return console.warn(`Unhandled log action type for UI mapping: ${e.action}`),null}return m?{timestamp:p,userId:x,type:m,details:h}:null},D=e=>{let{item:t,orgId:i,onClose:D,onActionSelected:I,open:C}=e;const[k,N]=(0,s.useState)([]),[w,E]=(0,s.useState)(!0),[P,T]=(0,s.useState)(null);if((0,s.useEffect)((()=>{if(null===t||void 0===t||!t.id||!i)return E(!1),void T("Missing item or organization ID for fetching logs.");N([]),E(!0),T(null);const e=(0,n.aU)(),s=`stockItems/${t.id}`,o=(0,n.rJ)(e,`orgs/${i}/logs`),r=(0,n.P)(o,(0,n._M)("entityPath","==",s),(0,n.My)("timestamp","desc")),l=(0,n.aQ)(r,(e=>{const t=e.docs.map((e=>({...e.data()}))).map(S).filter((e=>null!==e));N(t),E(!1)}),(e=>{console.error("Error fetching logs: ",e),T(`Failed to fetch activity log: ${e.message}`),E(!1)}));return()=>l()}),[null===t||void 0===t?void 0:t.id,i]),!C||!t)return null;const O=(0,o.getAvailableActions)(t.currentStatus,t.isFlagged);return(0,A.jsxs)(l.A,{open:C,onClose:D,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[" ",(0,A.jsxs)(a.A,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,A.jsxs)(r.A,{variant:"h6",children:["Item Details: ",t.productName]}),(0,A.jsx)(d.A,{"aria-label":"close",onClick:D,sx:{color:e=>e.palette.grey[500]},children:(0,A.jsx)(b.A,{})})]}),(0,A.jsxs)(c.A,{dividers:!0,sx:{pt:2},children:[" ",(0,A.jsxs)(u.A,{sx:{mb:2},children:[(0,A.jsx)(r.A,{variant:"subtitle1",gutterBottom:!0,children:"Key Information"}),(0,A.jsxs)(u.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:1},children:[(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Delivery Name:"})," ",j(t.deliveryName)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Product Name:"})," ",j(t.productName)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Status:"})," ",j(t.currentStatus)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Quantity:"})," ",j(t.quantity)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Price/Item:"})," ",j(t.pricePerItem,"$")]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Order Date:"})," ",j(t.orderDate?new Date(t.orderDate).toLocaleDateString():null)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Seller:"})," ",j(t.seller)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Order #:"})," ",j(t.orderNumber)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Destination:"})," ",j(t.destination)]}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{component:"span",sx:{fontWeight:"bold",minWidth:"120px",display:"inline-block"},children:"Flagged:"})," ",j(t.isFlagged)]})]})]}),(t.issueDescription||t.acquisitionNotes)&&(0,A.jsxs)(u.A,{sx:{mb:2},children:[(0,A.jsx)(r.A,{variant:"subtitle1",gutterBottom:!0,children:"Notes & Issues"}),t.issueDescription&&(0,A.jsxs)(u.A,{sx:{mb:1,p:1,background:e=>e.palette.warning.light,border:e=>`1px solid ${e.palette.warning.light}`,borderRadius:1},children:[(0,A.jsx)(r.A,{variant:"body2",sx:{fontWeight:"bold"},children:"Issue:"}),(0,A.jsx)(r.A,{variant:"body2",children:t.issueDescription})]}),t.acquisitionNotes&&(0,A.jsxs)(u.A,{sx:{mb:1},children:[(0,A.jsx)(r.A,{variant:"body2",sx:{fontWeight:"bold"},children:"Acquisition Notes:"}),(0,A.jsx)(r.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:t.acquisitionNotes})]})]}),(0,A.jsx)(p.A,{sx:{my:2}}),(0,A.jsxs)(u.A,{children:[(0,A.jsx)(r.A,{variant:"subtitle1",gutterBottom:!0,children:"Activity History"}),w?(0,A.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",my:2},children:(0,A.jsx)(x.A,{size:24})}):P?(0,A.jsxs)(r.A,{color:"error",variant:"body2",children:["Error loading history: ",P]}):0===k.length?(0,A.jsx)(r.A,{variant:"body2",sx:{color:"text.secondary"},children:"No activity history found for this item."}):(0,A.jsx)(m.A,{dense:!0,disablePadding:!0,children:k.map(((e,t)=>(0,A.jsx)(h.Ay,{disableGutters:!0,sx:{borderBottom:"1px dashed #eee",pb:.5,mb:.5},children:(0,A.jsx)(g.A,{primary:y(e),primaryTypographyProps:{variant:"body2"}})},t)))})]})]}),(0,A.jsxs)(v.A,{sx:{p:2,borderTop:e=>`1px solid ${e.palette.divider}`},children:[O.map((e=>(0,A.jsx)(f.A,{variant:"Edit Item"===e||"Resolve Issue"===e?"contained":"outlined",size:"small",onClick:()=>I(t.id||"",e),children:e},e))),(0,A.jsx)(f.A,{onClick:D,sx:{ml:"auto"},children:"Close"})," "]})]})}},5929:(e,t,i)=>{i.r(t),i.d(t,{ActionMenu:()=>M,default:()=>Y,getAvailableActions:()=>V});var s=i(9550),n=i(161),o=i(8613),r=i(4705),l=i(8677),a=i(2789),d=i(3368),c=i(3691),u=i(5982),p=i(1453),x=i(2630),m=i(7694),h=i(7553),g=i(4343),v=i(3969),f=i(3309),b=i(2843),A=i(2097),j=i(4799),y=i(8259),S=i(7443),D=i(756),I=i(4375),C=i(6172),k=i(1341),N=i(9651),w=i(2579),E=i(7934),P=i(9441),T=i(5535),O=i(2950),W=i(2043),R=i(579);function $(e){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,i]=e;return void 0!==i})))}const F=e=>{let{onSearch:t,inputRef:i}=e;return(0,R.jsx)(g.A,{inputRef:i,fullWidth:!0,variant:"outlined",placeholder:"Search by Delivery Name or Product Name...",onChange:e=>t(e.target.value),sx:{mb:2}})},U=e=>{let{currentFilter:t,onFilterChange:i}=e;return(0,R.jsx)(v.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,R.jsx)(f.A,{value:t,onChange:(e,t)=>{i(t)},"aria-label":"Stock item status filter",variant:"scrollable",scrollButtons:"auto",children:["All","Pending Delivery","Delivered","Issue","Late","Archived"].map((e=>(0,R.jsx)(b.A,{label:e,value:e},e)))})})},q=e=>{let{onClick:t}=e;return(0,R.jsx)(A.A,{variant:"contained",color:"primary",startIcon:(0,R.jsx)(O.A,{}),onClick:t,sx:{mb:2},children:"Add Stock Item"})},B=e=>{if("Pending Delivery"!==e.currentStatus)return!1;const t=new Date(e.orderDate),i=new Date;return i.setDate(i.getDate()-7),t<i},G=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:(new Date).toISOString(),type:t,userId:e,details:i}},V=(e,t)=>{let i=[];switch(e){case"Pending Delivery":case"Late":i=["Mark as Delivered","Report Issue","View Details","Edit Item","Add Note"];break;case"Delivered":i=["Archive","Report Issue","View Details","Edit Item","Add Note"];break;case"Issue":i=["Resolve Issue","Add Issue Update","Archive","View Details","Edit Item","Add Note"];break;default:i=["View Details"]}return"Archived"!==e&&i.unshift(t?"Unflag Item":"Flag Item"),i},M=e=>{let{itemId:t,actions:i,onActionSelected:s,onClose:n}=e;const r=(0,o.useRef)(null);return(0,o.useEffect)((()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&n()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[n]),(0,R.jsx)("div",{ref:r,style:{position:"absolute",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",boxShadow:"0 2px 5px rgba(0,0,0,0.15)",zIndex:10,minWidth:"150px",marginTop:"2px"},children:i.map((e=>(0,R.jsx)("button",{onClick:()=>s(t,e),style:{display:"block",width:"100%",padding:"8px 12px",border:"none",background:"none",textAlign:"left",cursor:"pointer"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#f0f0f0",onMouseLeave:e=>e.currentTarget.style.backgroundColor="transparent",children:e},e)))})},L=[{id:"orderDate",label:"Order Date"},{id:"quantity",label:"Qty"},{id:"productName",label:"Product Name"},{id:"deliveryName",label:"Delivery Name"},{id:"pricePerItem",label:"Price/Item"},{id:"seller",label:"Seller/Source"},{id:"destination",label:"Destination"},{id:"asinSku",label:"ASIN/SKU"},{id:"purchaseStatus",label:"Purchase Status"},{id:"orderNumber",label:"Order #"},{id:"currentStatus",label:"Status"},{id:"isFlagged",label:"Flagged"},{id:"acquisitionNotes",label:"Acquisition Notes"},{id:"issueDescription",label:"Issue Description"},{id:"dateDelivered",label:"Date Delivered"},{id:"actions",label:"Actions"}],z=["orderDate","quantity","productName","deliveryName","currentStatus","actions"],_=e=>{let{col:t}=e;const{attributes:i,listeners:s,setNodeRef:n,transform:o,transition:r,isDragging:d}=(0,l.gl)({id:t.id}),c={transform:a.Ks.Translate.toString(o),transition:r,opacity:d?.8:1,zIndex:d?10:1,cursor:"move",border:"1px solid #ccc",padding:"8px",textAlign:"actions"===t.id?"center":"left",backgroundColor:d?"#e0e0e0":"#f2f2f2"};return(0,R.jsx)("th",{ref:n,style:c,...i,...s,children:t.label})},K=e=>{var t,i;let{items:s,visibleColumns:n,onActionSelected:a,onViewDetails:d,onColumnReorder:c,selectedRowIndex:u=-1}=e;const[p,x]=(0,o.useState)(null),[m,h]=(0,o.useState)(null),g=()=>{x(null),h(null)},v=(0,r.FR)((0,r.MS)(r.AN),(0,r.MS)(r.uN,{coordinateGetter:l.JR})),f=n.map((e=>e.id));return(0,R.jsxs)(j.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,R.jsx)(y.A,{sx:{maxHeight:"calc(100vh - 300px)"},children:(0,R.jsx)(r.Mp,{sensors:v,collisionDetection:r.fp,onDragEnd:c,children:(0,R.jsxs)(S.A,{stickyHeader:!0,"aria-label":"stock items table",children:[(0,R.jsx)(D.A,{children:(0,R.jsx)(l.gB,{items:f,strategy:l.m$,children:n.map((e=>(0,R.jsx)(_,{col:e},e.id)))})}),(0,R.jsx)(I.A,{children:0===s.length?(0,R.jsx)(C.A,{children:(0,R.jsx)(k.A,{colSpan:n.length,align:"center",children:"No items found."})}):s.map(((e,t)=>{const i="Pending Delivery"===e.currentStatus&&B(e),s=((e,t,i)=>{const s=i?{borderLeft:"3px solid red"}:{};let n={};if("Pending Delivery"===e&&t)n={backgroundColor:"#cce5ff",color:"#004085"};else switch(e){case"Pending Delivery":n={backgroundColor:"#fff3cd",color:"#856404"};break;case"Delivered":n={backgroundColor:"#d4edda",color:"#155724"};break;case"Issue":n={backgroundColor:"#f8d7da",color:"#721c24"};break;case"Archived":n={backgroundColor:"#e2e3e5",color:"#383d41"};break;default:n={}}return{...n,...s}})(e.currentStatus,i,e.isFlagged);V(e.currentStatus,e.isFlagged);return(0,R.jsx)(C.A,{hover:!0,onClick:()=>d(e.id||""),sx:{cursor:"pointer",backgroundColor:t===u?e=>(0,N.X4)(e.palette.primary.light,.1):"inherit","&:last-child td, &:last-child th":{border:0},...s},children:n.map((t=>{if("actions"===t.id)return(0,R.jsx)(k.A,{align:"right",onClick:e=>e.stopPropagation(),sx:{py:.5},children:(0,R.jsx)(w.A,{"aria-label":"actions",size:"small",onClick:t=>{return i=t,s=e.id||"",x(i.currentTarget),void h(s);var i,s},children:(0,R.jsx)(W.A,{fontSize:"small"})})},t.id);const i=e[t.id];let s=i;return"orderDate"===t.id||"deliveryDate"===t.id?s=i?new Date(i).toLocaleDateString():"N/A":"boolean"===typeof i?s=i?"Yes":"No":null!==i&&void 0!==i&&""!==i||(s="-"),(0,R.jsx)(k.A,{sx:{py:1},children:s},t.id)}))},e.id)}))})]})})}),(0,R.jsx)(E.A,{anchorEl:p,open:Boolean(p),onClose:g,children:m&&V((null===(t=s.find((e=>e.id===m)))||void 0===t?void 0:t.currentStatus)||"Pending Delivery",null===(i=s.find((e=>e.id===m)))||void 0===i?void 0:i.isFlagged).map((e=>(0,R.jsx)(P.A,{onClick:()=>(e=>{m&&a(m,e),g()})(e),children:e},e)))})]})},H=e=>{let{isChecked:t,onChange:i}=e;return(0,R.jsxs)("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center"},children:[(0,R.jsx)("label",{htmlFor:"flagToggle",style:{marginRight:"8px",fontWeight:"bold"},children:"Show Flagged Only:"}),(0,R.jsx)("input",{type:"checkbox",id:"flagToggle",checked:t,onChange:e=>i(e.target.checked),style:{width:"20px",height:"20px"}})]})},J=e=>{let{onClose:t}=e;return(0,R.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,R.jsxs)("div",{style:{background:"white",padding:32,borderRadius:8,minWidth:400},children:[(0,R.jsx)("h3",{children:"Keyboard Shortcuts"}),(0,R.jsxs)("ul",{style:{lineHeight:2},children:[(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"/"})," \u2014 Focus search bar"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"a"})," \u2014 Add new item"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"c"})," \u2014 Open columns/settings"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"f"})," \u2014 Toggle flagged only"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"1-6"})," \u2014 Switch filter tabs"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"?"})," \u2014 Show this help"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"Arrow Up/Down"})," \u2014 Move row selection"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"Enter/o"})," \u2014 View details for selected row"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"e"})," \u2014 Edit selected row"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"r"})," \u2014 Report issue for selected row"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"l"})," \u2014 Flag/unflag selected row"]}),(0,R.jsxs)("li",{children:[(0,R.jsx)("b",{children:"Esc"})," \u2014 Close any open modal"]})]}),(0,R.jsx)("button",{autoFocus:!0,onClick:t,style:{marginTop:16,padding:"8px 20px"},children:"Close"})]})})},Y=e=>{let{user:t,org:i,permissions:a,logAction:g}=e;const[f,b]=(0,o.useState)([]),[A,j]=(0,o.useState)(!0),[y,S]=(0,o.useState)(null),[D,I]=(0,o.useState)("All"),[C,k]=(0,o.useState)(""),[N,w]=(0,o.useState)(!1),[E,P]=(0,o.useState)((()=>{const e=localStorage.getItem("visibleStockColumns");if(e)try{const t=JSON.parse(e),i=L.filter((e=>t.includes(e.id)));return i.length>0?i:z.map((e=>L.find((t=>t.id===e))))}catch(t){return console.error("Failed to parse saved columns:",t),z.map((e=>L.find((t=>t.id===e))))}return z.map((e=>L.find((t=>t.id===e))))})),O=(0,o.useRef)(null),[W,V]=(0,o.useState)(!1),[M,_]=(0,o.useState)(!1),[Y,Q]=(0,o.useState)(-1),[X,Z]=(0,o.useState)(null),[ee,te]=(0,o.useState)(!1),[ie,se]=(0,o.useState)(!1),[ne,oe]=(0,o.useState)(!1),[re,le]=(0,o.useState)(!1),[ae,de]=(0,o.useState)(!1),[ce,ue]=(0,o.useState)(!1),[pe,xe]=(0,o.useState)(!1),me=async(e,o,r)=>{if(!t||null===i||void 0===i||!i.id||!g)return console.error("User, Org ID, or logAction function is not available."),void S("Cannot perform action: Missing user or configuration.");const l=(0,s.H9)(n.db,`orgs/${i.id}/stockItems`,e),a=f.find((t=>t.id===e));try{const n=$(o);await(0,s.mZ)(l,{...n,lastModified:(0,s.O5)(),lastModifiedBy:t.uid});const d={userId:t.uid,orgId:i.id,entityPath:`stockItems/${e}`,timestamp:(0,s.O5)(),...r,before:r.action.startsWith("item.update")?$(a||{}):void 0,after:r.action.startsWith("item.update")?$(n):void 0};await g(d),console.log(`Action logged: ${r.action} for item ${e}`)}catch(d){console.error("Error updating item or logging action:",d),S(`Failed to ${r.action.replace("item.","")}. Please try again.`)}};console.log("--- ToolApp Body: Imported db from shell/firebase ---",n.db),console.log("--- ToolApp Body: Imported auth from shell/firebase ---",n.auth),(0,o.useEffect)((()=>{if(console.log("--- ToolApp useEffect: db instance ---",n.db),console.log("ToolApp useEffect: props.org =",i),null===i||void 0===i||!i.id)return console.error("ToolApp useEffect: Org ID is missing. Cannot fetch items."),j(!1),void S("Organization ID is missing. Cannot load data.");console.log(`ToolApp useEffect: Fetching items for orgId: ${i.id}`);const e=(0,s.rJ)(n.db,"organizations",i.id,"items"),t=(0,s.P)(e,(0,s.My)("orderDate","desc"));j(!0),S(null);const o=(0,s.aQ)(t,(e=>{console.log(`ToolApp useEffect: onSnapshot received ${e.size} documents.`);const t=e.docs.map((e=>{var t,i,s;const n=e.data();return{id:e.id,purchaseStatus:n.purchaseStatus||"Unknown",deliveryName:n.deliveryName||"",productName:n.productName||"",quantity:n.quantity||0,pricePerItem:n.pricePerItem||0,orderDate:null!==(t=n.orderDate)&&void 0!==t&&t.toDate?n.orderDate.toDate().toISOString():n.orderDate||"",currentStatus:n.currentStatus||"Pending Delivery",salesPrice:n.salesPrice,orderNumber:n.orderNumber,seller:n.seller,isVatRegistered:n.isVatRegistered,destination:n.destination,asinSku:n.asinSku,acquisitionNotes:n.acquisitionNotes,dateDelivered:null!==(i=n.dateDelivered)&&void 0!==i&&i.toDate?n.dateDelivered.toDate().toISOString():n.dateDelivered,processorNotes:n.processorNotes||"",issueDescription:n.issueDescription,isFlagged:n.isFlagged||!1,lastUpdated:null!==(s=n.lastUpdated)&&void 0!==s&&s.toDate?n.lastUpdated.toDate().toISOString():n.lastUpdated}}));b(t),j(!1)}),(e=>{console.error("ToolApp useEffect: Error fetching items:",e),S(`Error fetching data: ${e.message}`),j(!1)}));return()=>{console.log("ToolApp useEffect: Unsubscribing from snapshot listener."),o()}}),[null===i||void 0===i?void 0:i.id]);(0,r.FR)((0,r.MS)(r.AN),(0,r.MS)(r.uN,{coordinateGetter:l.JR}));const he=(0,o.useCallback)((e=>{const{active:t,over:i}=e;t.id!==(null===i||void 0===i?void 0:i.id)&&P((e=>{const s=e.findIndex((e=>e.id===t.id)),n=e.findIndex((e=>e.id===(null===i||void 0===i?void 0:i.id)));return(0,l.be)(e,s,n)}))}),[]),ge=()=>{se(!1),Z(null)},ve=()=>{oe(!1),Z(null)},fe=()=>{le(!1),Z(null)},be=()=>{de(!1),Z(null)},Ae=()=>{ue(!1)},je=async e=>{if(!t||null===i||void 0===i||!i.id||!g)return console.error("User, Org ID, or logAction function is not available."),void S("Cannot perform action: Missing user or configuration.");const o=await(0,s.gS)((0,s.rJ)(n.db,`orgs/${i.id}/stockItems`),{...e,currentStatus:"Pending Delivery",isFlagged:!1,lastModified:(0,s.O5)(),lastModifiedBy:t.uid,activityLog:[G(t.uid,"CREATED")]}),r={userId:t.uid,orgId:i.id,toolKey:"incoming-tool",entityPath:`stockItems/${o.id}`,action:"item.create",timestamp:(0,s.O5)()};await g(r),console.log(`Action logged: item.create for item ${o.id}`),be()},ye=(e,t)=>{const i=f.find((t=>t.id===e));if(i)switch(Z(i),t){case"View Details":te(!0);break;case"Edit Item":de(!0);break;case"Add Issue Update":se(!0);break;case"Resolve Issue":oe(!0);break;case"Report Issue":le(!0);break;case"Flag Item":case"Unflag Item":me(e,{isFlagged:"Flag Item"===t},{toolKey:"incoming-tool",action:"item.update.flag",details:{flagged:"Flag Item"===t}}),Z(null);break;case"Mark as Delivered":me(e,{currentStatus:"Delivered",dateDelivered:(new Date).toISOString()},{toolKey:"incoming-tool",action:"item.update.status.Delivered",details:{previousStatus:i.currentStatus}}),Z(null);break;case"Archive":me(e,{currentStatus:"Archived"},{toolKey:"incoming-tool",action:"item.update.status.Archived",details:{previousStatus:i.currentStatus}}),Z(null);break;default:console.warn(`Unhandled action: ${t}`),Z(null)}},Se=e=>{const t=f.find((t=>t.id===e));t&&(Z(t),te(!0))},De=f.map((e=>({...e,isLate:B(e)}))).filter((e=>{}));return(0,R.jsxs)(T.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[y&&(0,R.jsx)(v.A,{sx:{mb:2,p:2,backgroundColor:"#f8d7da",color:"#721c24",borderRadius:1},children:y}),(0,R.jsx)(F,{onSearch:k,inputRef:O}),(0,R.jsx)(U,{currentFilter:D,onFilterChange:I}),(0,R.jsx)(q,{onClick:()=>de(!0)}),(0,R.jsx)(H,{isChecked:!1,onChange:()=>console.log("Flag toggle changed")}),(0,R.jsx)(K,{items:De,visibleColumns:E,onActionSelected:ye,onViewDetails:Se,onColumnReorder:he,selectedRowIndex:Y}),ae&&t&&(0,R.jsx)(d.A,{open:ae,itemToEdit:X,onSubmit:e=>X?(async(e,t)=>{f.find((t=>t.id===e))?(await me(e,t,{toolKey:"incoming-tool",action:"item.update.fields",details:{updatedFields:Object.keys(t)}}),be()):S("Could not find item to update.")})(X.id||"",e):je,onClose:be,user:t,orgId:null===i||void 0===i?void 0:i.id}),(0,R.jsx)(c.A,{open:ee,item:X,orgId:null===i||void 0===i?void 0:i.id,onClose:()=>{te(!1),Z(null)},onActionSelected:ye}),(0,R.jsx)(p.A,{open:ie,item:X,onClose:ge,onSubmit:async e=>{null!==X&&void 0!==X&&X.id&&(await me(X.id,{},{toolKey:"incoming-tool",action:"item.update.issue.update",details:{note:e}}),ge())}}),(0,R.jsx)(x.A,{open:ne,item:X,onClose:ve,onSubmit:async(e,t)=>{null!==X&&void 0!==X&&X.id&&(await me(X.id,{currentStatus:"Delivered",issueDescription:void 0},{toolKey:"incoming-tool",action:"item.update.issue.resolve",details:{resolutionOutcome:e,note:t,previousStatus:X.currentStatus}}),ve())}}),re&&X&&(0,R.jsx)(u.A,{item:X,onSubmit:e=>(async(e,t)=>{var i;await me(e,{currentStatus:"Issue",issueDescription:t},{toolKey:"incoming-tool",action:"item.update.issue.report",details:{description:t,previousStatus:null===(i=f.find((t=>t.id===e)))||void 0===i?void 0:i.currentStatus}}),fe()})(X.id,e),onClose:fe}),ce&&(0,R.jsx)(m.A,{isOpen:ce,allColumns:L,initialVisibleColumns:E,onSave:e=>{localStorage.setItem("visibleStockColumns",JSON.stringify(e)),P(L.filter((t=>e.includes(t.id)))),Ae()},onClose:Ae}),pe&&(0,R.jsx)(J,{onClose:()=>{xe(!1)}}),M&&(0,R.jsx)(h.A,{orgId:null===i||void 0===i?void 0:i.id,onClose:()=>{},onEntityClick:e=>{console.log("User Activity View - Entity Clicked:",e);const t=e.split("/")[1];t&&Se(t)},onActionSelected:(e,t)=>{console.log("User Activity View - Action Selected:",e,t),ye(e,t)}})]})}},5982:(e,t,i)=>{i.d(t,{A:()=>o});var s=i(8613),n=i(579);const o=e=>{let{item:t,onSubmit:i,onClose:o}=e;const[r,l]=(0,s.useState)(""),[a,d]=(0,s.useState)("");return(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:o,children:(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",maxWidth:"500px",width:"90%",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("h3",{children:"Report Issue for:"}),(0,n.jsxs)("p",{style:{margin:"5px 0 15px 0",fontStyle:"italic"},children:[t.productName," - ",t.deliveryName]}),(0,n.jsx)("label",{htmlFor:"issueDescription",style:{fontWeight:"bold"},children:"Describe the Issue:"}),(0,n.jsx)("textarea",{id:"issueDescription",value:r,onChange:e=>{l(e.target.value),a&&d("")},style:{width:"calc(100% - 16px)",padding:"8px",minHeight:"80px",marginTop:"5px"},rows:4}),a&&(0,n.jsx)("div",{style:{color:"red",fontSize:"0.8em",marginTop:"4px"},children:a}),(0,n.jsxs)("div",{style:{marginTop:"20px",textAlign:"right"},children:[(0,n.jsx)("button",{type:"button",onClick:o,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,n.jsx)("button",{type:"button",onClick:()=>{r.trim()?i(r):d("Please enter a description of the issue.")},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Issue Report"})]})]})})}},7553:(e,t,i)=>{i.d(t,{A:()=>r});var s=i(8613),n=i(9550),o=i(579);const r=e=>{let{orgId:t,onClose:i,onEntityClick:r,onActionSelected:l}=e;const[a,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(!0),[p,x]=(0,s.useState)(null),[m,h]=(0,s.useState)({});(0,s.useEffect)((()=>{if(!t)return;const e=(0,n.aU)(),i=(0,n.rJ)(e,`orgs/${t}/members`);(0,n.GG)(i).then((e=>{const t={};e.docs.forEach((e=>{const i=e.data();t[e.id]=i.email||e.id})),h(t)})).catch((e=>console.error("Error fetching members:",e)))}),[t]),(0,s.useEffect)((()=>{if(!t)return x("Organization ID is required."),void u(!1);u(!0),x(null);const e=(0,n.aU)(),i=(0,n.rJ)(e,`orgs/${t}/logs`),s=(0,n.P)(i,(0,n._M)("tool","==","incomingtool"),(0,n.My)("ts","desc"),(0,n.AB)(100)),o=(0,n.aQ)(s,(e=>{const i=e.docs.map((e=>{const i=e.data();return{orgId:t,toolKey:i.toolKey||i.tool,action:i.action,entityPath:i.entityPath,timestamp:i.timestamp||i.ts,userId:i.userId||i.uid,userEmail:i.email,before:i.before,after:i.after,details:i.details}})).filter((e=>"app-loaded"!==e.action));d(i),u(!1)}),(e=>{console.error("Error fetching user activity logs: ",e),x(`Failed to load activity logs: ${e.message}`),u(!1)}));return()=>o()}),[t]);const g=e=>{var t,i,s;const l=e.timestamp instanceof n.Dc?e.timestamp.toDate().toLocaleString():"string"===typeof e.timestamp?new Date(e.timestamp).toLocaleString():"Invalid Date",a=e.userEmail||m[e.userId||""]||e.userId||"system",d=(e=>{switch(e.action){case"item.create":return"Item created";case"item.update.fields":{var t,i;if(e.before&&e.after){var s;const t=(null===(s=e.details)||void 0===s?void 0:s.changedFields)||Object.keys(e.after).filter((t=>{var i,s;return JSON.stringify(null===(i=e.before)||void 0===i?void 0:i[t])!==JSON.stringify(null===(s=e.after)||void 0===s?void 0:s[t])}));if(t.length)return`Edited ${t.map((t=>{var i,s;return`${t}: ${null===(i=e.before)||void 0===i?void 0:i[t]} \u2192 ${null===(s=e.after)||void 0===s?void 0:s[t]}`})).join(", ")}`}const n=null===(t=e.details)||void 0===t||null===(i=t.changedFields)||void 0===i?void 0:i.join(", ");return n?`Edited fields: ${n}`:"Item edited"}default:var n,o,r,l,a,d,c,u,p;return e.action.startsWith("item.update.status.")?`Status changed: ${(null===(n=e.details)||void 0===n?void 0:n.previousStatus)||(null===(o=e.before)||void 0===o?void 0:o.currentStatus)||"Unknown"} \u2192 ${(null===(r=e.details)||void 0===r?void 0:r.newStatus)||e.action.replace("item.update.status.","")}`:"item.update.flag"===e.action?(null===(l=e.details)||void 0===l?void 0:l.isFlagged)?"Item flagged":"Item unflagged":"item.update.issue.report"===e.action?`Issue reported: ${(null===(a=e.details)||void 0===a?void 0:a.description)||(null===(d=e.details)||void 0===d?void 0:d.issueDescription)||""}`:"item.update.issue.update"===e.action?`Issue update added: ${(null===(c=e.details)||void 0===c?void 0:c.note)||""}`:"item.update.issue.resolve"===e.action?`Issue resolved: ${(null===(u=e.details)||void 0===u?void 0:u.resolutionOutcome)||""}`:"item.add_note"===e.action?`Note added: ${(null===(p=e.details)||void 0===p?void 0:p.note)||""}`:e.action}})(e),c=e.entityPath.split("/"),u=c.length>=2?c[1]:"",p=null===(t=e.before)||void 0===t?void 0:t.quantity,x=null===(i=e.before)||void 0===i?void 0:i.productName,h=p&&x?`${p}x ${x}`:(null===(s=e.before)||void 0===s?void 0:s.deliveryName)||x||u;return(0,o.jsxs)("span",{children:[l,": ",d," by ",a," ",(0,o.jsx)("a",{href:"#",style:{textDecoration:"underline",cursor:"pointer"},onClick:e=>{e.preventDefault(),r(u)},children:h})]})},v={marginBottom:"5px",paddingBottom:"5px",borderBottom:"1px dashed #eee",fontSize:"0.9em"};return(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:40},onClick:i,children:(0,o.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",border:"1px solid #ccc",borderRadius:"8px",width:"80%",maxWidth:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,o.jsx)("h3",{children:"User Activity Log (Last 100 entries)"}),c&&(0,o.jsx)("div",{children:"Loading logs..."}),p&&(0,o.jsx)("div",{style:{color:"red"},children:p}),!c&&!p&&(0,o.jsxs)("div",{style:{flexGrow:1,overflowY:"auto",border:"1px solid #eee",padding:"10px",marginTop:"15px"},children:[0===a.length&&(0,o.jsx)("div",{children:"No activity logs found."}),a.map(((e,t)=>(0,o.jsx)("div",{style:v,children:g(e)},`${e.timestamp}-${t}`)))]}),(0,o.jsx)("div",{style:{marginTop:"20px",textAlign:"right"},children:(0,o.jsx)("button",{onClick:i,style:{padding:"8px 15px",fontWeight:"bold"},children:"Close"})})]})})}},7694:(e,t,i)=>{i.d(t,{A:()=>o});var s=i(8613),n=i(579);const o=e=>{let{isOpen:t,onClose:i,allColumns:o,initialVisibleColumns:r,onSave:l}=e;const[a,d]=(0,s.useState)((()=>Object.fromEntries(o.map((e=>[e.id,!1])))));(0,s.useEffect)((()=>{if(t){const e=new Set(r.map((e=>e.id))),t=Object.fromEntries(o.map((t=>[t.id,e.has(t.id)])));d(t)}}),[t,r,o]);if(!t)return null;const c={padding:"8px 12px",display:"flex",alignItems:"center"},u={marginLeft:"10px",cursor:"pointer"};return(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},onClick:i,children:(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"20px 30px",borderRadius:"8px",border:"1px solid #ccc",width:"400px",maxWidth:"90%",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("h3",{children:"Configure Table Columns"}),(0,n.jsx)("p",{children:"Select the columns you want to display:"}),(0,n.jsx)("div",{style:{flexGrow:1,overflowY:"auto",padding:"10px 0",border:"1px solid #eee",borderRadius:"4px",marginBottom:"15px"},children:o.map((e=>(0,n.jsxs)("div",{style:c,children:[(0,n.jsx)("input",{type:"checkbox",id:`col-checkbox-${e.id}`,checked:a[e.id]||!1,onChange:()=>{return t=e.id,void d((e=>({...e,[t]:!e[t]})));var t},disabled:"actions"===e.id}),(0,n.jsx)("label",{htmlFor:`col-checkbox-${e.id}`,style:u,children:e.label})]},e.id)))}),(0,n.jsxs)("div",{style:{marginTop:"auto",textAlign:"right",borderTop:"1px solid #eee",paddingTop:"15px"},children:[(0,n.jsx)("button",{type:"button",onClick:i,style:{marginRight:"10px",padding:"8px 15px"},children:"Cancel"}),(0,n.jsx)("button",{type:"button",onClick:()=>{const e=o.map((e=>e.id)).filter((e=>a[e]));l(e)},style:{padding:"8px 15px",fontWeight:"bold"},children:"Save Column Settings"})]})]})})}}}]);
//# sourceMappingURL=861.f4f5a829.chunk.js.map