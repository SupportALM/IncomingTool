"use strict";(self.webpackChunkincoming_tool=self.webpackChunkincoming_tool||[]).push([[935],{612:(e,t,i)=>{i.d(t,{Q:()=>o});var r=i(8613),n=i(8006),s=i(161);const o=e=>{const[t,i]=(0,r.useState)([]),[o,l]=(0,r.useState)(!0),[a,d]=(0,r.useState)(null),[c,u]=(0,r.useState)([]),[m,h]=(0,r.useState)(!0),[p,v]=(0,r.useState)(null),[g,A]=(0,r.useState)(""),[x,S]=(0,r.useState)("All"),[f,j]=(0,r.useState)(!1),y=o||m,b=a||p;(0,r.useEffect)((()=>{if(console.log("[useStockItems] Non-Archived Listener: Checking db and orgId:",{db_instance:s.db,org_id:e}),!s.db||!e)return console.warn("[useStockItems] Non-Archived Listener: db or orgId is missing, skipping Firestore query."),l(!1),void(e||i([]));l(!0),d(null),console.log(`[useStockItems] Non-Archived Listener: Setting up listener for orgs/${e}/stockItems (non-archived)`);const t=(0,n.query)((0,n.collection)(s.db,"orgs",e,"stockItems"),(0,n.where)("currentStatus","!=","Archived"),(0,n.orderBy)("currentStatus"),(0,n.orderBy)("orderDate","desc")),r=(0,n.onSnapshot)(t,(e=>{console.log("[useStockItems] Non-Archived Listener: Received snapshot.");const t=e.docs.map((e=>({...e.data(),id:e.id})));i(t),l(!1)}),(e=>{console.error("[useStockItems] Non-Archived Listener: Snapshot error:",e),d("Failed to load items: "+e.message),l(!1)}));return()=>{console.log("[useStockItems] Non-Archived Listener: Cleaning up listener."),r()}}),[e]),(0,r.useEffect)((()=>{if(console.log("[useStockItems] Archived Listener: Checking db and orgId:",{db_instance:s.db,org_id:e}),!s.db||!e)return console.warn("[useStockItems] Archived Listener: db or orgId is missing, skipping Firestore query."),h(!1),void(e||u([]));h(!0),v(null),console.log(`[useStockItems] Archived Listener: Setting up listener for orgs/${e}/stockItems (archived)`);const t=(0,n.query)((0,n.collection)(s.db,"orgs",e,"stockItems"),(0,n.where)("currentStatus","==","Archived"),(0,n.orderBy)("orderDate","desc")),i=(0,n.onSnapshot)(t,(e=>{console.log("[useStockItems] Archived Listener: Received snapshot.");const t=e.docs.map((e=>({...e.data(),id:e.id})));u(t),h(!1)}),(e=>{console.error("[useStockItems] Archived Listener: Snapshot error:",e),v("Failed to load archived items: "+e.message),h(!1)}));return()=>{console.log("[useStockItems] Archived Listener: Cleaning up listener."),i()}}),[e]);const I=(0,r.useMemo)((()=>("Archived"===x?c:t).filter((e=>{var t,i,r,n;const s=g.toLowerCase(),o=(null===(t=e.deliveryName)||void 0===t?void 0:t.toLowerCase().includes(s))||(null===(i=e.productName)||void 0===i?void 0:i.toLowerCase().includes(s))||(null===(r=e.seller)||void 0===r?void 0:r.toLowerCase().includes(s))||(null===(n=e.asinSku)||void 0===n?void 0:n.toLowerCase().includes(s));let l=!1;if("All"===x||"Archived"===x)l=!0;else if("Late"===x){l=(e=>{if("Pending Delivery"!==e.currentStatus)return!1;try{const t=new Date(e.orderDate),i=new Date;return i.setDate(i.getDate()-7),t<i}catch(t){return console.error("Error parsing orderDate for late check:",t),!1}})(e)}else l=e.currentStatus===x;const a=!f||!0===e.isFlagged;return l&&o&&a}))),[t,c,g,x,f]);return{allItems:t,archivedItems:c,items:I,loading:y,error:b,searchTerm:g,currentFilter:x,showFlaggedOnly:f,setSearchTerm:A,setCurrentFilter:S,setShowFlaggedOnly:j,setError:e=>{d(e),v(e)}}}},1453:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(8613),n=i(8517),s=i(1911),o=i(5895),l=i(4199),a=i(2967),d=i(2571),c=i(8263),u=i(5557),m=i(579);const h=e=>{let{isOpen:t,item:i,onSubmit:h,onClose:p}=e;const[v,g]=(0,r.useState)(""),[A,x]=(0,r.useState)("");return(0,m.jsxs)(n.A,{open:t,onClose:p,maxWidth:"sm",fullWidth:!0,children:[(0,m.jsxs)(s.A,{children:[(0,m.jsx)(o.A,{variant:"h6",children:"Add Issue Update for:"}),(0,m.jsxs)(o.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[i.productName," - ",i.deliveryName]})]}),(0,m.jsxs)(l.A,{dividers:!0,children:[i.issueDescription&&(0,m.jsx)(a.A,{sx:{mb:2,p:1.5,background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:1},children:(0,m.jsxs)(o.A,{variant:"body2",children:[(0,m.jsx)("strong",{children:"Initial Issue:"})," ",i.issueDescription]})}),(0,m.jsx)(d.A,{autoFocus:!0,margin:"dense",id:"updateNote",label:"Update Note *",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:v,onChange:e=>{g(e.target.value),A&&x("")},error:!!A,helperText:A||"Enter details about the update.",placeholder:"e.g., Contacted seller, awaiting response..."})]}),(0,m.jsxs)(c.A,{sx:{padding:"16px 24px"},children:[(0,m.jsx)(u.A,{onClick:p,color:"secondary",children:"Cancel"}),(0,m.jsx)(u.A,{onClick:()=>{v.trim()?(h(v),p()):x("Please enter an update note.")},variant:"contained",color:"primary",children:"Save Update Note"})]})]})}},1499:(e,t,i)=>{i.d(t,{W:()=>a});i(8613);var r=i(6623),n=i(8889),s=i(9801),o=i(6185),l=i(579);const a=e=>{let{itemId:t,actions:i,onActionSelected:a,onClose:d,anchorEl:c,open:u}=e;return(0,l.jsx)(r.A,{anchorEl:c,open:u,onClose:d,MenuListProps:{"aria-labelledby":`actions-button-${t}`},children:i.map((e=>(0,l.jsxs)(n.A,{onClick:()=>(e=>{a(t,e),d()})(e),children:[e.icon&&(0,l.jsx)(s.A,{sx:{minWidth:"32px"},children:e.icon}),(0,l.jsx)(o.A,{primary:e.label})]},e.id)))})}},2630:(e,t,i)=>{i.d(t,{A:()=>S});var r=i(8613),n=i(8517),s=i(1911),o=i(5895),l=i(4199),a=i(2967),d=i(3863),c=i(5809),u=i(4553),m=i(8889),h=i(468),p=i(2571),v=i(8263),g=i(5557),A=i(579);const x=["Item Accepted / Kept As Is","Item Repaired / Refurbished","Partial Refund Received","Returned to Supplier","Disposed Of","Other"],S=e=>{let{isOpen:t,item:i,onSubmit:S,onClose:f}=e;const[j,y]=(0,r.useState)(""),[b,I]=(0,r.useState)(""),[D,C]=(0,r.useState)("");return(0,A.jsxs)(n.A,{open:t,onClose:f,maxWidth:"sm",fullWidth:!0,children:[(0,A.jsxs)(s.A,{children:[(0,A.jsx)(o.A,{variant:"h6",children:"Resolve Issue for:"}),(0,A.jsxs)(o.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[i.productName," - ",i.deliveryName]})]}),(0,A.jsxs)(l.A,{dividers:!0,children:[i.issueDescription&&(0,A.jsx)(a.A,{sx:{mb:2,p:1.5,background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:1},children:(0,A.jsxs)(o.A,{variant:"body2",children:[(0,A.jsx)("strong",{children:"Initial Issue:"})," ",i.issueDescription]})}),(0,A.jsxs)(d.A,{fullWidth:!0,error:!!D,sx:{mb:2},children:[(0,A.jsx)(c.A,{id:"resolution-outcome-label",children:"Resolution Outcome *"}),(0,A.jsxs)(u.A,{labelId:"resolution-outcome-label",id:"resolutionOutcome",value:j,label:"Resolution Outcome *",onChange:e=>{y(e.target.value),D&&C("")},children:[(0,A.jsx)(m.A,{value:"",disabled:!0,children:(0,A.jsx)("em",{children:"-- Select an Outcome --"})}),x.map((e=>(0,A.jsx)(m.A,{value:e,children:e},e)))]}),D&&(0,A.jsx)(h.A,{children:D})]}),(0,A.jsx)(p.A,{id:"resolutionNotes",label:"Resolution Notes (Optional)",multiline:!0,rows:3,fullWidth:!0,value:b,onChange:e=>I(e.target.value),placeholder:"e.g., Supplier issued refund, repaired screen...",variant:"outlined",sx:{mb:2}})]}),(0,A.jsxs)(v.A,{sx:{padding:"16px 24px"},children:[(0,A.jsx)(g.A,{onClick:f,color:"secondary",children:"Cancel"}),(0,A.jsx)(g.A,{onClick:()=>{C(""),j?S(j,b.trim()||void 0):C("Please select a resolution outcome.")},variant:"contained",color:"primary",children:"Save Resolution"})]})]})}},3368:(e,t,i)=>{i.d(t,{A:()=>x});var r=i(8613),n=i(8517),s=i(1911),o=i(4199),l=i(2967),a=i(2571),d=i(3287),c=i(6647),u=i(8889),m=i(5847),h=i(5303),p=i(8263),v=i(5557),g=i(7347),A=i(579);const x=e=>{let{isOpen:t,onSave:i,onClose:x,initialData:S,firstInputRef:f}=e;const j=!!S,[y,b]=(0,r.useState)((null===S||void 0===S?void 0:S.purchaseStatus)||"Purchased"),[I,D]=(0,r.useState)((null===S||void 0===S?void 0:S.deliveryName)||""),[C,N]=(0,r.useState)((null===S||void 0===S?void 0:S.productName)||""),[k,w]=(0,r.useState)((null===S||void 0===S?void 0:S.quantity)||""),[E,O]=(0,r.useState)((null===S||void 0===S?void 0:S.pricePerItem)||""),[P,T]=(0,r.useState)((null===S||void 0===S?void 0:S.orderNumber)||""),[F,$]=(0,r.useState)((()=>(null===S||void 0===S?void 0:S.orderDate)||(new Date).toISOString().split("T")[0])),[R,U]=(0,r.useState)((null===S||void 0===S?void 0:S.seller)||""),[L,W]=(0,r.useState)((null===S||void 0===S?void 0:S.isVatRegistered)||"Unknown"),[_,q]=(0,r.useState)((null===S||void 0===S?void 0:S.destination)||""),[z,B]=(0,r.useState)((null===S||void 0===S?void 0:S.asinSku)||""),[G,V]=(0,r.useState)((null===S||void 0===S?void 0:S.acquisitionNotes)||""),[M,H]=(0,r.useState)((null===S||void 0===S?void 0:S.isFlagged)||!1),[J,K]=(0,r.useState)({});(0,r.useEffect)((()=>{S&&(b(S.purchaseStatus||"Purchased"),D(S.deliveryName||""),N(S.productName||""),w(S.quantity||""),O(S.pricePerItem||""),T(S.orderNumber||""),$(S.orderDate||(new Date).toISOString().split("T")[0]),U(S.seller||""),W(S.isVatRegistered||"Unknown"),q(S.destination||""),B(S.asinSku||""),V(S.acquisitionNotes||""),H(S.isFlagged||!1),K({}))}),[S]);const Q=e=>{e.preventDefault(),console.log("AddItemForm: handleSubmit",{deliveryName:I,productName:C,quantity:k,pricePerItem:E,orderDate:F,seller:R,destination:_,acquisitionNotes:G,isFlagged:M});const t=(()=>{const e={};return I.trim()||(e.deliveryName="Delivery Name is required."),C.trim()||(e.productName="Product Name is required."),(""===k||k<=0)&&(e.quantity="Quantity must be a positive number."),(""===E||E<0)&&(e.pricePerItem="Price must be zero or positive."),F||(e.orderDate="Order Date is required."),K(e),0===Object.keys(e).length})();console.log("AddItemForm: validation result",t,J),t?(console.log("AddItemForm: form valid, calling onSave"),i({purchaseStatus:y,deliveryName:I,productName:C,quantity:Number(k),pricePerItem:Number(E),orderNumber:P||void 0,orderDate:F,seller:R||void 0,isVatRegistered:"Unknown"===L?void 0:L,destination:_||void 0,asinSku:z||void 0,acquisitionNotes:G||void 0,isFlagged:M})):console.log("AddItemForm: form invalid, errors:",J)};return(0,A.jsxs)(n.A,{open:t,onClose:x,maxWidth:"sm",fullWidth:!0,children:[(0,A.jsx)(s.A,{children:j?"Edit Stock Item":"Add New Stock Item"}),(0,A.jsx)(o.A,{children:(0,A.jsxs)(l.A,{component:"form",onSubmit:Q,id:"add-item-form",noValidate:!0,sx:{mt:1},children:[(0,A.jsx)(a.A,{inputRef:f,margin:"normal",required:!0,fullWidth:!0,id:"deliveryName",label:"Delivery Name",name:"deliveryName",value:I,onChange:e=>D(e.target.value),error:!!J.deliveryName,helperText:J.deliveryName,InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"productName",label:"Product Name",name:"productName",value:C,onChange:e=>N(e.target.value),error:!!J.productName,helperText:J.productName,InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"The common name of the item. Example: Blue Widget Model X",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"quantity",label:"Quantity",name:"quantity",type:"number",value:k,onChange:e=>w(""===e.target.value?"":Number(e.target.value)),error:!!J.quantity,helperText:J.quantity,InputProps:{inputProps:{min:1},endAdornment:(0,A.jsx)(d.A,{title:"How many units of this item are included? Example: 50",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"pricePerItem",label:"Price Per Item",name:"pricePerItem",type:"number",value:E,onChange:e=>O(""===e.target.value?"":Number(e.target.value)),error:!!J.pricePerItem,helperText:J.pricePerItem,InputProps:{inputProps:{min:0,step:.01},endAdornment:(0,A.jsx)(d.A,{title:"The cost for one single unit. Example: 12.50",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",required:!0,fullWidth:!0,id:"orderDate",label:"Order Date",name:"orderDate",type:"date",value:F,onChange:e=>$(e.target.value),error:!!J.orderDate,helperText:J.orderDate,InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"The date the item was purchased or the return initiated.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"purchaseStatus",label:"Purchase Status",name:"purchaseStatus",select:!0,value:y,onChange:e=>b(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"What is the origin of this item?",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"Purchased",children:"Purchased"}),(0,A.jsx)(u.A,{value:"Ordered",children:"Ordered"}),(0,A.jsx)(u.A,{value:"Return Expected",children:"Return Expected"})]}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"orderNumber",label:"Order Number",name:"orderNumber",value:P,onChange:e=>T(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: External reference like eBay order ID or PO number. Example: 12-34567-89012",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"seller",label:"Seller / Source",name:"seller",value:R,onChange:e=>U(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Who did this item come from? Example: ebay_seller_123 or Customer Name (Return)",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"isVatRegistered",label:"Seller VAT Registered?",name:"isVatRegistered",select:!0,value:L,onChange:e=>W(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Is the seller registered for VAT?",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"Unknown",children:"Unknown"}),(0,A.jsx)(u.A,{value:"Yes",children:"Yes"}),(0,A.jsx)(u.A,{value:"No",children:"No"})]}),(0,A.jsxs)(a.A,{margin:"normal",fullWidth:!0,id:"destination",label:"Planned Destination",name:"destination",select:!0,value:["FBA Prep","Local Stock Shelf A","Refurbish Pile","Return to Supplier"].includes(_)?_:"Other",onChange:e=>{"Other"===e.target.value?q(""):q(e.target.value)},InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Where is this item intended to go after processing? Example: FBA Prep",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})},children:[(0,A.jsx)(u.A,{value:"FBA Prep",children:"FBA Prep"}),(0,A.jsx)(u.A,{value:"Local Stock Shelf A",children:"Local Stock Shelf A"}),(0,A.jsx)(u.A,{value:"Refurbish Pile",children:"Refurbish Pile"}),(0,A.jsx)(u.A,{value:"Return to Supplier",children:"Return to Supplier"}),(0,A.jsx)(u.A,{value:"Other",children:"Other (Specify Below)"})]}),""===_&&(0,A.jsx)(a.A,{margin:"dense",fullWidth:!0,id:"customDestination",label:"Specify Destination",name:"customDestination",value:_,onChange:e=>q(e.target.value),required:!0,error:!!J.destination,helperText:J.destination}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"asinSku",label:"ASIN / SKU",name:"asinSku",value:z,onChange:e=>B(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Amazon ASIN or internal SKU. Helps link inventory. Example: B0C1EXAMPLE / BLUE-WIDGET-XL",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(a.A,{margin:"normal",fullWidth:!0,id:"acquisitionNotes",label:"Acquisition Notes",name:"acquisitionNotes",value:G,onChange:e=>V(e.target.value),InputProps:{endAdornment:(0,A.jsx)(d.A,{title:"Optional: Any specific notes from the purchase, order, or return request. Example: Seller mentioned slight scratch.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",children:(0,A.jsx)(g.A,{fontSize:"small"})})})}}),(0,A.jsx)(m.A,{control:(0,A.jsx)(h.A,{id:"isFlagged",checked:M,onChange:e=>H(e.target.checked),name:"isFlagged"}),label:(0,A.jsxs)(l.A,{component:"span",sx:{display:"flex",alignItems:"center"},children:["Flag this item for follow-up",(0,A.jsx)(d.A,{title:"Check this box to mark the item with a flag for easy filtering later.",children:(0,A.jsx)(c.A,{size:"small",edge:"end",sx:{ml:.5},children:(0,A.jsx)(g.A,{fontSize:"inherit"})})})]}),sx:{mt:1}})]})}),(0,A.jsxs)(p.A,{children:[(0,A.jsx)(v.A,{onClick:x,children:"Cancel"}),(0,A.jsx)(v.A,{type:"submit",form:"add-item-form",variant:"contained",onClick:Q,children:j?"Save Changes":"Add Item"})]})]})}},3691:(e,t,i)=>{i.d(t,{A:()=>D});var r=i(8613),n=i.n(r),s=i(8006),o=i(8517),l=i(1911),a=i(4199),d=i(2967),c=i(5895),u=i(9623),m=i(5557),h=i(4225),p=i(2959),v=i(6185),g=i(549),A=i(5359),x=i(4527),S=i(8263),f=i(4558),j=i(579);const y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e||null===e||""===e?(0,j.jsx)("span",{style:{color:"#888"},children:"N/A"}):`${t}${e}${i}`},b=e=>{var t;const i=new Date(e.timestamp).toLocaleString();switch(e.type){case"CREATED":return`${i}: Item Created`;case"EDITED":return`${i}: Item Edited (${(null===(t=e.details.changedFields)||void 0===t?void 0:t.join(", "))||"details"} changed)`;case"STATUS_CHANGED":return`${i}: Status changed from ${e.details.previousStatus||"?"} to ${e.details.newStatus||"?"}`;case"FLAG_TOGGLED":return`${i}: Item ${e.details.isFlagged?"Flagged":"Unflagged"}`;case"ISSUE_REPORTED":return`${i}: Issue Reported: ${e.details.issueDescription||""}`;case"ISSUE_UPDATE_ADDED":return`${i}: Issue Update Added: ${e.details.note||""}`;case"ISSUE_RESOLVED":return`${i}: Issue Resolved (Outcome: ${e.details.resolutionOutcome||"N/A"}${e.details.note?` - Note: ${e.details.note}`:""}`;case"NOTE_ADDED":return`${i}: Note Added: ${e.details.note||""}`;default:return`${i}: Unknown action`}},I=e=>{var t,i,r,n,o,l,a,d,c,u;const m=e.timestamp instanceof s.Timestamp?e.timestamp.toDate().toISOString():"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),h=e.userId||"system";let p=null,v={};switch(e.action){case"item.create":p="CREATED";break;case"item.update.fields":p="EDITED";v={changedFields:e.before&&e.after?Object.keys(e.after).filter((t=>e.before&&e.after&&JSON.stringify(e.before[t])!==JSON.stringify(e.after[t]))):(null===(t=e.details)||void 0===t?void 0:t.changedFields)||["details"]};break;case"item.update.status.Delivered":p="STATUS_CHANGED",v={previousStatus:null===(i=e.before)||void 0===i?void 0:i.currentStatus,newStatus:"Delivered"};break;case"item.update.status.Archived":p="STATUS_CHANGED",v={previousStatus:null===(r=e.before)||void 0===r?void 0:r.currentStatus,newStatus:"Archived"};break;case"item.update.flag":p="FLAG_TOGGLED",v={isFlagged:null===(n=e.after)||void 0===n?void 0:n.isFlagged};break;case"item.update.issue.report":p="ISSUE_REPORTED",v={issueDescription:(null===(o=e.details)||void 0===o?void 0:o.description)||(null===(l=e.details)||void 0===l?void 0:l.issueDescription)};break;case"item.update.issue.resolve":p="ISSUE_RESOLVED",v={resolutionOutcome:null===(a=e.details)||void 0===a?void 0:a.outcome,note:null===(d=e.details)||void 0===d?void 0:d.note};break;case"item.update.issue.update":p="ISSUE_UPDATE_ADDED",v={note:null===(c=e.details)||void 0===c?void 0:c.note};break;case"item.add_note":p="NOTE_ADDED",v={note:null===(u=e.details)||void 0===u?void 0:u.note};break;default:return console.warn(`Unhandled log action type for UI mapping: ${e.action}`),null}return p?{timestamp:m,userId:h,type:p,details:v}:null},D=e=>{let{isOpen:t,item:i,orgId:D,onClose:C,closeButtonRef:N,onActionSelected:k}=e;const[w,E]=(0,r.useState)([]),[O,P]=(0,r.useState)(!0),[T,F]=(0,r.useState)(null),$=(0,f.tE)(i.currentStatus,i.isFlagged);return(0,r.useEffect)((()=>{if(null===i||void 0===i||!i.id||!D)return P(!1),void F("Missing item or organization ID for fetching logs.");E([]),P(!0),F(null);const e=(0,s.getFirestore)(),t=`stockItems/${i.id}`,r=(0,s.collection)(e,`orgs/${D}/logs`),n=(0,s.query)(r,(0,s.where)("entityPath","==",t),(0,s.orderBy)("timestamp","desc")),o=(0,s.onSnapshot)(n,(e=>{const t=e.docs.map((e=>({...e.data()}))).map(I).filter((e=>null!==e));E(t),P(!1)}),(e=>{console.error("Error fetching logs: ",e),F(`Failed to fetch activity log: ${e.message}`),P(!1)}));return()=>o()}),[null===i||void 0===i?void 0:i.id,D]),(0,j.jsxs)(o.A,{open:t,onClose:C,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[(0,j.jsxs)(l.A,{children:[i.productName," - Details"]}),(0,j.jsxs)(a.A,{dividers:!0,children:[" ",(0,j.jsxs)(d.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",pb:2},children:[(0,j.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Actions"}),(0,j.jsxs)(u.A,{direction:"row",spacing:1,flexWrap:"wrap",children:[" ",$.map((e=>(0,j.jsx)(m.A,{variant:"contained",size:"small",onClick:()=>k(i.id,e),title:e.description,children:e.label},e.id))),0===$.length&&(0,j.jsx)(c.A,{variant:"body2",color:"textSecondary",children:"No actions available for current status."})]})]}),(0,j.jsxs)(d.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",pb:1},children:[(0,j.jsx)(c.A,{variant:"h6",children:"Details"}),(0,j.jsxs)(h.A,{dense:!0,children:[" ",(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"ID",secondary:i.id})},"id"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Current Status",secondary:y(i.currentStatus)})},"currentStatus"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Flagged",secondary:i.isFlagged?"Yes":"No"})},"isFlagged"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Delivery Name",secondary:y(i.deliveryName)})},"deliveryName"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Product Name",secondary:y(i.productName)})},"productName"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Quantity",secondary:y(i.quantity)})},"quantity"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Price Per Item",secondary:y(i.pricePerItem,"\xa3")})},"pricePerItem"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Order Date",secondary:y(i.orderDate)})},"orderDate"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Purchase Status",secondary:y(i.purchaseStatus)})},"purchaseStatus"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Order Number",secondary:y(i.orderNumber)})},"orderNumber"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Seller / Source",secondary:y(i.seller)})},"seller"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"VAT Registered?",secondary:y(i.isVatRegistered)})},"isVatRegistered"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Destination",secondary:y(i.destination)})},"destination"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"ASIN / SKU",secondary:y(i.asinSku)})},"asinSku"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Acquisition Notes",secondary:y(i.acquisitionNotes),sx:{whiteSpace:"pre-wrap"}})},"acquisitionNotes"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Date Delivered",secondary:i.dateDelivered?new Date(i.dateDelivered).toLocaleString():y(null)})},"dateDelivered"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Processor Notes",secondary:y(i.processorNotes),sx:{whiteSpace:"pre-wrap"}})},"processorNotes"),(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:"Issue Description",secondary:y(i.issueDescription),sx:{whiteSpace:"pre-wrap"}})},"issueDescription")]})]}),(0,j.jsxs)(d.A,{children:[(0,j.jsx)(c.A,{variant:"h6",children:"Activity Log"}),O&&(0,j.jsx)(g.A,{size:24,sx:{display:"block",margin:"20px auto"}}),T&&(0,j.jsxs)(A.A,{severity:"error",children:["Error loading history: ",T]}),!O&&!T&&0===w.length&&(0,j.jsx)(c.A,{variant:"body2",color:"textSecondary",sx:{mt:2},children:"No activity recorded."}),!O&&!T&&w.length>0&&(0,j.jsx)(h.A,{dense:!0,children:w.map(((e,t)=>(0,j.jsxs)(n().Fragment,{children:[" ",(0,j.jsx)(p.Ay,{children:(0,j.jsx)(v.A,{primary:b(e),primaryTypographyProps:{variant:"body2"}})}),t<w.length-1&&(0,j.jsx)(x.A,{component:"li"})]},e.timestamp)))})]})]}),(0,j.jsx)(S.A,{children:(0,j.jsx)(m.A,{ref:N,onClick:C,children:"Close"})})]})}},4032:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(8613),n=i.n(r),s=i(2967),o=i(2571),l=i(5847),a=i(5303),d=i(5895),c=i(8229),u=i(6687),m=i(579);const h=e=>{let{searchTerm:t,onSearchTermChange:i,showFlaggedOnly:r,onShowFlaggedOnlyChange:h,currentFilter:p,onCurrentFilterChange:v}=e;return(0,m.jsxs)(n().Fragment,{children:[(0,m.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,m.jsx)(o.A,{label:"Search Items",variant:"outlined",size:"small",fullWidth:!0,sx:{flexGrow:1},value:t,onChange:e=>i(e.target.value)}),(0,m.jsx)(l.A,{control:(0,m.jsx)(a.A,{checked:r,onChange:e=>h(e.target.checked),size:"small"}),label:(0,m.jsx)(d.A,{variant:"body2",children:"Show Flagged Only"}),sx:{mr:0,whiteSpace:"nowrap"}})]}),(0,m.jsx)(s.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,m.jsxs)(c.A,{value:p,onChange:(e,t)=>v(t),variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,"aria-label":"Stock item status filter",children:[(0,m.jsx)(u.A,{label:"All",value:"All"}),(0,m.jsx)(u.A,{label:"Pending",value:"Pending Delivery"}),(0,m.jsx)(u.A,{label:"Delivered",value:"Delivered"}),(0,m.jsx)(u.A,{label:"Issue",value:"Issue"}),(0,m.jsx)(u.A,{label:"Late",value:"Late"}),(0,m.jsx)(u.A,{label:"Archived",value:"Archived"})]})})]})}},4558:(e,t,i)=>{i.d(t,{Do:()=>n,cj:()=>r,fW:()=>s,tE:()=>o});const r=[{id:"orderDate",label:"Order Date"},{id:"quantity",label:"Qty"},{id:"productName",label:"Product Name"},{id:"deliveryName",label:"Delivery Name"},{id:"pricePerItem",label:"Price/Item"},{id:"seller",label:"Seller/Source"},{id:"destination",label:"Destination"},{id:"asinSku",label:"ASIN/SKU"},{id:"purchaseStatus",label:"Purchase Status"},{id:"orderNumber",label:"Order #"},{id:"currentStatus",label:"Status"},{id:"isFlagged",label:"Flagged"},{id:"acquisitionNotes",label:"Acquisition Notes"},{id:"issueDescription",label:"Issue Description"},{id:"dateDelivered",label:"Date Delivered"},{id:"actions",label:"Actions"}],n=["orderDate","quantity","productName","deliveryName","currentStatus","actions"],s="incomingTool_visibleColumns",o=(e,t)=>{let i=[];switch(e){case"Pending Delivery":case"Late":i=[{id:"Mark as Delivered",label:"Mark as Delivered",description:"Update status to Delivered"},{id:"Report Issue",label:"Report Issue",description:"Report an issue with this item"},{id:"Add Note",label:"Add Note",description:"Add a note to the item history"}];break;case"Delivered":i=[{id:"Archive",label:"Archive",description:"Archive this item"},{id:"Report Issue",label:"Report Issue",description:"Report an issue with this item"},{id:"Add Note",label:"Add Note",description:"Add a note to the item history"}];break;case"Issue":i=[{id:"Resolve Issue",label:"Resolve Issue",description:"Mark the issue as resolved"},{id:"Add Issue Update",label:"Add Issue Update",description:"Add an update note to the ongoing issue"},{id:"Archive",label:"Archive",description:"Archive this item"},{id:"Add Note",label:"Add Note",description:"Add a general note to the item history"}];break;case"Archived":i=[{id:"Unarchive Item",label:"Unarchive",description:"Restore this item from archive"},{id:"Add Note",label:"Add Note",description:"Add a note to the item history"}];break;default:i=[{id:"Add Note",label:"Add Note",description:"Add a note to the item history"}]}return"Archived"!==e&&i.unshift(t?{id:"action_unflag",label:"Unflag",description:"Remove the flag from this item"}:{id:"action_flag",label:"Flag",description:"Flag this item for attention"}),i}},5929:(e,t,i)=>{i.r(t),i.d(t,{default:()=>C});var r=i(8613),n=i(3368),s=i(3691),o=i(5982),l=i(1453),a=i(2630),d=i(7694),c=i(7553),u=i(8006),m=i(267),h=i(6748),p=i(2967),v=i(5359),g=i(1),A=i(161),x=i(612),S=i(8137),f=i(4032),j=i(6439),y=i(4558),b=i(9256),I=i(1499),D=i(579);console.log("[IncomingTool] ToolApp.tsx: Top level, imported db is:",A.db);const C=e=>{let{user:t,org:i,permissions:C,logAction:N}=e;console.log("ToolApp Props Received:",{user:t,orgId:null===i||void 0===i?void 0:i.id,permissions:C,logActionExists:!!N}),console.log("ToolApp using imported db:",A.db),console.log("ToolApp using imported auth:",A.auth);const{items:k,allItems:w,archivedItems:E,loading:O,error:P,searchTerm:T,currentFilter:F,showFlaggedOnly:$,setSearchTerm:R,setCurrentFilter:U,setShowFlaggedOnly:L,setError:W}=(0,x.Q)(null===i||void 0===i?void 0:i.id);console.log("[IncomingTool] useStockItems returned:",{loading:O,error:P,items_length:null===k||void 0===k?void 0:k.length,allItems_length:null===w||void 0===w?void 0:w.length,currentFilter:F,showFlaggedOnly:$,searchTerm:T});const[_,q]=(0,r.useState)(null),[z,B]=(0,r.useState)(!1),[G,V]=(0,r.useState)(null),[M,H]=(0,r.useState)(null),[J,K]=(0,r.useState)(null),[Q,Y]=(0,r.useState)(null),[X,Z]=(0,r.useState)(!1),[ee,te]=(0,r.useState)(null),[ie,re]=(0,r.useState)(!1),[ne,se]=(0,r.useState)((()=>{try{const e=localStorage.getItem(y.fW),t=e?JSON.parse(e):y.Do;return Array.isArray(t)?t:y.Do}catch(P){return console.error("Error reading visible columns from localStorage",P),y.Do}})),[oe,le]=(0,r.useState)(null),[ae,de]=(0,r.useState)(null);(0,r.useEffect)((()=>{localStorage.setItem(y.fW,JSON.stringify(ne))}),[ne]);const ce=ne.map((e=>y.cj.find((t=>t.id===e)))).filter((e=>void 0!==e)),ue=(0,r.useCallback)((async(e,t,r,n)=>{if(console.log("[IncomingTool] updateItemAndLog: Checking db and org.id:",{db_instance:A.db,org_id:null===i||void 0===i?void 0:i.id}),!A.db||null===i||void 0===i||!i.id||!t)return console.error("Cannot update item: Missing configuration.",{db:!!A.db,orgId:null===i||void 0===i?void 0:i.id,userId:t}),void W("Cannot update item: Missing configuration.");console.log(`[IncomingTool] updateItemAndLog: Preparing to update item ${e} in org ${i.id}`);const s=(0,u.doc)(A.db,"orgs",i.id,"stockItems",e),o=w.find((t=>t.id===e));if(!o)return console.error(`Item ${e} not found for update`),void W(`Item ${e} not found.`);const l=(0,j.uJ)({...r,lastUpdated:(0,u.serverTimestamp)()}),a={...o,...l};try{if(await(0,u.updateDoc)(s,l),console.log(`Item ${e} updated successfully.`),console.log("updateItemAndLog: Attempting to log action. logAction available?",!!N),N){let t;try{if("EDITED"===n.type)t="item.update.fields";else if("FLAG_TOGGLED"===n.type)t="item.update.flag";else if("STATUS_CHANGED"===n.type){var d,c;t=`item.update.status.${(null===(d=n.details)||void 0===d||null===(c=d.newStatus)||void 0===c?void 0:c.toLowerCase())||"unknown"}`}else t="ISSUE_REPORTED"===n.type?"item.update.issue.report":"ISSUE_RESOLVED"===n.type?"item.update.issue.resolve":"ISSUE_UPDATE_ADDED"===n.type?"item.update.issue.update":"NOTE_ADDED"===n.type?"item.add_note":n.type}catch(m){console.error("Error deriving action name for logging:",m),t=n.type}const r={orgId:i.id,toolKey:"incomingtool",action:t,entityPath:`stockItems/${e}`,...void 0!==o&&{before:o},...void 0!==a&&{after:a},...void 0!==n.details&&{details:n.details}};await N(r)}}catch(h){throw console.error(`Error updating item ${e}:`,h),W(`Failed to update item: ${h.message}`),h}}),[i,w,N,W]),me=(0,r.useCallback)((async(e,i)=>{console.log(`Action: ${i.label} on item ${e}`);const r=w.find((t=>t.id===e));if(r)switch(i.id){case"Edit Item":V(r),B(!0);break;case"Flag Item":case"Unflag Item":const n="Flag Item"===i.id;await ue(e,null===t||void 0===t?void 0:t.uid,{isFlagged:n},(0,j.is)((null===t||void 0===t?void 0:t.uid)||"","FLAG_TOGGLED",{isFlagged:n}));break;case"Mark as Delivered":"Delivered"!==r.currentStatus&&await ue(e,null===t||void 0===t?void 0:t.uid,{currentStatus:"Delivered",dateDelivered:(new Date).toISOString()},(0,j.is)((null===t||void 0===t?void 0:t.uid)||"","STATUS_CHANGED",{previousStatus:r.currentStatus,newStatus:"Delivered"}));break;case"Archive":if("Archived"!==r.currentStatus){const i=r.currentStatus;await ue(e,null===t||void 0===t?void 0:t.uid,{currentStatus:"Archived",previousStatus:i},(0,j.is)((null===t||void 0===t?void 0:t.uid)||"","STATUS_CHANGED",{previousStatus:i,newStatus:"Archived"}))}break;case"Unarchive Item":if("Archived"===r.currentStatus){const i=r.previousStatus||"Delivered";await ue(e,null===t||void 0===t?void 0:t.uid,{currentStatus:i,previousStatus:void 0},(0,j.is)((null===t||void 0===t?void 0:t.uid)||"","STATUS_CHANGED",{previousStatus:"Archived",newStatus:i}))}break;case"Add Note":te(r);break;case"Report Issue":q(null),H(r);break;case"Resolve Issue":q(null),Y(r);break;case"Add Issue Update":q(null),K(r);break;case"View Details":q(r)}else if("Unarchive Item"===i.id){const i=E.find((t=>t.id===e));if(!i)return console.error(`Item ${e} not found in non-archived or archived items.`),void W(`Item ${e} not found.`);const r=i.previousStatus||"Delivered";await ue(e,null===t||void 0===t?void 0:t.uid,{currentStatus:r,previousStatus:void 0},(0,j.is)((null===t||void 0===t?void 0:t.uid)||"","STATUS_CHANGED",{previousStatus:"Archived",newStatus:r}))}else console.error(`Item ${e} not found for action ${i.id}.`),W(`Item ${e} not found.`)}),[null===t||void 0===t?void 0:t.uid,w,E,ue,V,B,H,K,Y,q,W]),he=(0,r.useCallback)((e=>{const t=w.find((t=>t.id===e));return t?(console.log("Viewing details for:",t),i?void q(t):(console.error("Org ID is missing, cannot fetch logs."),void W("Organization context is missing."))):(console.error("Item not found for viewing details:",e),void W("Item not found."))}),[i,w,W]),pe=(0,m.A)(),ve=(0,h.A)(pe.breakpoints.down("sm"));return(0,D.jsxs)(p.A,{sx:{p:ve?1:2},children:[(0,D.jsx)(b.A,{onAddItem:()=>{V(null),B(!0)},onOpenSettings:()=>Z(!0),onOpenActivity:()=>re(!0)}),P&&(0,D.jsx)(v.A,{severity:"error",onClose:()=>W(null),sx:{},children:P}),O&&(0,D.jsx)(g.A,{sx:{position:"absolute",top:0,left:0,right:0}}),(0,D.jsx)(f.A,{searchTerm:T,onSearchTermChange:R,showFlaggedOnly:$,onShowFlaggedOnlyChange:L,currentFilter:F,onCurrentFilterChange:U}),(0,D.jsx)(S.A,{items:k,loading:O,isMobile:ve,visibleColumns:ce,visibleColumnIds:ne,onColumnOrderChange:e=>se(e),onViewDetails:he,onMenuOpen:(e,t)=>{de(e.currentTarget),le(t.id)}}),(0,D.jsx)(n.A,{isOpen:z,onClose:()=>B(!1),onSave:async(e,r)=>{if(null===t||void 0===t||!t.uid||null===i||void 0===i||!i.id||!A.db)return void W("Missing user, org, or DB connection.");const n=(0,j.uJ)({...e,lastUpdated:(0,u.serverTimestamp)()});try{if(r){console.log(`[IncomingTool] handleSaveItem: Updating item ${r}`);(0,u.doc)(A.db,"orgs",i.id,"stockItems",r);const s=(0,j.is)(t.uid,"EDITED",{changedFields:Object.keys(e)});await ue(r,t.uid,n,s)}else{console.log("[IncomingTool] handleSaveItem: Adding new item");const e=(0,u.collection)(A.db,"orgs",i.id,"stockItems"),r={...n,currentStatus:"Pending Delivery",activityLog:[(0,j.is)(t.uid,"CREATED")],orgId:i.id},s=await(0,u.addDoc)(e,r);console.log("[IncomingTool] handleSaveItem: Item added with ID:",s.id),N&&await N({orgId:i.id,toolKey:"incomingtool",action:"item.create",entityPath:`stockItems/${s.id}`,after:{id:s.id,...r}})}B(!1),V(null)}catch(s){console.error("Error saving item:",s),W(`Failed to save item: ${s.message}`)}},initialData:G}),_&&(0,D.jsx)(s.A,{isOpen:!!_,onClose:()=>q(null),item:_,orgId:null===i||void 0===i?void 0:i.id,onActionSelected:me}),M&&(0,D.jsx)(o.A,{isOpen:!!M,onClose:()=>H(null),item:M,onSubmit:e=>(async(e,t,i)=>{const r=(0,j.is)(i,"ISSUE_REPORTED",{issueDescription:t});await ue(e,i,{currentStatus:"Issue",issueDescription:t},r),H(null)})(M.id,e,(null===t||void 0===t?void 0:t.uid)||"")}),J&&(0,D.jsx)(l.A,{isOpen:!!J,onClose:()=>K(null),item:J,onSubmit:e=>(async(e,t,i)=>{const r=(0,j.is)(i,"ISSUE_UPDATE_ADDED",{note:t});await ue(e,i,{},r),console.warn("Issue update note logged, but not stored directly on item field in this basic implementation."),K(null)})(J.id,e,(null===t||void 0===t?void 0:t.uid)||"")}),Q&&(0,D.jsx)(a.A,{isOpen:!!Q,onClose:()=>Y(null),item:Q,onSubmit:(e,i)=>(async(e,t,i)=>{if(!w.find((t=>t.id===e)))return;const r=(0,j.is)(i,"ISSUE_RESOLVED",{resolutionOutcome:t});await ue(e,i,{currentStatus:"Delivered",issueDescription:"Resolved: "+t},r),Y(null)})(Q.id,e,(null===t||void 0===t?void 0:t.uid)||"")}),ee&&(0,D.jsx)(l.A,{isOpen:!!ee,onClose:()=>te(null),item:ee,onSubmit:e=>(async(e,t,i)=>{const r=(0,j.is)(i,"NOTE_ADDED",{note:t});await ue(e,i,{},r),console.warn("General note logged, but not stored directly on item field."),te(null)})(ee.id,e,(null===t||void 0===t?void 0:t.uid)||"")}),(0,D.jsx)(d.A,{isOpen:X,onClose:()=>Z(!1),allColumns:y.cj.filter((e=>"actions"!==e.id)),initialVisibleColumns:ce,onSave:se}),(0,D.jsx)(c.A,{isOpen:ie,db:A.db,orgId:null===i||void 0===i?void 0:i.id,onClose:()=>re(!1)}),(()=>{if(!oe)return null;const e=w.find((e=>e.id===oe));if(!e)return null;const t=(0,y.tE)(e.currentStatus,e.isFlagged);return(0,D.jsx)(I.W,{itemId:e.id,actions:t,onActionSelected:me,anchorEl:ae,open:Boolean(ae&&oe===e.id),onClose:()=>de(null)})})()]})}},5982:(e,t,i)=>{i.d(t,{A:()=>m});var r=i(8613),n=i(8517),s=i(1911),o=i(5895),l=i(4199),a=i(2571),d=i(8263),c=i(5557),u=i(579);const m=e=>{let{isOpen:t,item:i,onSubmit:m,onClose:h}=e;const[p,v]=(0,r.useState)(""),[g,A]=(0,r.useState)("");return(0,u.jsxs)(n.A,{open:t,onClose:h,maxWidth:"sm",fullWidth:!0,children:[(0,u.jsxs)(s.A,{children:[(0,u.jsx)(o.A,{variant:"h6",children:"Report Issue for:"}),(0,u.jsxs)(o.A,{variant:"body2",color:"textSecondary",sx:{fontStyle:"italic"},children:[i.productName," - ",i.deliveryName]})]}),(0,u.jsx)(l.A,{dividers:!0,children:(0,u.jsx)(a.A,{autoFocus:!0,margin:"dense",id:"issueDescription",label:"Describe the Issue *",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:p,onChange:e=>{v(e.target.value),g&&A("")},error:!!g,helperText:g||"Please provide details about the problem."})}),(0,u.jsxs)(d.A,{sx:{padding:"16px 24px"},children:[(0,u.jsx)(c.A,{onClick:h,color:"secondary",children:"Cancel"}),(0,u.jsx)(c.A,{onClick:()=>{p.trim()?(m(p),h()):A("Please enter a description of the issue.")},variant:"contained",color:"primary",children:"Save Issue Report"})]})]})}},6439:(e,t,i)=>{function r(e){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,i]=e;return void 0!==i})))}i.d(t,{is:()=>n,uJ:()=>r});const n=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{timestamp:(new Date).toISOString(),type:t,userId:e,details:i}}},7553:(e,t,i)=>{i.d(t,{A:()=>x});var r=i(8613),n=i(8006),s=i(6185),o=i(5895),l=i(8517),a=i(1911),d=i(4199),c=i(2967),u=i(549),m=i(4225),h=i(2959),p=i(4527),v=i(8263),g=i(5557),A=i(579);const x=e=>{let{isOpen:t,db:i,orgId:x,onClose:S}=e;const[f,j]=(0,r.useState)([]),[y,b]=(0,r.useState)(!0),[I,D]=(0,r.useState)(null),[C,N]=(0,r.useState)({});(0,r.useEffect)((()=>{if(!x)return;const e=(0,n.collection)(i,`orgs/${x}/members`);(0,n.getDocs)(e).then((e=>{const t={};e.docs.forEach((e=>{const i=e.data();t[e.id]=i.email||e.id})),N(t)})).catch((e=>console.error("Error fetching members:",e)))}),[x,i,N]),(0,r.useEffect)((()=>{if(!x)return D("Organization ID is required."),void b(!1);b(!0),D(null);const e=(0,n.collection)(i,`orgs/${x}/logs`),t=(0,n.query)(e,(0,n.where)("tool","==","incomingtool"),(0,n.orderBy)("ts","desc"),(0,n.limit)(100)),r=(0,n.onSnapshot)(t,(e=>{const t=e.docs.map((e=>{const t=e.data();return{orgId:x,toolKey:t.toolKey||t.tool,action:t.action,entityPath:t.entityPath,timestamp:t.timestamp||t.ts,userId:t.userId||t.uid,userEmail:t.email,before:t.before,after:t.after,details:t.details}})).filter((e=>"app-loaded"!==e.action));j(t),b(!1)}),(e=>{console.error("Error fetching user activity logs: ",e);D(`Failed to load activity logs: ${e.message}`),b(!1)}));return()=>r()}),[x,i,j]);const k=e=>{var t,i,l;const a=e.timestamp instanceof n.Timestamp?e.timestamp.toDate().toLocaleString():"string"===typeof e.timestamp?new Date(e.timestamp).toLocaleString():"Invalid Date",d=e.userEmail||C[e.userId||""]||e.userId||"system",c=(e=>{switch(e.action){case"item.create":return"Item created";case"item.update.fields":{var t,i;if(e.before&&e.after){var r;const t=(null===(r=e.details)||void 0===r?void 0:r.changedFields)||Object.keys(e.after).filter((t=>{var i,r;return JSON.stringify(null===(i=e.before)||void 0===i?void 0:i[t])!==JSON.stringify(null===(r=e.after)||void 0===r?void 0:r[t])}));if(t.length)return`Edited ${t.map((t=>{var i,r;return`${t}: ${null===(i=e.before)||void 0===i?void 0:i[t]} \u2192 ${null===(r=e.after)||void 0===r?void 0:r[t]}`})).join(", ")}`}const n=null===(t=e.details)||void 0===t||null===(i=t.changedFields)||void 0===i?void 0:i.join(", ");return n?`Edited fields: ${n}`:"Item edited"}default:var n,s,o,l,a,d,c,u,m;return e.action.startsWith("item.update.status.")?`Status changed: ${(null===(n=e.details)||void 0===n?void 0:n.previousStatus)||(null===(s=e.before)||void 0===s?void 0:s.currentStatus)||"Unknown"} \u2192 ${(null===(o=e.details)||void 0===o?void 0:o.newStatus)||e.action.replace("item.update.status.","")}`:"item.update.flag"===e.action?(null===(l=e.details)||void 0===l?void 0:l.isFlagged)?"Item flagged":"Item unflagged":"item.update.issue.report"===e.action?`Issue reported: ${(null===(a=e.details)||void 0===a?void 0:a.description)||(null===(d=e.details)||void 0===d?void 0:d.issueDescription)||""}`:"item.update.issue.update"===e.action?`Issue update added: ${(null===(c=e.details)||void 0===c?void 0:c.note)||""}`:"item.update.issue.resolve"===e.action?`Issue resolved: ${(null===(u=e.details)||void 0===u?void 0:u.resolutionOutcome)||""}`:"item.add_note"===e.action?`Note added: ${(null===(m=e.details)||void 0===m?void 0:m.note)||""}`:e.action}})(e),u=e.entityPath.split("/"),m=u.length>=2?u[1]:"",h=null===(t=e.before)||void 0===t?void 0:t.quantity,p=null===(i=e.before)||void 0===i?void 0:i.productName,v=h&&p?`${h}x ${p}`:(null===(l=e.before)||void 0===l?void 0:l.deliveryName)||p||m;return(0,A.jsx)(s.A,{primary:(0,A.jsxs)(r.Fragment,{children:[(0,A.jsxs)(o.A,{sx:{display:"inline"},component:"span",variant:"body2",color:"text.primary",children:[a," - ",c," by ",d]}),(0,A.jsx)(o.A,{component:"span",variant:"body2",sx:{ml:1,color:"text.secondary"},children:v})]})})};return(0,A.jsxs)(l.A,{open:t,onClose:S,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[(0,A.jsxs)(a.A,{children:[(0,A.jsx)(o.A,{variant:"h6",children:"User Activity Log"}),(0,A.jsx)(o.A,{variant:"caption",children:"Last 100 entries"})]}),(0,A.jsxs)(d.A,{dividers:!0,children:[y&&(0,A.jsx)(c.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:(0,A.jsx)(u.A,{})}),I&&(0,A.jsx)(o.A,{color:"error",sx:{textAlign:"center",mt:2},children:I}),!y&&!I&&(0,A.jsx)(m.A,{dense:!0,sx:{width:"100%",bgcolor:"background.paper",p:0},children:0===f.length?(0,A.jsx)(h.Ay,{children:(0,A.jsx)(s.A,{primary:"No activity logs found."})}):f.map(((e,t)=>(0,A.jsxs)(r.Fragment,{children:[(0,A.jsx)(h.Ay,{alignItems:"flex-start",sx:{py:1.5},children:k(e)}),t<f.length-1&&(0,A.jsx)(p.A,{variant:"inset",component:"li"})]},`${e.timestamp}-${t}-${e.action}`)))})]}),(0,A.jsx)(v.A,{sx:{padding:"16px 24px"},children:(0,A.jsx)(g.A,{onClick:S,color:"primary",children:"Close"})})]})}},7694:(e,t,i)=>{i.d(t,{A:()=>v});var r=i(8613),n=i(8517),s=i(1911),o=i(5895),l=i(4199),a=i(2967),d=i(6679),c=i(5847),u=i(5303),m=i(8263),h=i(5557),p=i(579);const v=e=>{let{isOpen:t,onClose:i,allColumns:v,initialVisibleColumns:g,onSave:A}=e;const[x,S]=(0,r.useState)((()=>Object.fromEntries(v.map((e=>[e.id,!1])))));(0,r.useEffect)((()=>{if(t){const e=new Set(g.map((e=>e.id))),t=Object.fromEntries(v.map((t=>[t.id,e.has(t.id)])));S(t)}}),[t,g,v]);return(0,p.jsxs)(n.A,{open:t,onClose:i,maxWidth:"xs",fullWidth:!0,children:[(0,p.jsx)(s.A,{children:(0,p.jsx)(o.A,{variant:"h6",children:"Configure Table Columns"})}),(0,p.jsxs)(l.A,{dividers:!0,children:[(0,p.jsx)(o.A,{variant:"body2",gutterBottom:!0,children:"Select the columns you want to display:"}),(0,p.jsxs)(a.A,{sx:{maxHeight:"60vh",overflowY:"auto",pr:1},children:[" ",(0,p.jsx)(d.A,{children:v.map((e=>(0,p.jsx)(c.A,{control:(0,p.jsx)(u.A,{checked:x[e.id]||!1,onChange:()=>{return t=e.id,void S((e=>({...e,[t]:!e[t]})));var t},disabled:"actions"===e.id}),label:e.label},e.id)))})]})]}),(0,p.jsxs)(m.A,{sx:{padding:"16px 24px"},children:[(0,p.jsx)(h.A,{onClick:i,color:"secondary",children:"Cancel"}),(0,p.jsx)(h.A,{onClick:()=>{const e=v.map((e=>e.id)).filter((e=>x[e]));A(e)},variant:"contained",color:"primary",children:"Save Settings"})]})]})}},8137:(e,t,i)=>{i.d(t,{A:()=>D});i(8613);var r=i(9284),n=i(1648),s=i(1024),o=i(6800),l=i(2731),a=i(267),d=i(6393),c=i(5495),u=i(2967),m=i(5895),h=i(6647),p=i(6859),v=i(2523),g=i(2011),A=i(4755),x=i(9841),S=i(1399),f=i(2043),j=i(2327),y=i(579);const b=e=>{let{column:t}=e;const{attributes:i,listeners:r,setNodeRef:o,transform:a,transition:d,isDragging:c}=(0,n.gl)({id:t.id}),u={transform:s.Ks.Transform.toString(a),transition:d,opacity:c?.5:1,touchAction:"none"},m=["quantity","pricePerItem"].includes(t.id);return(0,y.jsx)(l.A,{ref:o,component:"th",scope:"col",style:u,...i,...r,align:m?"right":"left",sx:{fontWeight:"bold",cursor:"grab",whiteSpace:"nowrap",bgcolor:c?"#e0e0e0":"background.paper",..."isFlagged"===t.id&&{width:50,p:"6px 8px"},..."seller"===t.id&&{minWidth:140},..."deliveryName"===t.id&&{minWidth:160},..."quantity"===t.id&&{width:80},..."destination"===t.id&&{minWidth:110},..."pricePerItem"===t.id&&{width:100},..."orderNumber"===t.id&&{width:110},..."purchaseStatus"===t.id&&{width:110},..."orderDate"===t.id&&{width:110},..."asinSku"===t.id&&{width:120},..."productName"===t.id&&{minWidth:160},..."actions"===t.id&&{width:60,p:"6px 8px"},..."currentStatus"===t.id&&{width:100}},children:t.label})},I=e=>{var t,i;let{item:r,onViewDetails:n,onActionClick:s,cardSx:o}=e;const l=null!==(t=(0,a.A)().palette.action.hover)&&void 0!==t?t:"rgba(0, 0, 0, 0.04)";return(0,y.jsx)(d.A,{sx:{mb:2,cursor:"pointer",backgroundColor:(null===o||void 0===o?void 0:o.backgroundColor)||"transparent","&:hover":{backgroundColor:(null===o||void 0===o?void 0:o.hoverBackgroundColor)||l}},onClick:()=>n(r.id),children:(0,y.jsx)(c.A,{sx:{pb:"8px !important"},children:(0,y.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,y.jsxs)(u.A,{sx:{flexGrow:1,mr:1},children:[(0,y.jsx)(m.A,{variant:"subtitle1",component:"div",sx:{fontWeight:"bold",lineHeight:1.3},children:r.productName||r.deliveryName||"Unnamed Item"}),(0,y.jsxs)(m.A,{variant:"body2",color:"text.secondary",children:["Status: ",r.currentStatus]}),(0,y.jsxs)(m.A,{variant:"body2",color:"text.secondary",children:["Qty: ",null!==(i=r.quantity)&&void 0!==i?i:"N/A"," | Seller: ",r.seller||"N/A"]}),(0,y.jsxs)(m.A,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem"},children:["Order Date: ",r.orderDate?new Date(r.orderDate).toLocaleDateString():"N/A"]})]}),(0,y.jsx)(h.A,{size:"small",onClick:e=>{e.stopPropagation(),s(e,r)},sx:{mt:-1,mr:-1},children:(0,y.jsx)(f.A,{})})]})})})},D=e=>{let{items:t,loading:i,isMobile:s,visibleColumns:d,visibleColumnIds:c,onColumnOrderChange:D,onViewDetails:C,onMenuOpen:N}=e;const k=(0,a.A)(),w=(0,r.FR)((0,r.MS)(r.AN),(0,r.MS)(r.uN,{coordinateGetter:n.JR})),E=(e,t)=>{const i=e.split(".");let r=k;for(const n of i){if(!r||"object"!==typeof r||!(n in r))return console.warn(`Theme path "${e}" not found, using fallback "${t}".`),t;r=r[n]}return"string"===typeof r?r:t},O=e=>{let t="transparent",i=E("palette.action.hover","rgba(0, 0, 0, 0.04)");switch(e.currentStatus){case"Delivered":t=E("palette.success.50","#e8f5e9"),i=E("palette.success.100","#c8e6c9");break;case"Issue":t=E("palette.error.50","#ffebee"),i=E("palette.error.100","#ffcdd2");break;case"Archived":t=E("palette.grey.100","#f5f5f5"),i=E("palette.grey.200","#eeeeee");break;case"Pending Delivery":(e=>{if("Pending Delivery"!==e.currentStatus)return!1;try{const t=new Date(e.orderDate);if(isNaN(t.getTime()))return console.warn(`Invalid orderDate format for item ${e.id}:`,e.orderDate),!1;const i=new Date;return i.setDate(i.getDate()-7),t<i}catch(t){return console.error(`Error parsing orderDate for item ${e.id}:`,t),!1}})(e)&&(t=E("palette.warning.50","#fffde7"),i=E("palette.warning.100","#fff9c4"))}return{backgroundColor:t,hoverBackgroundColor:i}};return(0,y.jsxs)(r.Mp,{sensors:w,collisionDetection:r.fp,onDragEnd:e=>{const{active:t,over:i}=e;if(i&&t.id!==i.id){const e=c.indexOf(t.id),r=c.indexOf(i.id);if(-1===e||-1===r)return void console.error("Dragged item ID not found in visible columns",{activeId:t.id,overId:i.id});const s=(0,n.be)(c,e,r);D(s)}},modifiers:[o.dU],children:[!s&&(0,y.jsx)(p.A,{component:v.A,sx:{mt:2,maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:(0,y.jsxs)(g.A,{stickyHeader:!0,size:"small",children:[(0,y.jsx)(A.A,{children:(0,y.jsx)(x.A,{children:(0,y.jsx)(n.gB,{items:c,strategy:n.m$,children:d.map((e=>(0,y.jsx)(b,{column:e},e.id)))})})}),(0,y.jsxs)(S.A,{children:[t.map((e=>{const t=O(e);return(0,y.jsx)(x.A,{hover:!0,sx:{"& > *":{borderBottom:"unset"},cursor:"pointer",backgroundColor:t.backgroundColor,"&:hover":{backgroundColor:t.hoverBackgroundColor}},onClick:()=>C(e.id),children:d.map((t=>{var i;return(0,y.jsx)(l.A,{align:["quantity","pricePerItem"].includes(t.id)?"right":"left",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:["productName","deliveryName","seller"].includes(t.id)?200:void 0,..."isFlagged"===t.id&&{p:"6px 8px",textAlign:"center"},..."actions"===t.id&&{p:"0px 8px",textAlign:"center"}},children:"actions"===t.id?(0,y.jsx)(h.A,{size:"small",onClick:t=>{t.stopPropagation(),N(t,e)},children:(0,y.jsx)(f.A,{fontSize:"small"})}):"isFlagged"===t.id?e.isFlagged?(0,y.jsx)(j.A,{fontSize:"inherit",color:"error"}):null:"orderDate"===t.id||"dateDelivered"===t.id?e[t.id]?new Date(e[t.id]).toLocaleDateString():"":null!==(i=e[t.id])&&void 0!==i?i:""},t.id)}))},e.id)})),0===t.length&&!i&&(0,y.jsx)(x.A,{children:(0,y.jsx)(l.A,{colSpan:d.length,align:"center",children:"No items match the current filter."})})]})]})}),s&&(0,y.jsxs)(u.A,{sx:{p:1},children:[t.map((e=>(0,y.jsx)(I,{item:e,onViewDetails:C,onActionClick:N,cardSx:O(e)},e.id))),0===t.length&&!i&&(0,y.jsx)(m.A,{align:"center",sx:{mt:2,color:"text.secondary"},children:"No items match the current filter."})]})]})}},9256:(e,t,i)=>{i.d(t,{A:()=>m});i(8613);var r=i(2967),n=i(5895),s=i(3287),o=i(5557),l=i(6647),a=i(2950),d=i(6936),c=i(9161),u=i(579);const m=e=>{let{onAddItem:t,onOpenSettings:i,onOpenActivity:m}=e;return(0,u.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,u.jsx)(n.A,{variant:"h6",children:"Stock Items"}),(0,u.jsxs)(r.A,{children:[(0,u.jsx)(s.A,{title:"Add New Item",children:(0,u.jsx)(o.A,{variant:"contained",startIcon:(0,u.jsx)(a.A,{}),onClick:t,sx:{mr:1},children:"Add Item"})}),(0,u.jsx)(s.A,{title:"Table Settings",children:(0,u.jsx)(l.A,{onClick:i,sx:{mr:1},children:(0,u.jsx)(d.A,{})})}),(0,u.jsx)(s.A,{title:"View User Activity",children:(0,u.jsx)(l.A,{onClick:m,children:(0,u.jsx)(c.A,{})})})]})]})}}}]);
//# sourceMappingURL=935.aac072b4.chunk.js.map