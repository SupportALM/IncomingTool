{"version":3,"file":"static/js/544.219f48df.chunk.js","mappings":"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","sources":["AddUpdateModal.tsx","ResolveIssueModal.tsx","AddItemForm.tsx","ItemDetailModal.tsx","ToolApp.tsx","ReportIssueModal.tsx","UserActivityView.tsx","TableSettingsModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Typography, Box\n} from '@mui/material';\nimport { StockItem } from './types';\n\ninterface AddUpdateModalProps {\n  item: StockItem; // Pass the item for context\n  onSubmit: (note: string) => void;\n  onClose: () => void;\n}\n\nconst AddUpdateModal: React.FC<AddUpdateModalProps> = ({ item, onSubmit, onClose }) => {\n  const [note, setNote] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    if (!note.trim()) {\n      setError('Please enter an update note.');\n      return;\n    }\n    onSubmit(note);\n    onClose(); // Close modal on successful submission\n  };\n\n  return (\n    <Dialog open={true} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Add Issue Update for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {/* Display existing issue description for context */} \n        {item.issueDescription && (\n          <Box sx={{ mb: 2, p: 1.5, background: '#f8f9fa', border: '1px solid #dee2e6', borderRadius: 1 }}>\n            <Typography variant=\"body2\"><strong>Initial Issue:</strong> {item.issueDescription}</Typography>\n          </Box>\n        )}\n\n        {/* Update Note TextField */} \n        <TextField\n          autoFocus\n          margin=\"dense\"\n          id=\"updateNote\"\n          label=\"Update Note *\"\n          type=\"text\"\n          fullWidth\n          multiline\n          rows={4}\n          variant=\"outlined\"\n          value={note}\n          onChange={(e) => {\n            setNote(e.target.value);\n            if (error) setError(''); // Clear error on type\n          }}\n          error={!!error}\n          helperText={error || 'Enter details about the update.'}\n          placeholder=\"e.g., Contacted seller, awaiting response...\"\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Update Note\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default AddUpdateModal; ","import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Select, MenuItem, FormControl, InputLabel, Typography,\n  FormHelperText, Box\n} from '@mui/material';\nimport { StockItem } from './types';\n\ninterface ResolveIssueModalProps {\n  item: StockItem; // Pass the item for context\n  onSubmit: (outcome: string, note?: string) => void;\n  onClose: () => void;\n}\n\nconst RESOLUTION_OUTCOMES = [\n  \"Item Accepted / Kept As Is\",\n  \"Item Repaired / Refurbished\",\n  \"Partial Refund Received\",\n  \"Returned to Supplier\",\n  \"Disposed Of\",\n  \"Other\" // Allows adding notes for specifics\n];\n\nconst ResolveIssueModal: React.FC<ResolveIssueModalProps> = ({ item, onSubmit, onClose }) => {\n  const [outcome, setOutcome] = useState('');\n  const [note, setNote] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    setError(''); // Clear previous error\n    if (!outcome) {\n      setError('Please select a resolution outcome.');\n      return;\n    }\n    onSubmit(outcome, note.trim() || undefined); // Pass note only if it has content\n  };\n\n  return (\n    <Dialog open={true} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Resolve Issue for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {/* Display existing issue description */}\n        {item.issueDescription && (\n          <Box sx={{ mb: 2, p: 1.5, background: '#f8f9fa', border: '1px solid #dee2e6', borderRadius: 1 }}>\n            <Typography variant=\"body2\"><strong>Initial Issue:</strong> {item.issueDescription}</Typography>\n          </Box>\n        )}\n\n        {/* Resolution Outcome Select */}\n        <FormControl fullWidth error={!!error} sx={{ mb: 2 }}>\n          <InputLabel id=\"resolution-outcome-label\">Resolution Outcome *</InputLabel>\n          <Select\n            labelId=\"resolution-outcome-label\"\n            id=\"resolutionOutcome\"\n            value={outcome}\n            label=\"Resolution Outcome *\"\n            onChange={(e) => {\n              setOutcome(e.target.value as string);\n              if (error) setError(''); // Clear error on change\n            }}\n          >\n            <MenuItem value=\"\" disabled><em>-- Select an Outcome --</em></MenuItem>\n            {RESOLUTION_OUTCOMES.map(opt => (\n              <MenuItem key={opt} value={opt}>{opt}</MenuItem>\n            ))}\n          </Select>\n          {error && <FormHelperText>{error}</FormHelperText>}\n        </FormControl>\n\n        {/* Resolution Notes TextField */}\n        <TextField\n          id=\"resolutionNotes\"\n          label=\"Resolution Notes (Optional)\"\n          multiline\n          rows={3}\n          fullWidth\n          value={note}\n          onChange={(e) => setNote(e.target.value)}\n          placeholder=\"e.g., Supplier issued refund, repaired screen...\"\n          variant=\"outlined\"\n          sx={{ mb: 2 }}\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Resolution\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ResolveIssueModal;","import React, { useState, useEffect } from 'react';\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  Button,\n  Tooltip,\n  IconButton,\n  Box,\n  FormControlLabel,\n  Checkbox,\n  MenuItem,\n} from '@mui/material';\nimport InfoOutlinedIcon from '@mui/icons-material/InfoOutlined';\nimport { StockItem, PurchaseStatus, Destination } from './types';\n\ninterface AddItemFormProps {\n  onSave: (newItemOrUpdate: Omit<StockItem, 'id' | 'currentStatus' | 'dateDelivered' | 'processorNotes' | 'issueDescription'> & { isFlagged: boolean }) => void;\n  onClose: () => void;\n  initialData?: StockItem | null;\n  firstInputRef?: React.RefObject<HTMLInputElement | null>;\n}\n\nconst AddItemForm: React.FC<AddItemFormProps> = ({ onSave, onClose, initialData, firstInputRef }) => {\n  const isEditing = !!initialData;\n\n  // Initialize state for each form field\n  const [purchaseStatus, setPurchaseStatus] = useState<PurchaseStatus>(initialData?.purchaseStatus || 'Purchased');\n  const [deliveryName, setDeliveryName] = useState(initialData?.deliveryName || '');\n  const [productName, setProductName] = useState(initialData?.productName || '');\n  const [quantity, setQuantity] = useState<number | ''>(initialData?.quantity || '');\n  const [pricePerItem, setPricePerItem] = useState<number | ''>(initialData?.pricePerItem || '');\n  const [orderNumber, setOrderNumber] = useState(initialData?.orderNumber || '');\n  const [orderDate, setOrderDate] = useState(() => (initialData?.orderDate || new Date().toISOString().split('T')[0]));\n  const [seller, setSeller] = useState(initialData?.seller || '');\n  const [isVatRegistered, setIsVatRegistered] = useState<'Yes' | 'No' | 'Unknown'>(initialData?.isVatRegistered || 'Unknown');\n  const [destination, setDestination] = useState<Destination>(initialData?.destination || '');\n  const [asinSku, setAsinSku] = useState(initialData?.asinSku || '');\n  const [acquisitionNotes, setAcquisitionNotes] = useState(initialData?.acquisitionNotes || '');\n  const [isFlagged, setIsFlagged] = useState(initialData?.isFlagged || false);\n\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  // Populate state if initialData changes (needed if modal reuses component instance)\n  useEffect(() => {\n    if (initialData) {\n      setPurchaseStatus(initialData.purchaseStatus || 'Purchased');\n      setDeliveryName(initialData.deliveryName || '');\n      setProductName(initialData.productName || '');\n      setQuantity(initialData.quantity || '');\n      setPricePerItem(initialData.pricePerItem || '');\n      setOrderNumber(initialData.orderNumber || '');\n      setOrderDate(initialData.orderDate || new Date().toISOString().split('T')[0]);\n      setSeller(initialData.seller || '');\n      setIsVatRegistered(initialData.isVatRegistered || 'Unknown');\n      setDestination(initialData.destination || '');\n      setAsinSku(initialData.asinSku || '');\n      setAcquisitionNotes(initialData.acquisitionNotes || '');\n      setIsFlagged(initialData.isFlagged || false);\n      setErrors({}); // Clear errors when loading new data\n    } else {\n      // Reset form if initialData becomes null (e.g., switching from edit to add)\n      // Optional: Add logic here to reset all fields if needed\n    }\n  }, [initialData]); // Re-run effect if initialData changes\n\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n    if (!deliveryName.trim()) newErrors.deliveryName = 'Delivery Name is required.';\n    if (!productName.trim()) newErrors.productName = 'Product Name is required.';\n    if (quantity === '' || quantity <= 0) newErrors.quantity = 'Quantity must be a positive number.';\n    if (pricePerItem === '' || pricePerItem < 0) newErrors.pricePerItem = 'Price must be zero or positive.';\n    if (!orderDate) newErrors.orderDate = 'Order Date is required.';\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = (event: React.FormEvent) => {\n    event.preventDefault();\n    console.log('AddItemForm: handleSubmit', { deliveryName, productName, quantity, pricePerItem, orderDate, seller, destination, acquisitionNotes, isFlagged });\n    const isValid = validateForm();\n    console.log('AddItemForm: validation result', isValid, errors);\n    if (isValid) {\n      console.log('AddItemForm: form valid, calling onSave');\n      onSave({\n        purchaseStatus,\n        deliveryName,\n        productName,\n        quantity: Number(quantity),\n        pricePerItem: Number(pricePerItem),\n        orderNumber: orderNumber || undefined,\n        orderDate,\n        seller: seller || undefined,\n        isVatRegistered: isVatRegistered === 'Unknown' ? undefined : isVatRegistered,\n        destination: destination || undefined,\n        asinSku: asinSku || undefined,\n        acquisitionNotes: acquisitionNotes || undefined,\n        isFlagged: isFlagged,\n      });\n    } else {\n      console.log('AddItemForm: form invalid, errors:', errors);\n    }\n  };\n\n  return (\n    <Dialog open={true} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>{isEditing ? 'Edit Stock Item' : 'Add New Stock Item'}</DialogTitle>\n      <DialogContent>\n        <Box component=\"form\" onSubmit={handleSubmit} id=\"add-item-form\" noValidate sx={{ mt: 1 }}>\n          <TextField\n            inputRef={firstInputRef}\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"deliveryName\"\n            label=\"Delivery Name\"\n            name=\"deliveryName\"\n            value={deliveryName}\n            onChange={(e) => setDeliveryName(e.target.value)}\n            error={!!errors.deliveryName}\n            helperText={errors.deliveryName}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Group items arriving together with a unique name. Helps find them later. Example: eBay Batch Apr 16\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          <TextField\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"productName\"\n            label=\"Product Name\"\n            name=\"productName\"\n            value={productName}\n            onChange={(e) => setProductName(e.target.value)}\n            error={!!errors.productName}\n            helperText={errors.productName}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"The common name of the item. Example: Blue Widget Model X\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          <TextField\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"quantity\"\n            label=\"Quantity\"\n            name=\"quantity\"\n            type=\"number\"\n            value={quantity}\n            onChange={(e) => setQuantity(e.target.value === '' ? '' : Number(e.target.value))}\n            error={!!errors.quantity}\n            helperText={errors.quantity}\n            InputProps={{\n              inputProps: { min: 1 },\n              endAdornment: (\n                <Tooltip title=\"How many units of this item are included? Example: 50\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          <TextField\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"pricePerItem\"\n            label=\"Price Per Item\"\n            name=\"pricePerItem\"\n            type=\"number\"\n            value={pricePerItem}\n            onChange={(e) => setPricePerItem(e.target.value === '' ? '' : Number(e.target.value))}\n            error={!!errors.pricePerItem}\n            helperText={errors.pricePerItem}\n            InputProps={{\n              inputProps: { min: 0, step: 0.01 },\n              endAdornment: (\n                <Tooltip title=\"The cost for one single unit. Example: 12.50\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          <TextField\n            margin=\"normal\"\n            required\n            fullWidth\n            id=\"orderDate\"\n            label=\"Order Date\"\n            name=\"orderDate\"\n            type=\"date\"\n            value={orderDate}\n            onChange={(e) => setOrderDate(e.target.value)}\n            error={!!errors.orderDate}\n            helperText={errors.orderDate}\n            InputLabelProps={{ shrink: true }}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"The date the item was purchased or the return initiated.\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Add Remaining Fields Below */}\n\n          {/* Purchase Status */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"purchaseStatus\"\n            label=\"Purchase Status\"\n            name=\"purchaseStatus\"\n            select\n            value={purchaseStatus}\n            onChange={(e) => setPurchaseStatus(e.target.value as PurchaseStatus)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"What is the origin of this item?\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          >\n            <MenuItem value=\"Purchased\">Purchased</MenuItem>\n            <MenuItem value=\"Ordered\">Ordered</MenuItem>\n            <MenuItem value=\"Return Expected\">Return Expected</MenuItem>\n          </TextField>\n\n          {/* Order Number */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"orderNumber\"\n            label=\"Order Number\"\n            name=\"orderNumber\"\n            value={orderNumber}\n            onChange={(e) => setOrderNumber(e.target.value)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: External reference like eBay order ID or PO number. Example: 12-34567-89012\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Seller / Source */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"seller\"\n            label=\"Seller / Source\"\n            name=\"seller\"\n            value={seller}\n            onChange={(e) => setSeller(e.target.value)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Who did this item come from? Example: ebay_seller_123 or Customer Name (Return)\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Seller VAT Registered? */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"isVatRegistered\"\n            label=\"Seller VAT Registered?\"\n            name=\"isVatRegistered\"\n            select\n            value={isVatRegistered}\n            onChange={(e) => setIsVatRegistered(e.target.value as 'Yes' | 'No' | 'Unknown')}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Is the seller registered for VAT?\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          >\n            <MenuItem value=\"Unknown\">Unknown</MenuItem>\n            <MenuItem value=\"Yes\">Yes</MenuItem>\n            <MenuItem value=\"No\">No</MenuItem>\n          </TextField>\n\n          {/* Planned Destination */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"destination\"\n            label=\"Planned Destination\"\n            name=\"destination\"\n            select\n            value={['FBA Prep', 'Local Stock Shelf A', 'Refurbish Pile', 'Return to Supplier'].includes(destination) ? destination : 'Other'}\n            onChange={(e) => {\n              if (e.target.value === 'Other') {\n                setDestination(''); // Clear if switching to Other for custom input\n              } else {\n                setDestination(e.target.value as Destination);\n              }\n            }}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Where is this item intended to go after processing? Example: FBA Prep\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          >\n            <MenuItem value=\"FBA Prep\">FBA Prep</MenuItem>\n            <MenuItem value=\"Local Stock Shelf A\">Local Stock Shelf A</MenuItem>\n            <MenuItem value=\"Refurbish Pile\">Refurbish Pile</MenuItem>\n            <MenuItem value=\"Return to Supplier\">Return to Supplier</MenuItem>\n            <MenuItem value=\"Other\">Other (Specify Below)</MenuItem>\n          </TextField>\n\n          {/* Conditionally render TextField for custom destination */}\n          {destination === '' && (\n            <TextField\n              margin=\"dense\" // Use dense margin for tighter spacing\n              fullWidth\n              id=\"customDestination\"\n              label=\"Specify Destination\"\n              name=\"customDestination\"\n              value={destination} // Bind to the same state\n              onChange={(e) => setDestination(e.target.value)} // Update the same state\n              required // Make required if 'Other' logic implies specification\n              error={!!errors.destination} // Potentially add validation for custom dest\n              helperText={errors.destination}\n            />\n          )}\n\n          {/* ASIN / SKU */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"asinSku\"\n            label=\"ASIN / SKU\"\n            name=\"asinSku\"\n            value={asinSku}\n            onChange={(e) => setAsinSku(e.target.value)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Amazon ASIN or internal SKU. Helps link inventory. Example: B0C1EXAMPLE / BLUE-WIDGET-XL\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Acquisition Notes */}\n          <TextField\n            margin=\"normal\"\n            fullWidth\n            id=\"acquisitionNotes\"\n            label=\"Acquisition Notes\"\n            name=\"acquisitionNotes\"\n            value={acquisitionNotes}\n            onChange={(e) => setAcquisitionNotes(e.target.value)}\n            InputProps={{\n              endAdornment: (\n                <Tooltip title=\"Optional: Any specific notes from the purchase, order, or return request. Example: Seller mentioned slight scratch.\">\n                  <IconButton size=\"small\" edge=\"end\">\n                    <InfoOutlinedIcon fontSize=\"small\" />\n                  </IconButton>\n                </Tooltip>\n              ),\n            }}\n          />\n\n          {/* Flag Checkbox */}\n          <FormControlLabel\n            control={\n              <Checkbox\n                id=\"isFlagged\"\n                checked={isFlagged}\n                onChange={(e) => setIsFlagged(e.target.checked)}\n                name=\"isFlagged\"\n              />\n            }\n            label={\n              <Box component=\"span\" sx={{ display: 'flex', alignItems: 'center' }}>\n                Flag this item for follow-up\n                <Tooltip title=\"Check this box to mark the item with a flag for easy filtering later.\">\n                  {/* Wrap icon in IconButton for better accessibility/hover */}\n                  <IconButton size=\"small\" edge=\"end\" sx={{ ml: 0.5 }}>\n                    <InfoOutlinedIcon fontSize=\"inherit\" />\n                  </IconButton>\n                </Tooltip>\n              </Box>\n            }\n            sx={{ mt: 1 }} // Add some top margin\n          />\n        </Box>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose}>Cancel</Button>\n        <Button type=\"submit\" form=\"add-item-form\" variant=\"contained\" onClick={handleSubmit}>\n          {isEditing ? 'Save Changes' : 'Add Item'}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default AddItemForm;","import React, { useState, useEffect } from 'react';\nimport { getFirestore, collection, query, where, orderBy, onSnapshot, Timestamp } from 'firebase/firestore';\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  Typography,\n  Box,\n  List,\n  ListItem,\n  ListItemText,\n  Divider,\n  CircularProgress,\n  Alert,\n  Stack\n} from '@mui/material';\nimport { StockItem, ActivityEvent, LogActionData, ActivityEventType, ActionDefinition } from './types';\nimport { getAvailableActions } from './ToolApp'; // For action buttons\n\n// Helper function to format optional fields\nconst formatValue = (value: string | number | undefined | null, prefix = '', suffix = '') => {\n  if (value === undefined || value === null || value === '') {\n    return <span style={{ color: '#888' }}>N/A</span>; // Indicate if not available\n  }\n  return `${prefix}${value}${suffix}`;\n};\n\n// Helper function to format an activity event into a readable string\nconst formatActivityEvent = (event: ActivityEvent): string => {\n  const time = new Date(event.timestamp).toLocaleString();\n  switch (event.type) {\n    case 'CREATED':\n      return `${time}: Item Created`;\n    case 'EDITED':\n      const fields = event.details.changedFields?.join(', ') || 'details';\n      return `${time}: Item Edited (${fields} changed)`;\n    case 'STATUS_CHANGED':\n      return `${time}: Status changed from ${event.details.previousStatus || '?'} to ${event.details.newStatus || '?'}`;\n    case 'FLAG_TOGGLED':\n      return `${time}: Item ${event.details.isFlagged ? 'Flagged' : 'Unflagged'}`;\n    case 'ISSUE_REPORTED':\n      return `${time}: Issue Reported: ${event.details.issueDescription || ''}`;\n    case 'ISSUE_UPDATE_ADDED':\n      return `${time}: Issue Update Added: ${event.details.note || ''}`;\n    case 'ISSUE_RESOLVED':\n      return `${time}: Issue Resolved (Outcome: ${event.details.resolutionOutcome || 'N/A'}${event.details.note ? ` - Note: ${event.details.note}` : ''}`;\n    case 'NOTE_ADDED': // For general notes in future\n      return `${time}: Note Added: ${event.details.note || ''}`;\n    default:\n      return `${time}: Unknown action`;\n  }\n};\n\n// Helper function to map LogActionData from Firestore to the local ActivityEvent format\nconst mapLogToAction = (log: LogActionData): ActivityEvent | null => {\n  // Handle Firestore Timestamp or ISO string\n  const timestamp = log.timestamp instanceof Timestamp\n    ? log.timestamp.toDate().toISOString()\n    : (typeof log.timestamp === 'string' ? log.timestamp : new Date().toISOString());\n\n  const userId = log.userId || 'system'; // Default if userId is missing\n\n  let type: ActivityEventType | null = null;\n  let details: ActivityEvent['details'] = {};\n\n  // Map central log action strings to local ActivityEventType\n  switch (log.action) {\n    case 'item.create':\n      type = 'CREATED';\n      break;\n    case 'item.update.fields':\n      type = 'EDITED';\n      // Attempt to get changed fields by comparing before/after, fallback to details or generic message\n      const changed = log.before && log.after\n        ? Object.keys(log.after).filter(key => log.before && log.after && JSON.stringify(log.before[key]) !== JSON.stringify(log.after[key]))\n        : (log.details?.changedFields || ['details']);\n      details = { changedFields: changed };\n      break;\n    case 'item.update.status.Delivered':\n      type = 'STATUS_CHANGED';\n      details = { previousStatus: log.before?.currentStatus, newStatus: 'Delivered' };\n      break;\n    case 'item.update.status.Archived':\n      type = 'STATUS_CHANGED';\n      details = { previousStatus: log.before?.currentStatus, newStatus: 'Archived' };\n      break;\n    // TODO: Add mappings for other specific status changes if implemented (e.g., 'Pending Delivery', 'Issue')\n    case 'item.update.flag':\n      type = 'FLAG_TOGGLED';\n      details = { isFlagged: log.after?.isFlagged };\n      break;\n    case 'item.update.issue.report':\n      type = 'ISSUE_REPORTED';\n      details = { issueDescription: log.details?.description || log.details?.issueDescription }; // Allow for variations\n      break;\n    case 'item.update.issue.resolve':\n      type = 'ISSUE_RESOLVED';\n      details = { resolutionOutcome: log.details?.outcome, note: log.details?.note };\n      break;\n    case 'item.update.issue.update': // Action name used in handleSaveIssueUpdate via updateItemAndLog\n      type = 'ISSUE_UPDATE_ADDED';\n      details = { note: log.details?.note };\n      break;\n    case 'item.add_note': // Action name used in handleSaveNote via updateItemAndLog\n      type = 'NOTE_ADDED';\n      details = { note: log.details?.note };\n      break;\n    // Add more mappings if other log.action values exist\n    default:\n      console.warn(`Unhandled log action type for UI mapping: ${log.action}`);\n      return null; // Don't display unmapped actions for now\n  }\n\n  if (!type) return null;\n\n  return {\n    timestamp,\n    userId,\n    // userName: // Optional: Could fetch/join user name later if needed\n    type,\n    details\n  };\n};\n\ninterface ItemDetailModalProps {\n  item: StockItem;\n  orgId: string;\n  onClose: () => void;\n  closeButtonRef?: React.RefObject<HTMLButtonElement | null>;\n  onActionSelected: (itemId: string, action: ActionDefinition) => void;\n}\n\nconst ItemDetailModal: React.FC<ItemDetailModalProps> = ({ item, orgId, onClose, closeButtonRef, onActionSelected }) => {\n  // State for fetched logs\n  const [activityEvents, setActivityEvents] = useState<ActivityEvent[]>([]);\n  const [loadingLogs, setLoadingLogs] = useState<boolean>(true);\n  const [logError, setLogError] = useState<string | null>(null);\n\n  // Actions toolbar\n  const availableActions = getAvailableActions(item.currentStatus, item.isFlagged);\n\n  // Fetch logs when the modal opens or item/orgId changes\n  useEffect(() => {\n    if (!item?.id || !orgId) { // Ensure we have item ID and orgId prop\n      setLoadingLogs(false);\n      setLogError(\"Missing item or organization ID for fetching logs.\");\n      return;\n    }\n\n    setActivityEvents([]); // Clear previous logs\n    setLoadingLogs(true);\n    setLogError(null);\n    const db = getFirestore();\n    const entityPath = `stockItems/${item.id}`;\n    // Query the 'logs' collection using the orgId prop\n    const logsRef = collection(db, `orgs/${orgId}/logs`);\n    const q = query(logsRef, where('entityPath', '==', entityPath), orderBy('timestamp', 'desc'));\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      // Map the document data directly to LogActionData, assuming data matches the interface\n      const fetchedLogs = snapshot.docs.map(doc => ({ ...doc.data() } as LogActionData));\n\n      // Map LogActionData to ActivityEvent for display\n      const mappedEvents = fetchedLogs\n        .map(mapLogToAction)\n        .filter((event): event is ActivityEvent => event !== null); // Filter out nulls and type guard\n\n      setActivityEvents(mappedEvents);\n      setLoadingLogs(false);\n    }, (error) => {\n      console.error(\"Error fetching logs: \", error);\n      setLogError(`Failed to fetch activity log: ${error.message}`);\n      setLoadingLogs(false);\n    });\n\n    // Cleanup listener on unmount or when item changes\n    return () => unsubscribe();\n  }, [item?.id, orgId]); // Re-run if item ID or orgId prop changes\n\n  return (\n    <Dialog open={true} onClose={onClose} maxWidth=\"md\" fullWidth scroll=\"paper\">\n      <DialogTitle>\n        {item.productName} - Details\n      </DialogTitle>\n      <DialogContent dividers={true}> {/* dividers add padding and lines */}\n        {/* Action Buttons Toolbar */}\n        <Box sx={{ mb: 2, borderBottom: 1, borderColor: 'divider', pb: 2 }}>\n          <Typography variant=\"h6\" gutterBottom>Actions</Typography>\n          <Stack direction=\"row\" spacing={1} flexWrap=\"wrap\"> {/* Use Stack for layout */}\n            {availableActions.map(action => (\n              <Button\n                key={action.id}\n                variant=\"contained\"\n                size=\"small\"\n                onClick={() => onActionSelected(item.id, action)}\n                title={action.description} // Tooltip via title attribute\n                // sx={{ mb: 1 }} // Add margin bottom if wrapping occurs\n              >\n                {action.label}\n              </Button>\n            ))}\n            {availableActions.length === 0 && (\n              <Typography variant=\"body2\" color=\"textSecondary\">\n                No actions available for current status.\n              </Typography>\n            )}\n          </Stack>\n        </Box>\n\n        {/* Item Details Section */}\n        <Box sx={{ mb: 2, borderBottom: 1, borderColor: 'divider', pb: 1 }}>\n          <Typography variant=\"h6\">Details</Typography>\n          {/* Use List for better structure */}\n          <List dense> {/* dense reduces padding */}\n            {/* Map item properties to ListItems */}\n            <ListItem>\n              <ListItemText primary=\"ID\" secondary={item.id} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Current Status\" secondary={formatValue(item.currentStatus)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Flagged\" secondary={item.isFlagged ? 'Yes' : 'No'} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Delivery Name\" secondary={formatValue(item.deliveryName)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Product Name\" secondary={formatValue(item.productName)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Quantity\" secondary={formatValue(item.quantity)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Price Per Item\" secondary={formatValue(item.pricePerItem, '')} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Order Date\" secondary={formatValue(item.orderDate)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Purchase Status\" secondary={formatValue(item.purchaseStatus)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Order Number\" secondary={formatValue(item.orderNumber)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Seller / Source\" secondary={formatValue(item.seller)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"VAT Registered?\" secondary={formatValue(item.isVatRegistered)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Destination\" secondary={formatValue(item.destination)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"ASIN / SKU\" secondary={formatValue(item.asinSku)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Acquisition Notes\" secondary={formatValue(item.acquisitionNotes)} sx={{ whiteSpace: 'pre-wrap' }} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Date Delivered\" secondary={item.dateDelivered ? new Date(item.dateDelivered).toLocaleString() : formatValue(null)} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Processor Notes\" secondary={formatValue(item.processorNotes)} sx={{ whiteSpace: 'pre-wrap' }} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"Issue Description\" secondary={formatValue(item.issueDescription)} sx={{ whiteSpace: 'pre-wrap' }} />\n            </ListItem>\n          </List>\n        </Box>\n\n        {/* History/Activity Log Section */}\n        <Box>\n          <Typography variant=\"h6\">Activity Log</Typography>\n          {loadingLogs && <CircularProgress size={24} sx={{ display: 'block', margin: '20px auto' }} />}\n          {logError && <Alert severity=\"error\">Error loading history: {logError}</Alert>}\n          {!loadingLogs && !logError && activityEvents.length === 0 && (\n            <Typography variant=\"body2\" color=\"textSecondary\" sx={{ mt: 2 }}>\n              No activity recorded.\n            </Typography>\n          )}\n          {!loadingLogs && !logError && activityEvents.length > 0 && (\n            <List dense>\n              {activityEvents.map((event, index) => (\n                <React.Fragment key={index}>\n                  <ListItem>\n                    <ListItemText \n                      primary={formatActivityEvent(event)} \n                      primaryTypographyProps={{ variant: 'body2' }} \n                    />\n                  </ListItem>\n                  {index < activityEvents.length - 1 && <Divider component=\"li\" />} \n                </React.Fragment>\n              ))}\n            </List>\n          )}\n        </Box>\n      </DialogContent>\n      <DialogActions>\n        <Button ref={closeButtonRef} onClick={onClose}>Close</Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ItemDetailModal;","import { initializeApp } from 'firebase/app';\nimport { getAuth } from 'firebase/auth';\nimport { getFirestore } from 'firebase/firestore';\nimport React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport {\n    DndContext,\n    closestCenter,\n    KeyboardSensor,\n    PointerSensor,\n    useSensor,\n    useSensors,\n    DragEndEvent,\n} from '@dnd-kit/core';\nimport {\n    arrayMove,\n    SortableContext,\n    sortableKeyboardCoordinates,\n    useSortable,\n    horizontalListSortingStrategy,\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\nimport { restrictToHorizontalAxis } from '@dnd-kit/modifiers'; // Import the modifier\nimport { StockItem, ItemStatus, ActivityEvent, ActivityEventType, ActionDefinition } from './types'; // Import the interface\nimport AddItemForm from './AddItemForm'; // Import the form component\nimport ItemDetailModal from './ItemDetailModal'; // Import the details modal\nimport ReportIssueModal from './ReportIssueModal'; // Import the new modal\nimport AddUpdateModal from './AddUpdateModal'; // Import the new modal\nimport ResolveIssueModal from './ResolveIssueModal'; // Import the new modal\nimport TableSettingsModal from './TableSettingsModal'; // Import the new modal\nimport UserActivityView from './UserActivityView'; // Import the new component\nimport {\n  collection,\n  doc,\n  onSnapshot,\n  addDoc,\n  updateDoc,\n  serverTimestamp,\n  query,\n  orderBy\n} from 'firebase/firestore';\nimport { User as FirebaseUser } from \"firebase/auth\"; // Import Auth related types and functions\nimport { LogActionData } from 'shell-log-service'; // Import only the type, not the function\nimport { Box, Tabs, Tab, TextField, Button, TableContainer, Table, TableHead, TableRow, TableCell, Paper, IconButton, Menu, MenuItem, Tooltip, Switch as MuiSwitch, Dialog, DialogTitle, DialogContent, DialogActions, List, ListItem, ListItemText, Typography, Alert, LinearProgress } from '@mui/material';\nimport TableBody from '@mui/material/TableBody'; // Import TableBody separately\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport AddIcon from '@mui/icons-material/Add';\nimport Settings from '@mui/icons-material/Settings';\nimport FlagIcon from '@mui/icons-material/Flag'; // Import FlagIcon\n\n// Utility to remove undefined fields before saving to Firestore\nfunction removeUndefinedFields(obj: Record<string, any>) {\n  return Object.fromEntries(Object.entries(obj).filter(([_, v]) => v !== undefined));\n}\n\n// Define the props interface for ToolApp\nexport interface ToolAppProps {\n  user: FirebaseUser | null; // Use FirebaseUser type\n  org: any; // Replace 'any' with a specific org type if available\n  permissions: string[];\n  logAction?: (data: LogActionData) => Promise<void>; // Add logAction prop\n}\n\n// Function to check if an item is considered late\nconst isItemLate = (item: StockItem): boolean => {\n  if (item.currentStatus !== 'Pending Delivery') {\n    return false;\n  }\n  const orderDate = new Date(item.orderDate);\n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n  return orderDate < sevenDaysAgo;\n};\n\n// --- Helper Functions ---\n\n// Function to create a new ActivityEvent\nconst createActivityEvent = (\n    userId: string, // Add userId parameter\n    type: ActivityEventType,\n    details: ActivityEvent['details'] = {}\n): ActivityEvent => ({\n    timestamp: new Date().toISOString(),\n    type,\n    userId, // Include userId in the returned object\n    details,\n});\n\nexport const getAvailableActions = (status: ItemStatus, isFlagged?: boolean): ActionDefinition[] => {\n  let actions: ActionDefinition[] = [];\n  switch (status) {\n    case 'Pending Delivery':\n      actions = [\n        { id: 'Mark as Delivered', label: 'Mark as Delivered', description: 'Update status to Delivered' },\n        { id: 'Report Issue', label: 'Report Issue', description: 'Report an issue with this item' },\n        { id: 'View Details', label: 'View Details', description: 'View full item details and history' },\n        { id: 'Edit Item', label: 'Edit Item', description: 'Edit item details' },\n        { id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history' },\n      ]; break;\n    case 'Delivered':\n      actions = [\n        { id: 'Archive', label: 'Archive', description: 'Archive this item' },\n        { id: 'Report Issue', label: 'Report Issue', description: 'Report an issue with this item' },\n        { id: 'View Details', label: 'View Details', description: 'View full item details and history' },\n        { id: 'Edit Item', label: 'Edit Item', description: 'Edit item details' },\n        { id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history' },\n      ]; break;\n    case 'Issue': // Issue-specific actions\n      actions = [\n        { id: 'Resolve Issue', label: 'Resolve Issue', description: 'Mark the issue as resolved' },\n        { id: 'Add Issue Update', label: 'Add Issue Update', description: 'Add an update note to the ongoing issue' },\n        { id: 'Archive', label: 'Archive', description: 'Archive this item' },\n        { id: 'View Details', label: 'View Details', description: 'View full item details and history' },\n        { id: 'Edit Item', label: 'Edit Item', description: 'Edit item details' },\n        { id: 'Add Note', label: 'Add Note', description: 'Add a general note to the item history' },\n      ]; break;\n    case 'Late':\n      actions = [\n        { id: 'Mark as Delivered', label: 'Mark as Delivered', description: 'Update status to Delivered' },\n        { id: 'Report Issue', label: 'Report Issue', description: 'Report an issue with this item' },\n        { id: 'View Details', label: 'View Details', description: 'View full item details and history' },\n        { id: 'Edit Item', label: 'Edit Item', description: 'Edit item details' },\n        { id: 'Add Note', label: 'Add Note', description: 'Add a note to the item history' },\n      ]; break;\n    case 'Archived':\n      actions = [{ id: 'View Details', label: 'View Details', description: 'View full item details and history' }]; break;\n    default:\n      actions = [{ id: 'View Details', label: 'View Details', description: 'View full item details and history' }]; break;\n  }\n  if (status !== 'Archived') {\n    actions.unshift(\n      isFlagged\n        ? { id: 'Unflag Item', label: 'Unflag', description: 'Remove the flag from this item' }\n        : { id: 'Flag Item', label: 'Flag', description: 'Flag this item for attention' }\n    );\n  }\n  return actions;\n};\n\n// Simple Action Menu Component\ninterface ActionMenuProps {\n  itemId: string;\n  actions: ActionDefinition[];\n  onActionSelected: (itemId: string, action: ActionDefinition) => void;\n  onClose: () => void;\n  anchorEl: null | HTMLElement; // Added anchorEl for MUI Menu\n  open: boolean; // Added open state for MUI Menu\n}\n\n// Refactored ActionMenu using MUI\nexport const ActionMenu: React.FC<ActionMenuProps> = ({ \n  itemId, \n  actions, \n  onActionSelected, \n  onClose, \n  anchorEl, \n  open \n}) => {\n  // No longer need useRef or useEffect for click-outside, Menu handles it.\n\n  const handleSelectAction = (action: ActionDefinition) => {\n    onActionSelected(itemId, action);\n    onClose(); // Close the menu after selection\n  };\n\n  return (\n    <Menu\n      anchorEl={anchorEl}\n      open={open}\n      onClose={onClose} // MUI handles closing on click away\n      MenuListProps={{\n        'aria-labelledby': `actions-button-${itemId}`, // Improve accessibility\n      }}\n    >\n      {actions.map(action => (\n        <MenuItem \n          key={action.id} \n          onClick={() => handleSelectAction(action)}\n        >\n          {action.label}\n        </MenuItem>\n      ))}\n    </Menu>\n  );\n};\n\n// --- Configuration ---\nexport interface ColumnConfig {\n  id: keyof StockItem | 'actions'; // Use StockItem keys + custom 'actions' key\n  label: string;\n}\n\n// Define all possible columns (excluding activityLog for direct table display)\nconst ALL_COLUMNS: ColumnConfig[] = [\n  { id: 'orderDate', label: 'Order Date' },\n  { id: 'quantity', label: 'Qty' },\n  { id: 'productName', label: 'Product Name' },\n  { id: 'deliveryName', label: 'Delivery Name' },\n  { id: 'pricePerItem', label: 'Price/Item' },\n  { id: 'seller', label: 'Seller/Source' },\n  { id: 'destination', label: 'Destination' },\n  { id: 'asinSku', label: 'ASIN/SKU' },\n  { id: 'purchaseStatus', label: 'Purchase Status' },\n  { id: 'orderNumber', label: 'Order #' },\n  { id: 'currentStatus', label: 'Status' },\n  { id: 'isFlagged', label: 'Flagged' },\n  { id: 'acquisitionNotes', label: 'Acquisition Notes' },\n  { id: 'issueDescription', label: 'Issue Description' },\n  { id: 'dateDelivered', label: 'Date Delivered' },\n  { id: 'actions', label: 'Actions' },\n];\n\n// Default visible columns (keys/ids)\nconst DEFAULT_VISIBLE_COLUMN_IDS: Array<ColumnConfig['id']> = [\n    'orderDate', \n    'quantity', \n    'productName', \n    'deliveryName', \n    'currentStatus', \n    'actions',\n];\n\nconst LOCAL_STORAGE_KEY_VISIBLE_COLUMNS = 'incomingTool_visibleColumns';\n\n// --- Firestore Data ---\n\n// --- Draggable Header Component ---\ninterface DraggableHeaderProps {\n  column: ColumnConfig; // Use 'column' prop\n}\n\nconst DraggableHeader: React.FC<DraggableHeaderProps> = ({ column }) => {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: column.id }); // Use column.id\n\n  const style: React.CSSProperties = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1, // Dim when dragging\n    touchAction: 'none', // Prevent scrolling on touch devices while dragging\n  };\n\n  // Determine alignment based on column ID\n  const isNumeric = ['quantity', 'pricePerItem'].includes(column.id);\n\n  return (\n    // Use MUI TableCell as the sortable header element\n    <TableCell \n      ref={setNodeRef} \n      component=\"th\" // Specify it's a header cell\n      scope=\"col\" \n      style={style} \n      {...attributes} \n      {...listeners}\n      align={isNumeric ? 'right' : 'left'} // Set alignment\n      sx={{ \n        fontWeight: 'bold', \n        cursor: 'grab', \n        whiteSpace: 'nowrap',\n        bgcolor: isDragging ? '#e0e0e0' : 'background.paper', // Ensure header stays opaque, highlight on drag\n        // Apply specific widths/minWidths based on column ID\n        ...(column.id === 'isFlagged' && { width: 50, p: '6px 8px' }),\n        ...(column.id === 'seller' && { minWidth: 140 }),\n        ...(column.id === 'deliveryName' && { minWidth: 160 }),\n        ...(column.id === 'quantity' && { width: 80 }), // Already aligned right\n        ...(column.id === 'destination' && { minWidth: 110 }),\n        ...(column.id === 'pricePerItem' && { width: 100 }), // Already aligned right\n        ...(column.id === 'orderNumber' && { width: 110 }),\n        ...(column.id === 'purchaseStatus' && { width: 110 }),\n        ...(column.id === 'orderDate' && { width: 110 }),\n        ...(column.id === 'asinSku' && { width: 120 }),\n        ...(column.id === 'productName' && { minWidth: 160 }),\n        ...(column.id === 'actions' && { width: 60, p: '6px 8px' }),\n        ...(column.id === 'currentStatus' && { width: 100 }),\n      }}\n    >\n      {column.label} {/* Use column.label */}\n    </TableCell>\n  );\n};\n\n// Update StockProcessingList props to accept onColumnReorder\n// interface StockProcessingListProps {\n//   items: StockItem[];\n//   visibleColumns: ColumnConfig[];\n//   onActionSelected: (itemId: string, action: ActionDefinition) => Promise<void>; // Changed void to Promise<void>\n//   onViewDetails: (itemId: string) => void;\n//   onColumnReorder: (event: DragEndEvent) => void; \n//   selectedRowIndex?: number;\n//   openMenuId: string | null;\n//   menuAnchorEl: null | HTMLElement;\n//   handleMenuOpen: (event: React.MouseEvent<HTMLElement>, itemId: string) => void;\n//   handleMenuClose: () => void;\n// }\n\n// Refactored AddItemButton using MUI\n// const AddItemButton = ({ onClick }: { onClick: () => void }) => (\n//   <Button\n//     variant=\"contained\"\n//     color=\"primary\"\n//     startIcon={<AddIcon />}\n//     onClick={onClick}\n//     sx={{ mb: 2 }} // Add margin below the button\n//   >\n//     Add New Item\n//   </Button>\n// );\n\n// Component for the Flag Toggle\ninterface FlagToggleSwitchProps {\n  isFlagged: boolean;\n  onToggle: () => void;\n  disabled?: boolean;\n}\n\nconst FlagToggleSwitch: React.FC<FlagToggleSwitchProps> = ({ isFlagged, onToggle, disabled }) => {\n  return (\n    <Tooltip title={isFlagged ? \"Unflag Item\" : \"Flag Item\"} placement=\"top\">\n      {/* Add span to allow Tooltip when Switch is disabled */} \n      <span> \n        <MuiSwitch\n          checked={isFlagged}\n          onChange={onToggle}\n          disabled={disabled}\n          size=\"small\"\n          onClick={(e) => e.stopPropagation()} // Prevent row click when toggling\n        />\n      </span>\n    </Tooltip>\n  );\n};\n\n// Component for the Flag Toggle\nconst FlagToggle = ({ isChecked, onChange }: { isChecked: boolean; onChange: (checked: boolean) => void }) => (\n  <div style={{ marginLeft: 'auto', display: 'flex', alignItems: 'center' }}> {/* Push to the right */} \n    <label htmlFor=\"flagToggle\" style={{ marginRight: '8px', fontWeight: 'bold' }}>Show Flagged Only:</label>\n    <input \n      type=\"checkbox\" \n      id=\"flagToggle\"\n      checked={isChecked}\n      onChange={(e) => onChange(e.target.checked)}\n      style={{ width: '20px', height: '20px' }} // Basic styling for visibility\n    />\n  </div>\n);\n\n// --- Keyboard Shortcuts Help Modal ---\n// Refactored HelpModal using MUI Dialog\nconst HelpModal = ({ onClose }: { onClose: () => void }) => {\n  const shortcuts = [\n    { key: '/', description: 'Focus search bar' },\n    { key: 'a', description: 'Add new item' },\n    { key: 'c', description: 'Open columns/settings' },\n    { key: 'f', description: 'Toggle flagged only' },\n    { key: '1-6', description: 'Switch filter tabs' },\n    { key: '?', description: 'Show this help' },\n    { key: 'Arrow Up/Down', description: 'Move row selection' },\n    { key: 'Enter / o', description: 'View details for selected row' },\n    { key: 'e', description: 'Edit selected row' },\n    { key: 'r', description: 'Report issue for selected row' },\n    { key: 'l', description: 'Flag/unflag selected row' },\n    { key: 'Esc', description: 'Close any open modal' },\n  ];\n\n  return (\n    <Dialog open={true} onClose={onClose} aria-labelledby=\"help-modal-title\">\n      <DialogTitle id=\"help-modal-title\">Keyboard Shortcuts</DialogTitle>\n      <DialogContent dividers>\n        <List dense>\n          {shortcuts.map((shortcut, index) => (\n            <ListItem key={index}>\n              <ListItemText \n                primary={<Typography component=\"span\" sx={{ fontWeight: 'bold', minWidth: '100px', display: 'inline-block' }}>{shortcut.key}</Typography>} \n                secondary={<Typography component=\"span\" variant=\"body2\">{shortcut.description}</Typography>}\n              />\n            </ListItem>\n          ))}\n        </List>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose} autoFocus>Close</Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\n// --- Main Tool Component ---\n\n// --- IMPORTANT: Replace with your actual Firebase config ---\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID\n};\n\n// Optionally, throw if any are missing (for dev safety)\nObject.entries(firebaseConfig).forEach(([key, value]) => {\n  if (!value) {\n    throw new Error(`Missing Firebase config value for ${key}. Did you set your .env file?`);\n  }\n});\n\nconst app = initializeApp(firebaseConfig);\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst auth = getAuth(app); // Needed for Firestore permissions, silence unused warning\nconst db = getFirestore(app);\n\nconst ToolApp: React.FC<ToolAppProps> = ({ user, org, permissions, logAction }) => {\n  // Log received props, especially logAction\n  console.log('ToolApp Props Received:', { user, orgId: org?.id, permissions, logActionExists: !!logAction });\n\n  // Row selection state\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\n  const [isHelpModalOpen, setIsHelpModalOpen] = useState<boolean>(false);\n\n  const [allItems, setAllItems] = useState<StockItem[]>([]);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState<string>('');\n  const [currentFilter, setCurrentFilter] = useState<ItemStatus | 'All'>('All'); // Default filter\n  const [selectedItemDetails, setSelectedItemDetails] = useState<StockItem | null>(null); // For View Details Modal\n  const [isAddItemModalOpen, setIsAddItemModalOpen] = useState<boolean>(false); // State for modal visibility\n  const [showFlaggedOnly, setShowFlaggedOnly] = useState<boolean>(false); // State for flag toggle\n  const [editingItem, setEditingItem] = useState<StockItem | null>(null); // State to hold item being edited\n  // State for new modals\n  const [reportingIssueItem, setReportingIssueItem] = useState<StockItem | null>(null);\n  const [addingUpdateItem, setAddingUpdateItem] = useState<StockItem | null>(null);\n  const [resolvingIssueItem, setResolvingIssueItem] = useState<StockItem | null>(null);\n  const [isSettingsModalOpen, setIsSettingsModalOpen] = useState(false); // State for settings modal\n  const [itemForNote, setItemForNote] = useState<StockItem | null>(null); // New state for item context for general note\n  const [isUserActivityViewOpen, setIsUserActivityViewOpen] = useState<boolean>(false); // State for user activity view\n\n  // State for column configuration (order matters now)\n  const [visibleColumnIds, setVisibleColumnIds] = useState<Array<ColumnConfig['id']>>(() => {\n    try {\n      const stored = localStorage.getItem(LOCAL_STORAGE_KEY_VISIBLE_COLUMNS);\n      // Ensure stored value is an array, otherwise use default\n      const parsed = stored ? JSON.parse(stored) : DEFAULT_VISIBLE_COLUMN_IDS;\n      return Array.isArray(parsed) ? parsed : DEFAULT_VISIBLE_COLUMN_IDS;\n    } catch (error) {\n      console.error(\"Error reading visible columns from localStorage\", error);\n      return DEFAULT_VISIBLE_COLUMN_IDS;\n    }\n  });\n  \n  // Save visible columns to localStorage whenever they change\n  useEffect(() => {\n    try {\n        localStorage.setItem(LOCAL_STORAGE_KEY_VISIBLE_COLUMNS, JSON.stringify(visibleColumnIds));\n    } catch (error) {\n        console.error(\"Error saving visible columns to localStorage\", error);\n    }\n  }, [visibleColumnIds]);\n\n  // Derive visible columns based on IDs state (order is now determined by visibleColumnIds)\n  const visibleColumns = visibleColumnIds\n      .map(id => ALL_COLUMNS.find(col => col.id === id))\n      .filter((col): col is ColumnConfig => col !== undefined); // Filter out undefined if an ID becomes invalid\n\n  // Update filtering logic to include flag toggle\n  const filteredItems = allItems.filter(item => { // filteredItems is the displayed array\n\n    const matchesSearch = \n      !searchTerm || \n      item.deliveryName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      item.productName.toLowerCase().includes(searchTerm.toLowerCase());\n      \n    let matchesFilter = false;\n    if (currentFilter === 'All') {\n        matchesFilter = true;\n    } else if (currentFilter === 'Late') {\n        // Show items that are pending and meet the late criteria\n        matchesFilter = isItemLate(item);\n    } else {\n        // Standard status matching, but don't show late items unless 'Late' or 'All' filter is selected\n        // Or should late items still appear in Pending Delivery? Let's keep them there for now.\n        matchesFilter = item.currentStatus === currentFilter;\n    }\n\n    // Apply flag filter if toggle is on\n    const matchesFlag = !showFlaggedOnly || item.isFlagged === true;\n\n    return matchesFilter && matchesSearch && matchesFlag; // Add flag condition\n  });\n\n  // Clamp selectedRowIndex if filteredItems changes\n  useEffect(() => {\n    setSelectedRowIndex(idx => {\n      if (filteredItems.length === 0) return -1;\n      if (idx < 0) return 0;\n      if (idx >= filteredItems.length) return filteredItems.length - 1;\n      return idx;\n    });\n  }, [filteredItems]);\n\n  // --- Firestore Real-time Sync ---\n  useEffect(() => {\n    if (!org?.id) return;\n    setLoading(true);\n    setError(null);\n    const q = query(collection(db, 'orgs', org.id, 'stockItems'), orderBy('orderDate', 'desc'));\n    const unsub = onSnapshot(q, (snapshot) => {\n      const items: StockItem[] = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() })) as StockItem[];\n      setAllItems(items);\n      setLoading(false);\n    }, (err) => {\n      setError('Failed to load items: ' + err.message);\n      setLoading(false);\n    });\n    return () => unsub();\n  }, [org?.id]); // db is stable, remove from deps\n\n  // Placeholder functions for actions\n  const handleSearch = (term: string) => {\n    setSearchTerm(term);\n  };\n\n\n  const handleFilterChange = (filter: ItemStatus | 'All') => {\n    setCurrentFilter(filter);\n  };\n\n  // Centralized function to update item in Firestore and add log entry\n  const updateItemAndLog = useCallback(async (itemId: string, userId: string | undefined, changes: Partial<StockItem>, event: ActivityEvent) => {\n    if (!db || !org?.id || !userId) {\n      console.error('Cannot update item: Missing configuration.', { db: !!db, orgId: org?.id, userId });\n      setError('Cannot update item: Missing configuration.');\n      return;\n    }\n\n    const itemRef = doc(db, 'orgs', org.id, 'stockItems', itemId);\n    const itemBefore = allItems.find(i => i.id === itemId);\n    if (!itemBefore) {\n        console.error(`Item ${itemId} not found for update`);\n        setError(`Item ${itemId} not found.`);\n        return;\n    }\n\n    // Combine updates with new activity event and timestamp\n    const finalUpdates = removeUndefinedFields({\n      ...changes,\n      lastUpdated: serverTimestamp(),\n    });\n\n    const itemAfter = { ...itemBefore, ...finalUpdates }; // Approximate state after update\n\n    try {\n      await updateDoc(itemRef, finalUpdates);\n      console.log(`Item ${itemId} updated successfully.`);\n\n      // Log the generic update action\n      console.log('updateItemAndLog: Attempting to log action. logAction available?', !!logAction);\n      if (logAction) {\n        // Determine standardized action name\n        let actionName: string;\n        try {\n          if (event.type === 'EDITED') {\n            actionName = 'item.update.fields';\n          } else if (event.type === 'FLAG_TOGGLED') {\n            actionName = 'item.update.flag';\n          } else if (event.type === 'STATUS_CHANGED') {\n            const newStatus = event.details?.newStatus?.toLowerCase() || 'unknown';\n            actionName = `item.update.status.${newStatus}`;\n          } else if (event.type === 'ISSUE_REPORTED') {\n            actionName = 'item.update.issue.report';\n          } else if (event.type === 'ISSUE_RESOLVED') {\n            actionName = 'item.update.issue.resolve';\n          } else if (event.type === 'ISSUE_UPDATE_ADDED') {\n            actionName = 'item.update.issue.update';\n          } else if (event.type === 'NOTE_ADDED') {\n            actionName = 'item.add_note';\n          } else {\n            actionName = event.type; // Fallback\n          }\n        } catch (nameError) {\n          console.error('Error deriving action name for logging:', nameError);\n          actionName = event.type;\n        }\n\n        // Construct the data payload ensuring types match LogActionData\n        const logData: LogActionData = {\n           orgId: org.id,\n           toolKey: 'incomingtool',\n           action: actionName, // actionName is now guaranteed to be string\n           entityPath: `stockItems/${itemId}`,\n           // Conditionally add before/after/details if they exist\n           ...(itemBefore !== undefined && { before: itemBefore }),\n           ...(itemAfter !== undefined && { after: itemAfter }),\n           ...(event.details !== undefined && { details: event.details })\n        };\n\n        await logAction(logData); // Pass the correctly typed object\n\n      }\n\n    } catch (e) {\n      console.error(`Error updating item ${itemId}:`, e);\n      setError(`Failed to update item: ${(e as Error).message}`);\n      throw e; // Re-throw error to be caught by calling handler if needed\n    }\n  }, [org, allItems, logAction]);\n\n  // Update handleItemAction to dispatch to specific handlers or generic updates\n  const handleItemAction = useCallback(async (itemId: string, action: ActionDefinition) => {\n    console.log(`Action: ${action.label} on item ${itemId}`);\n    const item = allItems.find(i => i.id === itemId);\n    if (!item) return;\n\n    switch (action.id) {\n      case 'Edit Item':\n        setEditingItem(item);\n        setIsAddItemModalOpen(true);\n        break;\n      case 'Flag Item':\n      case 'Unflag Item':\n        const newFlagState = action.id === 'Flag Item';\n        await updateItemAndLog(itemId, user?.uid, \n          { isFlagged: newFlagState }, \n          createActivityEvent(user?.uid || '', 'FLAG_TOGGLED', { isFlagged: newFlagState })\n        );\n        break;\n      case 'Mark as Delivered':\n        if (item.currentStatus !== 'Delivered') {\n          await updateItemAndLog(itemId, user?.uid,\n            { currentStatus: 'Delivered', dateDelivered: new Date().toISOString() },\n            createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: item.currentStatus, newStatus: 'Delivered' })\n          );\n        }\n        break;\n      case 'Archive':\n         if (item.currentStatus !== 'Archived') {\n          await updateItemAndLog(itemId, user?.uid, \n            { currentStatus: 'Archived' },\n            createActivityEvent(user?.uid || '', 'STATUS_CHANGED', { previousStatus: item.currentStatus, newStatus: 'Archived' })\n          );\n         }\n        break;\n      case 'Add Note': // New case for adding a general note\n        setItemForNote(item); // Set the item context for the modal\n        break;\n      case 'Report Issue': // Close detail view & open report modal\n        setSelectedItemDetails(null);\n        setReportingIssueItem(item);\n        break;\n      case 'Resolve Issue': // Close detail view & open resolve modal\n        setSelectedItemDetails(null);\n        setResolvingIssueItem(item);\n        break;\n      case 'Add Issue Update': // Close detail view & open add-note modal\n        setSelectedItemDetails(null);\n        setAddingUpdateItem(item);\n        break;\n      case 'View Details': // Open item detail modal\n        setSelectedItemDetails(item);\n        break;\n      // Default case for actions handled elsewhere or needing no state change here (like View Details)\n    }\n  }, [user?.uid, allItems, updateItemAndLog, setEditingItem, setIsAddItemModalOpen, setReportingIssueItem, setAddingUpdateItem, setResolvingIssueItem, setSelectedItemDetails]);\n\n  // Handler for reporting an issue\n  const handleSaveReportIssue = useCallback(async (description: string) => {\n    if (!reportingIssueItem || !org?.id) return;\n    const itemId = reportingIssueItem.id;\n    try {\n      await updateItemAndLog(\n        itemId,\n        user?.uid,\n        { currentStatus: 'Issue', issueDescription: description },\n        createActivityEvent(user?.uid || '', 'ISSUE_REPORTED', { issueDescription: description })\n      );\n      setReportingIssueItem(null);\n    } catch (err) {\n      setError('Failed to report issue: ' + (err as Error).message);\n    }\n  }, [reportingIssueItem, org?.id, user?.uid, updateItemAndLog, setReportingIssueItem, setError]);\n\n  // Handler for adding an issue update note\n  const handleSaveIssueUpdate = useCallback(async (note: string) => {\n    if (!addingUpdateItem) return;\n    try {\n      await updateItemAndLog(\n        addingUpdateItem.id,\n        user?.uid,\n        {},\n        createActivityEvent(user?.uid || '', 'ISSUE_UPDATE_ADDED', { note })\n      );\n      setAddingUpdateItem(null); // Close modal\n    } catch (err) {\n      // Error is already logged by updateItemAndLog\n      // setError('Failed to add issue update: ' + (err as Error).message);\n    }\n  }, [addingUpdateItem, updateItemAndLog, setAddingUpdateItem, user?.uid]);\n\n  // Handler for resolving an issue\n  const handleSaveResolveIssue = useCallback(async (outcome: string, note?: string) => {\n    if (!resolvingIssueItem || !org?.id || !db) return;\n    const itemId = resolvingIssueItem.id;\n    // Determine new status based on outcome\n    let newStatus: ItemStatus = 'Delivered'; // Default\n    if (outcome === 'Returned to Supplier' || outcome === 'Disposed Of') {\n      newStatus = 'Archived';\n    }\n    // Could add more outcomes mapping to statuses\n\n    try {\n      const itemRef = doc(db, 'orgs', org.id, 'stockItems', itemId);\n      await updateDoc(itemRef, {\n        currentStatus: newStatus,\n        lastUpdated: serverTimestamp(),\n      });\n      // Log action\n      const itemBefore = allItems.find(item => item.id === itemId);\n      console.log('handleSaveResolveIssue: Attempting to log action. logAction available?', !!logAction);\n      if (logAction) {\n        await logAction({\n          orgId: org.id,\n          toolKey: 'incomingtool',\n          action: 'item.update.issue.resolve', // Standardized action name\n          entityPath: `stockItems/${itemId}`,\n          before: itemBefore,\n          after: { ...itemBefore, currentStatus: newStatus }, // Approximate state after update\n          details: { resolutionOutcome: outcome, note }\n        });\n      }\n      setResolvingIssueItem(null); // Close modal\n    } catch (err) {\n      setError('Failed to resolve issue: ' + (err as Error).message);\n    }\n  }, [resolvingIssueItem, org?.id, allItems, logAction, setResolvingIssueItem, setError]);\n\n  // Handler for Saving (Create or Update)\n  const handleCloseFormModal = useCallback(() => {\n    setIsAddItemModalOpen(false);\n    setEditingItem(null); // Clear editing state when closing\n  }, [setIsAddItemModalOpen, setEditingItem]);\n\n  const handleSaveItem = useCallback(async (itemData: Omit<StockItem, 'id' | 'currentStatus' | 'dateDelivered' | 'activityLog'> & { isFlagged: boolean }) => {\n    console.log('ToolApp: current editingItem at save', editingItem);\n    if (!org?.id || !db) {\n      console.error('ToolApp: Cannot save item because org.id or db is undefined', org);\n      setError('Cannot save item: No organization selected or database unavailable.');\n      return;\n    }\n    console.log('ToolApp: handleSaveItem called', itemData);\n    try {\n      if (editingItem && editingItem.id) {\n        // --- UPDATE LOGIC ---\n        const itemId = editingItem.id;\n        // Determine changed fields for the EDIT event\n        const changedFields = (Object.keys(itemData) as Array<keyof typeof itemData>).filter(key =>\n          editingItem.hasOwnProperty(key) && editingItem[key] !== itemData[key]\n        );\n        // Ensure isFlagged is always considered if it exists in itemData\n        if ('isFlagged' in itemData && !changedFields.includes('isFlagged') && editingItem.isFlagged !== itemData.isFlagged) {\n             changedFields.push('isFlagged');\n        }\n\n        const editEvent = createActivityEvent(user?.uid || '', 'EDITED', { changedFields: changedFields.length > 0 ? changedFields : undefined });\n\n        // Use updateItemAndLog for the actual update and central logging\n        await updateItemAndLog(itemId, user?.uid, itemData, editEvent);\n\n      } else {\n        // --- CREATE LOGIC ---\n        const newItem = removeUndefinedFields({\n          ...itemData,\n          currentStatus: 'Pending Delivery',\n          lastUpdated: serverTimestamp(),\n        });\n        const docRef = await addDoc(collection(db, 'orgs', org.id, 'stockItems'), newItem);\n\n        // Log create action separately (as updateItemAndLog needs an existing item)\n        console.log('handleSaveItem: Attempting to log action. logAction available?', !!logAction);\n        if (logAction) {\n          await logAction({\n            orgId: org.id,\n            toolKey: 'incomingtool',\n            action: 'item.create',\n            entityPath: `stockItems/${docRef.id}`,\n            after: newItem // Log the data that was added\n            // 'before' is omitted for create actions\n          });\n        }\n      }\n      handleCloseFormModal(); // Close modal on success\n    } catch (err) {\n      console.error('Failed to save item', err);\n      setError('Failed to save item: ' + (err as Error).message);\n      // Optionally, don't close the modal on error\n    }\n  }, [editingItem, org, user, logAction, updateItemAndLog, handleCloseFormModal, setError]);\n\n  // Handler to close the item details modal\n  const handleCloseDetailModal = useCallback(() => {\n    setSelectedItemDetails(null); // Clear state to hide the modal\n  }, [setSelectedItemDetails]);\n\n  // Ref to store the current org ID to avoid useCallback dependency issues\n  const orgIdRef = useRef<string | undefined>(undefined); // Initialize with undefined\n\n  // Effect to update the orgIdRef whenever the org prop changes\n  useEffect(() => {\n    orgIdRef.current = org?.id;\n  }, [org]);\n\n  // Handler to open the Add Item modal (clears any editing state)\n  const handleAddItem = useCallback(() => {\n    // Use the ref to get the current org ID\n    const currentOrgId = orgIdRef.current;\n    if (!currentOrgId) {\n      setError(\"Cannot add item: Organization ID is missing.\");\n      return;\n    }\n    // Clear any existing edit state and open add-item modal\n    setEditingItem(null);\n    setIsAddItemModalOpen(true);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [setIsAddItemModalOpen, setEditingItem, setError]);\n\n  // *** RESTORED HANDLERS END ***\n\n  // Handler for column drag-and-drop reordering\n  const handleColumnDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n\n    if (over && active.id !== over.id) {\n      setVisibleColumnIds((currentIds) => {\n        const oldIndex = currentIds.indexOf(active.id as ColumnConfig['id']);\n        const newIndex = currentIds.indexOf(over.id as ColumnConfig['id']);\n        // Use arrayMove to update the order\n        return arrayMove(currentIds, oldIndex, newIndex);\n      });\n    }\n  };\n\n  // Handler for saving column visibility changes from modal\n  const handleSaveColumnSettings = (idsFromModal: Array<ColumnConfig['id']>) => {\n    setVisibleColumnIds(currentVisibleIds => {\n        const modalIdSet = new Set(idsFromModal);\n\n        // 1. Filter current IDs to keep only those still checked in the modal (preserves order)\n        const keptOrderedIds = currentVisibleIds.filter(id => modalIdSet.has(id));\n\n        // 2. Find IDs that are in the modal list but *not* in the current visible list (newly checked)\n        const newlyAddedIds = idsFromModal.filter(id => !currentVisibleIds.includes(id));\n\n        // 3. Combine the kept ordered IDs with the newly added ones\n        const newVisibleOrder = [...keptOrderedIds, ...newlyAddedIds];\n\n        // Ensure 'actions' column is always present if it was somehow removed (optional safeguard)\n        // if (!newVisibleOrder.includes('actions') && ALL_COLUMNS.some(c => c.id === 'actions')) {\n        //     newVisibleOrder.push('actions');\n        // }\n\n        return newVisibleOrder;\n    });\n    setIsSettingsModalOpen(false);\n  };\n\n  // Ref for search input\n  const searchInputRef = useRef<HTMLInputElement>(null);\n\n  // Handler for viewing item details from StockProcessingList\n  const handleViewDetails = useCallback((itemId: string) => {\n    const item = allItems.find(i => i.id === itemId);\n    if (!item) {\n      console.error(\"Item not found for viewing details:\", itemId);\n      setError('Item not found.'); // Use setError state setter\n      return;\n    }\n    console.log(\"Viewing details for:\", item);\n    if (!org) {\n      console.error(\"Org ID is missing, cannot fetch logs.\");\n      setError('Organization context is missing.'); // Use setError state setter\n      return;\n    }\n    setSelectedItemDetails(item); // Use setSelectedItemDetails state setter\n    // TODO: Focus management - consider focusing the modal or close button\n  }, [org, allItems, setError]); // Update dependencies\n\n  // Effect hook for handling global keyboard shortcuts (Corrected structure with original logic)\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // console.log('Keydown event:', e.key); // Keep debug log if useful\n\n      // Don't trigger shortcuts if typing in an input or textarea\n      const target = e.target as HTMLElement;\n      const tag = target.tagName;\n      if (tag === 'INPUT' || tag === 'TEXTAREA' || target.isContentEditable) return;\n\n      // If any modal is open, only allow 'Escape' key\n      const anyModalOpen = isAddItemModalOpen || isSettingsModalOpen || selectedItemDetails || reportingIssueItem || addingUpdateItem || resolvingIssueItem || isHelpModalOpen || isUserActivityViewOpen;\n\n      if (anyModalOpen) {\n        if (e.key === 'Escape') {\n          // Close modals\n          if (isAddItemModalOpen) setIsAddItemModalOpen(false);\n          if (isSettingsModalOpen) setIsSettingsModalOpen(false);\n          if (selectedItemDetails) setSelectedItemDetails(null);\n          if (reportingIssueItem) setReportingIssueItem(null);\n          if (addingUpdateItem) setAddingUpdateItem(null);\n          if (resolvingIssueItem) setResolvingIssueItem(null);\n          if (isHelpModalOpen) setIsHelpModalOpen(false);\n          if (isUserActivityViewOpen) setIsUserActivityViewOpen(false);\n        }\n        return; // Ignore other keys if a modal is open\n      }\n\n      // --- Filter tab shortcuts --- (Restored)\n      if (e.key >= '1' && e.key <= '6') {\n        const tabMap: (ItemStatus | 'All')[] = ['All', 'Pending Delivery', 'Delivered', 'Issue', 'Late', 'Archived'];\n        const index = parseInt(e.key, 10) - 1;\n        if (index >= 0 && index < tabMap.length) {\n          setCurrentFilter(tabMap[index]);\n          e.preventDefault();\n          return;\n        }\n      }\n\n      // --- Help overlay --- (Restored)\n      if (e.key === '?') {\n        setIsHelpModalOpen(true);\n        e.preventDefault();\n        return;\n      }\n\n      // --- Row navigation and actions --- (Restored)\n      if (filteredItems.length > 0) {\n        if (e.key === 'Arrow Down') {\n          setSelectedRowIndex(idx => Math.min(filteredItems.length - 1, idx < 0 ? 0 : idx + 1));\n          e.preventDefault();\n          return;\n        }\n        if (e.key === 'Arrow Up') {\n          setSelectedRowIndex(idx => Math.max(0, idx - 1));\n          e.preventDefault();\n          return;\n        }\n        // Use 'Enter' or 'o' to open details (Restored)\n        if (e.key === 'Enter' || e.key === 'o') {\n          if (selectedRowIndex >= 0 && selectedRowIndex < filteredItems.length) {\n            setSelectedItemDetails(filteredItems[selectedRowIndex]);\n            e.preventDefault();\n            return;\n          }\n        }\n        // Use 'e' to edit (Restored)\n        if (e.key === 'e') {\n           if (selectedRowIndex >= 0 && selectedRowIndex < filteredItems.length) {\n             const itemToEdit = filteredItems[selectedRowIndex];\n             setEditingItem(itemToEdit); // Set the item to be edited\n             setIsAddItemModalOpen(true); // Open the modal (assuming it handles edits)\n             e.preventDefault();\n             return;\n           }\n         }\n        // Use 'r' to report issue (Restored)\n        if (e.key === 'r') {\n          if (selectedRowIndex >= 0 && selectedRowIndex < filteredItems.length) {\n            setReportingIssueItem(filteredItems[selectedRowIndex]);\n            e.preventDefault();\n            return;\n          }\n        }\n        // Use 'l' to toggle flag (Restored)\n        if (e.key === 'l') {\n          if (selectedRowIndex >= 0 && selectedRowIndex < filteredItems.length) {\n            const item = filteredItems[selectedRowIndex];\n            handleItemAction(item.id, item.isFlagged ? { id: 'Unflag Item', label: 'Unflag', description: 'Remove the flag from this item' } : { id: 'Flag Item', label: 'Flag', description: 'Flag this item for attention' });\n            e.preventDefault();\n            return;\n          }\n        }\n      }\n\n      // --- Other general shortcuts --- (Restored)\n      switch (e.key) {\n        case '/':\n          e.preventDefault(); // Prevent typing '/' in the search bar itself\n          searchInputRef.current?.focus();\n          break;\n        case 'a':\n        case 'A':\n          // Prevent opening add modal if editing\n          if (!editingItem) {\n             handleAddItem();\n          }\n          break;\n        case 'c':\n        case 'C':\n          setIsSettingsModalOpen(true);\n          break;\n        // 'f'/'F' toggle flag filter handled separately now if needed\n        // case 'f':\n        // case 'F':\n        //   setShowFlaggedOnly(v => !v); // Or use handleItemAction if 'l' is preferred\n        //   break;\n        default:\n          break;\n      }\n    }; // End of handleKeyDown function definition\n\n    // Add event listener when component mounts\n    document.addEventListener('keydown', handleKeyDown);\n\n    // Cleanup function to remove event listener when component unmounts\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n\n  }, [\n    // Dependencies: include all state and props used inside the effect\n    isAddItemModalOpen, isSettingsModalOpen, selectedItemDetails,\n    reportingIssueItem, addingUpdateItem, resolvingIssueItem, isHelpModalOpen, isUserActivityViewOpen,\n    filteredItems, selectedRowIndex, editingItem, \n    // Include functions called from within the effect if they aren't stable (use useCallback)\n    handleItemAction, setCurrentFilter, handleAddItem\n  ]);\n\n  // Handler for saving a general note\n  const handleSaveNote = useCallback(async (itemId: string, note: string) => {\n    if (!user?.uid) {\n      console.error('User ID is missing, cannot save note.');\n      setError('User ID is missing, cannot save note.');\n      return;\n    }\n    console.log(`Saving general note for item ${itemId}: ${note}`);\n    try {\n      // Create a NOTE_ADDED event\n      const event = createActivityEvent(user.uid, 'NOTE_ADDED', { note });\n      \n      // Call updateItemAndLog with an empty update object, as we're only adding to the log\n      // NOTE: updateItemAndLog currently requires an update object. \n      // If we want to *only* log without updating fields, we might need to adjust it\n      // or call logAction directly. For now, sending an empty update is harmless.\n      await updateItemAndLog(itemId, user.uid, {}, event);\n      \n      console.log(`General note saved and logged for item ${itemId}`);\n      setItemForNote(null); // Close the modal by clearing the item context\n    } catch (e) {\n      console.error(`Error saving general note for item ${itemId}:`, e);\n      setError(`Failed to save note: ${(e as Error).message}`);\n    }\n  }, [user?.uid, updateItemAndLog]);\n\n  // State for managing the action menu\n  const [openMenuId, setOpenMenuId] = useState<string | null>(null);\n  const [menuAnchorEl, setMenuAnchorEl] = useState<null | HTMLElement>(null);\n\n  // Handlers for the action menu\n  const handleMenuOpen = (event: React.MouseEvent<HTMLElement>, itemId: string) => {\n    setMenuAnchorEl(event.currentTarget);\n    setOpenMenuId(itemId);\n  };\n\n  const handleMenuClose = () => {\n    setMenuAnchorEl(null);\n    setOpenMenuId(null);\n  };\n\n  // Function to render cell content as MUI TableCell\n  const renderCellContent = (item: StockItem, columnId: keyof StockItem | 'actions' | 'isFlagged', handleActionClick: (event: React.MouseEvent<HTMLElement>) => void) => {\n    const value = item[columnId as keyof StockItem];\n    const textOverflowStyle = {\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      whiteSpace: 'nowrap',\n      display: 'block', // Needed for Tooltip and overflow to work correctly\n    };\n\n    const wrapWithTooltip = (content: React.ReactNode, fullValue: string | number | undefined | null) => (\n      <Tooltip title={String(fullValue ?? '')} placement=\"bottom-start\" enterDelay={500}>\n        <Box component=\"span\" sx={textOverflowStyle}>\n          {content}\n        </Box>\n      </Tooltip>\n    );\n\n    if (columnId === 'actions') {\n      return (\n        <IconButton\n          aria-label=\"actions\"\n          size=\"small\"\n          onClick={handleActionClick}\n        >\n          <MoreVertIcon fontSize=\"inherit\" />\n        </IconButton>\n      );\n    } else if (columnId === 'currentStatus') {\n      return (\n        <Typography variant=\"body2\" sx={{ fontWeight: 'medium', whiteSpace: 'nowrap' }}>\n          {item.currentStatus}\n        </Typography>\n      );\n    } else if (columnId === 'isFlagged') {\n      return item.isFlagged ? <FlagIcon color=\"error\" fontSize=\"small\" /> : null;\n    }\n\n    let content: React.ReactNode;\n    if (columnId === 'orderDate' && value) {\n      try {\n        content = new Date(value as string).toLocaleDateString();\n      } catch (e) {\n        content = String(value ?? '-'); // Fallback to string if parsing fails\n      }\n    } else if (columnId === 'pricePerItem' && typeof value === 'number') {\n      content = value.toFixed(2); // Format price to 2 decimal places\n    } else {\n      content = value === undefined || value === null || value === '' ? '-' : String(value);\n    }\n\n    const columnsNeedingTooltip = ['seller', 'deliveryName', 'productName', 'acquisitionNotes', 'asinSku', 'orderNumber', 'destination'];\n    if (columnsNeedingTooltip.includes(columnId)) {\n      return wrapWithTooltip(content, value);\n    }\n\n    return <Box component=\"span\" sx={{ whiteSpace: 'nowrap' }}>{content}</Box>;\n  };\n\n  // --- Drag and Drop Sensors Setup ---\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  );\n\n  // Define background colors based on item status for row highlighting\n  const statusColors: Record<ItemStatus, string> = {\n    // Keys must exactly match the ItemStatus type definition\n    \"Pending Delivery\": '#fffde7', // Light yellow\n    \"Delivered\": '#e3f2fd',        // Light blue (Use for delivered)\n    \"Issue\": '#ffebee',            // Light red (Use for issue)\n    \"Late\": '#fff3e0',             // Light orange/amber (Use for late)\n    \"Archived\": '#f5f5f5',        // Light grey\n  };\n\n  // --- Placeholder Components (Restored) ---\n  const SearchBar = ({ onSearch, inputRef }: { onSearch: (term: string) => void, inputRef?: React.RefObject<HTMLInputElement | null> }) => (\n    <TextField\n      inputRef={inputRef} // Pass the ref\n      fullWidth // Take up available width\n      variant=\"outlined\" // Standard MUI style\n      placeholder=\"Search by Delivery Name, Product Name, Seller, or ASIN/SKU...\"\n      onChange={e => onSearch(e.target.value)}\n      size=\"small\" // Make search bar compact\n      sx={{ mr: 2, flexGrow: 1 }} // Add margin-right and allow flexible growth\n    />\n  );\n\n  const FilterTabs = ({ currentFilter, onFilterChange }: { currentFilter: ItemStatus | 'All'; onFilterChange: (filter: ItemStatus | 'All') => void }) => {\n    const filters: (ItemStatus | 'All')[] = ['All', 'Pending Delivery', 'Delivered', 'Issue', 'Archived'];\n\n    const handleChange = (event: React.SyntheticEvent, newValue: ItemStatus | 'All') => {\n      onFilterChange(newValue);\n    };\n\n    return (\n      <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 2 }}>\n        <Tabs\n          value={currentFilter}\n          onChange={handleChange}\n          variant=\"scrollable\"\n          scrollButtons=\"auto\"\n          aria-label=\"Stock item status filter tabs\"\n        >\n          {filters.map(filter => (\n            <Tab key={filter} label={filter} value={filter} />\n          ))}\n        </Tabs>\n      </Box>\n    );\n  };\n\n  return (\n    <Box sx={{ display: 'flex', flexDirection: 'column', height: '100vh', p: 3 }}> {/* Main flex container */}\n      {/* Top Bar */} \n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2, flexShrink: 0 }}>\n        <h2>Incoming Stock Tool</h2>\n        <div>\n          {/* Add Item Button (Moved Here) */} \n          <Button variant=\"contained\" startIcon={<AddIcon />} onClick={handleAddItem} sx={{ mr: 1 }}> \n            Add Item\n          </Button>\n          {/* Add button to open User Activity View */} \n          <Button variant=\"outlined\" onClick={() => setIsUserActivityViewOpen(true)} sx={{ mr: 1 }}>Activity</Button> {/* Shorten Label */} \n          <Button variant=\"outlined\" onClick={() => setIsSettingsModalOpen(true)} startIcon={<Settings />}>Settings</Button> {/* Shorten Label */} \n        </div>\n      </Box>\n\n      {/* Error/Loading Messages */} \n      {error && <Alert severity=\"error\" onClose={() => setError(null)} sx={{ mb: 2, flexShrink: 0 }}>{error}</Alert>}\n      {loading && <LinearProgress sx={{ mb: 2, flexShrink: 0 }} />} \n \n      {/* Search and Flag Toggle Controls */} \n      <Box sx={{ display: 'flex', alignItems: 'center', mb: 1, flexShrink: 0 }}> {/* Reduced bottom margin */} \n        <SearchBar onSearch={handleSearch} inputRef={searchInputRef} />\n        <FlagToggle isChecked={showFlaggedOnly} onChange={setShowFlaggedOnly} />\n      </Box>\n\n      {/* Filter Tabs (Now on its own line) */} \n      <Box sx={{ flexShrink: 0, mb: 2 }}> {/* Ensure tabs don't shrink and add margin */} \n        <FilterTabs currentFilter={currentFilter} onFilterChange={handleFilterChange} />\n      </Box>\n\n      {/* Stock List Display */} \n      <DndContext\n        sensors={sensors}\n        collisionDetection={closestCenter}\n        onDragEnd={handleColumnDragEnd} // Use ToolApp handler\n        modifiers={[restrictToHorizontalAxis]}\n      >\n        {/* Table container grows to fill space */} \n        <TableContainer component={Paper} sx={{ flexGrow: 1, overflow: 'auto' }}>\n          <Table stickyHeader sx={{ minWidth: 650 }} aria-label=\"stock processing table\" size=\"small\">\n            <SortableContext items={visibleColumns.map(c => c.id)} strategy={horizontalListSortingStrategy}>\n              <TableHead>\n                <TableRow>\n                  {visibleColumns.map(column => (\n                    <DraggableHeader key={column.id} column={column} />\n                  ))}\n                </TableRow>\n              </TableHead>\n            </SortableContext>\n            <TableBody>\n              {/* Ensure mapping over filteredAndSortedItems */} \n              {filteredItems.length > 0 ? filteredItems.map((item, idx) => {\n                const isSelected = idx === selectedRowIndex;\n                return (\n                  <TableRow \n                    key={item.id}\n                    hover\n                    onClick={() => handleViewDetails(item.id)}\n                    selected={isSelected}\n                    sx={{\n                      cursor: 'pointer',\n                      backgroundColor: statusColors[item.currentStatus] || 'inherit',\n                      '&:hover': { backgroundColor: '#e0e0e0' }, // Darker hover for better contrast with dense table\n                      // Match header widths for consistency, including text overflow style\n                      '& .MuiTableCell-root': {\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                      }\n                    }}\n                  >\n                    {visibleColumns.map((col) => {\n                      // Determine alignment based on column ID (similar to header)\n                      const isNumeric = ['quantity', 'pricePerItem'].includes(col.id);\n                      return (\n                        <TableCell \n                          key={col.id} \n                          align={isNumeric ? 'right' : 'left'} \n                          // Optionally add padding overrides if needed, but rely on size='small'\n                        >\n                          {/* Call renderCellContent, passing the correct action handler */}\n                          {renderCellContent(\n                            item, \n                            col.id as keyof StockItem, \n                            // Pass inline function calling handleMenuOpen with item.id captured from closure\n                            (event) => handleMenuOpen(event, item.id) \n                          )} \n                        </TableCell>\n                      );\n                    })}\n                  </TableRow>\n                );\n              }) : (\n                <TableRow>\n                  <TableCell colSpan={visibleColumns.length} align=\"center\" sx={{ py: 3 }}>\n                    No items match the current filter or none loaded yet.\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </TableContainer>\n      </DndContext>\n      \n      {/* Render Add/Edit Item Form Modal */}\n      {isAddItemModalOpen && (\n        <AddItemForm \n          onSave={handleSaveItem} // Use combined save handler\n          onClose={handleCloseFormModal} // Use combined close handler\n          initialData={editingItem} // Pass item to edit (null if adding)\n        />\n      )}\n\n      {/* Render Item Details Modal */}\n      {selectedItemDetails && (\n        <ItemDetailModal \n          item={selectedItemDetails} \n          orgId={org.id} \n          onClose={handleCloseDetailModal} \n          onActionSelected={handleItemAction}\n        />\n      )}\n\n      {/* New Modals for Issue Handling */}\n      {reportingIssueItem && (\n        <ReportIssueModal \n          item={reportingIssueItem} // Pass the item\n          onSubmit={handleSaveReportIssue} \n          onClose={() => setReportingIssueItem(null)} \n        />\n      )}\n      {addingUpdateItem && (\n        <AddUpdateModal \n          item={addingUpdateItem} // Pass the item context\n          onSubmit={handleSaveIssueUpdate} \n          onClose={() => setAddingUpdateItem(null)} \n        />\n      )}\n      {resolvingIssueItem && (\n        <ResolveIssueModal \n          item={resolvingIssueItem} // Pass the item\n          onSubmit={handleSaveResolveIssue} \n          onClose={() => setResolvingIssueItem(null)} \n        />\n      )}\n      {itemForNote && (\n        <AddUpdateModal \n          item={itemForNote} // Pass the item context\n          onSubmit={(note) => handleSaveNote(itemForNote.id, note)} // Pass the specific item ID and note to the correct handler\n          onClose={() => setItemForNote(null)} // Close by clearing item context\n        />\n      )}\n\n      {/* Render Table Settings Modal */}\n      <TableSettingsModal\n        isOpen={isSettingsModalOpen}\n        onClose={() => setIsSettingsModalOpen(false)}\n        allColumns={ALL_COLUMNS}\n        initialVisibleColumns={visibleColumns} // Pass current derived configs\n        onSave={handleSaveColumnSettings} // Handler updates visibleColumnIds state\n      />\n      {/* Render User Activity View Modal */}\n      {isUserActivityViewOpen && org?.id && (\n        <UserActivityView\n          orgId={org.id}\n          onClose={() => setIsUserActivityViewOpen(false)}\n          onEntityClick={handleViewDetails}\n          onActionSelected={handleItemAction}\n        />\n      )}\n      {/* Render Help Modal */}\n      {isHelpModalOpen && <HelpModal onClose={() => setIsHelpModalOpen(false)} />}\n      \n      {/* Action Menu controlled by ToolApp state */}\n      <ActionMenu\n        itemId={openMenuId || ''}\n        // Ensure correct item source for actions\n        actions={openMenuId ? getAvailableActions(filteredItems.find(i => i.id === openMenuId)?.currentStatus ?? 'Pending Delivery', filteredItems.find(i => i.id === openMenuId)?.isFlagged ?? false) : []}\n        onActionSelected={handleItemAction} // Use ToolApp handler\n        onClose={handleMenuClose} // Use ToolApp handler\n        anchorEl={menuAnchorEl}\n        open={Boolean(openMenuId)}\n      />\n    </Box>\n  );\n}\n\nexport default ToolApp;","import React, { useState } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, TextField, Typography\n} from '@mui/material';\nimport { StockItem } from './types'; // Import StockItem if needed for context\n\ninterface ReportIssueModalProps {\n  item: StockItem; // Pass the item for context\n  onSubmit: (description: string) => void;\n  onClose: () => void;\n}\n\nconst ReportIssueModal: React.FC<ReportIssueModalProps> = ({ item, onSubmit, onClose }) => {\n  const [description, setDescription] = useState('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = () => {\n    if (!description.trim()) {\n      setError('Please enter a description of the issue.');\n      return;\n    }\n    onSubmit(description);\n    onClose(); // Close modal after successful submission\n  };\n\n  return (\n    <Dialog open={true} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Report Issue for:</Typography>\n        <Typography variant=\"body2\" color=\"textSecondary\" sx={{ fontStyle: 'italic' }}>\n          {item.productName} - {item.deliveryName}\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        <TextField\n          autoFocus\n          margin=\"dense\"\n          id=\"issueDescription\"\n          label=\"Describe the Issue *\"\n          type=\"text\"\n          fullWidth\n          multiline\n          rows={4}\n          variant=\"outlined\"\n          value={description}\n          onChange={(e) => {\n            setDescription(e.target.value);\n            if (error) setError(''); // Clear error on type\n          }}\n          error={!!error}\n          helperText={error || 'Please provide details about the problem.'}\n        />\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmit} variant=\"contained\" color=\"primary\">\n          Save Issue Report\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ReportIssueModal;","import React, { useState, useEffect, Fragment } from 'react';\nimport { \n  getFirestore, collection, query, where, orderBy, limit, onSnapshot, Timestamp, \n  getDocs, QuerySnapshot, QueryDocumentSnapshot, FirestoreError \n} from 'firebase/firestore';\nimport { \n  Dialog, DialogTitle, DialogContent, DialogActions, \n  Button, Typography, Box, CircularProgress, List, ListItem, ListItemText, Divider \n} from '@mui/material';\nimport { LogActionData, ActionDefinition } from './types'; \n\ninterface UserActivityViewProps {\n  orgId: string;\n  onClose: () => void;\n  onEntityClick: (itemId: string) => void;\n  onActionSelected: (itemId: string, action: ActionDefinition) => void; \n}\n\nconst getActionDescription = (log: LogActionData): string => {\n  switch (log.action) {\n    case 'item.create':\n      return 'Item created';\n    case 'item.update.fields': {\n      if (log.before && log.after) {\n        const fields = (log.details?.changedFields as string[] | undefined)\n          || Object.keys(log.after).filter(k => JSON.stringify(log.before?.[k]) !== JSON.stringify(log.after?.[k]));\n        if (fields.length) {\n          const changes = fields.map(f => `${f}: ${log.before?.[f]}  ${log.after?.[f]}`);\n          return `Edited ${changes.join(', ')}`;\n        }\n      }\n      const simple = (log.details?.changedFields as string[] | undefined)?.join(', ');\n      return simple ? `Edited fields: ${simple}` : 'Item edited';\n    }\n    default:\n      if (log.action.startsWith('item.update.status.')) {\n        const oldStat = log.details?.previousStatus || (log.before?.currentStatus as string) || 'Unknown';\n        const newStat = log.details?.newStatus || log.action.replace('item.update.status.', '');\n        return `Status changed: ${oldStat}  ${newStat}`;\n      }\n      if (log.action === 'item.update.flag') {\n        const flagged = log.details?.isFlagged;\n        return flagged ? 'Item flagged' : 'Item unflagged';\n      }\n      if (log.action === 'item.update.issue.report') {\n        return `Issue reported: ${log.details?.description || log.details?.issueDescription || ''}`;\n      }\n      if (log.action === 'item.update.issue.update') {\n        return `Issue update added: ${log.details?.note || ''}`;\n      }\n      if (log.action === 'item.update.issue.resolve') {\n        return `Issue resolved: ${log.details?.resolutionOutcome || ''}`;\n      }\n      if (log.action === 'item.add_note') {\n        return `Note added: ${log.details?.note || ''}`;\n      }\n      return log.action;\n  }\n};\n\nconst UserActivityView: React.FC<UserActivityViewProps> = ({ orgId, onClose, onEntityClick, onActionSelected }) => {\n  const [logs, setLogs] = useState<LogActionData[]>([]);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [error, setError] = useState<string | null>(null);\n  const [members, setMembers] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    if (!orgId) return;\n    const db = getFirestore();\n    const membersRef = collection(db, `orgs/${orgId}/members`);\n    getDocs(membersRef)\n      .then((snapshot: QuerySnapshot) => {\n        const map: Record<string, string> = {};\n        snapshot.docs.forEach((doc: QueryDocumentSnapshot) => {\n          const data: any = doc.data();\n          map[doc.id] = data.email || doc.id;\n        });\n        setMembers(map);\n      })\n      .catch((err: FirestoreError) => console.error('Error fetching members:', err));\n  }, [orgId, setMembers]);\n\n  useEffect(() => {\n    if (!orgId) {\n      setError('Organization ID is required.');\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    const db = getFirestore();\n    const logsRef = collection(db, `orgs/${orgId}/logs`);\n    const q = query(\n      logsRef,\n      where('tool', '==', 'incomingtool'),\n      orderBy('ts', 'desc'),\n      limit(100)\n    );\n\n    const unsubscribe = onSnapshot(q, (snapshot: QuerySnapshot) => {\n      const fetchedLogs = snapshot.docs.map(doc => {\n        const d = doc.data() as any;\n        return {\n          orgId,\n          toolKey: d.toolKey || d.tool,\n          action: d.action,\n          entityPath: d.entityPath,\n          timestamp: d.timestamp || d.ts,\n          userId: d.userId || d.uid,\n          userEmail: d.email, \n          before: d.before,\n          after: d.after,\n          details: d.details,\n        } as LogActionData;\n      });\n      const relevantLogs = fetchedLogs.filter(log => log.action !== 'app-loaded');\n      setLogs(relevantLogs);\n      setLoading(false);\n    }, (err) => {\n      console.error(\"Error fetching user activity logs: \", err); \n      const firestoreError = err as FirestoreError; \n      setError(`Failed to load activity logs: ${firestoreError.message}`);\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [orgId, setLogs]);\n\n  const renderLogEntryContent = (log: LogActionData) => {\n    const time = log.timestamp instanceof Timestamp\n      ? log.timestamp.toDate().toLocaleString()\n      : typeof log.timestamp === 'string'\n      ? new Date(log.timestamp).toLocaleString()\n      : 'Invalid Date';\n    const user = log.userEmail || members[log.userId || ''] || log.userId || 'system';\n    const actionDesc = getActionDescription(log);\n    const parts = log.entityPath.split('/');\n    const entityId = parts.length >= 2 ? parts[1] : '';\n    const qty = log.before?.quantity;\n    const name = log.before?.productName as string | undefined;\n    const entityLabel = qty && name\n      ? `${qty}x ${name}`\n      : ((log.before?.deliveryName as string) || name || entityId);\n\n    return (\n      <ListItemText\n        primary={\n          <Fragment>\n            <Typography sx={{ display: 'inline' }} component=\"span\" variant=\"body2\" color=\"text.primary\">\n              {time} - {actionDesc} by {user}\n            </Typography>\n            <Typography \n              component=\"span\" \n              variant=\"body2\" \n              onClick={() => onEntityClick(entityId)}\n              sx={{ ml: 1, cursor: 'pointer', color: 'primary.main', textDecoration: 'underline' }}\n            >\n              {entityLabel}\n            </Typography>\n          </Fragment>\n        }\n      />\n    );\n  };\n\n  return (\n    <Dialog open={true} onClose={onClose} maxWidth=\"md\" fullWidth scroll=\"paper\">\n      <DialogTitle>\n        <Typography variant=\"h6\">User Activity Log</Typography>\n        <Typography variant=\"caption\">Last 100 entries</Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        {loading && (\n          <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '200px' }}> \n            <CircularProgress />\n          </Box>\n        )}\n        {error && (\n          <Typography color=\"error\" sx={{ textAlign: 'center', mt: 2 }}>\n            {error}\n          </Typography>\n        )}\n        {!loading && !error && (\n          <List dense sx={{ width: '100%', bgcolor: 'background.paper', p: 0 }}> \n            {logs.length === 0 ? (\n              <ListItem>\n                <ListItemText primary=\"No activity logs found.\" />\n              </ListItem>\n            ) : (\n              logs.map((log, index) => (\n                <Fragment key={`${log.timestamp}-${index}-${log.action}`}> \n                  <ListItem alignItems=\"flex-start\" sx={{ py: 1.5 }}> \n                    {renderLogEntryContent(log)}\n                  </ListItem>\n                  {index < logs.length - 1 && <Divider variant=\"inset\" component=\"li\" />} \n                </Fragment>\n              ))\n            )}\n          </List>\n        )}\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"primary\">\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default UserActivityView;\n","import React, { useState, useEffect } from 'react';\nimport {\n  Dialog, DialogTitle, DialogContent, DialogActions,\n  Button, Typography, FormGroup, FormControlLabel, Checkbox, Box\n} from '@mui/material';\nimport { ColumnConfig } from './ToolApp'; // Import ColumnConfig from ToolApp\n\ninterface TableSettingsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  allColumns: ColumnConfig[];\n  initialVisibleColumns: ColumnConfig[];\n  onSave: (newVisibleColumnIds: Array<ColumnConfig['id']>) => void;\n}\n\n// --- Main Modal Component ---\nconst TableSettingsModal: React.FC<TableSettingsModalProps> = ({\n  isOpen,\n  onClose,\n  allColumns,\n  initialVisibleColumns,\n  onSave\n}) => {\n  // State to track checked status of each column ID\n  const [checkedState, setCheckedState] = useState<Record<ColumnConfig['id'], boolean>>(() =>\n    // Initialize state using Object.fromEntries for correct typing\n    Object.fromEntries(\n        allColumns.map(col => [col.id, false])\n    ) as Record<ColumnConfig['id'], boolean>\n  );\n\n  // Initialize or update checked state when modal opens or initialVisibleColumns change\n  useEffect(() => {\n    if (isOpen) {\n        const visibleIds = new Set(initialVisibleColumns.map(col => col.id));\n        // Create the updated state object directly using Object.fromEntries\n        const updatedCheckedState = Object.fromEntries(\n            allColumns.map(col => [col.id, visibleIds.has(col.id)])\n        ) as Record<ColumnConfig['id'], boolean>;\n        setCheckedState(updatedCheckedState);\n    }\n  }, [isOpen, initialVisibleColumns, allColumns]);\n\n  const handleCheckboxChange = (columnId: ColumnConfig['id']) => {\n      setCheckedState(prevState => ({\n          ...prevState,\n          [columnId]: !prevState[columnId]\n      }));\n  };\n\n  const handleSaveChanges = () => {\n    // Filter all column IDs to get only the ones that are checked\n    const newVisibleColumnIds = allColumns\n        .map(col => col.id)\n        .filter(id => checkedState[id]);\n    onSave(newVisibleColumnIds); // Pass the array of visible IDs\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} maxWidth=\"xs\" fullWidth>\n      <DialogTitle>\n        <Typography variant=\"h6\">Configure Table Columns</Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        <Typography variant=\"body2\" gutterBottom>\n          Select the columns you want to display:\n        </Typography>\n        <Box sx={{ maxHeight: '60vh', overflowY: 'auto', pr: 1 }}> {/* Scrollable Box */}\n          <FormGroup>\n            {allColumns.map(col => (\n              <FormControlLabel\n                key={col.id}\n                control={\n                  <Checkbox\n                    checked={checkedState[col.id] || false}\n                    onChange={() => handleCheckboxChange(col.id)}\n                    disabled={col.id === 'actions'} // Optionally disable toggling\n                  />\n                }\n                label={col.label}\n              />\n            ))}\n          </FormGroup>\n        </Box>\n      </DialogContent>\n      <DialogActions sx={{ padding: '16px 24px' }}>\n        <Button onClick={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSaveChanges} variant=\"contained\" color=\"primary\">\n          Save Settings\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default TableSettingsModal;"],"names":["_ref","item","onSubmit","onClose","note","setNote","useState","error","setError","_jsxs","Dialog","open","maxWidth","fullWidth","children","DialogTitle","_jsx","Typography","variant","color","sx","fontStyle","productName","deliveryName","DialogContent","dividers","issueDescription","Box","mb","p","background","border","borderRadius","TextField","autoFocus","margin","id","label","type","multiline","rows","value","onChange","e","target","helperText","placeholder","DialogActions","padding","Button","onClick","handleSubmit","trim","RESOLUTION_OUTCOMES","outcome","setOutcome","FormControl","InputLabel","Select","labelId","MenuItem","disabled","map","opt","FormHelperText","undefined","onSave","initialData","firstInputRef","isEditing","purchaseStatus","setPurchaseStatus","setDeliveryName","setProductName","quantity","setQuantity","pricePerItem","setPricePerItem","orderNumber","setOrderNumber","orderDate","setOrderDate","Date","toISOString","split","seller","setSeller","isVatRegistered","setIsVatRegistered","destination","setDestination","asinSku","setAsinSku","acquisitionNotes","setAcquisitionNotes","isFlagged","setIsFlagged","errors","setErrors","useEffect","event","preventDefault","console","log","isValid","validateForm","newErrors","Object","keys","length","Number","component","noValidate","mt","inputRef","required","name","InputProps","endAdornment","Tooltip","title","IconButton","size","edge","InfoOutlinedIcon","fontSize","inputProps","min","step","InputLabelProps","shrink","select","includes","FormControlLabel","control","Checkbox","checked","display","alignItems","ml","form","formatValue","prefix","arguments","suffix","style","formatActivityEvent","_event$details$change","time","timestamp","toLocaleString","details","changedFields","join","previousStatus","newStatus","resolutionOutcome","mapLogToAction","_log$details","_log$before","_log$before2","_log$after","_log$details2","_log$details3","_log$details4","_log$details5","_log$details6","_log$details7","Timestamp","toDate","userId","action","before","after","filter","key","JSON","stringify","currentStatus","description","warn","orgId","closeButtonRef","onActionSelected","activityEvents","setActivityEvents","loadingLogs","setLoadingLogs","logError","setLogError","availableActions","getAvailableActions","db","getFirestore","entityPath","logsRef","collection","q","query","where","orderBy","unsubscribe","onSnapshot","snapshot","mappedEvents","docs","doc","data","message","scroll","borderBottom","borderColor","pb","gutterBottom","Stack","direction","spacing","flexWrap","List","dense","ListItem","ListItemText","primary","secondary","whiteSpace","dateDelivered","processorNotes","CircularProgress","Alert","severity","index","React","primaryTypographyProps","Divider","ref","removeUndefinedFields","obj","fromEntries","entries","_","v","createActivityEvent","status","actions","unshift","ActionMenu","_ref2","itemId","anchorEl","Menu","MenuListProps","handleSelectAction","ALL_COLUMNS","DEFAULT_VISIBLE_COLUMN_IDS","LOCAL_STORAGE_KEY_VISIBLE_COLUMNS","DraggableHeader","_ref3","column","attributes","listeners","setNodeRef","transform","transition","isDragging","useSortable","CSS","Transform","toString","opacity","touchAction","isNumeric","TableCell","scope","align","fontWeight","cursor","bgcolor","width","minWidth","FlagToggle","_ref5","isChecked","marginLeft","htmlFor","marginRight","height","HelpModal","_ref6","shortcut","firebaseConfig","apiKey","process","authDomain","projectId","storageBucket","messagingSenderId","appId","forEach","_ref7","Error","app","initializeApp","getAuth","_ref8","_filteredItems$find$c","_filteredItems$find","_filteredItems$find$i","_filteredItems$find2","user","org","permissions","logAction","logActionExists","selectedRowIndex","setSelectedRowIndex","isHelpModalOpen","setIsHelpModalOpen","allItems","setAllItems","loading","setLoading","searchTerm","setSearchTerm","currentFilter","setCurrentFilter","selectedItemDetails","setSelectedItemDetails","isAddItemModalOpen","setIsAddItemModalOpen","showFlaggedOnly","setShowFlaggedOnly","editingItem","setEditingItem","reportingIssueItem","setReportingIssueItem","addingUpdateItem","setAddingUpdateItem","resolvingIssueItem","setResolvingIssueItem","isSettingsModalOpen","setIsSettingsModalOpen","itemForNote","setItemForNote","isUserActivityViewOpen","setIsUserActivityViewOpen","visibleColumnIds","setVisibleColumnIds","stored","localStorage","getItem","parsed","parse","Array","isArray","setItem","visibleColumns","find","col","filteredItems","matchesSearch","toLowerCase","matchesFilter","sevenDaysAgo","setDate","getDate","isItemLate","matchesFlag","idx","unsub","items","docSnap","err","updateItemAndLog","useCallback","async","changes","itemRef","itemBefore","i","finalUpdates","lastUpdated","serverTimestamp","itemAfter","updateDoc","actionName","_event$details","_event$details$newSta","nameError","logData","toolKey","handleItemAction","newFlagState","uid","handleSaveReportIssue","handleSaveIssueUpdate","handleSaveResolveIssue","handleCloseFormModal","handleSaveItem","itemData","hasOwnProperty","push","editEvent","newItem","docRef","addDoc","handleCloseDetailModal","orgIdRef","useRef","current","handleAddItem","searchInputRef","handleViewDetails","handleKeyDown","_searchInputRef$curre","tag","tagName","isContentEditable","tabMap","parseInt","Math","max","itemToEdit","focus","document","addEventListener","removeEventListener","handleSaveNote","openMenuId","setOpenMenuId","menuAnchorEl","setMenuAnchorEl","renderCellContent","columnId","handleActionClick","textOverflowStyle","overflow","textOverflow","MoreVertIcon","FlagIcon","content","toLocaleDateString","String","toFixed","wrapWithTooltip","fullValue","placement","enterDelay","sensors","useSensors","useSensor","PointerSensor","KeyboardSensor","coordinateGetter","sortableKeyboardCoordinates","statusColors","SearchBar","_ref9","onSearch","mr","flexGrow","FilterTabs","_ref10","onFilterChange","Tabs","handleChange","newValue","scrollButtons","Tab","flexDirection","justifyContent","flexShrink","startIcon","AddIcon","Settings","LinearProgress","term","DndContext","collisionDetection","closestCenter","onDragEnd","active","over","currentIds","oldIndex","indexOf","newIndex","arrayMove","modifiers","restrictToHorizontalAxis","TableContainer","Paper","Table","stickyHeader","SortableContext","c","strategy","horizontalListSortingStrategy","TableHead","TableRow","TableBody","isSelected","hover","selected","backgroundColor","handleMenuOpen","currentTarget","colSpan","py","AddItemForm","ItemDetailModal","ReportIssueModal","AddUpdateModal","ResolveIssueModal","TableSettingsModal","isOpen","allColumns","initialVisibleColumns","idsFromModal","currentVisibleIds","modalIdSet","Set","has","UserActivityView","onEntityClick","handleMenuClose","Boolean","setDescription","logs","setLogs","members","setMembers","membersRef","getDocs","then","email","catch","limit","relevantLogs","d","tool","ts","userEmail","renderLogEntryContent","_log$before4","_log$before5","_log$before6","actionDesc","_log$details2$changed","fields","k","f","_log$after2","simple","_log$before3","_log$details8","_log$details9","_log$details10","startsWith","replace","getActionDescription","parts","entityId","qty","entityLabel","Fragment","textDecoration","minHeight","textAlign","checkedState","setCheckedState","visibleIds","updatedCheckedState","maxHeight","overflowY","pr","FormGroup","handleCheckboxChange","prevState","handleSaveChanges","newVisibleColumnIds"],"sourceRoot":""}